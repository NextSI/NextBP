define([],function(){return function(e){"use strict";var t=this;this.html_id=e,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.onselect=null,this.onclose=null,this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_selecionar=this.dialog.find(".btn_selecionar"),this.arvore_selecionar=this.dialog.find("#arvore_selecionar"),this.pasta_id=null,this.show=function(e,n){t.onselect=e,t.pasta_id=n,show_modal(t.modal.attr("id")),t.listar()},this.close=function(){close_modal(t.modal.attr("id")),void 0!==t.onclose&&t.onclose&&t.onclose()},this.unload=function(){t.close(),View.unload(this.html_id)},this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){t.unload()}),this.btn_selecionar.unbind("click"),this.btn_selecionar.click(function(){t.onselect&&(t.onselect(t.pasta_id),t.unload())}),this.listar=function(){if(void 0===t.arvore_selecionar.jstree)return!1;t.arvore_selecionar.jstree({plugins:["json_data","contextmenu","sort","types"],contextmenu:{items:{Selecionar:{label:"Selecionar",icon:"glyphicon glyphicon-ok",action:function(e){t.pasta_id=t.arvore_selecionar.jstree(!0).get_node(t.arvore_selecionar.jstree(!0).get_selected()).original.pasta_id,t.btn_selecionar.trigger("click")}},NovaPasta:{label:"Nova pasta",icon:"glyphicon glyphicon-plus-sign",action:function(e){View.load("central_documentos/pasta",function(n,o){var i=$(e.reference).jstree(!0).get_node($(e.reference).jstree(!0).get_selected()).original.title,s={id:$(e.reference).jstree(!0).get_node($(e.reference).jstree(!0).get_selected()).original.id,nome:i};o.show_modal(null,FORMULARIO.NOVO,s);o.onsave=function(){t.arvore_selecionar.jstree(!0).refresh()}},View.ABA.NAO)}}}},types:{default:{icon:"fa fa-folder"},"f-open":{icon:"fa fa-folder-open"},"f-closed":{icon:"fa fa-folder"}},core:{multiple:!1,check_callback:!0,data:function(e,t){var n="#"==e.id;WS.get("documento/listar_arvore_pastas/",{documento_pasta_id:n?null:e.original.pasta_id},function(e){t(e)})}}}).on("changed.jstree",function(e,n){n.selected.length>0&&(t.pasta_id=t.arvore_selecionar.jstree(!0).get_node(n.selected[0]).original.pasta_id,t.btn_selecionar.attr("disabled",!1))}),t.arvore_selecionar.unbind("hover_node.jstree").on("hover_node.jstree",function(e,t){$("#"+t.node.id).prop("title",t.node.text)}),t.arvore_selecionar.unbind("open_node.jstree").on("open_node.jstree",function(e,n){t.jstree_item&&n.node.id==t.jstree_item.node.id&&(t.jstree_item=n),n.instance.set_type(n.node,"f-open")}),t.arvore_selecionar.unbind("close_node.jstree").on("close_node.jstree",function(e,n){t.jstree_item&&n.node.id==t.jstree_item.node.id&&(t.jstree_item=n),n.instance.set_type(n.node,"f-closed")}),t.arvore_selecionar.unbind("select_node.jstree").on("select_node.jstree",function(e,n){var o=window.event||e,i=o.which||o.button;if(1!=i&&void 0!==i)return!1;t.jstree_item&&(t.jstree_item.node.state.opened||t.jstree_item.instance.set_type(t.jstree_item.node,"f-closed")),n.node.state.opened||(t.jstree_item=n,t.jstree_item.instance.set_type(t.jstree_item.node,"f-open"))})}}});