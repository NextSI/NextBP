define(["react","react-dom","./ListarAprovadores"],function(a,o,i){return function(r){"use strict";var e=this;this.html_id=r,this.dialog=$("#"+this.html_id),this.title="Pasta",this.tipo=null,this.onclose=null,this.ondelete=null,this.onsave=null,this.houve_alteracao=!1,this.opcional_modal=this.dialog.find(".opcional_modal"),this.opcional_modal_dialog=this.dialog.find(".opcional_modal_dialog"),this.opcional_modal_content=this.dialog.find(".opcional_modal_content"),this.opcional_modal_header=this.dialog.find(".opcional_modal_header"),this.opcional_modal_body=this.dialog.find(".opcional_modal_body"),this.lbl_tab_geral=this.dialog.find(".lbl_tab_geral"),this.menu_geral=this.dialog.find(".menu_geral"),this.painel_geral=this.dialog.find(".painel_geral"),this.lbl_tab_seguranca=this.dialog.find(".lbl_tab_seguranca"),this.menu_seguranca=this.dialog.find(".menu_seguranca"),this.painel_seguranca=this.dialog.find(".painel_seguranca"),this.lbl_tab_aprovacao=this.dialog.find(".lbl_tab_aprovacao"),this.menu_aprovacao=this.dialog.find(".menu_aprovacao"),this.painel_aprovacao=this.dialog.find(".painel_aprovacao"),this.lbl_tab_cliente=this.dialog.find(".lbl_tab_cliente"),this.menu_cliente=this.dialog.find(".menu_cliente"),this.painel_cliente=this.dialog.find(".painel_cliente"),this.lbl_tab_prospect=this.dialog.find(".lbl_tab_prospect"),this.menu_prospect=this.dialog.find(".menu_prospect"),this.painel_prospect=this.dialog.find(".painel_prospect"),this.lbl_tab_fornecedor=this.dialog.find(".lbl_tab_fornecedor"),this.menu_fornecedor=this.dialog.find(".menu_fornecedor"),this.painel_fornecedor=this.dialog.find(".painel_fornecedor"),this.lbl_tab_historico=this.dialog.find(".lbl_tab_historico"),this.menu_log=this.dialog.find(".menu_log"),this.painel_historico=this.dialog.find(".painel_historico"),this.grid_historico_documento=this.dialog.find("#grid_historico_documento"),this.lbl_tab_notificacao=this.dialog.find(".lbl_tab_notificacao"),this.menu_notificacao=this.dialog.find(".menu_notificacao"),this.painel_notificacao=this.dialog.find(".painel_notificacao"),this.edt_nome=this.dialog.find(".edt_nome"),this.edt_codigo=this.dialog.find(".edt_codigo"),this.edt_tags_padrao=this.dialog.find(".edt_tags_padrao"),this.info_tags_padrao=this.dialog.find(".info_tags_padrao"),this.cbo_assunto_padrao=this.dialog.find(".cbo_assunto_padrao"),this.info_assunto_padrao=this.dialog.find(".info_assunto_padrao"),this.btn_assunto_padrao_visualizar=this.dialog.find(".btn_assunto_padrao_visualizar"),this.cbo_tipo_documento_padrao=this.dialog.find(".cbo_tipo_documento_padrao"),this.info_tipo_documento_padrao=this.dialog.find(".info_tipo_documento_padrao"),this.btn_tipo_documento_padrao_visualizar=this.dialog.find(".btn_tipo_documento_padrao_visualizar"),this.div_ListarAprovadores=this.dialog.find(".listarAprovadores"),this.ListarAprovadores=a.createElement(i,null,null),this.div_cbo_aprovador=this.dialog.find(".div_cbo_aprovador"),this.cbo_aprovador=this.dialog.find(".cbo_aprovador"),this.panel_central_documentos_pasta=this.dialog.find(".panel_central_documentos_pasta"),this.content_central_documentos_pasta=this.dialog.find(".content_central_documentos_pasta"),this.chk_controle_acessos=this.dialog.find(".chk_controle_acessos"),this.dx_popup_validacao_permissoes_retroativas=this.dialog.find(".dx_popup_validacao_permissoes_retroativas"),this.chk_aprovacao=this.dialog.find(".chk_aprovacao"),this.chk_notificacoes=this.dialog.find(".chk_notificacoes"),this.chk_notificacao_outros_usuarios=this.dialog.find(".chk_notificacao_outros_usuarios"),this.chk_notificacao_seguranca=this.dialog.find(".chk_notificacao_seguranca"),this.chk_notificacao_aprovador=this.dialog.find(".chk_notificacao_aprovador"),this.tab_aprovacao=this.dialog.find(".tab_aprovacao"),this.tab_aprovacao_grupo=this.dialog.find(".tab_aprovacao_grupo"),this.tab_permissoes=this.dialog.find(".tab_permissoes"),this.tab_permissoes_grupo=this.dialog.find(".tab_permissoes_grupo"),this.tab_cliente=this.dialog.find(".tab_cliente"),this.tab_prospect=this.dialog.find(".tab_prospect"),this.tab_fornecedor=this.dialog.find(".tab_fornecedor"),this.tab_notificacao=this.dialog.find(".tab_notificacao"),this.div_permissoes=this.dialog.find(".div_permissoes"),this.div_aprovacao=this.dialog.find(".div_aprovacao"),this.div_emails_adicionais=this.dialog.find(".div_emails_adicionais"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.btn_excluir=this.dialog.find(".btn_excluir"),this.btn_add_usuario=this.dialog.find(".btn_add_usuario"),this.btn_add_grupo=this.dialog.find(".btn_add_grupo"),this.btn_add_fornecedor=this.dialog.find(".btn_add_fornecedor"),this.btn_add_prospect=this.dialog.find(".btn_add_prospect"),this.btn_add_cliente=this.dialog.find(".btn_add_cliente"),this.btn_favoritar_item=this.dialog.find(".btn_favoritar_item"),this.btn_add_usuario_aprovacao=this.dialog.find(".btn_add_usuario_aprovacao"),this.btn_add_grupo_aprovacao=this.dialog.find(".btn_add_grupo_aprovacao"),this.row_codigo=this.dialog.find(".row_codigo"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.div_tipo_aprovacao=this.dialog.find(".div_tipo_aprovacao"),this.cbo_tipo_aprovacao=this.dialog.find(".cbo_tipo_aprovacao"),this.cbo_selecionar_alcada=this.dialog.find(".cbo_selecionar_alcada"),this.div_cbo_selecionar_alcada=this.dialog.find(".div_cbo_selecionar_alcada"),this.div_edt_prazo_dias=this.dialog.find(".div_edt_prazo_dias"),this.edt_prazo_dias=this.dialog.find(".edt_prazo_dias"),this.grupos_aprovacao=new Object,this.grupos_array_aprovacao=new Array,this.usuarios_aprovacao=new Object,this.usuarios_array_aprovacao=new Array,this.grupos=new Object,this.grupos_array=new Array,this.usuarios={automatic:!1,sug_automatic:!1,add_self:!1},this.usuarios_array=new Array,this.usuarios_aplicar_permissoes_retroativas=[],this.grupos_usuarios_aplicar_permissoes_retroativas=[],this.array_cliente=new Array,this.array_prospect=new Array,this.array_fornecedor=new Array,this.valor=null,this.documento_pasta_id=null,this.predecessor_id=null,this.permite_alterar_seguranca=!1,this.pasta_notificacao=null,this.usuario_historico=null,this.acao_historico=null,this.tipo_aprovacao,this.alcada_generica_id=null,this.usuario_permissao_escrita=null,this.limite=0,this.limite_quantidade=50,this.todos_carregados=!1,this.tab_email_usuarios={tabela:this.dialog.find(".tab_email_usuarios"),header:this.dialog.find(".tab_email_usuarios_header"),input:this.dialog.find(".tab_email_usuarios_header thead .edt_emails"),btn_add:this.dialog.find(".tab_email_usuarios_header thead .btn_add_email"),bp_drop:this.dialog.find(".tab_email_usuarios_header thead .bp_div_drop > ul"),create_row:function(a){var o=$(this.tabela).find("[template-row]").clone();return o.removeAttr("template-row").removeClass("hidden"),o.find(".lbl_email").text(a),o.appendTo(this.tabela.find("tbody")),o},getColumn:function(a,o){return $(a).find("."+o)},elem_key:0,arr_dados:[],add_email:function(a,o){var i,r,e=this.arr_dados;if(i=a.email,r=!1,e.filter(function(a){a.email==i&&(r=!0)}),!(!r&&a.email.trim().length>0&&validateEmail(a.email)))return validateEmail(a.email)?void(void 0!==o&&null!=o&&o(!1)):void alert_modal("Alerta","O e-mail inserido está inválido.");e.push({elem_key:a.elem_key,email:a.email}),void 0!==o&&null!=o&&o(!0)},remove_email:function(a,o){var i=this.arr_dados;i.filter(function(o,r){o.elem_key==a&&i.splice(r,1)})},reset:function(){$(this.tabela).find("tbody").find("tr:not([template-row])").remove(),this.elem_key=0,this.arr_dados=[]}},this.show_modal=function(a,o,i){e.opcional_modal.addClass("modal bs-example-modal-lg"),e.opcional_modal.attr("tabindex","-1"),e.opcional_modal.attr("role","dialog"),e.opcional_modal_dialog.addClass("modal-dialog modal-lg"),e.opcional_modal_content.addClass("modal-content"),e.opcional_modal_header.addClass("modal-header"),e.opcional_modal_header.show(),e.opcional_modal_body.addClass("modal-body"),e.btn_cancelar.show(),e.modal=this.dialog.find(".modal"),e.modal.attr("id",this.html_id+"_modal"),show_modal(e.modal.attr("id")),e.show(a,o,i)},this.show=function(a,o,i){verifica_favorito("pastas",a)&&e.btn_favoritar_item.find("span").addClass("glyphicon-star").removeClass("glyphicon-star-empty"),e.painel_geral.attr("id","painel_geral"+e.html_id),e.painel_seguranca.attr("id","painel_seguranca"+e.html_id),e.painel_aprovacao.attr("id","painel_aprovacao"+e.html_id),e.painel_cliente.attr("id","painel_cliente"+e.html_id),e.painel_prospect.attr("id","painel_prospect"+e.html_id),e.painel_fornecedor.attr("id","painel_fornecedor"+e.html_id),e.painel_historico.attr("id","painel_historico"+e.html_id),e.painel_notificacao.attr("id","painel_notificacao"+e.html_id),e.menu_geral.attr("href","#"+e.painel_geral.attr("id")),e.menu_seguranca.attr("href","#"+e.painel_seguranca.attr("id")),e.menu_aprovacao.attr("href","#"+e.painel_aprovacao.attr("id")),e.menu_cliente.attr("href","#"+e.painel_cliente.attr("id")),e.menu_prospect.attr("href","#"+e.painel_prospect.attr("id")),e.menu_fornecedor.attr("href","#"+e.painel_fornecedor.attr("id")),e.menu_log.attr("href","#"+e.painel_historico.attr("id")),e.menu_notificacao.attr("href","#"+e.painel_notificacao.attr("id")),e.tipo=o,void 0!==i&&i&&(e.predecessor_id=i.id),create_combobox(e.cbo_aprovador,e.listar_grupos_usuarios),e.RenderAprovadores(),void 0!==a&&a?(e.documento_pasta_id=a,e.lbl_tab_seguranca.addClass("hidden"),e.preencher()):(App.titulo_aba(e.html_id,"Nova pasta"),e.listar_assunto(),e.listar_tipo_documento(),e.permite_alterar(),e.listar_seguranca_sugerida(i.id),e.chk_notificacoes.prop("checked",e.pasta_notificacao||!1).change()),WS.get("documento/get_parametros/",null,function(a){e.informar_codigo_documento_pasta="N"!=a.documentos_informar_codigo_documento_pasta,1==e.informar_codigo_documento_pasta&&e.row_codigo.removeClass("hidden")}),e.info_tags_padrao.tooltip({title:"As tags inseridas neste campo serão automaticamente sugeridas ao inserir um novo documento nesta pasta",placement:"right"}),e.info_tags_padrao.tooltip(),e.info_assunto_padrao.tooltip({title:"O Assunto inserido neste campo será automaticamente sugerido ao inserir um novo documento nesta pasta",placement:"right"}),e.info_assunto_padrao.tooltip(),e.info_tipo_documento_padrao.tooltip({title:"O Tipo de documento inserido neste campo será automaticamente sugerido ao inserir um novo documento nesta pasta",placement:"right"}),e.info_tipo_documento_padrao.tooltip()},this.unload=function(){e.close()},this.close=function(){void 0!==e.modal&&close_modal(e.modal.attr("id")),void 0!==e.onclose&&e.onclose&&e.onclose(e.houve_alteracao)},this.permite_alterar=function(){var a=!1;switch(e.tipo){case FORMULARIO.NOVO:e.btn_salvar.show(),e.btn_excluir.hide(),e.btn_cancelar.show(),a=!0,e.valor=!0,e.permite_alterar_seguranca=!0,e.btn_favoritar_item.hide();break;case FORMULARIO.EDITAR:e.btn_salvar.show(),e.btn_favoritar_item.show(),e.btn_cancelar.show(),e.btn_excluir.hide(),a=!0,e.valor=!0,e.permite_alterar_seguranca=!0;break;case FORMULARIO.VISUALIZAR:e.btn_salvar.hide(),e.btn_favoritar_item.hide(),e.btn_cancelar.show(),e.btn_excluir.hide(),a=!1,e.valor=!1,e.permite_alterar_seguranca=!1;break;case FORMULARIO.EXCLUIR:e.btn_salvar.hide(),e.btn_favoritar_item.hide(),e.btn_cancelar.show(),e.btn_excluir.show(),a=!1,e.valor=!1,e.permite_alterar_seguranca=!1}e.edt_nome.prop("readonly",!a),e.edt_codigo.prop("readonly",!a),e.edt_tags_padrao.prop("readonly",!a),e.cbo_assunto_padrao.prop("disabled",!a),e.cbo_tipo_documento_padrao.prop("disabled",!a),e.chk_controle_acessos.prop("disabled",!a),e.chk_aprovacao.prop("disabled",!a),e.btn_add_grupo.prop("disabled",!a),e.btn_add_usuario.prop("disabled",!a),(e.usuario_permissao_escrita||e.tipo==FORMULARIO.NOVO)&&(e.panel_central_documentos_pasta.css("opacity","1").css("cursor","auto"),e.content_central_documentos_pasta.css("pointer-events","auto"))},this.listar_assunto=function(a){e.cbo_assunto_padrao.find("option").remove(),add_option(e.cbo_assunto_padrao,"","Nenhum"),WS.get("assunto/listar/",null,function(o){for(var i=0;i<o.length;i++){var r=o[i];add_option(e.cbo_assunto_padrao,r.assunto_id,r.descricao)}a&&e.cbo_assunto_padrao.val(a).trigger("change")})},this.listar_tipo_documento=function(a){e.cbo_tipo_documento_padrao.find("option").remove(),add_option(e.cbo_tipo_documento_padrao,"","Nenhum"),WS.get("tipo_documento/listar/",null,function(o){for(var i=0;i<o.length;i++){var r=o[i];add_option(e.cbo_tipo_documento_padrao,r.tipo_documento_id,r.nome)}a&&e.cbo_tipo_documento_padrao.val(a).trigger("change")})},this.preencher=function(){WS.get("documento_pasta/objeto/",{documento_pasta_id:e.documento_pasta_id},function(a){if(App.titulo_aba(e.html_id,"Pasta "+a.nome),"S"==a.raiz&&(e.edt_nome.prop("disabled",!0),e.edt_codigo.prop("disabled",!0)),e.predecessor_id=a.predecessor_id,e.arr_historico=a.historico,e.render_historico(),e.limite=0,e.todos_carregados=!1,e.edt_nome.val(a.nome),e.edt_codigo.val(a.codigo),e.edt_tags_padrao.val(a.tags_padrao),e.listar_assunto(a.assunto_id),e.listar_tipo_documento(a.tipo_documento_id),e.cbo_tipo_aprovacao.val(a.tipo_aprovacao).trigger("change"),e.cbo_tipo_aprovacao.selectpicker("refresh"),null!=a.alcada_generica_id&&a.alcada_generica_id>0?e.alcada_generica_id=a.alcada_generica_id:e.alcada_generica_id=null,e.chk_aprovacao.prop("checked",a.aprovacao).change(),e.chk_notificacoes.prop("checked",a.notificar_por_email||!1).change(),e.chk_controle_acessos.prop("checked",a.controle_acessos).change(),(App.sessao.dados.admin||a.usuario_permissao_seguranca)&&e.lbl_tab_seguranca.removeClass("hidden"),e.usuario_permissao_escrita=a.usuario_permissao_escrita,e.permite_alterar(),App.sessao.dados.admin||"N"!=a.controle_acessos&&!1!==a.controle_acessos?e.usuarios_array=a.usuarios_permissoes:(e.usuarios=App.sessao.dados,e.usuarios.visualizacao=!0,e.usuarios.download=!0,e.usuarios.escrita=!0,e.usuarios.exclusao=!0,e.usuarios.manutencao_revisoes=!0,e.usuarios.nova_revisao=!0,e.usuarios.seguranca=!0,e.usuarios.sugestao=!0,e.usuarios.automatic=!0,e.usuarios_array.push(e.usuarios)),e.render_usuarios(),e.grupos_array=a.grupos_permissoes,e.render_grupos(),e.obter_validacao_permissoes_retroativas(),e.usuarios_array_aprovacao=a.usuarios_aprovacao,e.render_usuarios_aprovacao(),e.grupos_array_aprovacao=a.grupos_aprovacao,e.render_grupos_aprovacao(),e.array_cliente=a.cliente,e.render_cliente(),e.render_prospect(),e.array_prospect=a.prospect,e.render_fornecedor(),e.array_fornecedor=a.fornecedor,e.chk_notificacao_seguranca.prop("checked",a.notificar_por_controle_acesso).change(),e.chk_notificacao_aprovador.prop("checked",a.notificar_por_controle_aprovacao).change(),a.notificar_por_email&&a.notificar_emails.length>0){e.chk_notificacao_outros_usuarios.prop("checked",!0).trigger("click");for(var o=0;o<a.notificar_emails.length;o++){var i=a.notificar_emails[o];e.tab_email_usuarios.input.val(i),e.tab_email_usuarios.btn_add.trigger("click")}}e.edt_prazo_dias.val(a.prazo_dias)})},this.render_historico=function(){o.render(a.createElement(window.components.DocumentoHistorico.default,{documento_pasta_id:e.documento_pasta_id}),e.grid_historico_documento[0])},this.render_usuarios=function(){var a=e.tab_permissoes.find("tbody"),o=a.find("tr:first"),i=function(a,o,i){$(e.usuarios_array).each(function(r,s){s.usuario_id==i.usuario_id&&(e.usuarios=s,"visualizacao"==o?e.usuarios.visualizacao=a.prop("checked"):"download"==o?e.usuarios.download=a.prop("checked"):"exclusao"==o?e.usuarios.exclusao=a.prop("checked"):"escrita"==o?e.usuarios.escrita=a.prop("checked"):"manutencao_revisoes"==o?e.usuarios.manutencao_revisoes=a.prop("checked"):"nova_revisao"==o?e.usuarios.nova_revisao=a.prop("checked"):"seguranca"==o?e.usuarios.seguranca=a.prop("checked"):"sugestao"==o&&(e.usuarios.sugestao=a.prop("checked")),e.usuarios_array[r]=e.usuarios)})},r=function(r){var s=o.clone();s.removeAttr("template-row"),s.css("display","");var t=$(s.find(".btn_usuario_remover"));s.find(".lbl_nome").text(r.nome);var n=s.find(".img_alerta_permissao"),d=(a=>{if(!e.validacao_permissoes_retroativas||!e.validacao_permissoes_retroativas.usuario)return[];var o=e.validacao_permissoes_retroativas.usuario.filter(o=>o.usuario_id==a);return o.length>0&&Array.isArray(o[0].pastas)?o[0].pastas:[]})(r.usuario_id);d.length>0?(n.tooltip({title:"Sem permissão de acesso à(s) pasta(s) predecessora(s)."}),n.show(),n.on("click",()=>e.configurar_popup_validacao_permissoes_retroativas(r.nome,d,"U",r.usuario_id,e.usuarios_aplicar_permissoes_retroativas)),e.usuarios_aplicar_permissoes_retroativas.includes(r.usuario_id)&&(n.removeClass("text-danger fa fa-exclamation-triangle"),n.addClass("text-info fas fa-magic"))):n.hide(),s.find(".lbl_codigo").text(r.codigo);var c=s.find(".chk_sugestao");c.attr("type","checkbox"),c.addClass("checkbox_bootstrap_toggle"),c.prop("checked",1==r.sugestao);var _=s.find(".chk_visualizacao");_.attr("type","checkbox"),_.addClass("checkbox_bootstrap_toggle"),_.prop("checked",1==r.visualizacao);var l=s.find(".chk_download");l.attr("type","checkbox"),l.addClass("checkbox_bootstrap_toggle"),l.prop("checked",1==r.download);var p=s.find(".chk_escrita");p.attr("type","checkbox"),p.addClass("checkbox_bootstrap_toggle"),p.prop("checked",1==r.escrita);var u=s.find(".chk_exclusao");u.attr("type","checkbox"),u.addClass("checkbox_bootstrap_toggle"),u.prop("checked",1==r.exclusao);var h=s.find(".chk_manutencao_revisoes");h.attr("type","checkbox"),h.addClass("checkbox_bootstrap_toggle"),h.prop("checked",1==r.manutencao_revisoes);var v=s.find(".chk_nova_revisao");v.attr("type","checkbox"),v.addClass("checkbox_bootstrap_toggle"),v.prop("checked",1==r.nova_revisao);var f=s.find(".chk_seguranca");f.attr("type","checkbox"),f.addClass("checkbox_bootstrap_toggle"),1==r.seguranca&&(r.usuario_id==App.sessao.usuario_id&&e.lbl_tab_seguranca.removeClass("hidden"),f.prop("checked",!0)),$(c).prop("disabled",!e.valor),$(_).prop("disabled",!e.valor),$(l).prop("disabled",!e.valor),$(p).prop("disabled",!e.valor),$(u).prop("disabled",!e.valor),$(h).prop("disabled",!e.valor),$(v).prop("disabled",!e.valor),$(f).prop("disabled",!e.valor),$(t).attr("disabled",!e.valor),!App.sessao.dados.admin&&(void 0!==r.automatic&&!0===r.automatic||void 0!==r.sug_automatic&&!0===r.sug_automatic||void 0!==r.add_self&&!0===r.add_self||App.sessao.dados.usuario_id==r.usuario_id)&&(c.prop("disabled",!0),_.prop("disabled",!0),l.prop("disabled",!0),p.prop("disabled",!0),u.prop("disabled",!0),h.prop("disabled",!0),v.prop("disabled",!0),f.prop("disabled",!0),t.attr("disabled",!0),void 0!==r.add_self&&!0===r.add_self&&t.attr("disabled",!1)),c.change(function(){i(c,"sugestao",r)}),_.change(function(){i(_,"visualizacao",r)}),l.change(function(){i(l,"download",r)}),p.change(function(){i(p,"escrita",r)}),u.change(function(){i(u,"exclusao",r)}),h.change(function(){i(h,"manutencao_revisoes",r)}),v.change(function(){i(v,"nova_revisao",r)}),f.change(function(){i(f,"seguranca",r)}),t.click(function(){alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',"Deseja remover o usuário?","Remover",function(){$(e.usuarios_array).each(function(a,o){o.usuario_id==r.usuario_id&&(s.remove(),e.usuarios_array.splice(a,1),e.render_usuarios())})},!0)}),s.appendTo(a)};e.tab_permissoes.find("tr:gt(1)").remove(),$(e.usuarios_array).each(function(a,o){r(o)}),App.aplicar_checkbox(a)},this.render_usuarios_aprovacao=function(){var a=e.tab_aprovacao.find("tbody"),o=a.find("tr:first");e.tab_aprovacao.find("tr:gt(1)").remove(),$(e.usuarios_array_aprovacao).each(function(i,r){!function(i){var r=o.clone();r.removeAttr("template-row"),r.css("display","");var s=$(r.find(".btn_usuario_remover"));r.find(".img_usuario"),r.find(".lbl_nome").text(i.nome),r.find(".lbl_codigo").text(i.codigo),s.unbind("click"),s.click(function(){alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',"Deseja remover o usuário?","Remover",function(){$(e.usuarios_array_aprovacao).each(function(a,o){o.usuario_id==i.usuario_id&&(r.remove(),e.usuarios_array_aprovacao.splice(a,1),e.render_usuarios_aprovacao())})},!0)}),r.appendTo(a)}(r)})},this.btn_favoritar_item.click(function(){var a=!1,o=$(this).find("span");o.hasClass("glyphicon-star")?(o.removeClass("glyphicon-star").addClass("glyphicon-star-empty"),a=!1):(o.addClass("glyphicon-star").removeClass("glyphicon-star-empty"),a=!0),favoritar_item("pastas",e.documento_pasta_id,a)}),this.render_grupos=function(){var a=e.tab_permissoes_grupo.find("tbody"),o=a.find("tr:first"),i=function(a,o,i){$(e.grupos_array).each(function(r,s){s.grupo_usuarios_id==i.grupo_usuarios_id&&(e.grupos=s,"visualizacao"==o?e.grupos.visualizacao=a.prop("checked"):"download"==o?e.grupos.download=a.prop("checked"):"exclusao"==o?e.grupos.exclusao=a.prop("checked"):"escrita"==o?e.grupos.escrita=a.prop("checked"):"manutencao_revisoes"==o?e.grupos.manutencao_revisoes=a.prop("checked"):"nova_revisao"==o?e.grupos.nova_revisao=a.prop("checked"):"seguranca"==o?e.grupos.seguranca=a.prop("checked"):"sugestao"==o&&(e.grupos.sugestao=a.prop("checked")),e.grupos_array[r]=e.grupos)})},r=function(r){var s=o.clone();s.removeAttr("template-row"),s.css("display",""),s.find(".lbl_nome").text(r.nome);var t=s.find(".img_alerta_permissao"),n=(a=>{if(!e.validacao_permissoes_retroativas||!e.validacao_permissoes_retroativas.grupo_usuarios)return[];var o=e.validacao_permissoes_retroativas.grupo_usuarios.filter(o=>o.grupo_usuarios_id==a);return o.length>0&&Array.isArray(o[0].pastas)?o[0].pastas:[]})(r.grupo_usuarios_id);n.length>0?(t.tooltip({title:"Sem permissão de acesso à(s) pasta(s) predecessora(s)."}),t.show(),t.on("click",()=>{e.configurar_popup_validacao_permissoes_retroativas(r.nome,n,"G",r.grupo_usuarios_id,e.grupos_usuarios_aplicar_permissoes_retroativas)}),e.grupos_usuarios_aplicar_permissoes_retroativas.includes(r.grupo_usuarios_id)&&(t.removeClass("text-danger fa fa-exclamation-triangle"),t.addClass("text-info fas fa-magic"))):t.hide(),s.find(".lbl_codigo").text(r.codigo);var d=s.find(".chk_sugestao");d.attr("type","checkbox"),d.addClass("checkbox_bootstrap_toggle"),d.prop("checked",1==r.sugestao);var c=s.find(".chk_visualizacao");c.attr("type","checkbox"),c.addClass("checkbox_bootstrap_toggle"),c.prop("checked",1==r.visualizacao);var _=s.find(".chk_download");_.attr("type","checkbox"),_.addClass("checkbox_bootstrap_toggle"),_.prop("checked",1==r.download);var l=s.find(".chk_escrita");l.attr("type","checkbox"),l.addClass("checkbox_bootstrap_toggle"),l.prop("checked",1==r.escrita);var p=s.find(".chk_exclusao");p.attr("type","checkbox"),p.addClass("checkbox_bootstrap_toggle"),p.prop("checked",1==r.exclusao);var u=s.find(".chk_manutencao_revisoes");u.attr("type","checkbox"),u.addClass("checkbox_bootstrap_toggle"),u.prop("checked",1==r.manutencao_revisoes);var h=s.find(".chk_nova_revisao");h.attr("type","checkbox"),h.addClass("checkbox_bootstrap_toggle"),h.prop("checked",1==r.nova_revisao);var v=s.find(".chk_seguranca");v.attr("type","checkbox"),v.addClass("checkbox_bootstrap_toggle"),1==r.seguranca&&(WS.get("grupo_usuarios/objeto/",{grupo_usuarios_id:r.grupo_usuarios_id},function(a){$(a.usuarios).each(function(a,o){o.usuario_id==App.sessao.usuario_id&&e.lbl_tab_seguranca.removeClass("hidden")})}),v.prop("checked",!0)),$(d).prop("disabled",!e.valor),$(c).prop("disabled",!e.valor),$(_).prop("disabled",!e.valor),$(l).prop("disabled",!e.valor),$(p).prop("disabled",!e.valor),$(u).prop("disabled",!e.valor),$(h).prop("disabled",!e.valor),$(v).prop("disabled",!e.valor),$(f).prop("disabled",!e.valor),d.change(function(){i(d,"sugestao",r)}),c.change(function(){i(c,"visualizacao",r)}),_.change(function(){i(_,"download",r)}),l.change(function(){i(l,"escrita",r)}),p.change(function(){i(p,"exclusao",r)}),u.change(function(){i(u,"manutencao_revisoes",r)}),h.change(function(){i(h,"nova_revisao",r)}),v.change(function(){i(v,"seguranca",r)});var f=$(s.find(".btn_grupo_remover"));f.unbind("click"),f.click(function(){alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',"Deseja remover o grupo?","Remover",function(){$(e.grupos_array).each(function(a,o){o.grupo_usuarios_id==r.grupo_usuarios_id&&(s.remove(),e.grupos_array.splice(a,1),e.render_grupos())})},!0)}),s.appendTo(a)};e.tab_permissoes_grupo.find("tr:gt(1)").remove(),$(e.grupos_array).each(function(a,o){r(o)}),App.aplicar_checkbox(a)},this.render_cliente=function(){var a=e.tab_cliente.find("tbody"),o=a.find("tr:first");e.tab_cliente.find("tr:gt(1)").remove(),$(e.array_cliente).each(function(i,r){!function(i){var r=o.clone();r.removeAttr("template-row"),r.css("display",""),$(r.find("[template-field='codigo']")).text(i.codigo),$(r.find("[template-field='nome']")).text(i.nome_fantasia),$(r.find("[template-field='email']")).text(i.email_agenda);var s=$(r.find("[template-button='btn_remover']"));s.unbind("click"),s.click(function(){alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',"Deseja remover o cliente?","Remover",function(){$(e.array_cliente).each(function(a,o){o.cliente_id==i.cliente_id&&(r.remove(),e.array_cliente.splice(a,1),e.render_cliente())})},!0)}),r.appendTo(a)}(r)})},this.render_prospect=function(){var a=e.tab_prospect.find("tbody"),o=a.find("tr:first");e.tab_prospect.find("tr:gt(1)").remove(),$(e.array_prospect).each(function(i,r){!function(i){var r=o.clone();r.removeAttr("template-row"),r.css("display",""),$(r.find("[template-field='codigo']")).text(i.codigo),$(r.find("[template-field='nome']")).text(i.nome_fantasia),$(r.find("[template-field='email']")).text(i.email_agenda);var s=$(r.find("[template-button='btn_remover']"));s.unbind("click"),s.click(function(){alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',"Deseja remover o prospect?","Remover",function(){$(e.array_prospect).each(function(a,o){o.prospect_id==i.prospect_id&&(r.remove(),e.array_prospect.splice(a,1),e.render_prospect())})},!0)}),r.appendTo(a)}(r)})},this.render_fornecedor=function(){var a=e.tab_fornecedor.find("tbody"),o=a.find("tr:first");e.tab_fornecedor.find("tr:gt(1)").remove(),$(e.array_fornecedor).each(function(i,r){!function(i){var r=o.clone();r.removeAttr("template-row"),r.css("display",""),$(r.find("[template-field='codigo']")).text(i.fornecedor_id),$(r.find("[template-field='nome']")).text(i.nome_fantasia),$(r.find("[template-field='telefone']")).text(i.telefone1);var s=$(r.find("[template-button='btn_remover']"));s.unbind("click"),s.click(function(){alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',"Deseja remover o fornecedor?","Remover",function(){$(e.array_fornecedor).each(function(a,o){o.fornecedor_id==i.fornecedor_id&&(r.remove(),e.array_fornecedor.splice(a,1),e.render_fornecedor())})},!0)}),r.appendTo(a)}(r)})},this.render_grupos_aprovacao=function(){var a=e.tab_aprovacao_grupo.find("tbody"),o=a.find("tr:first");e.tab_aprovacao_grupo.find("tr:gt(1)").remove(),$(e.grupos_array_aprovacao).each(function(i,r){!function(i){var r=o.clone();r.removeAttr("template-row"),r.css("display",""),r.find(".lbl_nome").text(i.nome),r.find(".lbl_codigo").text(i.codigo);var s=$(r.find(".btn_grupo_remover"));s.unbind("click"),s.click(function(){alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',"Deseja remover o grupo?","Remover",function(){$(e.grupos_array_aprovacao).each(function(a,o){o.grupo_usuarios_id==i.grupo_usuarios_id&&(r.remove(),e.grupos_array_aprovacao.splice(a,1),e.render_grupos_aprovacao())})},!0)}),r.appendTo(a)}(r)})},this.RenderAprovadores=function(){o.render(e.ListarAprovadores,e.div_ListarAprovadores[0])},this.listar_alcada=function(){WS.get("alcada_aprovadores/listar/",null,function(a){a.length>0&&(e.cbo_selecionar_alcada.find("option").remove(),$(a).each(function(a,o){add_option(e.cbo_selecionar_alcada,o.alcada_generica_id,o.nome)}),e.cbo_selecionar_alcada.selectpicker("refresh"),e.alcada_generica_id&&(e.cbo_selecionar_alcada.val(e.alcada_generica_id).trigger("change"),e.cbo_selecionar_alcada.selectpicker("refresh")))})},this.listar_grupos_usuarios=function(a){var o=e.cbo_aprovador.parent().find(".edt_combobox"),i=new Object;i.nome=o.val(),WS.get("alcada_aprovadores/listar_todos_aprovadores/",i,function(o){limpar_combobox(e.cbo_aprovador),$(o).each(function(a,o){var i=[];i.Nome=o.nome;var r=$('<span class="label lb_tipo" style="margin: 5px;"></span>');"usuarios"==o.tipo?(r.addClass("label-info"),r.text("U"),r.attr("tipo","usuarios")):"grupo_usuarios"==o.tipo?(r.addClass("label-warning"),r.text("GU"),r.attr("tipo","grupo_usuarios")):"alcada_generica"==o.tipo&&(r.addClass("label-danger"),r.text("AP"),r.attr("tipo","alcada_generica")),r.tooltip(),add_option_combobox(e.cbo_aprovador,a,o.id>0?o.id:null,i,r,JSON.stringify(o))}),o.length>0&&a(!0),$(e.cbo_aprovador.parent()).find(".ul_row").click(function(){var a=$(this).parent().attr("dados-adicionais")?JSON.parse($(this).parent().attr("dados-adicionais")):null;e.ListarAprovadores.props.setAprovadoresManual(a),setTimeout(function(){var a=e.cbo_aprovador.parent().find(".ncbo_scroll").find(".row_selected");e.cbo_aprovador.parent().find(".edt_combobox").val(""),a.removeClass("row_selected")})})})},this.listar_seguranca_sugerida=function(a){WS.get("documento_pasta/listar_seguranca_sugerida/",{documento_pasta_id:a},function(a){if(0==a.usuarios.length)e.usuarios=App.sessao.dados,e.usuarios.visualizacao=!0,e.usuarios.download=!0,e.usuarios.escrita=!0,e.usuarios.exclusao=!0,e.usuarios.manutencao_revisoes=!0,e.usuarios.nova_revisao=!0,e.usuarios.seguranca=!0,e.usuarios.sugestao=!0,e.usuarios.automatic=!0,e.usuarios_array.push(e.usuarios);else for(var o=0,i=a.usuarios.length;o<i;o++){var r=a.usuarios[o],s=!App.sessao.dados.admin&&r.usuario_id==App.sessao.dados.usuario_id;r.visualizacao=!!s,r.download=!!s,r.escrita=!!s,r.exclusao=!!s,r.manutencao_revisoes=!!s,r.nova_revisao=!!s,r.seguranca=!!s,r.sugestao=!!s,r.sug_automatic=!!s,e.usuarios_array.push(a.usuarios[o])}for(o=0,i=a.grupo_usuarios.length;o<i;o++){var t=a.grupo_usuarios[o];t.visualizacao=!1,t.download=!1,t.escrita=!1,t.exclusao=!1,t.manutencao_revisoes=!1,t.nova_revisao=!1,t.seguranca=!1,t.sugestao=!1,e.grupos_array.push(a.grupo_usuarios[o])}})},this.chk_controle_acessos.unbind("change"),this.chk_controle_acessos.change(function(){$(this).prop("checked")?(e.render_usuarios(e.usuarios_array),e.render_grupos(e.grupos_array),e.div_permissoes.fadeIn()):(e.div_permissoes.fadeOut(),e.usuarios_array=e.usuarios_array?e.usuarios_array:[],e.grupos_array=e.grupos_array?e.grupos_array:[],e.tab_permissoes.find("tr:gt(1)").remove(),e.tab_permissoes_grupo.find("tr:gt(1)").remove())}),this.btn_add_usuario.unbind("click"),this.btn_add_usuario.click(function(){View.load("usuario/selecionar",function(a,o){o.show(function(a){var o=!1;if($(e.usuarios_array).each(function(i,r){r.usuario_id==a.usuario_id&&(o=!0)}),!o){var i=!App.sessao.dados.admin&&a.usuario_id==App.sessao.dados.usuario_id;e.usuarios=a,e.usuarios.visualizacao=!!i,e.usuarios.download=!!i,e.usuarios.escrita=!!i,e.usuarios.exclusao=!!i,e.usuarios.manutencao_revisoes=!!i,e.usuarios.nova_revisao=!!i,e.usuarios.seguranca=!!i,e.usuarios.sugestao=!!i,e.usuarios.add_self=!!i,e.usuarios_array.push(e.usuarios)}e.render_usuarios(e.usuarios_array),e.obter_validacao_permissoes_retroativas()})})}),this.btn_add_cliente.unbind("click"),this.btn_add_cliente.click(function(){View.load("cliente/selecionar",function(a,o){o.show(function(a){var o=!1;$(e.array_cliente).each(function(i,r){r.cliente_id==a.cliente_id&&(o=!0)}),o||e.array_cliente.push(a),e.render_cliente()})})}),this.btn_add_fornecedor.unbind("click"),this.btn_add_fornecedor.click(function(){View.load("fornecedor/selecionar",function(a,o){o.show(function(a){var o=!1;$(e.array_fornecedor).each(function(i,r){r.fornecedor_id==a.fornecedor_id&&(o=!0)}),o||e.array_fornecedor.push(a),e.render_fornecedor()})})}),this.btn_add_prospect.unbind("click"),this.btn_add_prospect.click(function(){View.load("prospect/selecionar",function(a,o){o.show(function(a){var o=!1;$(e.array_prospect).each(function(i,r){r.prospect_id==a.prospect_id&&(o=!0,e.array_prospect[i].removido=!1)}),o||e.array_prospect.push(a),e.render_prospect()})})}),this.btn_add_usuario_aprovacao.unbind("click"),this.btn_add_usuario_aprovacao.click(function(){View.load("usuario/selecionar",function(a,o){o.show(function(a){var o=!1;$(e.usuarios_array_aprovacao).each(function(i,r){r.usuario_id==a.usuario_id&&(o=!0)}),o||(e.usuarios_aprovacao=a,e.usuarios_array_aprovacao.push(e.usuarios_aprovacao)),e.render_usuarios_aprovacao(e.usuarios_array_aprovacao)})})}),this.btn_add_grupo.unbind("click"),this.btn_add_grupo.click(function(){View.load("grupo_usuarios/selecionar",function(a,o){o.show(function(a){var o=!1;$(e.grupos_array).each(function(i,r){r.grupo_usuarios_id==a.grupo_usuarios_id&&(o=!0)}),o||(e.grupos=a,e.grupos.visualizacao=!1,e.grupos.download=!1,e.grupos.escrita=!1,e.grupos.exclusao=!1,e.grupos.manutencao_revisoes=!1,e.grupos.nova_revisao=!1,e.grupos.seguranca=!1,e.grupos.sugestao=!1,e.grupos_array.push(e.grupos)),e.render_grupos(e.grupos_array),e.obter_validacao_permissoes_retroativas()},MODULOS.DOCUMENTO)})}),this.btn_add_grupo_aprovacao.unbind("click"),this.btn_add_grupo_aprovacao.click(function(){View.load("grupo_usuarios/selecionar",function(a,o){o.show(function(a){var o=!1;$(e.grupos_array_aprovacao).each(function(i,r){r.grupo_usuarios_id==a.grupo_usuarios_id&&(o=!0)}),o||(e.grupos_aprovacao=a,e.grupos_array_aprovacao.push(e.grupos_aprovacao)),e.render_grupos_aprovacao(e.grupos_array_aprovacao)},MODULOS.DOCUMENTO)})}),this.btn_assunto_padrao_visualizar.unbind("click"),this.btn_assunto_padrao_visualizar.click(function(){""!=e.cbo_assunto_padrao.val()&&View.load("assunto/detalhes",function(a,o){o.show(e.cbo_assunto_padrao.val(),FORMULARIO.VISUALIZAR)})}),this.btn_tipo_documento_padrao_visualizar.unbind("click"),this.btn_tipo_documento_padrao_visualizar.click(function(){""!=e.cbo_tipo_documento_padrao.val()&&View.load("tipo_documento/detalhes",function(a,o){o.show(e.cbo_tipo_documento_padrao.val(),FORMULARIO.VISUALIZAR)})}),this.pesquisar_email=function(a){var o=e.tab_email_usuarios.input.val(),i=0,r=function(a){e.tab_email_usuarios.bp_drop.parent().attr("data-visible","true"),e.tab_email_usuarios.bp_drop.append($('<li class="li_click '+(0==i?"active":"")+'" data-email="'+a.email+'" data-selecionado="'+(0==i)+'">'+a.nome+" [ "+a.email+" ]</li>").click(function(){var a=$(this).attr("data-email");e.tab_email_usuarios.input.val(a),e.tab_email_usuarios.btn_add.trigger("click"),e.tab_email_usuarios.bp_drop.parent().attr("data-visible","false")})),i++};a.which!=KEYPRESS_PADRAO.KEYUP&&a.which!=KEYPRESS_PADRAO.KEYDOWN&&a.which!=KEYPRESS_PADRAO.ENTER&&WS.get("usuario/listar/",{nome:o},function(a){e.tab_email_usuarios.bp_drop.find("li:not([template-row])").remove();for(var o=0;o<a.length;o++){var i=a[o];r(i)}})},this.evento_hover_li=function(a,o){var i=$(o).find(".active");a==KEYPRESS_PADRAO.KEYUP?$(i).prev().length>0&&($(o).find(".active").removeClass("active").removeAttr("data-selecionado",!1),$(i).prev().addClass("active").attr("data-selecionado",!0)):a==KEYPRESS_PADRAO.KEYDOWN?$(i).next().length>0&&($(o).find(".active").removeClass("active").attr("data-selecionado",!1),$(i).next().addClass("active").attr("data-selecionado",!0)):a==KEYPRESS_PADRAO.ENTER&&($(o).find(".active").length>0?($(o).find(".active").trigger("click"),e.tab_email_usuarios.bp_drop.find("li:not([template-row])").remove()):e.tab_email_usuarios.btn_add.trigger("click"))},this.chk_notificacoes.unbind("change").change(function(){1==$(this).prop("checked")?(e.chk_notificacao_seguranca.parent().parents(".row").removeClass("hidden"),e.chk_notificacao_outros_usuarios.parent().parents(".row").removeClass("hidden"),e.chk_notificacao_aprovador.parent().parents(".row").removeClass("hidden")):(e.chk_notificacao_seguranca.prop("checked",!1).change().parent().parents(".row").addClass("hidden"),e.chk_notificacao_outros_usuarios.prop("checked",!1).change().parent().parents(".row").addClass("hidden"),e.chk_notificacao_aprovador.prop("checked",!1).change().parent().parents(".row").addClass("hidden"))}),this.chk_notificacao_outros_usuarios.unbind("click").change(function(){1==$(this).prop("checked")?e.div_emails_adicionais.removeClass("hidden"):e.div_emails_adicionais.addClass("hidden")}),this.tab_email_usuarios.btn_add.unbind("click").click(function(a){var o=parseInt(e.tab_email_usuarios.elem_key,10)+1;e.tab_email_usuarios.elem_key=o;var i=e.tab_email_usuarios.input.val(),r={id:o,email:i};e.tab_email_usuarios.add_email(r,function(a){if(a){var s=e.tab_email_usuarios.create_row(i);s.attr("data-id",o),e.tab_email_usuarios.getColumn(s,"btn_remover_email").unbind("click").click(function(a){var o=$(this),i=$(o).parents("tr");$(i).remove(),e.tab_email_usuarios.remove_email(r.elem_key)}),e.tab_email_usuarios.input.val("")}})}),this.tab_email_usuarios.input.unbind("focusout").focusout(function(){e.tab_email_usuarios.bp_drop.parent().attr("data-visible","false")}),this.tab_email_usuarios.input.unbind("keyup").keyup($.debounce(200,e.pesquisar_email)),this.tab_email_usuarios.input.keyup(function(a){e.evento_hover_li(a.which,e.tab_email_usuarios.bp_drop)}),this.btn_salvar.unbind("click"),this.btn_salvar.click(function(){if(1==e.cbo_tipo_aprovacao.val()){for(var a=!1,o=!1,i=[],r=e.ListarAprovadores.props.arrAprovadoresManual.length,s=0;s<r;s++){for(var t=s;t<r;t++)1==e.ListarAprovadores.props.arrAprovadoresManual[t].tipo_aprovador?s!=t&&e.ListarAprovadores.props.arrAprovadoresManual[s].usuario_id==e.ListarAprovadores.props.arrAprovadoresManual[t].usuario_id&&e.ListarAprovadores.props.arrAprovadoresManual[s].nivel==e.ListarAprovadores.props.arrAprovadoresManual[t].nivel&&(a=!0,i.push(e.ListarAprovadores.props.arrAprovadoresManual[s].aprovador_usuario_nome)):2==e.ListarAprovadores.props.arrAprovadoresManual[t].tipo_aprovador&&s!=t&&e.ListarAprovadores.props.arrAprovadoresManual[s].grupo_usuarios_id==e.ListarAprovadores.props.arrAprovadoresManual[t].grupo_usuarios_id&&e.ListarAprovadores.props.arrAprovadoresManual[s].nivel==e.ListarAprovadores.props.arrAprovadoresManual[t].nivel&&(a=!0,i.push(e.ListarAprovadores.props.arrAprovadoresManual[s].aprovador_grupo_nome));s>0&&parseInt(e.ListarAprovadores.props.arrAprovadoresManual[s].nivel)-parseInt(e.ListarAprovadores.props.arrAprovadoresManual[s-1].nivel)>1&&(o=!0)}if(1==a)return(n=new Validation).add(new ValidationMessage(Validation.CODES.ERR_FIELD,"Os itens abaixo estão duplicados: <br /><br />"+i)),alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',n),!1;if(1==o)return(n=new Validation).add(new ValidationMessage(Validation.CODES.ERR_FIELD,"Por gentileza, verifique a ordem dos niveis")),alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',n),!1;if(0==e.ListarAprovadores.props.arrAprovadoresManual.length)return(n=new Validation).add(new ValidationMessage(Validation.CODES.ERR_FIELD,"Por gentileza, informe ao menos um usuário para salvar uma alçada.")),alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',n),!1;if(1!=e.ListarAprovadores.props.arrAprovadoresManual[0].nivel)return(n=new Validation).add(new ValidationMessage(Validation.CODES.ERR_FIELD,'A alçada sempre deverá iniciar com o nivel "1" ')),alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',n),!1}else if(2==e.cbo_tipo_aprovacao.val()){var n;if(""==e.cbo_selecionar_alcada.val()||null==e.cbo_selecionar_alcada.val())return(n=new Validation).add(new ValidationMessage(Validation.CODES.ERR_FIELD,"Por gentileza, escolha ao menos uma alçada para continuar.")),alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',n),!1}WS.post("documento_pasta/salvar",{documento_pasta_id:e.documento_pasta_id,nome:e.edt_nome.val(),codigo:e.edt_codigo.val().trim(),tags_padrao:e.edt_tags_padrao.val(),assunto_id:e.cbo_assunto_padrao.val(),tipo_documento_id:e.cbo_tipo_documento_padrao.val(),predecessor_id:e.predecessor_id,usuarios_permissoes:JSON.stringify(e.usuarios_array),grupos_permissoes:JSON.stringify(e.grupos_array),controle_acessos:e.chk_controle_acessos.prop("checked"),validacao_permissoes_retroativas:JSON.stringify({usuarios:e.usuarios_aplicar_permissoes_retroativas||[],grupos:e.grupos_usuarios_aplicar_permissoes_retroativas||[]}),arrAprovadoresManual:JSON.stringify(e.ListarAprovadores.props.arrAprovadoresManual),tipo_aprovacao:e.cbo_tipo_aprovacao.val(),cliente:JSON.stringify(e.array_cliente),prospect:JSON.stringify(e.array_prospect),fornecedor:JSON.stringify(e.array_fornecedor),notificar_por_email:e.chk_notificacoes.prop("checked"),notificar_por_usuario_seguranca:e.chk_notificacao_seguranca.prop("checked"),notificar_por_usuario_aprovador:e.chk_notificacao_aprovador.prop("checked"),emails_adicionais:JSON.stringify(e.tab_email_usuarios.arr_dados)||JSON.stringify([]),alcada_generica_id:e.cbo_selecionar_alcada.val(),prazo_dias:e.edt_prazo_dias.val()},function(a){e.documento_pasta_id=a.id,alert_saved(a.nome+" salvo com sucesso"),e.houve_alteracao=!0,void 0!==e.onsave&&e.onsave&&e.onsave(),View.unload(e.html_id)},[e.btn_salvar])}),this.btn_excluir.unbind("click"),this.btn_excluir.click(function(){WS.post("documento_pasta/excluir",{documento_pasta_id:e.documento_pasta_id},function(a){e.documento_pasta_id=a.id,alert_saved(a.nome+" excluído com sucesso"),e.houve_alteracao=!0,void 0!==e.ondelete&&e.ondelete&&e.ondelete(e.houve_alteracao),View.unload(e.html_id)})}),this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){View.unload(e.html_id)}),this.cbo_tipo_aprovacao.unbind("change"),this.cbo_tipo_aprovacao.change(function(){if(2==e.cbo_tipo_aprovacao.val())e.div_tipo_aprovacao.removeClass("col-sm-12 col-md-6").addClass("col-sm-8 col-md-4"),e.div_edt_prazo_dias.removeClass("hidden"),e.div_cbo_selecionar_alcada.removeClass("hidden"),e.div_cbo_aprovador.addClass("hidden"),e.listar_alcada(),e.ListarAprovadores.props.setAprovadoresManual(null);else if(1==e.cbo_tipo_aprovacao.val()){e.div_tipo_aprovacao.removeClass("col-sm-12 col-md-6").addClass("col-sm-8 col-md-4"),e.div_edt_prazo_dias.removeClass("hidden"),e.div_cbo_selecionar_alcada.addClass("hidden"),e.div_cbo_aprovador.removeClass("hidden"),e.ListarAprovadores.props.setAlcadaSelecionada(null),e.ListarAprovadores.props.setDocumentoPastaSelecionada(parseInt(e.documento_pasta_id));var a=e.cbo_aprovador.parent();e.edt_aprovador=a.find(".edt_combobox"),e.edt_aprovador.keypress(function(a){if(13==a.keyCode){var o=e.cbo_aprovador.parent().find(".ncbo_scroll").find(".row_selected"),i=o.attr("dados-adicionais")?JSON.parse(o.attr("dados-adicionais")):null;e.ListarAprovadores.props.setAprovadoresManual(i),e.cbo_aprovador.parent().find(".edt_combobox").val(""),o.removeClass("row_selected")}})}else e.div_tipo_aprovacao.removeClass("col-sm-8 col-md-4").addClass("col-sm-12 col-md-6"),e.div_edt_prazo_dias.addClass("hidden"),e.div_cbo_selecionar_alcada.addClass("hidden"),e.div_cbo_aprovador.addClass("hidden"),e.ListarAprovadores.props.setAlcadaSelecionada(null),e.ListarAprovadores.props.setAprovadoresManual(null)}),this.cbo_selecionar_alcada.unbind("change"),this.cbo_selecionar_alcada.change(function(){e.ListarAprovadores.props.setAlcadaSelecionada(parseInt($(this).val()))}),this.obter_validacao_permissoes_retroativas=(()=>{if(!e.predecessor_id)return!1;WS.post("documento_pasta/verificar_permissoes_retroativas/",{documento_pasta_id:e.predecessor_id,usuarios_permissoes:JSON.stringify(e.usuarios_array),grupos_permissoes:JSON.stringify(e.grupos_array)},a=>{e.validacao_permissoes_retroativas=a,e.render_usuarios(),e.render_grupos()})}),this.configurar_popup_validacao_permissoes_retroativas=((a,o,i="U",r,s)=>{e.popup_validacao_permissoes_retroativas=e.dx_popup_validacao_permissoes_retroativas.dxPopup({contentTemplate:function(){var a=!0,t='<div class="text-left" style="min-width: 300px;">Sem permissão de acesso à(s) pasta(s) predecessora(s):<br><ul>';o.map(o=>{var i="";!1===o.permissao_seguranca_usuario_logado&&(a=!1,i=' <span class="text-danger">(você não possui permissão de segurança nesta pasta)</span>'),t+="<li><b>"+o.path+"</b>"+i+"</li>"}),t+="</ul>";const n=$("<div>").dxCheckBox({value:"G"===i?e.grupos_usuarios_aplicar_permissoes_retroativas.includes(r):e.usuarios_aplicar_permissoes_retroativas.includes(r),text:"Adicionar o "+("G"===i?"grupo de usuários":"usuário")+" às permissões de visualização das pastas citadas acima?",disabled:!a,onValueChanged:a=>{if(a.value)s.includes(r)||s.push(r);else{const a=s.indexOf(r);a>=0&&s.splice(a,1)}}});return $("<div>").append(t,n)},container:e.painel_seguranca,showTitle:!0,title:a,visible:!1,dragEnabled:!1,hideOnOutsideClick:!0,showCloseButton:!0,toolbarItems:[{widget:"dxButton",toolbar:"bottom",location:"after",options:{text:"Ok",onClick(){e.popup_validacao_permissoes_retroativas.dxPopup("instance").hide()}}}],onHidden(){e.render_usuarios(),e.render_grupos()}}),e.popup_validacao_permissoes_retroativas.dxPopup("instance").show()})}});