define(["react","react-dom","./../componentes_react/CboUsuarios"],function(a,o,e){return function(i){"use strict";var r=this;this.html_id=i,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.tipo=null,this.onclose=null,this.edt_nome=this.dialog.find(".edt_nome"),this.cbo_cor=this.dialog.find(".cbo_cor"),this.cor_exemplo=this.dialog.find(".cor_exemplo"),this.edt_nivel=this.dialog.find(".edt_nivel"),this.chk_bloqueado=this.dialog.find(".chk_bloqueado"),this.edt_emails=this.dialog.find(".edt_emails"),this.edt_emails_acompanhamento=this.dialog.find(".edt_emails_acompanhamento"),this.chk_publico=this.dialog.find(".chk_publico"),this.chk_descricao_motivo_on_assunto=this.dialog.find(".chk_descricao_motivo_on_assunto"),this.chk_particular=this.dialog.find(".chk_particular"),this.chk_acesso_supervisor=this.dialog.find(".chk_acesso_supervisor"),this.chk_acesso_substituto=this.dialog.find(".chk_acesso_substituto"),this.tr_acesso_supervisor=this.dialog.find(".tr_acesso_supervisor"),this.tr_acesso_substituto=this.dialog.find(".tr_acesso_substituto"),this.div_componente_responsavel_motivo=this.dialog.find(".div_componente_responsavel_motivo"),this.cboResponsaveis=a.createElement(e,null,null),this.tab_responsaveis=this.dialog.find(".tab_responsaveis"),this.chk_tipo_hora=this.dialog.find(".chk_tipo_hora"),this.chk_horas_uteis=this.dialog.find(".chk_horas_uteis"),this.chk_dias_corridos=this.dialog.find(".chk_dias_corridos"),this.edt_horas=this.dialog.find(".edt_horas"),this.edt_dias=this.dialog.find(".edt_dias"),this.cbo_calendario_trabalho=this.dialog.find(".cbo_calendario_trabalho"),this.chk_altera_solicitante=this.dialog.find(".chk_altera_solicitante"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.btn_excluir=this.dialog.find(".btn_excluir"),this.chk_admin_encerra=this.dialog.find(".chk_admin_encerra"),this.chk_solicitante_encerra=this.dialog.find(".chk_solicitante_encerra"),this.chk_permite_fixar_previsao_retorno=this.dialog.find(".chk_permite_fixar_previsao_retorno"),this.chk_permite_programar_inicio_sla=this.dialog.find(".chk_permite_programar_inicio_sla"),this.chk_utiliza_encerramento=this.dialog.find(".chk_utiliza_encerramento"),this.edt_horas_encerramento=this.dialog.find(".edt_horas_encerramento"),this.cbo_calendario_trabalho_encerramento=this.dialog.find(".cbo_calendario_trabalho_encerramento"),this.chk_utiliza_resolucao_atendimento=this.dialog.find(".chk_utiliza_resolucao_atendimento"),this.edt_horas_resolucao_atendimento=this.dialog.find(".edt_horas_resolucao_atendimento"),this.cbo_calendario_trabalho_resolucao_atendimento=this.dialog.find(".cbo_calendario_trabalho_resolucao_atendimento"),this.grid_motivos_entidades=this.dialog.find(".grid_motivos_entidades"),this.div_utiliza_resolucao_atendimento=this.dialog.find(".div_utiliza_resolucao_atendimento"),this.dxButtonQuestionPermiteFixarPrevisaoRetorno=this.dialog.find(".dxButtonQuestionPermiteFixarPrevisaoRetorno"),this.dxButtonQuestionPermiteProgramarInicioSLA=this.dialog.find(".dxButtonQuestionPermiteProgramarInicioSLA"),this.dxButtonQuestionUtilizaResolucaoAtendimento=this.dialog.find(".dxButtonQuestionUtilizaResolucaoAtendimento"),this.div_utiliza_encerramento=this.dialog.find(".div_utiliza_encerramento"),this.chk_tipo_config_encerramento=this.dialog.find(".chk_tipo_config_encerramento"),this.chk_horas_uteis_encerramento=this.dialog.find(".chk_horas_uteis_encerramento"),this.chk_dias_corridos_encerramento=this.dialog.find(".chk_dias_corridos_encerramento"),this.edt_dias_encerramento=this.dialog.find(".edt_dias_encerramento"),this.chk_solicitante_chamado_reclassificar_para_qualquer_responsavel=this.dialog.find(".chk_solicitante_chamado_reclassificar_para_qualquer_responsavel"),this.chk_responsavel_chamado_reclassificar_para_qualquer_responsavel=this.dialog.find(".chk_responsavel_chamado_reclassificar_para_qualquer_responsavel"),this.chk_adicionar_usuario_logado_responsavel=this.dialog.find(".chk_adicionar_usuario_logado_responsavel"),this.chk_definir_situacao_aguardando_responsavel=this.dialog.find(".chk_definir_situacao_aguardando_responsavel"),this.chk_colaborador_altera_previsao_retorno=this.dialog.find(".chk_colaborador_altera_previsao_retorno"),this.chk_obrigatorio_informar_horas=this.dialog.find(".chk_obrigatorio_informar_horas"),this.chk_sugerir_mensagem_padrao_colaboradores=this.dialog.find(".chk_sugerir_mensagem_padrao_colaboradores"),this.edt_mensagem_padrao=this.dialog.find(".edt_mensagem_padrao"),this.chk_confirmar_leitura_email=this.dialog.find(".chk_confirmar_leitura_email"),this.chk_notificacao_mensagem_reclassificacao_opcional=this.dialog.find(".chk_notificacao_mensagem_reclassificacao_opcional"),this.chk_notificacao_observacao_interna_opcional=this.dialog.find(".chk_notificacao_observacao_interna_opcional"),this.chk_valor_padrao_notificar_envolvolvidos=this.dialog.find(".chk_valor_padrao_notificar_envolvolvidos"),this.div_valor_padrao_notificar_envolvolvidos=this.dialog.find(".div_valor_padrao_notificar_envolvolvidos"),this.cbo_formulario_avaliacao=this.dialog.find(".cbo_formulario_avaliacao"),this.cbo_formulario_abertura=this.dialog.find(".cbo_formulario_abertura"),this.cbo_formulario_encerramento=this.dialog.find(".cbo_formulario_encerramento"),this.chk_utiliza_apontamento_chamados=this.dialog.find(".chk_utiliza_apontamento_chamados"),this.chk_registrar_mensagem_apontamento=this.dialog.find(".chk_registrar_mensagem_apontamento"),this.div_registrar_mensagem_apontamento=this.dialog.find(".div_registrar_mensagem_apontamento"),this.div_projeto_apontamento=this.dialog.find(".div_projeto_apontamento"),this.div_dx_grid_projetos=this.dialog.find(".div_dx_grid_projetos"),this.chamado_motivo_id=null,this.arr_responsaveis=[],this.tipo_gestao_tempo=null,this.tipo_gestao_tempo_encerramento=null,this.dataGridEntidadesMotivo=null,this.dx_grid_projetos=null,this.projeto_apontamento_id=null,this.validar_grid_motivos_entidades=!0,this.aplicar_alteracoes_chk_utiliza_resolucao_atendimento=!0,this.show=function(a,e){r.edt_horas.mask("000:00"),r.edt_horas_encerramento.mask("000:00"),r.edt_horas_resolucao_atendimento.mask("000:00");for(var i=new Colors,t=0;t<i.length;t++)r.cbo_cor.append('<option value="'+i[t].hex+'" style="background:'+i[t].hex+"; color: "+i[t].nome_hex+'">'+i[t].nome+"</option>");switch(e){case FORMULARIO.NOVO:r.btn_salvar.show(),r.btn_excluir.hide(),r.permite_alterar(!0),r.cbo_cor.val(""),r.edt_nivel.val(10),r.listar_calendario_trabalho(),r.chk_altera_solicitante.prop("checked",!0).trigger("click"),r.chk_dias_corridos.prop("checked",!0).trigger("click"),r.chk_dias_corridos_encerramento.prop("checked",!0).trigger("click"),r.chk_confirmar_leitura_email.prop("checked",!0).trigger("click"),r.chk_notificacao_mensagem_reclassificacao_opcional.prop("checked",!0).trigger("click"),r.chk_notificacao_observacao_interna_opcional.prop("checked",!0).trigger("click"),r.chk_valor_padrao_notificar_envolvolvidos.prop("checked",!0).trigger("click"),r.render_formulario_avaliacao(),r.render_formulario_abertura(),r.render_formulario_encerramento();break;case FORMULARIO.EDITAR:r.btn_salvar.show(),r.btn_excluir.hide(),r.permite_alterar(!0);break;case FORMULARIO.VISUALIZAR:r.btn_salvar.hide(),r.btn_excluir.hide(),r.permite_alterar(!1);break;case FORMULARIO.EXCLUIR:r.btn_salvar.hide(),r.btn_excluir.show(),r.permite_alterar(!1)}o.render(r.cboResponsaveis,r.div_componente_responsavel_motivo[0]),r.cboResponsaveis.props.setObjParam({EquipeInterna:!0,EmpresaId:App.temp.empresa,Modulo:MODULOS.CHAMADO,ExibirGrupos:!0}),r.cboResponsaveis.props.setFunctionSelect(r.fn_select_resp_motivo),r.tipo=e,show_modal(r.modal.attr("id")),void 0!==a&&a&&(r.chamado_motivo_id=a,r.preencher()),r.dxButtonQuestionPermiteFixarPrevisaoRetorno.dxButton({icon:"fas fa-question-circle",width:"25px",onClick:function(a){alertaPopUp("Informação","<div><p><strong>Fixação da data de retorno do chamado</strong></p><p>Quando você marca essa opção, a data de retorno que você escolheu inicialmente não vai mudar nas próximas mensagens. Isso ajuda a manter a mesma data prevista de retorno para o seu chamado, evitando sugestões de novas datas automaticamente.</p></div>","Ok")}}),r.dxButtonQuestionPermiteProgramarInicioSLA.dxButton({icon:"fas fa-question-circle",width:"25px",onClick:function(a){alertaPopUp("Informação","<div><p><strong>Programação de início do SLA</strong></p><p>Ao marcar essa opção, você pode definir uma data específica para começar a contar o tempo de resposta (SLA) do seu chamado. Isso é útil para planejar melhor quando o tempo de atendimento deve começar a ser contado, considerando a data que você escolheu.</p></div>","Ok")}}),r.dxButtonQuestionUtilizaResolucaoAtendimento.dxButton({icon:"fas fa-question-circle",width:"25px",onClick:function(a){alertaPopUp("Informação","Ativando esse parâmetro chamados na situação <b>Aguardando Solicitante</b> que ultrapassarem as horas úteis ou dias corridos configurados abaixo serão encerrados por inatividade.<br /><br /> Regras de cálculo: <b>Previsão de Retorno + horas úteis ou dias corridos</b> (de acordo com o configuradono no motivo)<br />Todos chamados cuja data calculada acima seja inferior a data atual serão automaticamente <b>encerrados</b>.","Ok")}}),set_focus(r.edt_nome)},this.fn_select_resp_motivo=function(){var a=r.cboResponsaveis.props.UsuarioSelecionado,o=a.id,e=a.tipo,i=a.nome,t={},_=!1;$(r.arr_responsaveis).each(function(a,i){(i.usuario_id==o&&"usuarios"==e||i.grupo_usuarios_id==o&&"grupo_usuarios"==e)&&(_=!0)}),!_&&o>0&&(t.tipo=e,t.nome=i,"usuarios"==e?t.usuario_id=o:"grupo_usuarios"==e&&(t.grupo_usuarios_id=o),r.arr_responsaveis.push(t),r.render_responsaveis())},this.listar_calendario_trabalho=function(a,o,e){r.cbo_calendario_trabalho.find("option").remove(),add_option(r.cbo_calendario_trabalho,"","Nenhum"),r.cbo_calendario_trabalho_encerramento.find("option").remove(),add_option(r.cbo_calendario_trabalho_encerramento,"","Nenhum"),r.cbo_calendario_trabalho_resolucao_atendimento.find("option").remove(),add_option(r.cbo_calendario_trabalho_resolucao_atendimento,"","Nenhum"),WS.get("calendario_trabalho/listar/",null,function(i){r.calendarios_trabalho_lista=i,r.render_grid_motivos_entidades();for(var t=0;t<i.length;t++){var _=i[t];add_option(r.cbo_calendario_trabalho,_.calendario_trabalho_id,_.nome),add_option(r.cbo_calendario_trabalho_encerramento,_.calendario_trabalho_id,_.nome),add_option(r.cbo_calendario_trabalho_resolucao_atendimento,_.calendario_trabalho_id,_.nome)}a&&r.cbo_calendario_trabalho.val(a).trigger("change"),o&&r.cbo_calendario_trabalho_encerramento.val(o).trigger("change"),e&&r.cbo_calendario_trabalho_resolucao_atendimento.val(e).trigger("change"),r.cbo_calendario_trabalho.selectpicker("refresh"),r.cbo_calendario_trabalho_encerramento.selectpicker("refresh"),r.cbo_calendario_trabalho_resolucao_atendimento.selectpicker("refresh")})},this.render_responsaveis=function(){var a=r.tab_responsaveis.find("tbody"),o=a.find("tr:first");r.tab_responsaveis.find("tr:gt(1)").remove(),$(r.arr_responsaveis).each(function(e,i){!function(e){var i=o.clone();i.removeAttr("template-row"),i.css("display","");var t=$(i.find("[template-field='tipo']"));"usuarios"==e.tipo?(t.addClass("label-info"),t.attr("title","Usuário"),t.attr("data-original-title","Usuário"),t.text("U")):"grupo_usuarios"==e.tipo&&(t.addClass("label-warning"),t.attr("title","Grupo de Usuários"),t.attr("data-original-title","Grupo de Usuários"),t.text("GU")),t.tooltip(),$(i.find("[template-field='nome']")).text(e.nome);var _=$(i.find(".btn_usuario_remover"));_.unbind("click"),_.click(function(){alert_modal(r.title.text(),"Deseja remover da Usuário?","Remover",function(){$(r.arr_responsaveis).each(function(a,o){"usuarios"==o.tipo?o.usuario_id==e.usuario_id&&(i.remove(),r.arr_responsaveis.splice(a,1),r.render_responsaveis()):"grupo_usuarios"==o.tipo&&o.grupo_usuarios_id==e.grupo_usuarios_id&&(i.remove(),r.arr_responsaveis.splice(a,1),r.render_responsaveis())})},!0)}),i.appendTo(a)}(i)})},this.close=function(){close_modal(r.modal.attr("id")),void 0!==r.onclose&&r.onclose&&r.onclose()},this.unload=function(){r.close(),View.unload(this.html_id)},this.cbo_cor_change=function(){r.cor_exemplo.css("background",r.cbo_cor.val()?r.cbo_cor.val():"")},this.radios=function(){const a=()=>{r.edt_dias.prop("disabled",!1),r.edt_horas.prop("disabled",!1),!0===r.chk_horas_uteis.prop("checked")?(r.cbo_calendario_trabalho.prop("disabled",!1).val(""),r.edt_dias.val(""),r.edt_dias.prop("disabled",!0),r.tipo_gestao_tempo=CHAMADO_MOTIVO_TEMPO.HORAS_UTEIS):!0===r.chk_dias_corridos.prop("checked")&&(r.cbo_calendario_trabalho.prop("disabled",!0).val(""),r.edt_horas.val(""),r.edt_horas.prop("disabled",!0),r.tipo_gestao_tempo=CHAMADO_MOTIVO_TEMPO.DIAS_CORRIDOS),r.cbo_calendario_trabalho.selectpicker("refresh"),r.render_grid_motivos_entidades()};let o=r.dataGridEntidadesMotivo?r.dataGridEntidadesMotivo.getController("editing").getChanges():[];o&&o.length?alertaPopUp("Atenção","A tabela de <strong>Controle de Tempo de Atendimento por Entidade</strong> possui alterações não salvas, que serão descartadas com a alteração dessa configuração. Deseja continuar?","Sim, descartar alterações",()=>{a()},"Não, manter alterações",()=>{r.chk_horas_uteis.prop("checked")?(r.chk_horas_uteis.prop("checked",!1),r.chk_dias_corridos.prop("checked",!0)):r.chk_dias_corridos.prop("checked")&&(r.chk_horas_uteis.prop("checked",!0),r.chk_dias_corridos.prop("checked",!1))}):a()},this.radios_encerramento=function(){r.edt_dias_encerramento.prop("disabled",!1),r.edt_horas_encerramento.prop("disabled",!1),!0===r.chk_horas_uteis_encerramento.prop("checked")?(r.cbo_calendario_trabalho_encerramento.prop("disabled",!1).val(""),r.edt_dias_encerramento.val(""),r.edt_dias_encerramento.prop("disabled",!0),r.tipo_gestao_tempo_encerramento=CHAMADO_MOTIVO_TEMPO.HORAS_UTEIS):!0===r.chk_dias_corridos_encerramento.prop("checked")&&(r.cbo_calendario_trabalho_encerramento.prop("disabled",!0).val(""),r.edt_horas_encerramento.val(""),r.edt_horas_encerramento.prop("disabled",!0),r.tipo_gestao_tempo_encerramento=CHAMADO_MOTIVO_TEMPO.DIAS_CORRIDOS),r.cbo_calendario_trabalho_encerramento.selectpicker("refresh")},this.validar_hora_minuto=function(a){var o=new Validation,e=a.split(":"),i=e[1];e.length;return i>59||a.length>0&&6!=a.length?(o.add(new ValidationMessage(Validation.CODES.ERR_FIELD,'Campo "Horas Úteis" inválido!')),alert_modal("Validação",o),!1):!(a>"838:59")||(o.add(new ValidationMessage(Validation.CODES.ERR_FIELD,'Campo "Horas Úteis" deve ser menor que 838:59 horas!')),alert_modal("Validação",o),!1)},this.permite_alterar=function(a){r.edt_nome.prop("readonly",!a),r.cbo_cor.prop("disabled",!a),r.cor_exemplo.prop("readonly",!a),r.edt_dias.prop("readonly",!a),r.edt_horas.prop("readonly",!a),r.edt_nivel.prop("readonly",!a),r.chk_bloqueado.prop("disabled",!a),r.edt_emails.prop("readonly",!a),r.edt_emails_acompanhamento.prop("readonly",!a),r.chk_altera_solicitante.prop("disabled",!a),r.chk_publico.prop("disabled",!a),r.chk_descricao_motivo_on_assunto.prop("disabled",!a),r.chk_particular.prop("disabled",!a),r.chk_acesso_supervisor.prop("disabled",!a),r.chk_acesso_substituto.prop("disabled",!a),r.chk_tipo_hora.prop("disabled",!a),r.chk_solicitante_encerra.prop("disabled",!a),r.chk_admin_encerra.prop("disabled",!a),r.cbo_calendario_trabalho.prop("disabled",!a),r.chk_permite_fixar_previsao_retorno.prop("disabled",!a),r.chk_permite_programar_inicio_sla.prop("disabled",!a),r.chk_utiliza_encerramento.prop("disabled",!a),r.edt_horas_encerramento.prop("disabled",!a),r.cbo_calendario_trabalho_encerramento.prop("disabled",!a),r.chk_utiliza_resolucao_atendimento.prop("disabled",!a),r.edt_horas_resolucao_atendimento.prop("disabled",!a),r.cbo_calendario_trabalho_resolucao_atendimento.prop("disabled",!a),r.chk_tipo_config_encerramento.prop("disabled",!a),r.chk_confirmar_leitura_email.prop("disabled",!a),r.chk_notificacao_mensagem_reclassificacao_opcional.prop("disabled",!a),r.chk_notificacao_observacao_interna_opcional.prop("disabled",!a),r.chk_valor_padrao_notificar_envolvolvidos.prop("disabled",!a),r.chk_horas_uteis_encerramento.prop("disabled",!a),r.chk_dias_corridos_encerramento.prop("disabled",!a),r.edt_dias_encerramento.prop("disabled",!a),r.chk_solicitante_chamado_reclassificar_para_qualquer_responsavel.prop("disabled",!a),r.chk_responsavel_chamado_reclassificar_para_qualquer_responsavel.prop("disabled",!a),r.chk_adicionar_usuario_logado_responsavel.prop("disabled",!a),r.chk_definir_situacao_aguardando_responsavel.prop("disabled",!a),r.chk_colaborador_altera_previsao_retorno.prop("disabled",!a),r.chk_obrigatorio_informar_horas.prop("disabled",!a)},this.preencher=function(){WS.get("chamado_motivo/objeto/",{chamado_motivo_id:r.chamado_motivo_id},function(a){r.edt_nome.val(a.nome),r.cbo_cor.val(a.cor),r.edt_emails.val(a.emails),r.edt_emails_acompanhamento.val(a.email_acompanhamento),r.edt_nivel.val(a.nivel),r.chk_bloqueado.prop("checked","S"==a.bloqueado||!0===a.bloqueado).trigger("change"),parseInt(a.dias,10)>0?(r.edt_dias.val(a.dias),r.chk_dias_corridos.prop("checked",!0).trigger("click")):(r.edt_dias.prop("disabled",!0),r.edt_horas.val(format_time(a.horas_uteis)),r.chk_horas_uteis.prop("checked",!0).trigger("click")),parseInt(a.dias_encerramento,10)>0?(r.edt_dias_encerramento.val(a.dias_encerramento),r.chk_dias_corridos_encerramento.prop("checked",!0).trigger("click")):(r.edt_dias_encerramento.prop("disabled",!0),r.edt_horas_encerramento.val(format_time(a.horas_uteis_encerramento)),r.chk_horas_uteis_encerramento.prop("checked",!0).trigger("click")),r.edt_dias.prop("disabled",!0),r.edt_horas_resolucao_atendimento.val(format_time(a.horas_uteis_resolucao_atendimento)),r.listar_calendario_trabalho(a.calendario_trabalho_id,a.calendario_trabalho_id_encerramento,a.calendario_trabalho_id_resolucao_atendimento),r.chk_utiliza_encerramento.prop("checked","S"===a.utiliza_encerramento.toString()).change(),r.chk_permite_fixar_previsao_retorno.prop("checked","S"===a.permite_fixar_previsao_retorno.toString()).change(),r.chk_permite_programar_inicio_sla.prop("checked","S"===a.permite_programar_inicio_sla.toString()).change(),r.chk_utiliza_resolucao_atendimento.prop("checked","S"===a.utiliza_resolucao_atendimento.toString()).trigger("change"),r.chk_altera_solicitante.prop("checked","S"===a.altera_solicitante.toString()).change(),r.chk_publico.prop("checked","S"===a.publico.toString()).change(),"S"==a.chk_exibir_na_abertura_grupo_motivo_chamado&&$(r.chk_publico.parents()[2]).addClass("bg-danger").tooltip({title:'como a opção "Exibir grupo de motivos na abertura de chamados" habilitada esta opção não será utilizada !',placement:"auto",container:"body"}),r.chk_descricao_motivo_on_assunto.prop("checked","S"===a.descricao_motivo_on_assunto.toString()).change(),r.chk_particular.prop("checked","S"===a.particular.toString()).change(),r.chk_acesso_supervisor.prop("checked","S"===a.acesso_supervisor.toString()).change(),r.chk_acesso_substituto.prop("checked","S"===a.acesso_substituto_chamado_privado.toString()).trigger("change"),r.chk_solicitante_encerra.prop("checked","S"===a.somente_solicitante_encerra.toString()).change(),r.chk_admin_encerra.prop("checked","S"===a.somente_admin_encerra.toString()).change(),r.chk_solicitante_chamado_reclassificar_para_qualquer_responsavel.prop("checked","S"===a.solicitante_chamado_reclassificar_para_qualquer_responsavel.toString()).change(),r.chk_responsavel_chamado_reclassificar_para_qualquer_responsavel.prop("checked","S"===a.responsavel_chamado_reclassificar_para_qualquer_responsavel.toString()).change(),r.chk_adicionar_usuario_logado_responsavel.prop("checked","S"===a.adicionar_usuario_logado_responsavel.toString()).change(),r.chk_definir_situacao_aguardando_responsavel.prop("checked","S"===a.definir_situacao_aguardando_responsavel.toString()).change(),r.chk_colaborador_altera_previsao_retorno.prop("checked","S"===a.solicitante_pode_alterar_previsao_retorno.toString()).change(),r.chk_obrigatorio_informar_horas.prop("checked","S"===a.obrigatorio_informar_horas.toString()).change(),r.chk_sugerir_mensagem_padrao_colaboradores.prop("checked","S"===a.sugerir_mensagem_padrao_colaboradores.toString()).change(),r.arr_responsaveis=a.responsaveis,r.chk_confirmar_leitura_email.prop("checked","S"===a.confirmar_leitura_email.toString()).change(),r.chk_notificacao_mensagem_reclassificacao_opcional.prop("checked","S"===a.notificacao_mensagem_reclassificacao_opcional.toString()).change(),r.chk_notificacao_observacao_interna_opcional.prop("checked","S"===a.notificacao_observacao_interna_opcional.toString()).change(),r.chk_valor_padrao_notificar_envolvolvidos.prop("checked","S"===a.valor_padrao_notificar_envolvolvidos.toString()).change(),r.render_responsaveis(),r.cbo_cor_change(),r.edt_mensagem_padrao.val(a.mensagem_padrao),r.render_formulario_avaliacao(a.formulario_avaliacao_id),r.render_formulario_abertura(a.formulario_abertura_id),r.render_formulario_encerramento(a.formulario_encerramento_id),r.projeto_apontamento_id=a.projeto_apontamento_id,r.chk_utiliza_apontamento_chamados.prop("checked","S"===a.utiliza_apontamento_chamado||!0===a.utiliza_apontamento_chamado).trigger("change"),r.chk_registrar_mensagem_apontamento.prop("checked","S"===a.registrar_mensagem_apontamento||!0===a.registrar_mensagem_apontamento).trigger("change"),r.render_grid_projetos(a.projeto_apontamento_id)})},this.render_grid_motivos_entidades=function(){let a=null;r.chk_horas_uteis.prop("checked")?a=CHAMADO_MOTIVO_TEMPO.HORAS_UTEIS:r.chk_dias_corridos.prop("checked")&&(a=CHAMADO_MOTIVO_TEMPO.DIAS_CORRIDOS);let o=r.chk_utiliza_resolucao_atendimento.prop("checked");ReactDOM.unmountComponentAtNode(r.grid_motivos_entidades[0]),ReactDOM.render(React.createElement(window.components.MotivoChamadoEntidades.default,{getDataGridEntidadesMotivo:function(a){r.dataGridEntidadesMotivo=a.current.instance},chamado_motivo_id:r.chamado_motivo_id,tipo_tempo_previsao:a,utiliza_resolucao_atendimento:o,calendarios_trabalho_lista:r.calendarios_trabalho_lista}),r.grid_motivos_entidades[0])},this.render_grid_projetos=function(a){ReactDOM.render(React.createElement(window.components.SelecaoProjeto.default,{selecionado:a,aoAlterar:a=>r.projeto_apontamento_id=a}),r.div_dx_grid_projetos[0])},this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){r.unload()}),this.chk_tipo_hora.unbind("click"),this.chk_tipo_hora.click(function(){r.radios()}),this.chk_tipo_config_encerramento.unbind("click"),this.chk_tipo_config_encerramento.click(function(){r.radios_encerramento()}),this.chk_solicitante_encerra.unbind("click"),this.chk_solicitante_encerra.change(function(a,o){!0===r.chk_solicitante_encerra.prop("checked")&&r.chk_admin_encerra.prop("checked",!1).change()}),this.chk_admin_encerra.unbind("click"),this.chk_admin_encerra.change(function(a,o){!0===r.chk_admin_encerra.prop("checked")&&r.chk_solicitante_encerra.prop("checked",!1).change()}),this.btn_salvar.unbind("click"),this.btn_salvar.click(function(){const a=r.dataGridEntidadesMotivo;if(a){const o=a.getController("editing").getChanges()||[],e=a.getVisibleRows().map(a=>{const e=o.find(o=>o.key===a.key);return{...a.data,...e?.data||{},id:a.key}}),i=[];for(let a=0;a<e.length;a++){const o=e[a];for(let r=a+1;r<e.length;r++){const a=e[r];o.entidade_id===a.entidade_id&&o.chamado_prioridade_id===a.chamado_prioridade_id&&i.push(o,a)}}if(i.length>0)return void alertaPopUp("Validação","Existem entidades com <strong>prioridade duplicada</strong>.","Ok")}r.validar_hora_minuto(r.edt_horas.val())&&r.validar_hora_minuto(r.edt_horas_encerramento.val())&&r.validar_hora_minuto(r.edt_horas_resolucao_atendimento.val())&&(!r.chk_utiliza_apontamento_chamados.prop("checked")||null!==r.projeto_apontamento_id&&""!==r.projeto_apontamento_id?WS.post("chamado_motivo/salvar",{chamado_motivo_id:r.chamado_motivo_id,nome:r.edt_nome.val(),cor:r.cbo_cor.val(),dias:r.edt_dias.val(),emails:r.edt_emails.val(),email_acompanhamento:r.edt_emails_acompanhamento.val(),nivel:r.edt_nivel.val(),bloqueado:r.chk_bloqueado.prop("checked"),altera_solicitante:r.chk_altera_solicitante.prop("checked"),publico:r.chk_publico.prop("checked"),descricao_motivo_on_assunto:r.chk_descricao_motivo_on_assunto.prop("checked"),particular:r.chk_particular.prop("checked"),acesso_supervisor:r.chk_acesso_supervisor.prop("checked"),acesso_substituto_chamado_privado:r.chk_acesso_substituto.prop("checked"),responsaveis:JSON.stringify(r.arr_responsaveis),horas_uteis:r.edt_horas.val(),tipo_gestao_tempo:r.tipo_gestao_tempo,calendario_trabalho_id:r.cbo_calendario_trabalho.val(),somente_admin_encerra:r.chk_admin_encerra.prop("checked"),somente_solicitante_encerra:r.chk_solicitante_encerra.prop("checked"),permite_fixar_previsao_retorno:r.chk_permite_fixar_previsao_retorno.prop("checked"),permite_programar_inicio_sla:r.chk_permite_programar_inicio_sla.prop("checked"),utiliza_encerramento:r.chk_utiliza_encerramento.prop("checked"),utiliza_resolucao_atendimento:r.chk_utiliza_resolucao_atendimento.prop("checked"),horas_uteis_encerramento:r.edt_horas_encerramento.val(),horas_uteis_resolucao_atendimento:r.edt_horas_resolucao_atendimento.val(),calendario_trabalho_id_encerramento:r.cbo_calendario_trabalho_encerramento.val(),calendario_trabalho_id_resolucao_atendimento:r.cbo_calendario_trabalho_resolucao_atendimento.val(),tipo_gestao_tempo_encerramento:r.tipo_gestao_tempo_encerramento,dias_encerramento:r.edt_dias_encerramento.val(),solicitante_chamado_reclassificar_para_qualquer_responsavel:r.chk_solicitante_chamado_reclassificar_para_qualquer_responsavel.prop("checked"),responsavel_chamado_reclassificar_para_qualquer_responsavel:r.chk_responsavel_chamado_reclassificar_para_qualquer_responsavel.prop("checked"),adicionar_usuario_logado_responsavel:r.chk_adicionar_usuario_logado_responsavel.prop("checked"),definir_situacao_aguardando_responsavel:r.chk_definir_situacao_aguardando_responsavel.prop("checked"),solicitante_pode_alterar_previsao_retorno:r.chk_colaborador_altera_previsao_retorno.prop("checked"),obrigatorio_informar_horas:r.chk_obrigatorio_informar_horas.prop("checked"),sugerir_mensagem_padrao_colaboradores:r.chk_sugerir_mensagem_padrao_colaboradores.prop("checked"),mensagem_padrao:r.edt_mensagem_padrao.val(),confirmar_leitura_email:r.chk_confirmar_leitura_email.prop("checked"),notificacao_mensagem_reclassificacao_opcional:r.chk_notificacao_mensagem_reclassificacao_opcional.prop("checked"),notificacao_observacao_interna_opcional:r.chk_notificacao_observacao_interna_opcional.prop("checked"),valor_padrao_notificar_envolvolvidos:r.chk_valor_padrao_notificar_envolvolvidos.prop("checked"),formulario_avaliacao_id:r.cbo_formulario_avaliacao.val(),formulario_abertura_id:r.cbo_formulario_abertura.val(),formulario_encerramento_id:r.cbo_formulario_encerramento.val(),chamado_motivo_entidades:CircularJSON.stringify(r.dataGridEntidadesMotivo.getController("editing").getChanges()),utiliza_apontamento_chamado:r.chk_utiliza_apontamento_chamados.prop("checked"),registrar_mensagem_apontamento:r.chk_registrar_mensagem_apontamento.prop("checked"),projeto_apontamento_id:r.projeto_apontamento_id},function(a){r.chamado_motivo_id=a.id,alert_saved(a.nome+" salvo com sucesso"),r.unload()},[r.btn_excluir,r.btn_salvar,r.btn_cancelar]):alertaPopUp("Validação",'Selecione um Projeto na aba "Projetos" para realizar os apontamentos',"Ok",()=>{}))}),this.btn_excluir.unbind("click"),this.btn_excluir.click(function(){WS.post("chamado_motivo/excluir",{chamado_motivo_id:r.chamado_motivo_id},function(a){alert_saved(a.nome+" excluído com sucesso"),r.unload()},[r.btn_excluir,r.btn_salvar,r.btn_cancelar])}),this.chk_utiliza_encerramento.unbind("change"),this.chk_utiliza_encerramento.change(function(a){1==$(this).prop("checked")?r.div_utiliza_encerramento.removeClass("hidden"):r.div_utiliza_encerramento.addClass("hidden")}),this.chk_utiliza_resolucao_atendimento.on("change",function(a){const o=()=>{1==$(this).prop("checked")?r.div_utiliza_resolucao_atendimento.removeClass("hidden"):r.div_utiliza_resolucao_atendimento.addClass("hidden"),r.render_grid_motivos_entidades()};let e=r.dataGridEntidadesMotivo?r.dataGridEntidadesMotivo.getController("editing").getChanges():[];e&&e.length&&r.validar_grid_motivos_entidades?alertaPopUp("Atenção","A tabela de <strong>Controle de Tempo de Atendimento por Entidade</strong> possui alterações não salvas, que serão descartadas com a alteração dessa configuração. Deseja continuar?","Sim, descartar alterações",()=>{o()},"Não, manter alterações",()=>{r.validar_grid_motivos_entidades=!1,r.aplicar_alteracoes_chk_utiliza_resolucao_atendimento=!1,$(this).prop("checked")?$(this).prop("checked",!1).trigger("change"):$(this).prop("checked",!0).trigger("change"),r.validar_grid_motivos_entidades=!0,r.aplicar_alteracoes_chk_utiliza_resolucao_atendimento=!0}):r.aplicar_alteracoes_chk_utiliza_resolucao_atendimento&&o()}),this.chk_particular.unbind("change"),this.chk_particular.change(function(a,o){!0===r.chk_particular.prop("checked")?(r.edt_emails.prop("disabled",!0),r.edt_emails_acompanhamento.prop("disabled",!0),r.edt_emails.val(null),r.edt_emails_acompanhamento.val(null),r.tr_acesso_supervisor.removeClass("hidden"),r.tr_acesso_substituto.removeClass("hidden")):(r.edt_emails.prop("disabled",!1),r.edt_emails_acompanhamento.prop("disabled",!1),r.tr_acesso_supervisor.addClass("hidden"),r.tr_acesso_substituto.addClass("hidden"))}),this.cbo_cor.unbind("change"),this.cbo_cor.change(function(){r.cbo_cor_change()}),this.render_formulario_avaliacao=function(a){WS.get("formulario/listar/",{tipo_formulario:1},function(o){r.cbo_formulario_avaliacao.find("option").remove(),add_option(r.cbo_formulario_avaliacao,"","Nenhum");for(var e=0;e<o.length;e++){var i=o[e];add_option(r.cbo_formulario_avaliacao,i.formulario_id,i.nome)}a&&r.cbo_formulario_avaliacao.val(a)})},this.render_formulario_abertura=function(a){WS.get("formulario/listar/",{tipo_formulario:1},function(o){r.cbo_formulario_abertura.find("option").remove(),add_option(r.cbo_formulario_abertura,"","Nenhum");for(var e=0;e<o.length;e++){var i=o[e];add_option(r.cbo_formulario_abertura,i.formulario_id,i.nome)}a&&r.cbo_formulario_abertura.val(a)})},this.render_formulario_encerramento=function(a){WS.get("formulario/listar/",{tipo_formulario:1},function(o){r.cbo_formulario_encerramento.find("option").remove(),add_option(r.cbo_formulario_encerramento,"","Nenhum");for(var e=0;e<o.length;e++){var i=o[e];add_option(r.cbo_formulario_encerramento,i.formulario_id,i.nome)}a&&r.cbo_formulario_encerramento.val(a)})},this.exibir_div_valor_padrao_notificar_envolvolvidos=()=>{!0===r.chk_notificacao_observacao_interna_opcional.prop("checked")||!0===r.chk_notificacao_mensagem_reclassificacao_opcional.prop("checked")?r.div_valor_padrao_notificar_envolvolvidos.removeClass("hidden"):r.div_valor_padrao_notificar_envolvolvidos.addClass("hidden")},this.chk_notificacao_observacao_interna_opcional.on("change",this.exibir_div_valor_padrao_notificar_envolvolvidos),this.chk_notificacao_mensagem_reclassificacao_opcional.on("change",this.exibir_div_valor_padrao_notificar_envolvolvidos),this.chk_utiliza_apontamento_chamados.on("change",function(a){$(this).prop("checked")?(r.div_projeto_apontamento.removeClass("hidden"),r.div_registrar_mensagem_apontamento.removeClass("hidden")):(r.div_projeto_apontamento.addClass("hidden"),r.div_registrar_mensagem_apontamento.addClass("hidden"))})}});