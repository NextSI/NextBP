define(["react","react-dom","./../central_documentos/SelectPasta"],function(a,o,e){return function(i){"use strict";var r=this;this.html_id=i,this.dialog=$("#"+this.html_id),this.title="Modelagem de Processo",this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.tipo=null,this.onclose=null,this.btn_fechar=null,this.scrollview=this.dialog.find(".scrollview"),this.menu_configuracoes=this.dialog.find(".menu_configuracoes"),this.menu_atividades=this.dialog.find(".menu_atividades"),this.menu_versoes=this.dialog.find(".menu_versoes"),this.menu_supervisores=this.dialog.find(".menu_supervisores"),this.menu_recorrencia=this.dialog.find(".menu_recorrencia"),this.menu_diagrama=this.dialog.find(".menu_diagrama"),this.aba_configuracoes=this.dialog.find(".aba_configuracoes"),this.aba_atividades=this.dialog.find(".aba_atividades"),this.aba_versoes=this.dialog.find(".aba_versoes"),this.aba_supervisores=this.dialog.find(".aba_supervisores"),this.aba_periodicidade=this.dialog.find(".aba_periodicidade"),this.aba_diagrama=this.dialog.find(".aba_diagrama"),this.lbl_titulo_processo=this.dialog.find(".lbl_titulo_processo"),this.edt_nome=this.dialog.find(".edt_nome"),this.nome_tabela=this.dialog.find(".nome_tabela"),this.edt_instrucao_trabalho=this.dialog.find(".edt_instrucao_trabalho"),this.chk_ativo=this.dialog.find(".chk_ativo"),this.chk_cliente=this.dialog.find(".chk_cliente"),this.chk_diretorio=this.dialog.find(".chk_diretorio"),this.tr_escolha_pasta_anexos_solicitacao=this.dialog.find(".tr_escolha_pasta_anexos_solicitacao"),this.tr_armazenar_anexos_modulo_documentos=this.dialog.find(".tr_armazenar_anexos_modulo_documentos"),this.cbo_categoria_processos=this.dialog.find(".cbo_categoria_processos"),this.btn_categoria_processos_visualizar=this.dialog.find(".btn_categoria_processos_visualizar"),this.btn_categoria_processos_recarregar=this.dialog.find(".btn_categoria_processos_recarregar"),this.btn_categoria_processos_novo=this.dialog.find(".btn_categoria_processos_novo"),this.div_pasta=this.dialog.find(".div_pasta"),this.selectPasta=a.createElement(e,null,null),this.cbo_calendario_trabalho=this.dialog.find(".cbo_calendario_trabalho"),this.btn_calendario_trabalho_visualizar=this.dialog.find(".btn_calendario_trabalho_visualizar"),this.btn_calendario_trabalho_recarregar=this.dialog.find(".btn_calendario_trabalho_recarregar"),this.btn_calendario_trabalho_novo=this.dialog.find(".btn_calendario_trabalho_novo"),this.cbo_formulario=this.dialog.find(".cbo_formulario"),this.btn_formulario_visualizar=this.dialog.find(".btn_formulario_visualizar"),this.btn_formulario_recarregar=this.dialog.find(".btn_formulario_recarregar"),this.btn_formulario_novo=this.dialog.find(".btn_formulario_novo"),this.chk_permite_anexos=this.dialog.find(".chk_permite_anexos"),this.chk_exibir_modal_confirmacao_envio=this.dialog.find(".chk_exibir_modal_confirmacao_envio"),this.chk_permite_download_formulario_nao_concluido=this.dialog.find(".chk_permite_download_formulario_nao_concluido"),this.div_anexo_relacao=this.dialog.find(".div_anexo_relacao"),this.btn_nova_versao=this.dialog.find(".btn_nova_versao"),this.tab_supervisores=this.dialog.find(".tab_supervisores"),this.cbo_supervisores=this.dialog.find(".cbo_supervisores"),this.chk_cliente_acompanha=this.dialog.find(".chk_cliente_acompanha"),this.div_cliente_acompanha=this.dialog.find(".cliente_acompanha"),this.chk_solicitante_acompanha=this.dialog.find(".chk_solicitante_acompanha"),this.div_solicitante_acompanha=this.dialog.find(".solicitante_acompanha"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_salvar_processo=this.dialog.find(".btn_salvar_processo"),this.btn_excluir=this.dialog.find(".btn_excluir"),this.tab_atividades=this.dialog.find(".tab_atividades"),this.div_diagrama=this.dialog.find(".div_diagrama"),this.tab_versoes=this.dialog.find(".tab_versoes"),this.abertura_automatica_ativo=this.dialog.find(".abertura_automatica_ativo"),this.permitir_abertura_manual=this.dialog.find(".permitir_abertura_manual"),this.abertura_automatica_dias=this.dialog.find(".abertura_automatica_dias"),this.abertura_automatica_quantidade=this.dialog.find(".abertura_automatica_quantidade"),this.abertura_automatica_hora_abertura=this.dialog.find(".abertura_automatica_hora_abertura"),this.abertura_automatica_ultimo_sincronismo=this.dialog.find(".abertura_automatica_ultimo_sincronismo"),this.div_configuracoes_abertura_automatica=this.dialog.find(".div_configuracoes_abertura_automatica"),this.processo={processo_id:null,nome:"",nova_versao_observacao:"",instrucao_trabalho:"",ativo:!1,categoria_processos_id:null,calendario_trabalho_id:null,formulario_id:null,permite_anexos:!0,documento_pasta_id:null,elementos:[],diagrama:null},this.arr_versoes=[],this.formulario=null,this.array_supervisores=[],this.array_grupo_supervisores=[],this.diagram=null,this.elemento_shape_temporario=null,this.elemento_connector_temporario=null,this.flag_primeiro_carregamento=!0,this.conectores_diagrama=[],this.show=function(a,e){switch(r.scrollview.dxScrollView().dxScrollView("instance"),r.scrollview.css("height","calc(100vh - 45px)"),o.render(r.selectPasta,r.div_pasta[0]),r.aba_configuracoes.attr("id","aba_configuracoes"+r.html_id),r.aba_atividades.attr("id","aba_atividades"+r.html_id),r.aba_diagrama.attr("id","aba_diagrama"+r.html_id),r.aba_versoes.attr("id","aba_versoes"+r.html_id),r.aba_supervisores.attr("id","aba_supervisores"+r.html_id),r.aba_periodicidade.attr("id","aba_periodicidade"+r.html_id),r.menu_configuracoes.attr("href","#"+r.aba_configuracoes.attr("id")),r.menu_atividades.attr("href","#"+r.aba_atividades.attr("id")),r.menu_diagrama.attr("href","#"+r.aba_diagrama.attr("id")),r.menu_versoes.attr("href","#"+r.aba_versoes.attr("id")),r.menu_supervisores.attr("href","#"+r.aba_supervisores.attr("id")),r.menu_recorrencia.attr("href","#"+r.aba_periodicidade.attr("id")),r.edt_instrucao_trabalho.attr("id","edt_instrucao_trabalho"+r.html_id),e){case FORMULARIO.NOVO:case FORMULARIO.EDITAR:r.btn_salvar_processo.show(),r.btn_excluir.hide(),r.permite_alterar(!0);break;case FORMULARIO.VISUALIZAR:r.btn_salvar_processo.hide(),r.btn_excluir.hide(),r.permite_alterar(!1);break;case FORMULARIO.EXCLUIR:r.btn_salvar_processo.hide(),r.btn_excluir.show(),r.permite_alterar(!1)}r.tipo=e,void 0!==a&&a?(r.processo.processo_id=a,r.preencher()):(set_tinymce(r.edt_instrucao_trabalho,""),r.listar_formulario(),r.listar_categoria_processos(),r.listar_documento_pasta(),r.listar_calendario_trabalho(),r.listar_versoes(),r.listar_periodicidade(),r.chk_permite_anexos.prop("checked",!0).change(),r.chk_exibir_modal_confirmacao_envio.prop("checked",!0).trigger("change"),r.nome_tabela.val("p_")),create_combobox(r.cbo_supervisores,r.listar_supervisores),set_focus(r.edt_nome),setTimeout(function(){r.btn_fechar=$('[aba-id-md5="'+r.html_id+'"] .btn_fechar'),r.btn_fechar.click(function(){void 0!==r.onclose&&r.onclose&&r.onclose()})},300)},this.close=function(){close_modal(r.modal.attr("id")),void 0!==r.onclose&&r.onclose&&r.onclose()},this.unload=function(){r.close(),View.unload(this.html_id)},this.permite_alterar=function(a){r.edt_nome.prop("disabled",!a),r.cbo_supervisores.prop("disabled",!a),r.btn_nova_versao.prop("disabled",!a),r.selectPasta.props.setDesabilitado(!a),r.cbo_categoria_processos.prop("disabled",!a),r.cbo_calendario_trabalho.prop("disabled",!a),r.btn_formulario_novo.prop("disabled",!a),r.btn_categoria_processos_novo.prop("disabled",!a),r.btn_calendario_trabalho_novo.prop("disabled",!a)},this.listar_supervisores=function(a){var o=r.cbo_supervisores.parent(),e=o.find(".edt_combobox");WS.get("usuario/listar_usuarios_grupos/",{nome:e.val(),equipe_interna:!0,listar_grupos:!0,modulo:MODULOS.PROCESSO},function(i){limpar_combobox(r.cbo_supervisores),$(i).each(function(a,o){var e=[];e.Nome=o.nome;var i=$('<span class="label lb_tipo" style="margin: 5px;"></span>');"usuarios"==o.tipo?(i.addClass("tipo_supervisor label-info"),i.attr("title","Usuário"),i.attr("data-original-title","Usuário"),i.text("U"),i.attr("tipo","usuarios")):"grupo_usuarios"==o.tipo&&(i.addClass("tipo_supervisor label-warning"),i.attr("title","Grupo de Usuários"),i.attr("data-original-title","Grupo de Usuários"),i.text("GU"),i.attr("tipo","grupo_usuarios")),i.tooltip(),add_option_combobox(r.cbo_supervisores,a,o.id>0?o.id:null,e,i)}),a(!0),e.keypress(function(a){if(13==a.keyCode){var o=r.cbo_supervisores.parent().find(".ncbo_scroll").find(".row_selected"),i=e.attr("selected-value"),t=o.find(".tipo_supervisor").attr("tipo"),s=e.val();if(i>0){if("usuarios"==t){var c=!1;if($(r.array_supervisores).each(function(a,o){o.usuario_id===i&&"N"==o.excluido&&(c=!0)}),!c){var n={usuario_id:i,nome:s,excluido:"N",permite_edicao:!1,notifica_cancelamento:!0};r.array_supervisores.push(n),r.render_supervisores(n)}}else if("grupo_usuarios"==t){c=!1;if($(r.array_grupo_supervisores).each(function(a,o){o.grupo_usuarios_id===i&&"N"==o.excluido&&(c=!0)}),!c){var _={grupo_usuarios_id:i,nome:s,excluido:"N",permite_edicao:!1,notifica_cancelamento:!0};r.array_grupo_supervisores.push(_),r.render_supervisores(null,_)}}e.val(""),set_focus(e)}}});o.find(".ul_row").bind("click",function(){var a=$(this).parent().attr("id_registro"),o=$(this).find(".tipo_supervisor").attr("tipo");if(a>0){if("usuarios"==o){var i=!1;$(r.array_supervisores).each(function(o,e){e.usuario_id===a&&"N"==e.excluido&&(i=!0)}),setTimeout(function(){if(!i){var o={usuario_id:a,nome:e.val(),excluido:"N",permite_edicao:!1,notifica_cancelamento:!0};r.array_supervisores.push(o),r.render_supervisores(o)}},150)}else if("grupo_usuarios"==o){i=!1;$(r.grupo_usuarios_equipe).each(function(o,e){e.grupo_usuarios_id===a&&"N"==e.excluido&&(i=!0)}),setTimeout(function(){if(!i){var o={grupo_usuarios_id:a,nome:e.val(),excluido:"N",permite_edicao:!1,notifica_cancelamento:!0};r.array_grupo_supervisores.push(o),r.render_supervisores(null,o)}},150)}e.val(""),set_focus(e)}e.val(""),set_focus(e)})})},this.render_supervisores=function(a,o){var e=r.tab_supervisores.find("tbody"),i=e.find("[template-row]"),t=function(a,o,t){var s=i.clone();s.removeAttr("template-row"),s.css("display",""),s.addClass("rows");var c=$(s.find("[template-field='tipo']")),n=$(s.find(".chk_permite_edicao")),_=$(s.find(".chk_notifica_cancelamento"));n.removeClass("template_switch"),App.aplicar_checkbox(n.parent()),_.removeClass("template_switch"),App.aplicar_checkbox(_.parent()),o?($(n).prop("checked",r.array_grupo_supervisores[t].permite_edicao).change(),$(n).change(function(a){r.array_grupo_supervisores[t].permite_edicao=$(this).prop("checked")}),$(_).prop("checked",r.array_grupo_supervisores[t].notifica_cancelamento).change(),$(_).change(function(a){r.array_grupo_supervisores[t].notifica_cancelamento=$(this).prop("checked")})):($(n).prop("checked",r.array_supervisores[t].permite_edicao).change(),$(n).change(function(a){r.array_supervisores[t].permite_edicao=$(this).prop("checked")}),$(_).prop("checked",r.array_supervisores[t].notifica_cancelamento).change(),$(_).change(function(a){r.array_supervisores[t].notifica_cancelamento=$(this).prop("checked")})),o?(c.addClass("label-warning"),c.attr("title","Grupo de Usuários"),c.attr("data-original-title","Grupo de Usuários"),c.text("GU")):(c.addClass("label-info"),c.attr("title","Usuário"),c.attr("data-original-title","Usuário"),c.text("U")),c.tooltip(),$(s.find("[template-field='nome']")).text(a.nome);var d=$(s.find(".btn_usuario_remover"));d.unbind("click"),d.click(function(){o?alert_modal("Validação","Deseja remover o Grupo de Usuários?","Remover",function(){$(r.array_grupo_supervisores).each(function(o,e){e.grupo_usuarios_id==a.grupo_usuarios_id&&(s.remove(),r.array_grupo_supervisores[o].excluido="S")})},!0):alert_modal("Validação","Deseja remover o Usuário?","Remover",function(){$(r.array_supervisores).each(function(o,e){e.usuario_id==a.usuario_id&&(s.remove(),r.array_supervisores[o].excluido="S")})},!0)}),s.appendTo(e)};r.tab_supervisores.find(".rows").remove(),$(r.array_supervisores).each(function(a,o){"N"==o.excluido&&t(o,!1,a)}),$(r.array_grupo_supervisores).each(function(a,o){"N"==o.excluido&&t(o,!0,a)})},this.preencher=function(a,o){var e=function(a){r.array_supervisores=a.array_supervisores,r.array_grupo_supervisores=a.array_grupo_supervisores,r.render_supervisores(),r.lbl_titulo_processo.text(a.nome),r.edt_nome.val(a.nome),a.nome_tabela?(r.nome_tabela.val(a.nome_tabela).prop("disabled",!0),r.cbo_formulario.prop("disabled",!0),r.btn_formulario_recarregar.prop("disabled",!0),r.btn_formulario_novo.prop("disabled",!0)):r.nome_tabela.val("p_"),set_tinymce(r.edt_instrucao_trabalho,a.instrucao_trabalho),r.chk_ativo.prop("disabled",!1),r.chk_cliente.prop("disabled",!1),r.chk_diretorio.prop("disabled",!1),r.chk_cliente_acompanha.prop("disabled",!1),r.chk_solicitante_acompanha.prop("disabled",!1),r.chk_permite_anexos.prop("disabled",!1),r.chk_exibir_modal_confirmacao_envio.prop("disabled",!1),r.chk_permite_download_formulario_nao_concluido.prop("disabled",!1),r.chk_ativo.prop("checked",!0===a.ativo).change(),r.chk_cliente.prop("checked",!0===a.relaciona_cliente).change(),r.chk_diretorio.prop("checked",!0===a.escolher_pasta_solicitacao).change(),r.chk_permite_download_formulario_nao_concluido.prop("checked",!0===a.permite_download_formulario_nao_concluido).change(),r.listar_categoria_processos(a.categoria_processos_id),r.processo.documento_pasta_id=a.documento_pasta_id,r.listar_documento_pasta(a.documento_pasta_id,a.documento_pasta_path),r.listar_calendario_trabalho(a.calendario_trabalho_id),r.listar_formulario(a.formulario_id),r.chk_permite_anexos.prop("checked",!0===a.permite_anexos).change(),r.chk_exibir_modal_confirmacao_envio.prop("checked",!0===a.exibir_modal_confirmacao_envio||"S"==a.exibir_modal_confirmacao_envio).trigger("change"),r.chk_cliente_acompanha.prop("checked",!0===a.cliente_acompanha).change(),r.chk_solicitante_acompanha.prop("checked",!0===a.solicitante_acompanha).change(),r.tipo!=FORMULARIO.VISUALIZAR&&r.tipo!=FORMULARIO.EXCLUIR||(r.chk_ativo.prop("disabled",!0),r.chk_cliente.prop("disabled",!0),r.chk_diretorio.prop("disabled",!0),r.chk_permite_anexos.prop("disabled",!0),r.chk_exibir_modal_confirmacao_envio.prop("disabled",!0),r.chk_cliente_acompanha.prop("disabled",!0),r.chk_solicitante_acompanha.prop("disabled",!0),r.chk_permite_download_formulario_nao_concluido.prop("disabled",!0)),r.processo.elementos=a.elementos,r.processo.diagrama=a.diagrama?JSON.parse(a.diagrama):null,r.listar_versoes(),r.listar_periodicidade(a.abertura_automatica_ativo,a.abertura_automatica_dias,a.abertura_automatica_quantidade,a.abertura_automatica_hora_abertura,a.abertura_automatica_ultimo_sincronismo,a.permitir_abertura_manual),"function"==typeof o&&o()};a?e(a):WS.get("processo/objeto/",{processo_id:r.processo.processo_id},e)},this.listar_categoria_processos=function(a){r.cbo_categoria_processos.find("option").remove(),add_option(r.cbo_categoria_processos,"","Nenhum"),WS.get("categoria_processos/listar/",null,function(o){for(var e=0;e<o.length;e++){var i=o[e];add_option(r.cbo_categoria_processos,i.categoria_processos_id,i.nome)}r.cbo_categoria_processos.selectpicker("refresh"),a&&r.cbo_categoria_processos.selectpicker("val",a).change()})},this.listar_documento_pasta=function(a,o){if(a){var e=void 0===o||""===o;r.selectPasta.props.setDocumentoPastaID(a,e)}void 0!==o&&""!==o&&r.selectPasta.props.setDocumentoPastaPath(o),r.selectPasta.props.handleSelecionar=function(){r.processo.documento_pasta_id=r.selectPasta.props.documentoPastaID}},this.listar_calendario_trabalho=function(a){r.cbo_calendario_trabalho.find("option").remove(),add_option(r.cbo_calendario_trabalho,"","Nenhum"),WS.get("calendario_trabalho/listar/",null,function(o){for(var e=0;e<o.length;e++){var i=o[e];add_option(r.cbo_calendario_trabalho,i.calendario_trabalho_id,i.nome)}r.cbo_calendario_trabalho.selectpicker("refresh"),a&&r.cbo_calendario_trabalho.selectpicker("val",a).change()})},this.listar_formulario=function(a){r.cbo_formulario.find("option").remove(),add_option(r.cbo_formulario,"","Nenhum"),WS.get("formulario/listar/",null,function(o){for(var e=0;e<o.length;e++){var i=o[e];add_option(r.cbo_formulario,i.formulario_id,i.nome)}r.cbo_formulario.selectpicker("refresh"),a&&r.cbo_formulario.selectpicker("val",a).change()})},this.listar_versoes=function(){WS.get("processo/listar_versoes/",{processo_id:r.processo.processo_id},function(a){r.arr_versoes=a,r.render_versoes()})},this.listar_periodicidade=function(a,o,e,i,t,s){var c=function(a){a?r.div_configuracoes_abertura_automatica.removeClass("hidden"):r.div_configuracoes_abertura_automatica.addClass("hidden")};a=void 0!==a&&a,s=void 0!==s&&s;r.abertura_automatica_ativo.dxSwitch({value:a,onValueChanged:function(a){c(a.value)}}),r.permitir_abertura_manual.dxSwitch({value:s}),c(a);r.abertura_automatica_dias.dxTagBox({dataSource:new DevExpress.data.DataSource.default({store:[{ID:1,descricao:"Primeiro dia de cada mês",categoria:"Dias do mês"},{ID:2,descricao:"Dia 2 de cada mês",categoria:"Dias do mês"},{ID:3,descricao:"Dia 3 de cada mês",categoria:"Dias do mês"},{ID:4,descricao:"Dia 4 de cada mês",categoria:"Dias do mês"},{ID:5,descricao:"Dia 5 de cada mês",categoria:"Dias do mês"},{ID:6,descricao:"Dia 6 de cada mês",categoria:"Dias do mês"},{ID:7,descricao:"Dia 7 de cada mês",categoria:"Dias do mês"},{ID:8,descricao:"Dia 8 de cada mês",categoria:"Dias do mês"},{ID:9,descricao:"Dia 9 de cada mês",categoria:"Dias do mês"},{ID:10,descricao:"Dia 10 de cada mês",categoria:"Dias do mês"},{ID:12,descricao:"Dia 12 de cada mês",categoria:"Dias do mês"},{ID:13,descricao:"Dia 13 de cada mês",categoria:"Dias do mês"},{ID:14,descricao:"Dia 14 de cada mês",categoria:"Dias do mês"},{ID:15,descricao:"Dia 15 de cada mês",categoria:"Dias do mês"},{ID:16,descricao:"Dia 16 de cada mês",categoria:"Dias do mês"},{ID:17,descricao:"Dia 17 de cada mês",categoria:"Dias do mês"},{ID:18,descricao:"Dia 18 de cada mês",categoria:"Dias do mês"},{ID:19,descricao:"Dia 19 de cada mês",categoria:"Dias do mês"},{ID:20,descricao:"Dia 20 de cada mês",categoria:"Dias do mês"},{ID:21,descricao:"Dia 21 de cada mês",categoria:"Dias do mês"},{ID:22,descricao:"Dia 22 de cada mês",categoria:"Dias do mês"},{ID:23,descricao:"Dia 23 de cada mês",categoria:"Dias do mês"},{ID:24,descricao:"Dia 24 de cada mês",categoria:"Dias do mês"},{ID:25,descricao:"Dia 25 de cada mês",categoria:"Dias do mês"},{ID:26,descricao:"Dia 26 de cada mês",categoria:"Dias do mês"},{ID:27,descricao:"Dia 27 de cada mês",categoria:"Dias do mês"},{ID:28,descricao:"Dia 28 de cada mês",categoria:"Dias do mês"},{ID:29,descricao:"Dia 29 de cada mês",categoria:"Dias do mês"},{ID:30,descricao:"Dia 30 de cada mês",categoria:"Dias do mês"},{ID:31,descricao:"Dia 31 de cada mês",categoria:"Dias do mês"},{ID:32,descricao:"Último dia de cada mês",categoria:"Dias do mês"},{ID:33,descricao:"Todo Domingo",categoria:"Dias da semana"},{ID:34,descricao:"Toda Segunda-feira",categoria:"Dias da semana"},{ID:35,descricao:"Toda Terça-feira",categoria:"Dias da semana"},{ID:36,descricao:"Toda Quarta-feira",categoria:"Dias da semana"},{ID:37,descricao:"Toda Quinta-feira",categoria:"Dias da semana"},{ID:38,descricao:"Toda Sexta-feira",categoria:"Dias da semana"},{ID:39,descricao:"Todo Sábado",categoria:"Dias da semana"}],group:"categoria"}),grouped:!0,displayExpr:"descricao",valueExpr:"ID",showSelectionControls:!0,applyValueMode:"useButtons",searchEnabled:!0,value:o?JSON.parse(o):null,onOpened:function(a){a.component._popup.option("resizeEnabled",!0)}}),r.abertura_automatica_quantidade.dxNumberBox({value:e||1,min:1,showSpinButtons:!0}),r.abertura_automatica_hora_abertura.dxDateBox({type:"time",pickerType:"rollers",value:i?new Date(agora(!0).substring(0,10)+"T"+i.substr(0,5)):null}),r.abertura_automatica_ultimo_sincronismo.dxDateBox({type:"datetime",disabled:!0,value:t?new Date(t.substring(0,10)+"T"+t.substr(11,8)):null})},this.render_atividades=function(){require(["./assets/view/processo/util"],function(a){(new a).render_atividades(r.tab_atividades,r.processo,r.formulario,r.elemento_onsave)})},this.render_diagrama=function(){require(["./assets/view/processo/util"],function(a){var o=new a,e=[];r.conectores_diagrama=[],o.gerar_elem_key(r.processo,e,r.conectores_diagrama),r.flag_primeiro_carregamento||(r.processo.diagrama=JSON.parse(r.diagram.export())),r.diagram=dx_Diagrama({div_html:r.div_diagrama,elementos:e,conectores:r.conectores_diagrama,nodes_on_inserting:dx_Diagrama_Node_OnInserting(r),nodes_on_removing:dx_Diagrama_Node_OnRemoving(r,o),edges_on_inserting:dx_Diagrama_Edge_OnInserting(r),edges_on_updating:dx_Diagrama_Edge_OnUpdating(r),edges_on_removing:dx_Diagrama_Edge_OnRemoving(r),on_content_ready:dx_Diagrama_Importar_Diagrama_Processo(r),on_dbl_click:dx_Diagrama_Dbl_Click(r),diferenca_altura:0}),View.setHideEvent(r.html_id,function(){setTimeout(function(){App.abas.find("[aba-id-md5="+r.html_id+"]").length&&r.diagram.repaint()})}),View.setShowEvent(r.html_id,function(){setTimeout(function(){r.diagram.repaint()})})})},this.elemento_onsave=function(a,o){if(void 0!==a){if(void 0!==r.processo.elementos&&r.processo.elementos){for(var e=-1,i=0;i<r.processo.elementos.length;i++)if(r.processo.elementos[i].elem_key==a.elem_key){e=i;break}if(e<0)r.processo.elementos.push(a);else if(r.processo.elementos[e]=a,r.conectores_diagrama.length>0){let o=null;a.elemento_tipo==PROCESSO_ELEMENTO_TIPO.GATEWAY?o="gateway_"+a.id:a.elemento_tipo==PROCESSO_ELEMENTO_TIPO.ATIVIDADE&&(o="atividade_"+a.id);let e=r.conectores_diagrama.filter(a=>a.from==o);for(let i=0;i<a.destinos.length;i++){let t=a.destinos[i],s=null;if(t.elemento_tipo==PROCESSO_ELEMENTO_TIPO.ATIVIDADE?s="atividade_"+t.id:t.elemento_tipo==PROCESSO_ELEMENTO_TIPO.GATEWAY&&(s="gateway_"+t.id),0==e.filter(a=>a.to==s).length){let a={from:o,id:o+"_"+s,to:s};r.conectores_diagrama.push(a)}}}}if(o)for(i=0;i<r.processo.elementos.length;i++)if(o.elem_key==r.processo.elementos[i].elem_key){var t={tipo:a.tipo,elemento_tipo:a.elemento_tipo,descricao:a.descricao,elem_key:a.elem_key,permite_retorno:!!a.permite_retorno&&a.permite_retorno,opcional:!!a.opcional&&a.opcional,sequencia:a.sequencia,evento_enviar:null,filtro_evento_enviar:null,tipo_automacao:null};r.processo.elementos[i].destinos.push(t)}if(r.elemento_shape_temporario&&(r.elemento_shape_temporario.dataKey=(a.elemento_tipo==PROCESSO_ELEMENTO_TIPO.ATIVIDADE?"atividade_":"gateway_")+(a.id?a.id:a.elem_key)),r.elemento_connector_temporario){var s=JSON.parse(r.diagram.export());for(i=0;i<s.shapes.length;i++){var c=s.shapes[i];if(r.elemento_connector_temporario.beginItemKey==c.key){r.elemento_connector_temporario.dataKey=c.dataKey+"_"+r.elemento_shape_temporario.dataKey;break}}}}r.render_atividades()},this.carregar_formulario=function(a){WS.get("formulario/objeto/",{formulario_id:a},function(a){r.formulario=a})},this.render_versoes=function(){var a=r.tab_versoes.find("tbody"),o=a.find("tr:first");r.tab_versoes.find("tr:gt(1)").remove(),$(r.arr_versoes).each(function(e,i){!function(e){var i=o.clone();i.removeAttr("template-row"),i.css("display",""),e.ativa&&i.addClass("bg-success");var t=$(i.find("[template-field='ativa']"));e.ativa?t.show():t.hide(),$(i.find("[template-field='sequencia']")).text(e.sequencia),$(i.find("[template-field='publicacao']")).text(e.publicacao?e.publicacao.format_date_time():"");var s=$(i.find("[template-field='nova_versao_observacao']"));e.nova_versao_observacao&&(s.tooltip({title:e.nova_versao_observacao.substr(0,500),placement:"auto"}),s.tooltip().click(function(){alertaPopUp("Mudanças da nova versão do processo",e.nova_versao_observacao)}));var c=$(i.find(".btn_ativar_versao"));c.unbind("click");var n=i.find(".btn_restaurar_versao");n.unbind("click");var _=$(i.find(".btn_versao_teste"));_.unbind("click"),e.ativa?(c.hide(),_.hide()):(c.click(function(){alert_modal(r.lbl_titulo_processo.text(),'Deseja ativar esta versão do processo?<hr/><strong class="text-danger">OBS: Essa alteração afetará os formulários, os mesmo voltarão igual a versão ativa.</strong><br><strong class="text-info">As alterações feitas na modelagem que não foram versionadas serão perdidas.</strong>',"Ativar versão",function(){WS.post("processo/ativar_versao/",{versao_processo_id:e.versao_processo_id},function(a){r.arr_versoes=a,r.flag_primeiro_carregamento=!0,r.render_versoes(),r.preencher()},[c])},!0)}),c.show()),n.click(function(){alert_modal(r.lbl_titulo_processo.text(),'Deseja restaurar a modelagem?<hr/><strong class="text-info">As alterações feitas na modelagem que não foram versionadas serão perdidas.</strong>',"Restaurar versão",function(){WS.post("processo/ativar_versao/",{versao_processo_id:e.versao_processo_id,restaurar:!0},function(a){r.arr_versoes=a,r.flag_primeiro_carregamento=!0,r.render_versoes(),r.preencher()},[c])},!0)}),"S"!=e.versao_teste?(_.click(function(){alert_modal(r.lbl_titulo_processo.text(),"Deseja marcar esta versão como teste?","Versão de teste",function(){WS.post("processo/versao_teste/",{versao_processo_id:e.versao_processo_id},function(a){r.arr_versoes=a,r.render_versoes()},[_])},!0)}),_.show()):(i.addClass("bg-warning"),i.find(".icone_teste").removeClass("hidden"),_.hide());var d=$(i.find(".btn_documentacao_versao"));d.unbind("click"),d.click(function(){App.obter_token_publico(function(a){App.download(WS_URI+"processo/download_versao/?versao_processo_id="+e.versao_processo_id+"&empresa_filial_id="+App.temp.empresa+"&token_publico="+a)})}),i.appendTo(a)}(i)})},this.edt_nome.unbind("keyup"),this.edt_nome.keyup(function(){r.lbl_titulo_processo.text(r.edt_nome.val())}),this.nome_tabela.unbind("keydown").bind("keydown",function(a){if(!new RegExp("^[_0-9a-zA-Z\b]+$").test(a.key))return a.preventDefault(),!1;setTimeout(function(){0!==r.nome_tabela.val().indexOf("p_")?r.nome_tabela.val("p_"):r.nome_tabela.val(removerAcentos(r.nome_tabela.val()))})}),this.nome_tabela.unbind("paste").bind("paste",function(a){a.preventDefault()}),this.btn_categoria_processos_visualizar.unbind("click"),this.btn_categoria_processos_visualizar.click(function(){""!=r.cbo_categoria_processos.val()&&View.load("categoria_processos/detalhes",function(a,o){o.show(r.cbo_categoria_processos.val(),FORMULARIO.VISUALIZAR)})}),this.btn_categoria_processos_recarregar.unbind("click"),this.btn_categoria_processos_recarregar.click(function(){r.listar_categoria_processos(r.cbo_categoria_processos.val())}),this.btn_categoria_processos_novo.unbind("click"),this.btn_categoria_processos_novo.click(function(){View.load("categoria_processos/detalhes",function(a,o){o.onclose=function(){o.categoria_processos_id&&r.listar_categoria_processos(o.categoria_processos_id)},o.show(null,FORMULARIO.NOVO)})}),this.btn_calendario_trabalho_visualizar.unbind("click"),this.btn_calendario_trabalho_visualizar.click(function(){""!=r.cbo_calendario_trabalho.val()&&View.load("calendario_trabalho/detalhes",function(a,o){o.show(r.cbo_calendario_trabalho.val(),FORMULARIO.VISUALIZAR)})}),this.btn_calendario_trabalho_recarregar.unbind("click"),this.btn_calendario_trabalho_recarregar.click(function(){r.listar_calendario_trabalho(r.cbo_calendario_trabalho.val())}),this.btn_calendario_trabalho_novo.unbind("click"),this.btn_calendario_trabalho_novo.click(function(){View.load("calendario_trabalho/detalhes",function(a,o){o.onclose=function(){o.calendario_trabalho_id&&r.listar_calendario_trabalho(o.calendario_trabalho_id)},o.show(null,FORMULARIO.NOVO)})}),this.btn_formulario_visualizar.unbind("click"),this.btn_formulario_visualizar.click(function(){""!=r.cbo_formulario.val()&&View.load("formulario/detalhes",function(a,o){o.show(r.cbo_formulario.val(),FORMULARIO.VISUALIZAR)},View.ABA.MULTIPLAS)}),this.btn_formulario_recarregar.unbind("click"),this.btn_formulario_recarregar.click(function(){r.listar_formulario(r.cbo_formulario.val())}),this.btn_formulario_novo.unbind("click"),this.btn_formulario_novo.click(function(){View.load("formulario/detalhes",function(a,o){o.onclose=function(){o.formulario_id&&r.listar_formulario(o.formulario_id)},o.show(null,FORMULARIO.NOVO)},View.ABA.MULTIPLAS)}),this.cbo_formulario.unbind("change"),this.cbo_formulario.change(function(){r.cbo_formulario.val()&&r.carregar_formulario(r.cbo_formulario.val())}),this.chk_permite_anexos.change(function(){$(this).prop("checked")?(r.div_anexo_relacao.fadeIn(),r.tr_escolha_pasta_anexos_solicitacao.fadeOut(),r.chk_diretorio.prop("checked",!1).change()):(r.div_anexo_relacao.fadeOut(),r.tr_escolha_pasta_anexos_solicitacao.fadeIn())}),this.chk_diretorio.change(function(){$(this).prop("checked")?(r.tr_armazenar_anexos_modulo_documentos.fadeOut(),r.tr_armazenar_anexos_modulo_documentos.prop("checked",!1).change()):r.tr_armazenar_anexos_modulo_documentos.fadeIn()}),this.chk_cliente.change(function(){$(this).prop("checked")?r.div_cliente_acompanha.fadeIn():r.div_cliente_acompanha.fadeOut()}),this.btn_categoria_processos_novo.unbind("click"),this.btn_categoria_processos_novo.click(function(){View.load("categoria_processos/detalhes",function(a,o){o.onclose=function(){o.categoria_processos_id&&r.listar_categoria_processos(o.categoria_processos_id)},o.show(null,FORMULARIO.NOVO)})}),this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){r.unload()}),this.btn_salvar_processo.unbind("click"),this.btn_salvar_processo.click(function(a){WS.post("processo/salvar",{processo_id:r.processo.processo_id,nome:r.edt_nome.val(),nome_tabela:r.nome_tabela.val(),instrucao_trabalho:get_tinymce(r.edt_instrucao_trabalho),ativo:r.chk_ativo.prop("checked"),categoria_processos_id:r.cbo_categoria_processos.val(),documento_pasta_id:r.processo.documento_pasta_id,calendario_trabalho_id:r.cbo_calendario_trabalho.val(),formulario_id:r.cbo_formulario.val(),permite_anexos:r.chk_permite_anexos.prop("checked"),exibir_modal_confirmacao_envio:r.chk_exibir_modal_confirmacao_envio.prop("checked"),permite_download_formulario_nao_concluido:r.chk_permite_download_formulario_nao_concluido.prop("checked"),elementos:JSON.stringify(r.processo.elementos),relaciona_cliente:r.chk_cliente.prop("checked"),escolher_pasta_solicitacao:r.chk_diretorio.prop("checked"),cliente_acompanha:r.chk_cliente_acompanha.prop("checked"),solicitante_acompanha:r.chk_solicitante_acompanha.prop("checked"),array_supervisores:JSON.stringify(r.array_supervisores),array_grupo_supervisores:JSON.stringify(r.array_grupo_supervisores),abertura_automatica_ativo:r.abertura_automatica_ativo.dxSwitch("instance").option("value"),abertura_automatica_dias:JSON.stringify(r.abertura_automatica_dias.dxTagBox("instance").option("value")),abertura_automatica_quantidade:r.abertura_automatica_quantidade.dxNumberBox("instance").option("value"),abertura_automatica_hora_abertura:r.abertura_automatica_hora_abertura.dxDateBox("instance").option("text"),permitir_abertura_manual:r.permitir_abertura_manual.dxSwitch("instance").option("value"),diagrama:r.diagram?r.diagram.export():JSON.stringify(r.processo.diagrama)},function(o){if(r.processo.processo_id=o.id,r.processo.elementos=o.elementos,r.tipo=FORMULARIO.EDITAR,alert_saved(o.nome+" salvo com sucesso"),a.currentTarget.classList.contains("salvar-e-sair"))return void r.unload();r.preencher(o,function(){r.render_atividades(),r.repaint_diagram()})},[r.btn_cancelar,r.btn_excluir,r.btn_salvar_processo,r.btn_nova_versao])}),this.btn_excluir.unbind("click"),this.btn_excluir.click(function(){WS.post("processo/excluir",{processo_id:r.processo.processo_id},function(a){alert_saved(a.nome+" excluido com sucesso"),r.unload()},[r.btn_cancelar,r.btn_excluir,r.btn_salvar_processo])}),this.btn_nova_versao.unbind("click"),this.btn_nova_versao.click(function(){View.load("processo/nova_versao",function(a,o){o.show(r.processo.processo_id),o.onsave=function(a){WS.post("processo/gerar_versao/",{processo_id:r.processo.processo_id,nome:r.edt_nome.val(),nome_tabela:r.nome_tabela.val(),nova_versao_observacao:a,instrucao_trabalho:get_tinymce(r.edt_instrucao_trabalho),ativo:r.chk_ativo.prop("checked"),categoria_processos_id:r.cbo_categoria_processos.val(),documento_pasta_id:r.processo.documento_pasta_id,calendario_trabalho_id:r.cbo_calendario_trabalho.val(),formulario_id:r.cbo_formulario.val(),permite_anexos:r.chk_permite_anexos.prop("checked"),exibir_modal_confirmacao_envio:r.chk_exibir_modal_confirmacao_envio.prop("checked"),elementos:JSON.stringify(r.processo.elementos),relaciona_cliente:r.chk_cliente.prop("checked"),escolher_pasta_solicitacao:r.chk_diretorio.prop("checked"),cliente_acompanha:r.chk_cliente_acompanha.prop("checked"),solicitante_acompanha:r.chk_solicitante_acompanha.prop("checked"),array_supervisores:JSON.stringify(r.array_supervisores),array_grupo_supervisores:JSON.stringify(r.array_grupo_supervisores),permite_download_formulario_nao_concluido:r.chk_permite_download_formulario_nao_concluido.prop("checked"),abertura_automatica_ativo:r.abertura_automatica_ativo.dxSwitch("instance").option("value"),abertura_automatica_dias:JSON.stringify(r.abertura_automatica_dias.dxTagBox("instance").option("value")),abertura_automatica_quantidade:r.abertura_automatica_quantidade.dxNumberBox("instance").option("value"),abertura_automatica_hora_abertura:r.abertura_automatica_hora_abertura.dxDateBox("instance").option("text"),permitir_abertura_manual:r.permitir_abertura_manual.dxSwitch("instance").option("value"),diagrama:r.diagram?r.diagram.export():JSON.stringify(r.processo.diagrama)},function(a){r.processo.processo_id=a.processo.id,r.processo.elementos=a.processo.elementos,alert_saved(a.processo.nome+" salvo com sucesso"),r.unload()},[r.btn_cancelar,r.btn_excluir,r.btn_salvar_processo,r.btn_nova_versao])}})}),this.repaint_diagram=function(){r.menu_diagrama.parent().hasClass("active")&&setTimeout(function(){r.render_diagrama()})},this.menu_atividades.unbind("click").click(function(){r.menu_atividades.parent().hasClass("active")||r.render_atividades(),r.repaint_diagram()}),this.menu_diagrama.unbind("click").click(function(){r.menu_diagrama.parent().hasClass("active")||r.render_diagrama()}),this.menu_configuracoes.unbind("click").click(function(){r.repaint_diagram()}),this.menu_versoes.unbind("click").click(function(){r.repaint_diagram()}),this.menu_supervisores.unbind("click").click(function(){r.repaint_diagram()}),this.menu_recorrencia.unbind("click").click(function(){r.repaint_diagram()}),r.dialog.keydown(function(a){if(a.ctrlKey&&(67==a.keyCode||88==a.keyCode)){var o=$("<input>");$("body").append(o),o.val(" ").select(),document.execCommand("copy"),o.remove()}})}});