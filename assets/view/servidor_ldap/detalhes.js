define([],function(){return function(i){"use strict";var o=this;this.html_id=i,this.dialog=$("#"+this.html_id),this.title="Servidor LDAP - Detalhes",this.onclose=null,this.params={servidor_ldap_id:null,tipo:FORMULARIO.NOVO},this.cbo_motivo=this.dialog.find(".cbo_motivo"),this.cbo_local=this.dialog.find(".cbo_local"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_excluir=this.dialog.find(".btn_excluir"),this.btn_testar_conexao=this.dialog.find(".btn_testar_conexao"),this.btn_testar_filtro=this.dialog.find(".btn_testar_filtro"),this.edt_nome=this.dialog.find(".edt_nome"),this.edt_endereco=this.dialog.find(".edt_endereco"),this.edt_codigo=this.dialog.find(".edt_codigo"),this.edt_filtro=this.dialog.find(".edt_filtro"),this.edt_porta=this.dialog.find(".edt_porta"),this.chk_utilizar_ssl=this.dialog.find(".chk_utilizar_ssl"),this.edt_base=this.dialog.find(".edt_base"),this.edt_login_ldap=this.dialog.find(".edt_login_ldap"),this.edt_senha_ldap=this.dialog.find(".edt_senha_ldap"),this.cbo_tipo=this.dialog.find(".cbo_tipo"),this.div_dominio=this.dialog.find(".div_dominio"),this.edt_dominio=this.dialog.find(".edt_dominio"),this.chk_padrao=this.dialog.find(".chk_padrao"),this.show=function(i){switch(o.params=i,o.inicializar_componentes(),o.params.tipo){case FORMULARIO.NOVO:o.edt_login_ldap.val(""),o.edt_senha_ldap.val(""),o.btn_salvar.show(),o.btn_excluir.hide(),o.permite_alterar(!0),o.retornar_proximo_codigo();break;case FORMULARIO.EDITAR:o.btn_salvar.show(),o.btn_excluir.hide(),o.permite_alterar(!0);break;case FORMULARIO.VISUALIZAR:o.btn_salvar.hide(),o.btn_excluir.hide(),o.permite_alterar(!1);break;case FORMULARIO.EXCLUIR:o.btn_salvar.hide(),o.btn_excluir.show(),o.permite_alterar(!1)}null!=o.params.servidor_ldap_id&&o.preencher()},this.preencher=function(){WS.get({route:"servidor_ldap/objeto/",data:{servidor_ldap_id:o.params.servidor_ldap_id},func_response:function(i){i&&(o.edt_codigo.val(i.id),o.edt_nome.val(i.nome),o.cbo_tipo.val(i.tipo),o.edt_endereco.val(i.endereco),o.edt_porta.val(i.porta),o.chk_utilizar_ssl.prop("checked",i.utilizar_ssl).trigger("change"),o.edt_dominio.val(i.dominio),o.edt_login_ldap.val(i.usuario_ldap),o.chk_padrao.prop("checked",i.padrao).trigger("change"),i.padrao&&o.chk_padrao.prop("disabled")&&o.chk_padrao.parent().removeClass("off").addClass("on"),o.edt_base.val(i.base_dn),o.edt_filtro.val(i.filtro_conexao))}})},this.permite_alterar=function(i){o.edt_nome.prop("readonly",!i),o.edt_codigo.prop("readonly",!i),o.edt_endereco.prop("readonly",!i),o.edt_porta.prop("readonly",!i),o.chk_utilizar_ssl.prop("disabled",!i),o.edt_base.prop("readonly",!i),o.edt_filtro.prop("readonly",!i),o.cbo_tipo.prop("disabled",!i),o.edt_dominio.prop("disabled",!i),o.chk_padrao.prop("disabled",!i)},this.close=function(){void 0!==o.onclose&&o.onclose&&o.onclose()},this.unload=function(){o.close(),View.unload(this.html_id)},this.inicializar_componentes=function(){o.edt_filtro.val("(&(objectClass=user)(objectCategory=person)(!userAccountControl:1.2.840.113556.1.4.803:=2))"),o.edt_codigo.prop("disabled",!0)},this.btn_salvar.unbind("click").click(function(i){var t={nome:o.edt_nome.val(),tipo:o.cbo_tipo.val(),codigo:o.edt_codigo.val(),endereco:o.edt_endereco.val(),porta:o.edt_porta.val(),utilizar_ssl:o.chk_utilizar_ssl.prop("checked"),filtro_conexao:o.edt_filtro.val(),base_dn:o.edt_base.val(),dominio:o.edt_dominio.val(),usuario_ldap:o.edt_login_ldap.val(),senha_ldap:o.edt_senha_ldap.val(),padrao:o.chk_padrao.prop("checked")};WS.post({route:"servidor_ldap/salvar",data:t,type:"POST",func_response:function(i){i&&(alert_saved("Servidor "+i.nome+" salvo com sucesso"),o.unload())},disable_buttons:[o.btn_salvar,o.btn_cancelar]})}),this.btn_excluir.unbind("click").click(function(i){WS.post({route:"servidor_ldap/excluir",data:{servidor_ldap_id:o.params.servidor_ldap_id},type:"POST",func_response:function(i){i&&(alert_saved("Servidor "+o.edt_nome.val()+" excluido com sucesso"),o.unload())},disable_buttons:[o.btn_excluir,o.btn_cancelar]})}),this.btn_cancelar.unbind("click").click(function(i){o.unload()}),this.btn_testar_conexao.unbind("click").click(function(i){WS.get("servidor_ldap/validar_servidor/",{ldap_tipo:o.cbo_tipo.val(),ldap_server:o.edt_endereco.val(),ldap_porta:o.edt_porta.val(),ldap_utilizar_ssl:o.chk_utilizar_ssl.prop("checked"),ldap_usuario:o.edt_login_ldap.val(),ldap_senha:o.edt_senha_ldap.val(),ldap_dominio:o.edt_dominio.val()},function(i){alert_modal("Atenção",i[0].mensagem)})}),this.btn_testar_filtro.unbind("click").click(function(i){WS.get("servidor_ldap/validar_servidor/",{ldap_tipo:o.cbo_tipo.val(),ldap_server:o.edt_endereco.val(),ldap_porta:o.edt_porta.val(),ldap_utilizar_ssl:o.chk_utilizar_ssl.prop("checked"),ldap_usuario:o.edt_login_ldap.val(),ldap_senha:o.edt_senha_ldap.val(),ldap_dn:o.edt_base.val(),ldap_filtro:o.edt_filtro.val(),ldap_dominio:o.edt_dominio.val()},function(i){alert_modal("Atenção",i[0].mensagem)})}),this.cbo_tipo.unbind("change"),this.cbo_tipo.change(function(){"1"==o.cbo_tipo.val()?""!=o.edt_filtro.val()&&o.edt_filtro.val("(&(objectClass=user)(objectCategory=person)(!userAccountControl:1.2.840.113556.1.4.803:=2))"):""!=o.edt_filtro.val()&&o.edt_filtro.val("(|(objectClass=user)(objectClass=organizationalUnit))")}),this.retornar_proximo_codigo=function(){WS.get("servidor_ldap/retornar_proximo_codigo/",null,function(i){o.edt_codigo.val(i[0].prox_cod)})}}});