define(["react","react-dom","./../central_documentos/SelectPasta"],function(a,o,e){return function(i){"use strict";var r=this;this.html_id=i,this.dialog=$("#"+this.html_id),this.title="Modelagem de Processo",this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.tipo=null,this.onclose=null,this.btn_fechar=null,this.scrollview=this.dialog.find(".scrollview"),this.menu_configuracoes=this.dialog.find(".menu_configuracoes"),this.menu_modelistas=this.dialog.find(".menu_modelistas"),this.menu_atividades=this.dialog.find(".menu_atividades"),this.menu_supervisores=this.dialog.find(".menu_supervisores"),this.menu_historico=this.dialog.find(".menu_historico"),this.aba_configuracoes=this.dialog.find(".aba_configuracoes"),this.aba_modelistas=this.dialog.find(".aba_modelistas"),this.aba_atividades=this.dialog.find(".aba_atividades"),this.aba_supervisores=this.dialog.find(".aba_supervisores"),this.aba_historico=this.dialog.find(".aba_historico"),this.lbl_titulo_processo=this.dialog.find(".lbl_titulo_processo"),this.edt_nome=this.dialog.find(".edt_nome"),this.nome_tabela=this.dialog.find(".nome_tabela"),this.edt_instrucao_trabalho=this.dialog.find(".edt_instrucao_trabalho"),this.chk_ativo=this.dialog.find(".chk_ativo"),this.chk_cliente=this.dialog.find(".chk_cliente"),this.chk_diretorio=this.dialog.find(".chk_diretorio"),this.tr_escolha_pasta_anexos_solicitacao=this.dialog.find(".tr_escolha_pasta_anexos_solicitacao"),this.tr_armazenar_anexos_modulo_documentos=this.dialog.find(".tr_armazenar_anexos_modulo_documentos"),this.cbo_categoria_processos=this.dialog.find(".cbo_categoria_processos"),this.btn_categoria_processos_visualizar=this.dialog.find(".btn_categoria_processos_visualizar"),this.btn_categoria_processos_recarregar=this.dialog.find(".btn_categoria_processos_recarregar"),this.btn_categoria_processos_novo=this.dialog.find(".btn_categoria_processos_novo"),this.div_pasta=this.dialog.find(".div_pasta"),this.selectPasta=a.createElement(e,null,null),this.cbo_calendario_trabalho=this.dialog.find(".cbo_calendario_trabalho"),this.btn_calendario_trabalho_visualizar=this.dialog.find(".btn_calendario_trabalho_visualizar"),this.btn_calendario_trabalho_recarregar=this.dialog.find(".btn_calendario_trabalho_recarregar"),this.btn_calendario_trabalho_novo=this.dialog.find(".btn_calendario_trabalho_novo"),this.cbo_formulario=this.dialog.find(".cbo_formulario"),this.btn_formulario_visualizar=this.dialog.find(".btn_formulario_visualizar"),this.btn_formulario_recarregar=this.dialog.find(".btn_formulario_recarregar"),this.btn_formulario_novo=this.dialog.find(".btn_formulario_novo"),this.chk_permite_anexos=this.dialog.find(".chk_permite_anexos"),this.chk_exibir_modal_confirmacao_envio=this.dialog.find(".chk_exibir_modal_confirmacao_envio"),this.chk_permite_download_formulario_nao_concluido=this.dialog.find(".chk_permite_download_formulario_nao_concluido"),this.div_anexo_relacao=this.dialog.find(".div_anexo_relacao"),this.chk_esconder_grupos_campos_vazios=this.dialog.find(".chk_esconder_grupos_campos_vazios"),this.tr_ocultar_mensagem_campos_vazios=this.dialog.find(".tr_ocultar_mensagem_campos_vazios"),this.chk_ocultar_mensagem_campos_vazios=this.dialog.find(".chk_ocultar_mensagem_campos_vazios"),this.chk_excluir_solicitacoes_em_branco=this.dialog.find(".chk_excluir_solicitacoes_em_branco"),this.dx_abertura_automatica=this.dialog.find(".dx_abertura_automatica"),this.dx_historico_processos=this.dialog.find(".dx_historico_processos"),this.dx_modelistas_processos=this.dialog.find(".dx_modelistas_processos"),this.divAtvArvore=this.dialog.find(".divAtvArvore"),this.divAtvDiagrama=this.dialog.find(".divAtvDiagrama"),this.tab_supervisores=this.dialog.find(".tab_supervisores"),this.cbo_supervisores=this.dialog.find(".cbo_supervisores"),this.chk_cliente_acompanha=this.dialog.find(".chk_cliente_acompanha"),this.div_cliente_acompanha=this.dialog.find(".cliente_acompanha"),this.chk_solicitante_acompanha=this.dialog.find(".chk_solicitante_acompanha"),this.div_solicitante_acompanha=this.dialog.find(".solicitante_acompanha"),this.lbl_tab_historico=this.dialog.find(".lbl_tab_historico"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_salvar_processo=this.dialog.find(".btn_salvar_processo"),this.btn_excluir=this.dialog.find(".btn_excluir"),this.btn_versoes=this.dialog.find(".btn_versoes"),this.btn_atv_arvore=this.dialog.find(".btn_atv_arvore"),this.btn_atv_diagrama=this.dialog.find(".btn_atv_diagrama"),this.btn_atv_diagrama_reprocessar=this.dialog.find(".btn_atv_diagrama_reprocessar"),this.divComponenteDrawer=this.dialog.find(".divComponenteDrawer"),this.tab_atividades=this.dialog.find(".tab_atividades"),this.processoDiagram=this.dialog.find(".processoDiagram"),this.array_abertura_automatica=[],this.chk_permitir_abertura_manual=this.dialog.find(".chk_permitir_abertura_manual"),this.processo={processo_id:null,nome:"",nova_versao_observacao:"",instrucao_trabalho:"",ativo:!1,categoria_processos_id:null,calendario_trabalho_id:null,formulario_id:null,permite_anexos:!0,solicitante_acompanha:!1,documento_pasta_id:null,elementos:[],diagrama:null},this.arr_versoes=[],this.formulario=null,this.array_supervisores=[],this.array_grupo_supervisores=[],this.conectores_diagrama=[],this.versao_processo_id=null,this.dxDiagram=null,this.dxDatagridModelistas=null,this.flag_listar_versoes=!0,this.show=function(a,e){switch(r.scrollview.dxScrollView().dxScrollView("instance"),r.scrollview.css("height","calc(100vh - 45px)"),o.render(r.selectPasta,r.div_pasta[0]),r.aba_configuracoes.attr("id","aba_configuracoes"+r.html_id),r.aba_atividades.attr("id","aba_atividades"+r.html_id),r.aba_modelistas.attr("id","aba_modelistas"+r.html_id),r.aba_supervisores.attr("id","aba_supervisores"+r.html_id),r.aba_historico.attr("id","aba_historico"+r.html_id),r.menu_configuracoes.attr("href","#"+r.aba_configuracoes.attr("id")),r.menu_atividades.attr("href","#"+r.aba_atividades.attr("id")),r.menu_modelistas.attr("href","#"+r.aba_modelistas.attr("id")),r.menu_supervisores.attr("href","#"+r.aba_supervisores.attr("id")),r.menu_historico.attr("href","#"+r.aba_historico.attr("id")),r.edt_instrucao_trabalho.attr("id","edt_instrucao_trabalho"+r.html_id),e){case FORMULARIO.NOVO:case FORMULARIO.EDITAR:r.btn_salvar_processo.show(),r.btn_excluir.hide(),r.permite_alterar(!0);break;case FORMULARIO.VISUALIZAR:r.btn_salvar_processo.hide(),r.btn_excluir.hide(),r.permite_alterar(!1);break;case FORMULARIO.EXCLUIR:r.btn_salvar_processo.hide(),r.btn_excluir.show(),r.permite_alterar(!1)}r.tipo=e;const i={scrollview:r.scrollview,btnToggle:r.btn_versoes,processo_id:a,fnRenderVersoes:r.getFnRenderVersoes,fnPreencher:r.preencher,fnRestaurarVersao:r.fnRestaurarVersao,fnAtivarVersao:r.fnAtivarVersao,fnGerarVersao:r.fnGerarVersao,readOnly:e===FORMULARIO.VISUALIZAR||e===FORMULARIO.EXCLUIR,getFnDiagram:r.getFnDiagram};ReactDOM.render(React.createElement(window.components.ProcessoDrawerRight.default,i),r.divComponenteDrawer[0]),void 0!==a&&a?(r.processo.processo_id=a,r.preencher()):(set_tinymce(r.edt_instrucao_trabalho,""),r.listar_formulario(),r.listar_categoria_processos(),r.listar_documento_pasta(),r.listar_calendario_trabalho(),r.listar_versoes(),r.render_abertura_automatica(),r.render_historico(),r.chk_exibir_modal_confirmacao_envio.prop("checked",!0).trigger("change"),r.chk_esconder_grupos_campos_vazios.prop("checked",!1).trigger("change"),r.nome_tabela.val("p_")),create_combobox(r.cbo_supervisores,r.listar_supervisores),set_focus(r.edt_nome),setTimeout(function(){r.btn_fechar=$('[aba-id-md5="'+r.html_id+'"] .btn_fechar'),r.btn_fechar.click(function(){void 0!==r.onclose&&r.onclose&&r.onclose()})},300)},this.close=function(){close_modal(r.modal.attr("id")),void 0!==r.onclose&&r.onclose&&r.onclose()},this.unload=function(){r.close(),View.unload(this.html_id)},this.permite_alterar=function(a){r.edt_nome.prop("disabled",!a),r.cbo_supervisores.prop("disabled",!a),r.selectPasta.props.setDesabilitado(!a),r.cbo_categoria_processos.prop("disabled",!a),r.cbo_calendario_trabalho.prop("disabled",!a),r.btn_formulario_novo.prop("disabled",!a),r.btn_categoria_processos_novo.prop("disabled",!a),r.btn_calendario_trabalho_novo.prop("disabled",!a)},this.listar_supervisores=function(a){var o=r.cbo_supervisores.parent(),e=o.find(".edt_combobox");WS.get("usuario/listar_usuarios_grupos/",{nome:e.val(),equipe_interna:!0,listar_grupos:!0,modulo:MODULOS.PROCESSO},function(i){limpar_combobox(r.cbo_supervisores),$(i).each(function(a,o){var e=[];e.Nome=o.nome;var i=$('<span class="label lb_tipo" style="margin: 5px;"></span>');"usuarios"==o.tipo?(i.addClass("tipo_supervisor label-info"),i.attr("title","Usuário"),i.attr("data-original-title","Usuário"),i.text("U"),i.attr("tipo","usuarios")):"grupo_usuarios"==o.tipo&&(i.addClass("tipo_supervisor label-warning"),i.attr("title","Grupo de Usuários"),i.attr("data-original-title","Grupo de Usuários"),i.text("GU"),i.attr("tipo","grupo_usuarios")),i.tooltip(),add_option_combobox(r.cbo_supervisores,a,o.id>0?o.id:null,e,i)}),a(!0),e.keypress(function(a){if(13==a.keyCode){var o=r.cbo_supervisores.parent().find(".ncbo_scroll").find(".row_selected"),i=e.attr("selected-value"),s=o.find(".tipo_supervisor").attr("tipo"),t=e.val();if(i>0){if("usuarios"==s){var c=!1;if($(r.array_supervisores).each(function(a,o){o.usuario_id===i&&"N"==o.excluido&&(c=!0)}),!c){var _={usuario_id:i,nome:t,excluido:"N",permite_edicao:!1,notifica_cancelamento:!0,reabertura_solicitacoes_concluidas:!1};r.array_supervisores.push(_),r.render_supervisores()}}else if("grupo_usuarios"==s){c=!1;if($(r.array_grupo_supervisores).each(function(a,o){o.grupo_usuarios_id===i&&"N"==o.excluido&&(c=!0)}),!c){var n={grupo_usuarios_id:i,nome:t,excluido:"N",permite_edicao:!1,notifica_cancelamento:!0,reabertura_solicitacoes_concluidas:!1};r.array_grupo_supervisores.push(n),r.render_supervisores()}}e.val(""),set_focus(e)}}});o.find(".ul_row").bind("click",function(){var a=$(this).parent().attr("id_registro"),o=$(this).find(".tipo_supervisor").attr("tipo");if(a>0){if("usuarios"==o){var i=!1;$(r.array_supervisores).each(function(o,e){e.usuario_id===a&&"N"==e.excluido&&(i=!0)}),setTimeout(function(){if(!i){var o={usuario_id:a,nome:e.val(),excluido:"N",permite_edicao:!1,notifica_cancelamento:!0,reabertura_solicitacoes_concluidas:!1};r.array_supervisores.push(o),r.render_supervisores()}},150)}else if("grupo_usuarios"==o){i=!1;$(r.grupo_usuarios_equipe).each(function(o,e){e.grupo_usuarios_id===a&&"N"==e.excluido&&(i=!0)}),setTimeout(function(){if(!i){var o={grupo_usuarios_id:a,nome:e.val(),excluido:"N",permite_edicao:!1,notifica_cancelamento:!0,reabertura_solicitacoes_concluidas:!1};r.array_grupo_supervisores.push(o),r.render_supervisores()}},150)}e.val(""),set_focus(e)}e.val(""),set_focus(e)})})},this.render_supervisores=function(){var a=r.tab_supervisores.find("tbody"),o=a.find("[template-row]"),e=function(e,i,s){let t=o.clone();t.removeAttr("template-row"),t.css("display",""),t.addClass("rows");let c=$(t.find("[template-field='tipo']")),_=$(t.find(".chk_permite_edicao")),n=$(t.find(".chk_notifica_cancelamento")),l=$(t.find(".chk_reabertura_solicitacoes_concluidas"));_.removeClass("template_switch"),App.aplicar_checkbox(_.parent()),n.removeClass("template_switch"),App.aplicar_checkbox(n.parent()),l.removeClass("template_switch"),App.aplicar_checkbox(l.parent()),i?($(_).prop("checked",r.array_grupo_supervisores[s].permite_edicao).change(),$(_).change(function(a){r.array_grupo_supervisores[s].permite_edicao=$(this).prop("checked")}),$(n).prop("checked",r.array_grupo_supervisores[s].notifica_cancelamento).change(),$(n).change(function(a){r.array_grupo_supervisores[s].notifica_cancelamento=$(this).prop("checked")}),$(l).prop("checked",r.array_grupo_supervisores[s].reabertura_solicitacoes_concluidas).change(),$(l).change(function(a){r.array_grupo_supervisores[s].reabertura_solicitacoes_concluidas=$(this).prop("checked")})):($(_).prop("checked",r.array_supervisores[s].permite_edicao).change(),$(_).change(function(a){r.array_supervisores[s].permite_edicao=$(this).prop("checked")}),$(n).prop("checked",r.array_supervisores[s].notifica_cancelamento).change(),$(n).change(function(a){r.array_supervisores[s].notifica_cancelamento=$(this).prop("checked")}),$(l).prop("checked",r.array_supervisores[s].reabertura_solicitacoes_concluidas).change(),$(l).change(function(a){r.array_supervisores[s].reabertura_solicitacoes_concluidas=$(this).prop("checked")})),i?(c.addClass("label-warning"),c.attr("title","Grupo de Usuários"),c.attr("data-original-title","Grupo de Usuários"),c.text("GU")):(c.addClass("label-info"),c.attr("title","Usuário"),c.attr("data-original-title","Usuário"),c.text("U")),c.tooltip(),$(t.find("[template-field='nome']")).text(e.nome);var d=$(t.find(".btn_usuario_remover"));d.unbind("click"),d.click(function(){i?alert_modal("Validação","Deseja remover o Grupo de Usuários?","Remover",function(){$(r.array_grupo_supervisores).each(function(a,o){o.grupo_usuarios_id==e.grupo_usuarios_id&&(t.remove(),r.array_grupo_supervisores[a].excluido="S")})},!0):alert_modal("Validação","Deseja remover o Usuário?","Remover",function(){$(r.array_supervisores).each(function(a,o){o.usuario_id==e.usuario_id&&(t.remove(),r.array_supervisores[a].excluido="S")})},!0)}),t.appendTo(a)};r.tab_supervisores.find(".rows").remove(),$(r.array_supervisores).each(function(a,o){"N"==o.excluido&&e(o,!1,a)}),$(r.array_grupo_supervisores).each(function(a,o){"N"==o.excluido&&e(o,!0,a)})},this.preencher=function(a,o,e){r.versao_processo_id=e;var i=function(a){r.array_supervisores=a.array_supervisores,r.array_grupo_supervisores=a.array_grupo_supervisores,r.render_supervisores(),r.renderizar_listagem_modelista(),r.lbl_titulo_processo.text(a.nome),r.edt_nome.val(a.nome),a.nome_tabela?(r.nome_tabela.val(a.nome_tabela).prop("disabled",!0),r.cbo_formulario.prop("disabled",!0),r.btn_formulario_recarregar.prop("disabled",!0),r.btn_formulario_novo.prop("disabled",!0)):r.nome_tabela.val("p_"),set_tinymce(r.edt_instrucao_trabalho,a.instrucao_trabalho),r.chk_ativo.prop("disabled",!1),r.chk_permitir_abertura_manual.prop("disabled",!1),r.chk_cliente.prop("disabled",!1),r.chk_diretorio.prop("disabled",!1),r.chk_cliente_acompanha.prop("disabled",!1),r.chk_solicitante_acompanha.prop("disabled",!1),r.chk_permite_anexos.prop("disabled",!1),r.chk_exibir_modal_confirmacao_envio.prop("disabled",!1),r.chk_permite_download_formulario_nao_concluido.prop("disabled",!1),r.chk_esconder_grupos_campos_vazios.prop("disabled",!1),r.chk_ocultar_mensagem_campos_vazios.prop("disabled",!1),r.chk_excluir_solicitacoes_em_branco.prop("disabled",!1),r.chk_ativo.prop("checked",!0===a.ativo).change(),r.chk_permitir_abertura_manual.prop("checked",!0===a.permitir_abertura_manual).change(),r.chk_cliente.prop("checked",!0===a.relaciona_cliente).change(),r.chk_diretorio.prop("checked",!0===a.escolher_pasta_solicitacao).change(),r.chk_permite_download_formulario_nao_concluido.prop("checked",!0===a.permite_download_formulario_nao_concluido).change(),r.listar_categoria_processos(a.categoria_processos_id),r.processo.documento_pasta_id=a.documento_pasta_id,r.listar_documento_pasta(a.documento_pasta_id,a.documento_pasta_path),r.listar_calendario_trabalho(a.calendario_trabalho_id),r.listar_formulario(a.formulario_id),r.chk_permite_anexos.prop("checked",!0===a.permite_anexos).change(),r.chk_exibir_modal_confirmacao_envio.prop("checked",!0===a.exibir_modal_confirmacao_envio||"S"==a.exibir_modal_confirmacao_envio).trigger("change"),r.chk_esconder_grupos_campos_vazios.prop("checked",!0===a.esconder_grupos_campos_vazios||"S"==a.esconder_grupos_campos_vazios).trigger("change"),r.chk_ocultar_mensagem_campos_vazios.prop("checked",!0===a.ocultar_mensagem_campos_vazios||"S"==a.ocultar_mensagem_campos_vazios).trigger("change"),r.chk_excluir_solicitacoes_em_branco.prop("checked",!0===a.excluir_solicitacoes_em_branco||"S"==a.excluir_solicitacoes_em_branco).trigger("change"),r.chk_cliente_acompanha.prop("checked",!0===a.cliente_acompanha).change(),r.chk_solicitante_acompanha.prop("checked",!0===a.solicitante_acompanha).change(),r.processo.solicitante_acompanha=!0===a.solicitante_acompanha,r.array_abertura_automatica=a.array_abertura_automatica,r.render_abertura_automatica(a.formulario_id),r.render_historico(a.processo_id),r.tipo!=FORMULARIO.VISUALIZAR&&r.tipo!=FORMULARIO.EXCLUIR||(r.chk_ativo.prop("disabled",!0),r.chk_permitir_abertura_manual.prop("disabled",!0),r.chk_cliente.prop("disabled",!0),r.chk_diretorio.prop("disabled",!0),r.chk_permite_anexos.prop("disabled",!0),r.chk_exibir_modal_confirmacao_envio.prop("disabled",!0),r.chk_esconder_grupos_campos_vazios.prop("disabled",!0),r.chk_ocultar_mensagem_campos_vazios.prop("disabled",!0),r.chk_excluir_solicitacoes_em_branco.prop("disabled",!0),r.chk_cliente_acompanha.prop("disabled",!0),r.chk_solicitante_acompanha.prop("disabled",!0),r.chk_permite_download_formulario_nao_concluido.prop("disabled",!0)),r.conectores_diagrama=[],r.processo.elementos=a.elementos,r.processo.diagrama=a.diagrama?JSON.parse(a.diagrama):null,r.flag_listar_versoes&&(r.flag_listar_versoes=!1,r.listar_versoes()),"function"==typeof o&&o(),r.menu_atividades.parent().hasClass("active")&&(r.divAtvArvore.hasClass("hidden")?r.render_diagrama():r.render_atividades())};a?i(a):r.processo.processo_id&&WS.get("processo/objeto/",{processo_id:r.processo.processo_id,versao_processo_id:e},i),r.lbl_tab_historico.removeClass("hidden"),r.render_historico()},this.render_historico=a=>{ReactDOM.render(React.createElement(window.components.ListagemProcessoHistorico.default,{processoId:r.processo.processo_id}),r.dx_historico_processos[0])},this.listar_categoria_processos=function(a){r.cbo_categoria_processos.find("option").remove(),add_option(r.cbo_categoria_processos,"","Nenhum"),WS.get("categoria_processos/listar/",null,function(o){for(var e=0;e<o.length;e++){var i=o[e];add_option(r.cbo_categoria_processos,i.categoria_processos_id,i.nome)}r.cbo_categoria_processos.selectpicker("refresh"),a&&r.cbo_categoria_processos.selectpicker("val",a).change()})},this.listar_documento_pasta=function(a,o){if(a){var e=void 0===o||""===o;r.selectPasta.props.setDocumentoPastaID(a,e)}void 0!==o&&""!==o&&r.selectPasta.props.setDocumentoPastaPath(o),r.selectPasta.props.handleSelecionar=function(){r.processo.documento_pasta_id=r.selectPasta.props.documentoPastaID}},this.listar_calendario_trabalho=function(a){r.cbo_calendario_trabalho.find("option").remove(),add_option(r.cbo_calendario_trabalho,"","Nenhum"),WS.get("calendario_trabalho/listar/",null,function(o){for(var e=0;e<o.length;e++){var i=o[e];add_option(r.cbo_calendario_trabalho,i.calendario_trabalho_id,i.nome)}r.cbo_calendario_trabalho.selectpicker("refresh"),a&&r.cbo_calendario_trabalho.selectpicker("val",a).change()})},this.listar_formulario=function(a){r.cbo_formulario.find("option").remove(),add_option(r.cbo_formulario,"","Nenhum"),WS.get("formulario/listar/",null,function(o){for(var e=0;e<o.length;e++){var i=o[e];add_option(r.cbo_formulario,i.formulario_id,i.nome)}r.cbo_formulario.selectpicker("refresh"),a&&r.cbo_formulario.selectpicker("val",a).change()})},this.listar_versoes=function(){WS.get("processo/listar_versoes/",{processo_id:r.processo.processo_id},function(a){r.arr_versoes=a,r.fnRenderVersoes()})},this.render_atividades=function(){require(["./assets/view/processo/util"],function(a){(new a).render_atividades(r.tab_atividades,r.processo,r.formulario,r.elemento_onsave)})},this.render_diagrama=function(){require(["./assets/view/processo/util"],function(a){var o=new a,e=[];r.conectores_diagrama=[],o.gerar_elem_key(r.processo,e,r.conectores_diagrama),setTimeout(()=>{const a={fnGetInstanceDiagram:r.fnGetInstanceDiagram,fnSalvarElemento:r.elemento_onsave,nodesDataSource:e,edgesDataSource:r.conectores_diagrama,processo:r.processo,formulario:r.formulario,div:r.divComponenteDrawer,util:o};ReactDOM.render(React.createElement(window.components.ProcessoDiagram.default,a),r.processoDiagram[0])})})},this.elemento_onsave=function(a,o){if(void 0!==a){if(void 0!==r.processo.elementos&&r.processo.elementos){for(var e=-1,i=0;i<r.processo.elementos.length;i++)if(r.processo.elementos[i].elem_key==a.elem_key){e=i;break}if(e<0)r.processo.elementos.push(a);else if(r.processo.elementos[e]=a,r.conectores_diagrama.length>0){let o=null;a.elemento_tipo==PROCESSO_ELEMENTO_TIPO.GATEWAY?o="gateway_"+(a.id?a.id:a.elem_key):a.elemento_tipo==PROCESSO_ELEMENTO_TIPO.ATIVIDADE&&(o="atividade_"+(a.id?a.id:a.elem_key));let e=r.conectores_diagrama.filter(a=>a.from==o);for(let i=0;i<a.destinos.length;i++){let s=a.destinos[i],t=null;if(s.elemento_tipo==PROCESSO_ELEMENTO_TIPO.ATIVIDADE?t="atividade_"+(parseInt(s.id)?s.id:s.elem_key):s.elemento_tipo==PROCESSO_ELEMENTO_TIPO.GATEWAY&&(t="gateway_"+(parseInt(s.id)?s.id:s.elem_key)),0==e.filter(a=>a.to==t).length){let a={from:o,id:o+"_"+t,to:t};r.conectores_diagrama.push(a)}}}}if(o)for(i=0;i<r.processo.elementos.length;i++)if(o.elem_key==r.processo.elementos[i].elem_key){var s={tipo:a.tipo,elemento_tipo:a.elemento_tipo,descricao:a.descricao,elem_key:a.elem_key,permite_retorno:!!a.permite_retorno&&a.permite_retorno,opcional:!!a.opcional&&a.opcional,sequencia:a.sequencia,evento_enviar:null,filtro_evento_enviar:null,tipo_automacao:null};r.processo.elementos[i].destinos.push(s)}}r.menu_atividades.parent().hasClass("active")&&(r.divAtvArvore.hasClass("hidden")||r.render_atividades())},this.carregar_formulario=function(a){r.processo.formulario_id=a,WS.get("formulario/objeto/",{formulario_id:a},function(a){r.formulario=a})},this.fnRenderVersoes=null,this.getFnRenderVersoes=function(a){r.fnRenderVersoes=a},this.fnRestaurarVersao=function(a){WS.post("processo/restaurar_versao/",{versao_processo_id:a,restaurar:!0},async function(a){r.arr_versoes=a,r.formulario=await WS.asyncGet("formulario/objeto/",{formulario_id:r.processo.formulario_id}),r.fnRenderVersoes(),r.preencher()})},this.fnAtivarVersao=function(a,o){WS.post("processo/ativar_versao/",{versao_processo_id:a,versao_teste:o},function(a){r.arr_versoes=a,r.fnRenderVersoes(),r.preencher()})},this.fnGerarVersao=function(){View.load("processo/nova_versao",function(a,o){o.show(r.processo.processo_id),o.onsave=async function(a,o,e){WS.post("processo/gerar_versao/",{processo_id:r.processo.processo_id,nome:r.edt_nome.val(),nome_tabela:r.nome_tabela.val(),nova_versao_observacao:a,instrucao_trabalho:get_tinymce(r.edt_instrucao_trabalho),ativo:r.chk_ativo.prop("checked"),categoria_processos_id:r.cbo_categoria_processos.val(),documento_pasta_id:r.processo.documento_pasta_id,calendario_trabalho_id:r.cbo_calendario_trabalho.val(),formulario_id:r.cbo_formulario.val(),permite_anexos:r.chk_permite_anexos.prop("checked"),exibir_modal_confirmacao_envio:r.chk_exibir_modal_confirmacao_envio.prop("checked"),esconder_grupos_campos_vazios:r.chk_esconder_grupos_campos_vazios.prop("checked"),ocultar_mensagem_campos_vazios:r.chk_ocultar_mensagem_campos_vazios.prop("checked"),excluir_solicitacoes_em_branco:r.chk_excluir_solicitacoes_em_branco.prop("checked"),elementos:JSON.stringify(r.processo.elementos),relaciona_cliente:r.chk_cliente.prop("checked"),escolher_pasta_solicitacao:r.chk_diretorio.prop("checked"),cliente_acompanha:r.chk_cliente_acompanha.prop("checked"),solicitante_acompanha:r.chk_solicitante_acompanha.prop("checked"),array_supervisores:JSON.stringify(r.array_supervisores),array_grupo_supervisores:JSON.stringify(r.array_grupo_supervisores),array_abertura_automatica:JSON.stringify(r.array_abertura_automatica),permite_download_formulario_nao_concluido:r.chk_permite_download_formulario_nao_concluido.prop("checked"),permitir_abertura_manual:r.chk_permitir_abertura_manual.prop("checked"),diagrama:r.dxDiagram?await r.exportDiagram():JSON.stringify(r.processo.diagrama),versao_processo_id:r.versao_processo_id,tipo_versao:o,ativar_versao:e},function(a){r.processo.processo_id=a.processo.id,r.processo.elementos=a.processo.elementos,alert_saved(a.processo.nome+" salvo com sucesso"),r.unload()},[r.btn_cancelar,r.btn_excluir,r.btn_salvar_processo])}})},this.fnGetInstanceDiagram=function(a){r.dxDiagram=a,r.fnDiagram(a),View.setShowEvent(r.html_id,()=>{r.divComponenteDrawer.find(".divTmp").show(),r.divComponenteDrawer.children().dxDrawer("instance").repaint()})},this.fnDiagram=null,this.getFnDiagram=function(a){r.fnDiagram=a},this.exportDiagram=async function(){let a=JSON.parse(r.dxDiagram.export()),o=await r.dxDiagram.getEdgeDataSource().store().load().then(a=>a);for(let e=0;e<o.length;e++){const i=o[e];if(void 0!==i.elemKey&&i.elemKey!=i.id)for(let o=0;o<a.connectors.length;o++){const e=a.connectors[o];i.id===e.dataKey&&(a.connectors[o].dataKey=i.elemKey)}}return r.processo.diagrama=a,JSON.stringify(a)},this.render_abertura_automatica=a=>{ReactDOM.unmountComponentAtNode(r.dx_abertura_automatica[0]),ReactDOM.render(React.createElement(window.components.DataGridProcessoRecorrencia.default,{processoId:r.processo.processo_id,formularioId:a||null,data:r.array_abertura_automatica,onRowRemoved:r.dx_abertura_automatica_on_row_removed,onRowInserted:r.dx_abertura_automatica_on_row_inserted}),r.dx_abertura_automatica[0])},this.fnGetInstanceDatagrid=function(a){r.dxDatagridModelistas=a},this.renderizar_listagem_modelista=()=>{ReactDOM.render(React.createElement(window.views.processos.ListagemModelista.default,{processoId:r.processo.processo_id,fnGetInstanceDatagrid:r.fnGetInstanceDatagrid}),r.dx_modelistas_processos[0])},this.edt_nome.unbind("keyup"),this.edt_nome.keyup(function(){r.lbl_titulo_processo.text(r.edt_nome.val())}),this.nome_tabela.unbind("keydown").bind("keydown",function(a){if(!new RegExp("^[_0-9a-zA-Z\b]+$").test(a.key))return a.preventDefault(),!1;setTimeout(function(){0!==r.nome_tabela.val().indexOf("p_")?r.nome_tabela.val("p_"):r.nome_tabela.val(removerAcentos(r.nome_tabela.val()))})}),this.nome_tabela.unbind("paste").bind("paste",function(a){a.preventDefault()}),this.btn_categoria_processos_visualizar.unbind("click"),this.btn_categoria_processos_visualizar.click(function(){""!=r.cbo_categoria_processos.val()&&View.load("categoria_processos/detalhes",function(a,o){o.show(r.cbo_categoria_processos.val(),FORMULARIO.VISUALIZAR)})}),this.btn_categoria_processos_recarregar.unbind("click"),this.btn_categoria_processos_recarregar.click(function(){r.listar_categoria_processos(r.cbo_categoria_processos.val())}),this.btn_categoria_processos_novo.unbind("click"),this.btn_categoria_processos_novo.click(function(){View.load("categoria_processos/detalhes",function(a,o){o.onclose=function(){o.categoria_processos_id&&r.listar_categoria_processos(o.categoria_processos_id)},o.show(null,FORMULARIO.NOVO)})}),this.btn_calendario_trabalho_visualizar.unbind("click"),this.btn_calendario_trabalho_visualizar.click(function(){""!=r.cbo_calendario_trabalho.val()&&View.load("calendario_trabalho/detalhes",function(a,o){o.show(r.cbo_calendario_trabalho.val(),FORMULARIO.VISUALIZAR)})}),this.btn_calendario_trabalho_recarregar.unbind("click"),this.btn_calendario_trabalho_recarregar.click(function(){r.listar_calendario_trabalho(r.cbo_calendario_trabalho.val())}),this.btn_calendario_trabalho_novo.unbind("click"),this.btn_calendario_trabalho_novo.click(function(){View.load("calendario_trabalho/detalhes",function(a,o){o.onclose=function(){o.calendario_trabalho_id&&r.listar_calendario_trabalho(o.calendario_trabalho_id)},o.show(null,FORMULARIO.NOVO)})}),this.btn_formulario_visualizar.unbind("click"),this.btn_formulario_visualizar.click(function(){""!=r.cbo_formulario.val()&&View.load("formulario/detalhes",function(a,o){o.show(r.cbo_formulario.val(),FORMULARIO.VISUALIZAR)},View.ABA.MULTIPLAS)}),this.btn_formulario_recarregar.unbind("click"),this.btn_formulario_recarregar.click(function(){r.listar_formulario(r.cbo_formulario.val())}),this.btn_formulario_novo.unbind("click"),this.btn_formulario_novo.click(function(){View.load("formulario/detalhes",function(a,o){o.onclose=function(){o.formulario_id&&r.listar_formulario(o.formulario_id)},o.show(null,FORMULARIO.NOVO)},View.ABA.MULTIPLAS)}),this.cbo_formulario.unbind("change"),this.cbo_formulario.change(function(){r.cbo_formulario.val()&&r.carregar_formulario(r.cbo_formulario.val())}),this.chk_permite_anexos.change(function(){$(this).prop("checked")?(r.div_anexo_relacao.fadeIn(),r.tr_escolha_pasta_anexos_solicitacao.fadeOut(),r.chk_diretorio.prop("checked",!1).change()):(r.div_anexo_relacao.fadeOut(),r.tr_escolha_pasta_anexos_solicitacao.fadeIn())}),this.chk_solicitante_acompanha.change(function(){r.processo.solicitante_acompanha=$(this).prop("checked")}),this.chk_diretorio.change(function(){$(this).prop("checked")?(r.tr_armazenar_anexos_modulo_documentos.fadeOut(),r.tr_armazenar_anexos_modulo_documentos.prop("checked",!1).change()):r.tr_armazenar_anexos_modulo_documentos.fadeIn()}),this.chk_cliente.change(function(){$(this).prop("checked")?r.div_cliente_acompanha.fadeIn():r.div_cliente_acompanha.fadeOut()}),this.chk_esconder_grupos_campos_vazios.change(function(){$(this).prop("checked")?r.tr_ocultar_mensagem_campos_vazios.fadeIn():r.tr_ocultar_mensagem_campos_vazios.fadeOut()}),this.btn_categoria_processos_novo.unbind("click"),this.btn_categoria_processos_novo.click(function(){View.load("categoria_processos/detalhes",function(a,o){o.onclose=function(){o.categoria_processos_id&&r.listar_categoria_processos(o.categoria_processos_id)},o.show(null,FORMULARIO.NOVO)})}),this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){r.unload()}),this.btn_salvar_processo.unbind("click"),this.btn_salvar_processo.click(async function(a){let o=r.dxDatagridModelistas.getController("data")._items,e=[];for(let a=0;a<o.length;a++){let i=o[a];i.removed||e.push(i.data)}WS.post("processo/salvar",{processo_id:r.processo.processo_id,nome:r.edt_nome.val(),nome_tabela:r.nome_tabela.val(),instrucao_trabalho:get_tinymce(r.edt_instrucao_trabalho),ativo:r.chk_ativo.prop("checked"),categoria_processos_id:r.cbo_categoria_processos.val(),documento_pasta_id:r.processo.documento_pasta_id,calendario_trabalho_id:r.cbo_calendario_trabalho.val(),formulario_id:r.cbo_formulario.val(),permite_anexos:r.chk_permite_anexos.prop("checked"),exibir_modal_confirmacao_envio:r.chk_exibir_modal_confirmacao_envio.prop("checked"),esconder_grupos_campos_vazios:r.chk_esconder_grupos_campos_vazios.prop("checked"),ocultar_mensagem_campos_vazios:r.chk_ocultar_mensagem_campos_vazios.prop("checked"),excluir_solicitacoes_em_branco:r.chk_excluir_solicitacoes_em_branco.prop("checked"),permite_download_formulario_nao_concluido:r.chk_permite_download_formulario_nao_concluido.prop("checked"),elementos:JSON.stringify(r.processo.elementos),relaciona_cliente:r.chk_cliente.prop("checked"),escolher_pasta_solicitacao:r.chk_diretorio.prop("checked"),cliente_acompanha:r.chk_cliente_acompanha.prop("checked"),solicitante_acompanha:r.chk_solicitante_acompanha.prop("checked"),array_supervisores:JSON.stringify(r.array_supervisores),array_grupo_supervisores:JSON.stringify(r.array_grupo_supervisores),array_abertura_automatica:JSON.stringify(r.array_abertura_automatica),permitir_abertura_manual:r.chk_permitir_abertura_manual.prop("checked"),diagrama:r.dxDiagram?await r.exportDiagram():JSON.stringify(r.processo.diagrama),versao_processo_id:r.versao_processo_id,array_modelistas:window.CircularJSON.stringify(e)},function(o){if(r.processo.processo_id=o.id,r.processo.elementos=o.elementos,r.tipo=FORMULARIO.EDITAR,alert_saved(o.nome+" salvo com sucesso"),a.currentTarget.classList.contains("salvar-e-sair"))return void r.unload();r.preencher(o,function(){r.menu_atividades.parent().hasClass("active")&&(r.divAtvArvore.hasClass("hidden")?r.render_diagrama():r.render_atividades())})},[r.btn_cancelar,r.btn_excluir,r.btn_salvar_processo])}),this.btn_excluir.unbind("click"),this.btn_excluir.click(function(){WS.post("processo/excluir",{processo_id:r.processo.processo_id},function(a){alert_saved(a.nome+" excluido com sucesso"),r.unload()},[r.btn_cancelar,r.btn_excluir,r.btn_salvar_processo])}),this.menu_atividades.unbind("click").click(function(){r.menu_atividades.parent().hasClass("active")||(r.divAtvDiagrama.hasClass("hidden")?(r.btn_atv_diagrama.show(),r.render_atividades()):(r.btn_atv_arvore.show(),r.btn_atv_diagrama_reprocessar.show()))}),this.menu_modelistas.unbind("click").click(function(){r.menu_modelistas.parent().hasClass("active")||r.renderizar_listagem_modelista()}),this.menu_configuracoes.off("click").on("click",()=>{r.btn_atv_diagrama.hide(),r.btn_atv_diagrama_reprocessar.hide(),r.btn_atv_arvore.hide()}),this.menu_supervisores.off("click").on("click",()=>{r.btn_atv_diagrama.hide(),r.btn_atv_diagrama_reprocessar.hide(),r.btn_atv_arvore.hide()}),this.btn_atv_diagrama.off("click").on("click",()=>{r.divAtvArvore.addClass("hidden"),r.divAtvDiagrama.removeClass("hidden"),r.btn_atv_diagrama.hide(),r.btn_atv_diagrama_reprocessar.fadeIn(1e3),r.btn_atv_arvore.fadeIn(1e3),r.render_diagrama()}),this.btn_atv_diagrama_reprocessar.off("click").on("click",()=>{alertaPopUp("Reprocessar Diagrama",'Deseja continuar? Todo o diagrama será reprocessado com base nas atividades e gateways da aba "Árvore".',"Sim, continuar",()=>{r.processo.diagrama=null,r.render_diagrama()},"Não",()=>{},null,"200px")}),this.btn_atv_arvore.off("click").on("click",async()=>{r.divComponenteDrawer.find(".divTmp").find(".btn_cancelar.close").trigger("click"),r.divAtvArvore.removeClass("hidden"),r.divAtvDiagrama.addClass("hidden"),r.btn_atv_diagrama.fadeIn(1e3),r.btn_atv_diagrama_reprocessar.hide(),r.btn_atv_arvore.hide(),r.processo.diagrama=JSON.parse(await r.exportDiagram()),r.render_atividades()}),r.dialog.keydown(function(a){if(a.ctrlKey&&(67==a.keyCode||88==a.keyCode)){var o=$("<input>");$("body").append(o),o.val(" ").select(),document.execCommand("copy"),o.remove()}})}});