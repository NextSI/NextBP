var dx_Filter_Builder=function(e){if(e){e=spread({div_html:null,fields:null,valor:null},e);var t=tratar_formulario(e.fields);return e.div_html.dxFilterBuilder({allowHierarchicalFields:!0,fields:t,value:e.valor?tratar_valor(e.valor,t):null,groupOperations:["and","or"],customOperations:[{name:"anyof",caption:App.lang.gateway_destino_evento.anyof,icon:"check",editorTemplate:function(e){return $("<div>").dxTagBox({value:e.value,items:e.field.lookup.dataSource,onValueChanged:function(t){e.setValue(t.value&&t.value.length?t.value:null)},width:"auto"})},calculateFilterExpression:function(e,t){return e&&e.length&&Array.prototype.concat.apply([],e.map(function(e){return[[t.dataField,"=",e],"or"]})).slice(0,-1)}}],onContentReady:function(e){e.element.find(".dx-filterbuilder-item-field").unbind("click").click(function(){setTimeout(function(){$(".dx-item").unbind("click").click(function(e){$(this).parent().find(".dx-treeview-toggle-item-visibility").length&&e.stopPropagation()})})})}}).dxFilterBuilder("instance")}},tratar_valor=function(e,t){var a=[];if("string"==typeof e[0])for(var o=0;o<t.length;o++){(r=t[o]).dataField==e[0]&&a.push(e)}else for(o=0;o<e.length;o++){var r,n=!1;if("object"==typeof(r=e[o]))if("string"==typeof r[0]){for(var i=0;i<t.length;i++)if(t[i].dataField==r[0]){n=!0,a.push(r);break}n||o++}else a.push(tratar_valor(r,t));else a.push(r)}return a},tratar_formulario=function(e){for(var t=[],a=0;a<e.grupos.length;a++){var o=e.grupos[a];t.push({dataField:o.id.toString(),caption:o.nome,filterOperations:[null]});for(var r=0;r<o.elementos.length;r++){var n=o.elementos[r];n.tipo!=ELEMENTO_TIPO.TABELA&&n.id_elemento&&n.tipo!=ELEMENTO_TIPO.ANEXO&&n.tipo!=ELEMENTO_TIPO.SELECAO_DOCUMENTO&&n.tipo!=ELEMENTO_TIPO.BOTAO&&t.push({dataField:o.id+"."+n.id_elemento,caption:n.nome+" ID: #"+n.id_elemento,dataType:datatype_elemento_tipo(n.tipo),format:n.tipo==ELEMENTO_TIPO.DECIMAL?{type:"fixedPoint",precision:parseInt(n.decimais)}:n.tipo==ELEMENTO_TIPO.DATA?"dd/MM/yyyy":null,filterOperations:n.tipo!=ELEMENTO_TIPO.OPCOES||n.tipo_lista_opcoes!=TIPO_LISTA_OPCOES.CHECKBOX&&n.tipo_lista_opcoes!=TIPO_LISTA_OPCOES.OPTION_MULTIPLAS?n.tipo==ELEMENTO_TIPO.CAIXA_VERIFICACAO?["=","<>"]:void 0:["=","<>","isblank","isnotblank","anyof"],lookup:n.tipo==ELEMENTO_TIPO.OPCOES?{dataSource:n.opcoes}:null,customizeText:function(e){return"date"==this.dataType?e.value.format_date():e.value}})}}return t},localizar_condicao=function(e){var t="";if(e)if("string"==typeof e[0])t+="("+formatar_condicao(e)+")";else if(e.length){t+="(";for(var a=0;a<e.length;a++){var o=e[a];t+="object"==typeof o?"string"==typeof o[0]?formatar_condicao(o):localizar_condicao(o):converter_operador(o)}t+=")"}return t},formatar_condicao=function(e){var t=e[0].split(".");t.length>1&&t.shift(),t=t.join(".");var a=e[1];!0!==e[2]&&!1!==e[2]||(e[2]=!0===e[2]?"S":"N");var o=null==e[2]?'""':'"'+e[2]+'"',r="("+t+".attr('type_campo') == 'inteiro' ? parseInt("+t+".val()) || 0 : ("+t+".attr('type_campo') == 'decimal' ? "+t+".maskMoney('unmasked')[0] || 0 : ("+t+".hasClass('text_fixo') ? "+t+".text() : ("+t+".attr('type') == 'radio' ? "+t+".filter(':checked').val() : ("+t+".attr('type') == 'checkbox' ? obter_valores_checkBox("+t+") : ("+t+".hasClass('input_consulta_integracao') ? "+t+".find('.dx-dropdownbox').dxDropDownBox('instance').option('value') || '' : "+t+".val()))))))";let n=null;switch(a){case"=":case"<>":case"<":case"<=":case">":case">=":n="("+r+converter_operador(a)+" ("+t+".attr('type_campo') == 'inteiro' ? parseInt("+o+") || 0 : ("+t+".attr('type_campo') == 'decimal' ? parseFloat("+o+") || 0 : ("+t+".attr('type') == 'date' ? "+o+".substr(0,10) : "+o+"))))";break;case"between":n="("+r+" >= "+("("+t+".attr('type_campo') == 'inteiro' ? parseInt("+o+".split(',')[0]) || 0 : ("+t+".attr('type_campo') == 'decimal' ? parseFloat("+o+".split(',')[0]) || 0 : ("+t+".attr('type') == 'date' ? "+o+".split(',')[0].substr(0,10) : "+o+")))")+" && "+r+" <= "+("("+t+".attr('type_campo') == 'inteiro' ? parseInt("+o+".split(',')[1]) || 0 : ("+t+".attr('type_campo') == 'decimal' ? parseFloat("+o+".split(',')[1]) || 0 : ("+t+".attr('type') == 'date' ? "+o+".split(',')[1].substr(0,10) : "+o+")))")+")";break;case"contains":n="("+r+".includes("+o+"))";break;case"notcontains":n="(!"+r+".includes("+o+"))";break;case"startswith":n="("+r+".startsWith("+o+"))";break;case"endswith":n="("+r+".endsWith("+o+"))";break;case"isblank":n="("+r+")";break;case"isnotblank":n="(!"+r+")";break;case"or":n=" || ";break;case"and":n=" && ";break;case"anyof":n="findOne("+r+","+o+".split(','))"}return n="(typeof("+t+") != 'undefined' ? ("+n+") : console.warn('campo "+t+" está sendo chamado, porém não está disponível nesta etapa do processo')) ",n},converter_operador=function(e){switch(e){case"=":return" == ";case"<>":return" != ";case"<":return" < ";case"<=":return" <= ";case">":return" > ";case">=":return" >= ";case"or":return" || ";case"and":return" && "}};