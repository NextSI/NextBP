define([],function(){return function(a){"use strict";var o=this;this.html_id=a,this.dialog=$("#"+this.html_id),this.title="Nova Mensagem do Mural",this.tipo=null,this.onclose=null,this.onsave=null,this.edt_mensagem=this.dialog.find(".edt_mensagem"),this.edt_usuario=this.dialog.find(".edt_usuario"),this.div_toolbar=this.dialog.find(".div_toolbar"),this.div_usuario=this.dialog.find(".div_usuario"),this.cbo_tipo=this.dialog.find(".cbo_tipo"),this.btn_anexo=this.dialog.find(".btn_anexo"),this.div_anexos=this.dialog.find(".panel-footer .react-anexos")[0],this.div_tipo=this.dialog.find(".div_tipo"),this.titulo=this.dialog.find(".titulo"),this.div_mensagem_publica=this.dialog.find(".div_mensagem_publica"),this.chk_mensagem_publica=this.dialog.find(".chk_mensagem_publica"),this.chk_permite_comentario=this.dialog.find(".chk_permite_comentario"),this.chk_votacao=this.dialog.find(".chk_votacao"),this.dx_data_publicacao=this.dialog.find(".dx_data_publicacao"),this.div_votacao=this.dialog.find(".div_votacao"),this.react_component_votacao=null,this.mensagem_id=null,this.numero_anexo=null,this.anexo_array=[],this.administrativo=null,this.data_publicacao=null,this.nova_votacao=null,this.votacao_id=null,this.votacao_pergunta=null,this.votacao_expiracao=null,this.votacao_voto_secreto=null,this.post_params_adicionais={},this.anexo_fotos=[],this.anexo=[],this.grupo_id=null,this.grupo_privacidade="N",this.show=function(a,i,e,t,n){switch(o.edt_mensagem.attr("id","edt_mensagem"+o.html_id),void 0!==t&&null!=t?o.grupo_id=t:t=null,void 0!==n&&null!=n&&(o.grupo_privacidade=n),o.tipo=i,o.render_toolbar(),!0!==App.sessao.dados.admin&&(App.verifica_permissao(App.temp.empresa,"mural_mensagem_clientes")||o.cbo_tipo.find('[value="1"]').remove(),App.verifica_permissao(App.temp.empresa,"mural_mensagem_fornecedores")||o.cbo_tipo.find('[value="4"]').remove()),o.tipo){case FORMULARIO.NOVO:o.div_usuario.addClass("hidden"),o.permite_alterar(!0);break;case FORMULARIO.EDITAR:o.edt_usuario.prop("readonly",!0),o.div_usuario.removeClass("hidden");break;case FORMULARIO.VISUALIZAR:case FORMULARIO.EXCLUIR:o.div_usuario.removeClass("hidden"),o.permite_alterar(!1)}if(o.exibir_div_mensagem_publica(),o.chk_mensagem_publica.dxSwitch({value:!1,css:""}),o.chk_permite_comentario.dxSwitch({value:!0}),o.chk_votacao.dxSwitch({value:!1,onValueChanged(a){o.exibir_div_votacao(a.value)}}),0==e?(o.div_tipo.addClass("hidden"),o.titulo.text("Publicações"),o.administrativo="N"):(o.titulo.text("Mensagem do Mural"),o.administrativo="S"),void 0!==a&&a?(o.mensagem_id=a,o.preencher()):(set_tinymce(o.edt_mensagem,"",!1,null,null,null,"100%"),o.renderDataPublicacao()),set_focus(o.edt_mensagem),App.PE.Mural_Mensagem_Detalhes_Ao_Abrir)try{App.PE.Mural_Mensagem_Detalhes_Ao_Abrir(o)}catch(a){console.log(a)}this.render_input()},this.exibir_div_votacao=function(a){a?o.votacao_id>0?(o.react_component_votacao=React.createElement(window.components.Votacao.default,{votacao_id:o.votacao_id,pergunta:o.votacao_pergunta,expiracao:o.votacao_expiracao,voto_secreto:o.votacao_voto_secreto}),ReactDOM.render(o.react_component_votacao,o.div_votacao[0])):(o.react_component_votacao=React.createElement(window.components.NovaVotacao.default,{aoAlterar:a=>{o.nova_votacao=a}}),ReactDOM.render(o.react_component_votacao,o.div_votacao[0])):(ReactDOM.unmountComponentAtNode(o.div_votacao[0]),o.nova_votacao=null)},this.exibir_div_mensagem_publica=function(){o.grupo_id>0&&"P"===o.grupo_privacidade?o.div_mensagem_publica.show():o.div_mensagem_publica.hide()},this.close=function(){void 0!==o.onclose&&o.onclose&&o.onclose()},this.unload=function(){o.close(),View.unload(this.html_id)},this.render_toolbar=function(){o.div_toolbar.dxToolbar({items:[{locateInMenu:"auto",location:"before",widget:"dxButton",options:{text:"Cancelar",onClick:o.cancelar_click}},{locateInMenu:"auto",location:"after",widget:"dxButton",visible:o.tipo==FORMULARIO.EXCLUIR,options:{text:"Excluir",type:"danger",icon:"fa fa-trash",onClick:o.excluir_click}},{locateInMenu:"auto",location:"after",widget:"dxButton",visible:o.tipo==FORMULARIO.NOVO||o.tipo==FORMULARIO.EDITAR,options:{text:"Publicar",type:"default",icon:"far fa-save",stylingMode:"contained",onClick:o.salvar_click}}]})},this.render_input=function(a){o.arquivos_anexados=a||[],o.arquivos_removidos=o.arquivos_removidos||[],o.arquivos_iniciais||(o.arquivos_iniciais={}),o.arquivos_iniciais=o.arquivos_anexados.filter(a=>!a.isNovo).map(a=>({documento_revisao_id:a.documento_revisao_id,documento_id:a.documento_id,nome:a.nome})),this.div_anexos&&ReactDOM.render(React.createElement(window.components.InputAnexoPreview.default,{aoAlterar:function(a){o.arquivos_anexados=a;var i=a.filter(a=>!a.isNovo);o.arquivos_iniciais.forEach(function(a){i.find(function(o){return o.documento_revisao_id==a.documento_revisao_id})||o.arquivos_removidos.push({documento_revisao_id:a.documento_revisao_id,documento_id:a.documento_id})})},arquivos:o.arquivos_anexados}),this.div_anexos)},this.permite_alterar=function(a){o.edt_mensagem.prop("readonly",!a),o.edt_usuario.prop("readonly",!a),o.cbo_tipo.prop("disabled",!a),setTimeout(function(){tinyMCE.get(o.edt_mensagem.attr("id")).getBody().setAttribute("contenteditable",a)},300)},this.preencher=function(){WS.get("mural_mensagem/objeto/",{mural_mensagem_id:o.mensagem_id,administrativo:o.administrativo},function(a){o.mensagem_id=a.id,set_tinymce(o.edt_mensagem,a.mensagem,!1,null,null,null,"100vh"),o.edt_usuario.val(a.autor_nome),o.cbo_tipo.val(a.tipo).trigger("change"),o.chk_mensagem_publica.dxSwitch("instance").option("value","S"===a.publica),o.chk_permite_comentario.dxSwitch("instance").option("value","S"===a.permite_comentario),o.votacao_id=a.votacao_id,o.votacao_pergunta=a.votacao_pergunta,o.votacao_expiracao=a.votacao_expiracao,o.votacao_voto_secreto="S"===a.votacao_voto_secreto,o.chk_votacao.dxSwitch("instance").option("readOnly",!0),o.chk_votacao.dxSwitch("instance").option("value",o.votacao_id>0),!isNaN(o.votacao_id)&&o.votacao_id||o.chk_votacao.parent().hide(),o.exibir_div_votacao(o.votacao_id>0),o.cbo_tipo.selectpicker("refresh"),o.renderDataPublicacao(a.data_publicacao),o.grupo_id=a.grupo_id,o.grupo_privacidade=a.grupo_privacidade,o.exibir_div_mensagem_publica(),o.consultar_anexos()})},this.consultar_anexos=function(){WS.get("documento/listar_documentos_mural_mensagem/",{mural_mensagem_id:o.mensagem_id},function(a){var i=[];a.forEach(a=>{i.push({documento_revisao_id:a.documento_revisao_id,documento_id:a.documento_id,nome:a.revisao_nome,mime_type:a.mime_type,size:a.revisao_tamanho,isNovo:!1})}),o.render_input(i)})},this.renderDataPublicacao=function(a){a||(a=agora(!0,!0)),a=a.replace(" ","T"),o.data_publicacao=o.dx_data_publicacao.dxDateBox({type:"datetime",dateSerializationFormat:"yyyy-MM-ddTHH:mm:ss",showClearButton:!0,value:a,readOnly:o.cbo_tipo.prop("disabled")}).dxDateBox("instance")},this.cancelar_click=function(){o.unload()},this.salvar_click=function(){if(!o.data_publicacao.option("value"))return void alertaPopUp("Validação","A data de publicação não pode ser vazia","Ok",()=>{});o.anexo_array=[],(o.arquivos_anexados||[]).forEach(a=>{a instanceof File?o.anexo_array.push(a):a.isNovo&&a.file instanceof File&&o.anexo_array.push(a.file)}),o.anexos_removidos=[],(o.arquivos_anexados||[]).forEach(a=>{});const a={mural_mensagem_id:o.mensagem_id,mensagem:get_tinymce(o.edt_mensagem),tipo:o.cbo_tipo.val(),documentos:o.anexo_array,documentos_removidos:JSON.stringify(o.arquivos_removidos),mobile:App.is_nativo()?"sim":"nao",administrativo:o.administrativo,grupo_id:o.grupo_id,publica:"P"==o.grupo_privacidade?o.chk_mensagem_publica.dxSwitch("instance").option("value"):null,permite_comentario:o.chk_permite_comentario.dxSwitch("instance").option("value"),data_publicacao:o.data_publicacao.option("value"),votacao:CircularJSON.stringify(o.nova_votacao),...o.post_params_adicionais};WS.post("mural_mensagem/salvar",a,function(a){alert_saved("Mensagem publicada com sucesso"),void 0!==o.onsave&&o.onsave&&o.onsave(a),o.unload()},[],null,!0)},this.excluir_click=function(){WS.post("mural_mensagem/excluir",{mural_mensagem_id:o.mensagem_id,administrativo:o.administrativo,grupo_id:o.grupo_id},function(a){alert_saved("Mensagem excluida com sucesso"),void 0!==o.onsave&&o.onsave&&o.onsave(a),o.unload()})},this.remover_anexo_click=function(){$(this).closest(".div_anexos_row").remove()}}});