define([],function(){return function(a){"use strict";var t=this;this.html_id=a,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title="Configuração de E-mail",this.tipo=null,this.onclose=null,this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.btn_excluir=this.dialog.find(".btn_excluir"),this.btn_testar_conexao_smtp=this.dialog.find(".btn_testar_conexao_smtp"),this.btn_testar_conexao_pop=this.dialog.find(".btn_testar_conexao_pop"),this.lbl_tab_geral=this.dialog.find(".lbl_tab_geral"),this.lbl_tab_interacao=this.dialog.find(".lbl_tab_interacao"),this.edt_email_nome=this.dialog.find(".edt_email_nome"),this.edt_email=this.dialog.find(".edt_email"),this.cbo_envio_protocolo=this.dialog.find(".cbo_envio_protocolo"),this.cbo_leitura_protocolo=this.dialog.find(".cbo_leitura_protocolo"),this.cbo_smtp_oauth_client=this.dialog.find(".cbo_smtp_oauth_client"),this.cbo_pop_oauth_client=this.dialog.find(".cbo_pop_oauth_client"),this.edt_smtp_usuario=this.dialog.find(".edt_smtp_usuario"),this.edt_pop_usuario=this.dialog.find(".edt_pop_usuario"),this.edt_smtp_senha=this.dialog.find(".edt_smtp_senha"),this.edt_pop_senha=this.dialog.find(".edt_pop_senha"),this.edt_smtp_endereco=this.dialog.find(".edt_smtp_endereco"),this.edt_pop_endereco=this.dialog.find(".edt_pop_endereco"),this.edt_smtp_porta=this.dialog.find(".edt_smtp_porta"),this.edt_pop_porta=this.dialog.find(".edt_pop_porta"),this.cbo_smtp_seguranca=this.dialog.find(".cbo_smtp_seguranca"),this.cbo_pop_seguranca=this.dialog.find(".cbo_pop_seguranca"),this.smtp_btn=$("#smtp_btn"),this.pop_btn=$("#pop_btn"),this.chk_smtp_requer_autenticacao=this.dialog.find(".chk_smtp_requer_autenticacao"),this.chk_smtp_oauth_client=this.dialog.find(".chk_smtp_oauth_client"),this.chk_pop_oauth_client=this.dialog.find(".chk_pop_oauth_client"),this.btn_oauth_client=this.dialog.find(".btn_oauth_client"),this.btn_oauth_client_refresh=this.dialog.find(".btn_oauth_client_refresh"),this.chk_ignorar_emails_antigos=this.dialog.find(".chk_ignorar_emails_antigos"),this.div_quantidade_dias_email_antigo=this.dialog.find(".div_quantidade_dias_email_antigo"),this.edt_quantidade_dias_email_antigo=this.dialog.find(".edt_quantidade_dias_email_antigo"),this.chk_notificacao=this.dialog.find(".chk_notificacao"),this.chk_emails_desconhecidos=this.dialog.find(".chk_emails_desconhecidos"),this.chk_emails_agenda=this.dialog.find(".chk_emails_agenda"),this.chk_abertura_chamado=this.dialog.find(".chk_abertura_chamado"),this.chk_interacao_chamado=this.dialog.find(".chk_interacao_chamado"),this.chk_enviar_email_usuario_sem_cadastro=this.dialog.find(".chk_enviar_email_usuario_sem_cadastro"),this.chk_enviar_email_usuario_sem_cadastro_para=this.dialog.find(".chk_enviar_email_usuario_sem_cadastro_para"),this.div_lista_emails=this.dialog.find(".div_lista_emails"),this.edt_lista_emails=this.dialog.find(".edt_lista_emails"),this.table_interacao=this.dialog.find(".table_interacao"),this.edt_deletar_email_numero_tentativa=this.dialog.find(".edt_deletar_email_numero_tentativa"),this.i_ajuda_apagar_x_tentativas=this.dialog.find(".i_ajuda_apagar_x_tentativas"),this.senha_smtp="",this.senha_pop="",this.show=function(){t.preencher(),show_modal(t.modal.attr("id")),set_focus(t.edt_email),App.verifica_permissao(App.temp.empresa,"oauth_client")&&(t.btn_oauth_client.on("click",t.btn_oauth_client_click),t.btn_oauth_client.attr("href","javascript:;"))},this.close=function(){close_modal(t.modal.attr("id")),void 0!==t.onclose&&t.onclose&&t.onclose()},this.unload=function(){t.close(),View.unload(this.html_id)},this.preencher=function(){WS.get("conta_email/get_parametros/",null,function(a){t.edt_email.val(a.email),t.cbo_envio_protocolo.val(a.envio_protocolo),t.edt_smtp_usuario.val(a.smtp_usuario),t.edt_smtp_endereco.val(a.smtp_endereco),t.edt_smtp_porta.val(a.smtp_porta),t.cbo_smtp_seguranca.val(a.smtp_seguranca),t.cbo_leitura_protocolo.val(a.leitura_protocolo),t.edt_pop_usuario.val(a.pop_usuario),t.edt_pop_endereco.val(a.pop_endereco),t.edt_pop_porta.val(a.pop_porta),t.cbo_pop_seguranca.val(a.pop_seguranca),t.chk_smtp_requer_autenticacao.prop("checked",a.smtp_requer_autenticacao).trigger("change"),t.chk_smtp_oauth_client.prop("checked",a.smtp_oauth_client||!1).trigger("change"),t.chk_pop_oauth_client.prop("checked",a.pop_oauth_client||!1).trigger("change"),t.listar_oauth_client(a.smtp_oauth_client_id||null,a.pop_oauth_client_id||null),App.sessao.dados.senhas_ocultas?(t.edt_pop_senha.attr("placeholder","Alterar senha"),t.edt_smtp_senha.attr("placeholder","Alterar senha"),t.senha_smtp=a.smtp_senha,t.senha_pop=a.pop_senha):(t.edt_pop_senha.val(a.pop_senha),t.edt_smtp_senha.val(a.smtp_senha)),t.chk_ignorar_emails_antigos.prop("checked","S"==a.ignorar_emails_antigos).change(),t.edt_quantidade_dias_email_antigo.val(a.quantidade_dias_email_antigo),t.chk_emails_agenda.prop("checked","S"==a.exclui_interacao_agenda).change(),t.chk_interacao_chamado.prop("checked","S"==a.exclui_interacao_chamado).change(),t.chk_notificacao.prop("checked","S"==a.exclui_interacao_servidor).change(),t.chk_abertura_chamado.prop("checked","S"==a.exclui_interacao_abertura_chamado).change(),t.chk_emails_desconhecidos.prop("checked","S"==a.exclui_interacao_desconhecidos).change(),t.chk_enviar_email_usuario_sem_cadastro.prop("checked","S"==a.enviar_email_usuario_sem_cadastro).change(),t.chk_enviar_email_usuario_sem_cadastro_para.prop("checked","S"==a.enviar_email_usuario_sem_cadastro_para).change(),t.edt_lista_emails.val(a.lista_emails),t.chk_enviar_email_usuario_sem_cadastro_para.prop("checked")?t.div_lista_emails.removeClass("hidden"):t.div_lista_emails.addClass("hidden"),t.edt_deletar_email_numero_tentativa.val(a.deletar_email_numero_tentativa),t.i_ajuda_apagar_x_tentativas.tooltip({title:'Informe a quantidade de tentativas de envio, após essa quantidade, caso não tenha sucesso o e-mail será excluído<br /><b>OBS: para não excluir e-mails coloque "0".</b>',html:!0,placement:"auto",container:"body"})})},this.atualizar_tabela=function(){t.table_interacao.find("tr:not(.hidden)").each(function(a){$(this).toggleClass("active",!!(1&a))})},this.chk_ignorar_emails_antigos.change(function(){t.chk_ignorar_emails_antigos.prop("checked")?t.div_quantidade_dias_email_antigo.removeClass("hidden"):t.div_quantidade_dias_email_antigo.addClass("hidden"),t.atualizar_tabela()}),this.chk_enviar_email_usuario_sem_cadastro_para.change(function(){t.chk_enviar_email_usuario_sem_cadastro_para.prop("checked")?t.div_lista_emails.removeClass("hidden"):t.div_lista_emails.addClass("hidden"),t.atualizar_tabela()}),this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){t.unload()}),this.btn_testar_conexao_smtp.unbind("click"),this.btn_testar_conexao_smtp.click(function(){View.load("configuracao_email/teste_smtp",function(a,e){e.show(t.cbo_envio_protocolo.val(),t.edt_email.val(),t.edt_smtp_usuario.val(),t.edt_smtp_senha.val(),t.edt_smtp_endereco.val(),t.edt_smtp_porta.val(),t.cbo_smtp_seguranca.val(),t.chk_smtp_requer_autenticacao.prop("checked"),t.chk_smtp_oauth_client.prop("checked"),t.cbo_smtp_oauth_client.val())})}),this.btn_testar_conexao_pop.unbind("click"),this.btn_testar_conexao_pop.click(function(){WS.post("conta_email/testar_conexao_pop",{leitura_protocolo:t.cbo_leitura_protocolo.val(),pop_usuario:t.edt_pop_usuario.val(),pop_senha:t.edt_pop_senha.val(),pop_endereco:t.edt_pop_endereco.val(),pop_porta:t.edt_pop_porta.val(),pop_seguranca:t.cbo_pop_seguranca.val(),pop_oauth_client:t.chk_pop_oauth_client.prop("checked"),pop_oauth_client_id:t.cbo_pop_oauth_client.val()},function(a){},[t.btn_testar_conexao_pop,t.btn_testar_conexao_smtp,t.btn_salvar])}),this.btn_salvar.unbind("click"),this.btn_salvar.click(function(){t.chk_enviar_email_usuario_sem_cadastro_para.prop("checked")&&""==t.edt_lista_emails.val()?alert_modal("Nenhum e-mail informado.",'Informe pelo menos um e-mail ou desabilite a opção:<br /> "Enviar e-mail de usuário inválido para".'):WS.post("conta_email/salvar_config_email",{email:t.edt_email.val(),envio_protocolo:t.cbo_envio_protocolo.val(),smtp_usuario:t.edt_smtp_usuario.val(),smtp_senha:""==t.edt_smtp_senha.val()?t.senha_smtp:t.edt_smtp_senha.val(),smtp_endereco:t.edt_smtp_endereco.val(),smtp_porta:t.edt_smtp_porta.val(),smtp_seguranca:t.cbo_smtp_seguranca.val(),leitura_protocolo:t.cbo_leitura_protocolo.val(),pop_usuario:t.edt_pop_usuario.val(),pop_senha:""==t.edt_pop_senha.val()?t.senha_pop:t.edt_pop_senha.val(),pop_endereco:t.edt_pop_endereco.val(),pop_porta:t.edt_pop_porta.val(),pop_seguranca:t.cbo_pop_seguranca.val(),smtp_requer_autenticacao:t.chk_smtp_requer_autenticacao.prop("checked"),smtp_oauth_client:t.chk_smtp_oauth_client.prop("checked"),smtp_oauth_client_id:t.cbo_smtp_oauth_client.val(),pop_oauth_client:t.chk_pop_oauth_client.prop("checked"),pop_oauth_client_id:t.cbo_pop_oauth_client.val(),ignorar_emails_antigos:t.chk_ignorar_emails_antigos.prop("checked"),quantidade_dias_email_antigo:t.edt_quantidade_dias_email_antigo.val(),exclui_interacao_agenda:t.chk_emails_agenda.prop("checked"),exclui_interacao_desconhecidos:t.chk_emails_desconhecidos.prop("checked"),exclui_interacao_chamado:t.chk_interacao_chamado.prop("checked"),exclui_interacao_servidor:t.chk_notificacao.prop("checked"),exclui_interacao_abertura_chamado:t.chk_abertura_chamado.prop("checked"),enviar_email_usuario_sem_cadastro:t.chk_enviar_email_usuario_sem_cadastro.prop("checked"),enviar_email_usuario_sem_cadastro_para:t.chk_enviar_email_usuario_sem_cadastro_para.prop("checked"),lista_emails:t.edt_lista_emails.val(),deletar_email_numero_tentativa:t.edt_deletar_email_numero_tentativa.val()},function(a){alert_saved("Configurações salvas com sucesso"),t.unload()},[t.btn_testar_conexao_pop,t.btn_testar_conexao_smtp,t.btn_salvar,t.btn_cancelar])}),this.smtp_btn.click(function(){var a=$("#edt_smtp_senha"),t=$("#ico_smtp_senha");t.removeClass(),"password"==a.attr("type")?(a.attr("type","text"),t.addClass("glyphicon glyphicon-eye-close")):(a.attr("type","password"),t.addClass("glyphicon glyphicon-eye-open"))}),this.pop_btn.click(function(){var a=$("#edt_pop_senha"),t=$("#ico_pop_senha");t.removeClass(),"password"==a.attr("type")?(a.attr("type","text"),t.addClass("glyphicon glyphicon-eye-close")):(a.attr("type","password"),t.addClass("glyphicon glyphicon-eye-open"))}),this.habilitar_smtp_usuario_senha=()=>{const a=!!this.chk_smtp_requer_autenticacao.prop("checked"),t=!!this.chk_smtp_oauth_client.prop("checked");this.edt_smtp_usuario.prop("readonly",!a),this.edt_smtp_senha.prop("readonly",!a||t),a?(this.edt_smtp_usuario.closest(".form-group").show(),this.chk_smtp_oauth_client.closest("div").show()):(this.edt_smtp_usuario.closest(".form-group").hide(),this.chk_smtp_oauth_client.closest("div").hide()),a&&!t?this.edt_smtp_senha.closest(".form-group").show():this.edt_smtp_senha.closest(".form-group").hide(),a&&t?this.cbo_smtp_oauth_client.closest(".form-group").show():this.cbo_smtp_oauth_client.closest(".form-group").hide()},this.habilitar_pop_usuario_senha=()=>{const a=!!this.chk_pop_oauth_client.prop("checked");this.edt_pop_senha.prop("readonly",a),a?(this.cbo_pop_oauth_client.closest(".form-group").show(),this.edt_pop_senha.closest(".form-group").hide()):(this.cbo_pop_oauth_client.closest(".form-group").hide(),this.edt_pop_senha.closest(".form-group").show())},this.chk_smtp_requer_autenticacao.change(this.habilitar_smtp_usuario_senha),this.chk_smtp_oauth_client.change(this.habilitar_smtp_usuario_senha),this.chk_pop_oauth_client.change(this.habilitar_pop_usuario_senha),this.listar_oauth_client=(a,t)=>{this.cbo_smtp_oauth_client.find("option").remove(),add_option(this.cbo_smtp_oauth_client,"","Nenhum"),this.cbo_pop_oauth_client.find("option").remove(),add_option(this.cbo_pop_oauth_client,"","Nenhum");WS.get("oauth_client/listar/",{},e=>{for(let a=0;a<e.data.length;a++){const t=e.data[a];add_option(this.cbo_smtp_oauth_client,t.id,t.nome),add_option(this.cbo_pop_oauth_client,t.id,t.nome)}a&&this.cbo_smtp_oauth_client.val(a).trigger("change"),t&&this.cbo_pop_oauth_client.val(t).trigger("change"),this.cbo_smtp_oauth_client.selectpicker("refresh"),this.cbo_pop_oauth_client.selectpicker("refresh")})},this.btn_oauth_client_refresh.on("click",()=>{t.listar_oauth_client(t.cbo_smtp_oauth_client.val(),t.cbo_pop_oauth_client.val())}),this.btn_oauth_client_click=()=>{View.loadReact(views.oauth_client.Listagem.default,{},a=>{},View.ABA.SIM)}}});