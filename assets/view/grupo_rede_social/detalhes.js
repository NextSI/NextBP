define([],function(){return function(o){"use strict";var i=this;this.html_id=o,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.tipo=null,this.onclose=null,this.onconfirm=null,this.lbl_nome_grupo=this.dialog.find(".lbl_nome_grupo"),this.edt_nome=this.dialog.find(".edt_nome"),this.radio_permissao=this.dialog.find(".radio_permissao"),this.lbl_url_publica=this.dialog.find(".lbl_url_publica"),this.edt_link_sufixo=this.dialog.find(".edt_link_sufixo"),this.cbo_membros=this.dialog.find(".cbo_membros"),this.cbo_tipo_usuario=this.dialog.find(".cbo_tipo_usuario"),this.cbo_membros_motivo_chamado=this.dialog.find(".cbo_membros_motivo_chamado"),this.edt_pesquisa_membros=null,this.edt_pesquisa_membros_motivo_chamado=null,this.carrega_img_grupo=this.dialog.find(".carrega_img_grupo"),this.files=this.dialog.find(".files"),this.chk_listas_discussao=this.dialog.find(".chk_listas_discussao"),this.tab_equipe=this.dialog.find(".tab_equipe"),this.tab_equipe_motivo_chamado=this.dialog.find(".tab_equipe_motivo_chamado"),this.lbl_tab_equipe=this.dialog.find(".lbl_tab_equipe"),this.lbl_tab_motivo_chamado=this.dialog.find(".lbl_tab_motivo_chamado"),this.tab_equipe_tipo_usuario=this.dialog.find(".tab_equipe_tipo_usuario"),this.lb_tipo_usuario=this.dialog.find(".lb_tipo_usuario"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_confirmar=this.dialog.find(".btn_confirmar"),this.btn_excluir=this.dialog.find(".btn_excluir"),this.btn_remover_logo=this.dialog.find(".btn_remover_logo"),this.btn_alterar_logo=this.dialog.find(".btn_alterar_logo"),this.admin=this.dialog.find(".admin"),this.admin_motivo_chamado=this.dialog.find(".admin_motivo_chamado"),this.grupo_id=null,this.valor=null,this.usuario_id_selecionado=null,this.usuario_id_selecionado_motivo_chamado=null,this.usuarios_responsaveis=new Object,this.equipe=new Array,this.grupo=new Array,this.motivo_chamado=new Array,this.tipo_usuario=new Array,this.formulario=null,this.logo_id=null,this.link_sufixo_ja_definido=!1,this.show=function(o,a){switch(i.grupo_id=o,i.formulario=a,i.lbl_url_publica.text(App.sessao.dados.app_url+"/#/social/grupo/"),a){case FORMULARIO.NOVO:i.btn_confirmar.show(),i.btn_excluir.hide(),i.permite_alterar(!0),i.dialog.find(':radio[value="N"]').attr("checked",!0).change();break;case FORMULARIO.EDITAR:i.btn_confirmar.show(),i.btn_excluir.hide(),i.permite_alterar(!0);break;case FORMULARIO.VISUALIZAR:i.btn_confirmar.hide(),i.btn_excluir.hide(),i.permite_alterar(!1);break;case FORMULARIO.EXCLUIR:i.btn_confirmar.hide(),i.btn_excluir.show(),i.permite_alterar(!1)}var e=!1;null==i.edt_pesquisa_membros&&(create_combobox(i.cbo_membros,i.listar_membros),i.edt_pesquisa_membros=i.cbo_membros.parent().find(".edt_combobox"),i.edt_pesquisa_membros.keypress(function(o){if(13==o.keyCode){var a=i.cbo_membros.parent(),r=a.find(".ncbo_scroll").find(".row_selected"),t=r.attr("id_registro"),_=a.find(".edt_combobox");a.find(".chk_administrador_grupo"),a.find(".chk_permite_publicar"),i.usuario_id_selecionado=t;var d=r.find(".tipo_equipe").attr("tipo");$(i.equipe).each(function(o,i){i.usuario_id===t&&(e=!0)}),$(i.grupo).each(function(o,i){i.usuario_id===t&&(e=!0)}),setTimeout(function(){if("U"==d){if(!e){var o={};o.usuario_id=t,o.nome=_.val(),o.administrador_grupo="N",o.autorizado_publicar="N",o.membro_grupo="S",o.removido=!1,o.tipo="U",i.equipe.push(o)}}else if("G"==d&&!e){var a={};a.grupo_usuario_id=t,a.nome=_.val(),a.administrador_grupo="N",a.autorizado_publicar="N",a.membro_grupo="S",a.removido=!1,a.tipo="G",i.grupo.push(a)}i.render_equipe()},150)}}));var r=!1;null==i.edt_pesquisa_membros_motivo_chamado&&(create_combobox(i.cbo_membros_motivo_chamado,i.listar_membros_motivo_chamado),i.edt_pesquisa_membros_motivo_chamado=i.cbo_membros_motivo_chamado.parent().find(".edt_combobox"),i.edt_pesquisa_membros_motivo_chamado.keypress(function(o){if(13==o.keyCode){var a=i.cbo_membros_motivo_chamado.parent(),e=a.find(".ncbo_scroll").find(".row_selected").attr("id_registro"),t=a.find(".edt_combobox");a.find(".chk_administrador_grupo_motivo_chamado"),a.find(".chk_permite_publicar_motivo_chamado"),i.usuario_id_selecionado_motivo_chamado=e,$(i.motivo_chamado).each(function(o,i){i.motivo_id===e&&(r=!0)}),setTimeout(function(){if(!r){var o={};o.motivo_id=e,o.nome=t.val(),o.administrador_grupo="N",o.autorizado_publicar="N",o.membro_grupo="S",o.removido=!1,i.motivo_chamado.push(o)}i.render_equipe_motivo_chamado()},150)}})),void 0!==o&&o&&(i.grupo_id=o,i.preencher()),show_modal(i.modal.attr("id"))},this.listar_membros=function(o){var a={modulo:MODULOS.SOCIAL,nome:i.edt_pesquisa_membros.val()};WS.get("usuario/listar_usuarios_grupos_rede_social/",a,function(a){limpar_combobox(i.cbo_membros),$(a).each(function(o,a){var e=[];e.Nome=a.nome;var r=$('<img class="carrega_img" style=" height: 30px; width: 30px; margin-right: 4px;"/>&nbsp;');r.addClass("tipo_equipe"),"U"==a.tipo?(r.attr("tipo","U"),null!=a.foto_id?r.attr("src",WS_URI+"documento/midia/?documento_id="+a.foto_id+"&token_midia="+App.sessao.token_midia+"&anticache="+(new Date).getTime()):(r.attr("tipo","U"),r.attr("src","assets/img/icones_bp/imagem_usuario_padrao.svg"))):"G"==a.tipo&&(r.attr("tipo","G"),r.attr("src","assets/img/icones_bp/pesquisa_grupo.svg")),add_option_combobox(i.cbo_membros,o,a.id,e,r)});var e=i.cbo_membros.next(),r=!1;e.find(".ul_row").bind("mousedown",function(){var o=i.cbo_membros.parent(),a=(o.find(".ncbo_scroll").find(".row_selected"),$(this).parent().attr("id_registro")),e=o.find(".edt_combobox"),t=(o.find(".chk_administrador_grupo"),o.find(".chk_permite_publicar"),$(this).find(".tipo_equipe").attr("tipo"));i.usuario_id_selecionado=a,$(i.equipe).each(function(o,i){i.usuario_id===a&&(r=!0)}),$(i.grupo).each(function(o,i){i.usuario_id===a&&(r=!0)}),setTimeout(function(){if("U"==t){if(!r){var o={};o.usuario_id=a,o.nome=e.val(),o.administrador_grupo="N",o.autorizado_publicar="N",o.membro_grupo="S",o.removido=!1,o.tipo="U",i.equipe.push(o)}}else if("G"==t&&!r){var _={};_.grupo_usuario_id=a,_.nome=e.val(),_.administrador_grupo="N",_.autorizado_publicar="N",_.membro_grupo="S",_.removido=!1,_.tipo="G",i.grupo.push(_)}i.render_equipe()},150)}),o(!0)})},this.listar_membros_motivo_chamado=function(o){var a={nome:i.edt_pesquisa_membros_motivo_chamado.val()};WS.get("grupo_motivo_chamado/listar/",a,function(a){limpar_combobox(i.cbo_membros_motivo_chamado),$(a).each(function(o,a){var e=[];e.Nome=a.nome;var r=$('<img class="carrega_img_motivo_chamado" style=" height: 30px; width: 30px; margin-right: 4px;"/>&nbsp;');r.attr("src","assets/img/icones_bp/comunication.svg"),add_option_combobox(i.cbo_membros_motivo_chamado,o,a.grupo_id,e,r)});var e=i.cbo_membros_motivo_chamado.next(),r=!1;e.find(".ul_row").bind("mousedown",function(){var o=i.cbo_membros_motivo_chamado.parent(),a=(o.find(".ncbo_scroll").find(".row_selected"),$(this).parent().attr("id_registro")),e=o.find(".edt_combobox");o.find(".chk_administrador_grupo_motivo_chamado"),o.find(".chk_permite_publicar_motivo_chamado"),i.usuario_id_selecionado_motivo_chamado=a,$(i.motivo_chamado).each(function(o,i){i.motivo_id===a&&(r=!0)}),setTimeout(function(){if(!r){var o={};o.motivo_id=a,o.nome=e.val(),o.administrador_grupo="N",o.autorizado_publicar="N",o.membro_grupo="S",o.removido=!1,i.motivo_chamado.push(o)}i.render_equipe_motivo_chamado()},150)}),o(!0)})},i.cbo_tipo_usuario.unbind("click"),i.cbo_tipo_usuario.click(function(){var o=!1;$(i.tipo_usuario).each(function(a,e){e.tipo_usuario===i.cbo_tipo_usuario.val()&&(o=!0)}),setTimeout(function(){if(!o){var a={};i.cbo_tipo_usuario.val()>0&&(a.tipo_usuario=i.cbo_tipo_usuario.val(),a.nome=$("#cbo_tipo_usuario option:selected").text(),a.administrador_grupo="N",a.autorizado_publicar="N",a.membro_grupo="S",a.removido=!1,i.tipo_usuario.push(a))}i.render_equipe_tipo_usuario()},150)}),this.render_equipe=function(o){var a=i.tab_equipe.find("tbody"),e=a.find("tr:first"),r=function(o,r,t){var _=e.clone();_.removeAttr("template-row"),_.css("display",""),$(_.find("[template-field='nome']")).text(o.nome);var d=$(_.find(".btn_usuario_remover")),s=$(_.find(".chk_administrador_grupo")),n=$(_.find(".chk_permite_publicar")),u=$(_.find(".div_permite_esconder")),c=$(_.find(".chk_permite_publicar"));c.attr("type","checkbox"),c.addClass("checkbox_bootstrap_toggle");var p=$(_.find(".chk_administrador_grupo"));p.attr("type","checkbox"),p.addClass("checkbox_bootstrap_toggle"),1==o.administrador_grupo||"S"==o.administrador_grupo?(p.prop("checked",!0).change(),u.hasClass("hidden")||u.addClass("hidden")):(p.prop("checked",!1).change(),u.hasClass("hidden")&&u.removeClass("hidden")),1==o.autorizado_publicar||"S"==o.autorizado_publicar?c.prop("checked",!0).change():c.prop("checked",!1).change(),$(p).prop("disabled",!i.valor),p.unbind("change"),p.on("change",function(a,e){"U"==o.tipo?s.prop("checked")?(i.equipe[t].administrador_grupo="S",u.hasClass("hidden")||u.addClass("hidden")):(i.equipe[t].administrador_grupo="N",u.hasClass("hidden")&&u.removeClass("hidden")):"G"==o.tipo&&(s.prop("checked")?(i.grupo[t].administrador_grupo="S",u.hasClass("hidden")||u.addClass("hidden")):(i.grupo[t].administrador_grupo="N",u.hasClass("hidden")&&u.removeClass("hidden")))}),c.unbind("change"),c.on("change",function(a,e){("U"==o.tipo?i.equipe:i.grupo)[t].autorizado_publicar=n.prop("checked")?"S":"N"}),d.unbind("click"),d.click(function(){alert_modal(i.title.text(),"Deseja remover o Usuário?","Remover",function(){"U"==o.tipo?$(i.equipe).each(function(a,e){e.usuario_id==o.usuario_id&&(i.formulario==FORMULARIO.EDITAR?WS.post("grupos_rede_social/excluir_usuario_grupo/",{grupo_id:i.grupo_id,usuario_id:o.usuario_id},function(o){o&&(i.equipe.splice(a,1),_.remove())},[d]):(_.remove(),i.equipe.splice(a,1),i.render_equipe()))}):$(i.grupo).each(function(a,e){e.usuario_id==o.usuario_id&&(i.formulario==FORMULARIO.EDITAR?WS.post("grupos_rede_social/excluir_usuario_grupo_grupo/",{grupo_id:i.grupo_id,grupo_usuario_id:o.grupo_usuario_id},function(o){o&&(i.grupo.splice(a,1),_.remove())},[d]):(_.remove(),i.grupo.splice(a,1),i.render_equipe()))})},!0)}),_.appendTo(a)};i.tab_equipe.find("tr:gt(1)").remove(),$(i.equipe).each(function(o,i){r(i,0,o)}),$(i.grupo).each(function(o,i){r(i,0,o)}),App.aplicar_checkbox(a)},this.render_equipe_tipo_usuario=function(o){var a=i.tab_equipe_tipo_usuario.find("tbody"),e=a.find("tr:first");i.tab_equipe_tipo_usuario.find("tr:gt(1)").remove(),$(i.tipo_usuario).each(function(o,r){!function(o,r,t){var _=e.clone();_.removeAttr("template-row"),_.css("display",""),$(_.find("[template-field='nome_tipo_usuario']")).text(o.nome);var d=$(_.find(".btn_usuario_remover_tipo_usuario")),s=$(_.find(".chk_administrador_grupo_tipo_usuario")),n=$(_.find(".chk_permite_publicar_tipo_usuario")),u=$(_.find(".chk_permite_publicar_tipo_usuario")),c=$(_.find(".div_esconder_publicar_tipo_usuario")),p=$(_.find(".chk_administrador_grupo_tipo_usuario"));p.attr("type","checkbox"),p.addClass("checkbox_bootstrap_toggle"),(u=$(_.find(".chk_permite_publicar_tipo_usuario"))).attr("type","checkbox"),u.addClass("checkbox_bootstrap_toggle");var m=$(_.find(".chk_permite_publicar_tipo_usuario"));m.attr("type","checkbox"),m.addClass("checkbox_bootstrap_toggle"),1==o.administrador_grupo||"S"==o.administrador_grupo?(p.prop("checked",!0).change(),c.hasClass("hidden")||c.addClass("hidden")):(p.prop("checked",!1).change(),c.hasClass("hidden")&&c.removeClass("hidden")),1==o.autorizado_publicar||"S"==o.autorizado_publicar?m.prop("checked",!0).change():m.prop("checked",!1).change(),$(p).prop("disabled",!i.valor),$(u).prop("disabled",!i.valor),p.unbind("change"),p.on("change",function(o,a){s.prop("checked")?(i.tipo_usuario[t].administrador_grupo="S",c.hasClass("hidden")||c.addClass("hidden")):(i.tipo_usuario[t].administrador_grupo="N",c.hasClass("hidden")&&c.removeClass("hidden"))}),m.unbind("change"),m.on("change",function(o,a){n.prop("checked")?i.tipo_usuario[t].autorizado_publicar="S":i.tipo_usuario[t].autorizado_publicar="N"}),d.unbind("click"),d.click(function(){alert_modal(i.title.text(),"Deseja remover o Usuário?","Remover",function(){$(i.tipo_usuario).each(function(a,e){e.tipo_usuario==o.tipo_usuario&&(i.formulario==FORMULARIO.EDITAR?WS.post("grupos_rede_social/excluir_usuario_tipo_usuario/",{grupo_id:i.grupo_id,tipo_usuario:o.tipo_usuario},function(o){o&&(i.tipo_usuario.splice(a,1),_.remove())},[d]):(_.remove(),i.tipo_usuario.splice(a,1),i.render_equipe_tipo_usuario()))})},!0)}),_.appendTo(a)}(r,0,o)}),App.aplicar_checkbox(a)},this.render_equipe_motivo_chamado=function(o){var a=i.tab_equipe_motivo_chamado.find("tbody"),e=a.find("tr:first");i.tab_equipe_motivo_chamado.find("tr:gt(1)").remove(),$(i.motivo_chamado).each(function(o,r){!function(o,r,t){var _=e.clone();_.removeAttr("template-row"),_.css("display",""),$(_.find("[template-field='nome_motivo_chamado']")).text(o.nome);var d=$(_.find(".btn_usuario_remover_motivo_chamado")),s=$(_.find(".chk_administrador_grupo_motivo_chamado")),n=($(_.find(".chk_permite_publicar_motivo_chamado")),$(_.find(".div_permite_motivo_chamado"))),u=$(_.find(".chk_administrador_grupo_motivo_chamado"));u.attr("type","checkbox"),u.addClass("checkbox_bootstrap_toggle");var c=$(_.find(".chk_permite_publicar_motivo_chamado"));c.attr("type","checkbox"),c.addClass("checkbox_bootstrap_toggle"),1==o.administrador_grupo||"S"==o.administrador_grupo?(u.prop("checked",!0).change(),n.hasClass("hidden")||n.addClass("hidden")):(u.prop("checked",!1).change(),n.hasClass("hidden")&&n.removeClass("hidden")),1==o.autorizado_publicar||"S"==o.autorizado_publicar?c.prop("checked",!0).change():c.prop("checked",!1).change(),$(u).prop("disabled",!i.valor),$(c).prop("disabled",!i.valor),u.unbind("click"),u.on("change",function(o,a){s.prop("checked")?(i.motivo_chamado[t].administrador_grupo="S",n.hasClass("disa")||n.addClass("hidden")):(i.motivo_chamado[t].administrador_grupo="N",n.hasClass("hidden")&&n.removeClass("hidden"))}),c.unbind("click"),c.on("change",function(o,a){c.prop("checked")?i.motivo_chamado[t].autorizado_publicar="S":i.motivo_chamado[t].autorizado_publicar="N"}),d.unbind("click"),d.click(function(){alert_modal(i.title.text(),"Deseja remover Grupo de Motivo de chamado?","Remover",function(){$(i.motivo_chamado).each(function(a,e){e.motivo_id==o.motivo_id&&(i.formulario==FORMULARIO.EDITAR?WS.post("grupos_rede_social/excluir_usuario_grupo_motivo_chamado/",{grupo_id:i.grupo_id,motivo_id:o.motivo_id},function(o){o&&(i.motivo_chamado.splice(a,1),_.remove())},[d]):(_.remove(),i.motivo_chamado.splice(a,1),i.render_equipe_motivo_chamado()))})},!0)}),_.appendTo(a)}(r,0,o)}),App.aplicar_checkbox(a)},this.preencher=function(){WS.get("grupos_rede_social/objeto/",{grupo_id:i.grupo_id},function(o){i.lbl_nome_grupo.text(o.nome),i.edt_nome.val(o.nome),i.grupo_id=o.id,i.edt_link_sufixo.val(o.link_sufixo),""!=o.link_sufixo?i.link_sufixo_ja_definido=!0:i.edt_link_sufixo.val(string_to_slug(o.nome)),null!=o.foto_id?(i.logo_id=o.foto_id.id,i.carrega_img_grupo.attr("src",WS_URI+"documento/midia/?tipo=v&tamanho=60&documento_id="+o.foto_id.id+"&token_midia="+App.sessao.token_midia+"&considera_excluido=S&anticache="+(new Date).getTime()).on("error",function(){i.carrega_img_grupo.attr("src","assets/img/icones_bp/grupo_no_img.svg")})):i.carrega_img_grupo.attr("src","assets/img/icones_bp/grupo_no_img.svg"),i.dialog.find(':radio[value="'+o.privado+'"]').attr("checked",!0).change(),i.equipe=o.membros,i.grupo=o.grupo_usuario,i.motivo_chamado=o.chamado_motivo,i.tipo_usuario=o.tipo_usuario,1==o.listas_discussao||"S"==o.listas_discussao?i.chk_listas_discussao.prop("checked",!0).change():i.chk_listas_discussao.prop("checked",!1).change(),i.render_equipe(),i.render_equipe_motivo_chamado(),i.render_equipe_tipo_usuario()})},this.preview_logo=function(o){var a=o.target.files[0],e=new FileReader;e.onload=function(o){i.carrega_img_grupo.attr("src",o.target.result)},e.readAsDataURL(a)},this.close=function(){close_modal(i.modal.attr("id")),void 0!==i.onclose&&i.onclose&&i.onclose()},this.unload=function(){i.close(),View.unload(this.html_id)},this.permite_alterar=function(o){i.edt_nome.prop("readonly",!o),i.radio_permissao.prop("readonly",!o),i.files.prop("disabled",!o),i.valor=o},i.btn_cancelar.unbind("click"),i.btn_cancelar.click(function(){i.unload()}),this.btn_confirmar.unbind("click"),this.btn_confirmar.click(function(){var o=null;$.each(i.files,function(i,a){a.files.length>0&&(o=a.files[0])});var a=null;a=1==(a=i.chk_listas_discussao.prop("checked"))?"S":"N",WS.post("grupos_rede_social/salvar/",{grupo_id:i.grupo_id,nome:i.edt_nome.val(),link_sufixo:i.edt_link_sufixo.val(),privado:i.dialog.find("input[name='radio_permissao']:checked").val(),membros:JSON.stringify(i.equipe),grupo_usuario:JSON.stringify(i.grupo),foto_id:o,motivo_chamado:JSON.stringify(i.motivo_chamado),tipo_usuario:JSON.stringify(i.tipo_usuario),listas_discussao:a},function(o){i.grupo_id=o.id,alert_saved(o.nome+" salvo com sucesso"),void 0!==i.onconfirm&&i.onconfirm&&i.onconfirm(o),i.unload()},[i.btn_confirmar],null,!0)}),this.btn_excluir.unbind("click"),this.btn_excluir.click(function(){WS.post("grupos_rede_social/excluir/",{grupo_id:i.grupo_id},function(o){alert_saved(o.nome+" excluido com sucesso"),i.unload()},[i.btn_excluir])}),this.btn_alterar_logo.unbind("click"),this.btn_alterar_logo.click(function(){i.files.click()}),this.btn_remover_logo.unbind("click"),this.btn_remover_logo.click(function(){alert_modal("Remover Logo","Deseja remover este logo?","Remover",function(){WS.post("documento/excluir",{documento_id:i.logo_id,excluir:!0,grupo_id:i.grupo_id,excluir_logo_grupo:!0},function(o){i.carrega_img_grupo.attr("src","assets/img/icones_bp/grupo_no_img.svg"),alert_saved("Logo removido com sucesso")},null,null,!0)},!0)}),this.edt_link_sufixo.unbind("keypress"),this.edt_link_sufixo.keypress(function(){if(!new RegExp("^[-_0-9a-zA-Z\b]+$").test(event.key))return event.preventDefault(),!1}),this.edt_link_sufixo.unbind("keyup"),this.edt_link_sufixo.keyup(function(){i.link_sufixo_ja_definido=""!==i.edt_link_sufixo.val(),i.link_sufixo_ja_definido||i.edt_link_sufixo.val(string_to_slug(i.edt_nome.val()))}),this.edt_nome.unbind("keyup"),this.edt_nome.keyup(function(){i.link_sufixo_ja_definido||i.edt_link_sufixo.val(string_to_slug(i.edt_nome.val()))}),i.files[0].addEventListener("change",i.preview_logo,!1)}});