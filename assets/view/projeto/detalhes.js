define(["react","react-dom","./../central_documentos/SelectPasta","./../componentes_react/CboUsuarios"],function(e,o,a,i){return function(t){"use strict";var n=this;this.html_id=t,this.dialog=$("#"+this.html_id),this.tipo=null,this.onclose=null,this.onconfirm=null,this.title="Projeto",this.tab_geral=this.dialog.find(".tab_geral"),this.tab_equipe=this.dialog.find(".tab_equipe"),this.tab_financeiro=this.dialog.find(".tab_financeiro"),this.tab_movimentacao_financeira=this.dialog.find(".tab_movimentacao_financeira"),this.tab_revisao=this.dialog.find(".tab_revisao"),this.tab_rel_posicionamento=this.dialog.find(".tab_rel_posicionamento"),this.tab_config=this.dialog.find(".tab_config"),this.tab_personalizado=this.dialog.find(".tab_personalizado"),this.tab_referencias=this.dialog.find(".tab_referencias"),this.menu_geral=this.dialog.find(".menu_geral"),this.menu_equipe=this.dialog.find(".menu_equipe"),this.menu_financeiro=this.dialog.find(".menu_financeiro"),this.menu_movimentacao_financeira=this.dialog.find(".menu_movimentacao_financeira"),this.menu_revisao=this.dialog.find(".menu_revisao"),this.menu_rel_posicionamento=this.dialog.find(".menu_rel_posicionamento"),this.menu_config=this.dialog.find(".menu_config"),this.menu_personalizado=this.dialog.find(".menu_personalizado"),this.menu_referencias=this.dialog.find(".menu_referencias"),this.lbl_tab_equipe=this.dialog.find(".lbl_tab_equipe"),this.tabela_equipe=this.dialog.find(".tabela_equipe"),this.lbl_tab_revisao=this.dialog.find(".lbl_tab_revisao"),this.lbl_tab_rel_posicionamento=this.dialog.find(".lbl_tab_rel_posicionamento"),this.lbl_tab_config=this.dialog.find(".lbl_tab_config"),this.lbl_tab_financeiro=this.dialog.find(".lbl_tab_financeiro"),this.lbl_tab_movimentacao_financeira=this.dialog.find(".lbl_tab_movimentacao_financeira"),this.lbl_tab_referencias=this.dialog.find(".lbl_tab_referencias"),this.lbl_nome_projeto=this.dialog.find(".lbl_nome_projeto"),this.chk_template=this.dialog.find(".chk_template"),this.cbo_tipo=this.dialog.find(".cbo_tipo"),this.cbo_calendario_trabalho=this.dialog.find(".cbo_calendario_trabalho"),this.btn_revisao=this.dialog.find(".btn_revisao"),this.btn_refresh_revisao=this.dialog.find(".btn_refresh_revisao"),this.tbl_revisao=this.dialog.find(".tbl_revisao"),this.div_total_horas=this.dialog.find(".div_total_horas"),this.div_clientes=this.dialog.find(".div_clientes"),this.div_datas=this.dialog.find(".div_datas"),this.div_status=this.dialog.find(".div_status"),this.div_template=this.dialog.find(".div_template"),this.div_projeto_status=this.dialog.find(".div_projeto_status"),this.div_revisao=this.dialog.find(".div_revisao"),this.div_classificacao=this.dialog.find(".div_classificacao"),this.divFormularioPersonalizado=this.dialog.find(".divFormularioPersonalizado"),this.gridReferencias=this.dialog.find("#gridReferencias"),this.cbo_projetos_template=this.dialog.find(".cbo_projetos_template"),this.cbo_cliente=this.dialog.find(".cbo_cliente"),this.cbo_status=this.dialog.find(".cbo_status"),this.dx_dropdown_projeto_categoria=this.dialog.find(".dx_dropdown_projeto_categoria"),this.chk_sugerir_codigo=this.dialog.find(".chk_sugerir_codigo"),this.chk_bloquear_codigo=this.dialog.find(".chk_bloquear_codigo"),this.chk_bloquear_novos_apontamentos_concluidos=this.dialog.find(".chk_bloquear_novos_apontamentos_concluidos"),this.chk_validar_predecessoras_no_apontamento=this.dialog.find(".chk_validar_predecessoras_no_apontamento"),this.div_componente_usuario=this.dialog.find(".div_componente_usuario"),this.cboEquipe=e.createElement(i,null,null),this.cbo_classificacao=this.dialog.find(".cbo_classificacao"),this.edt_nome=this.dialog.find(".edt_nome"),this.edt_destinatarios=this.dialog.find(".edt_destinatarios"),this.edt_codigo=this.dialog.find(".edt_codigo"),this.edt_inicio=this.dialog.find(".edt_inicio"),this.edt_fim=this.dialog.find(".edt_fim"),this.edt_inicio_real=this.dialog.find(".edt_inicio_real"),this.edt_fim_real=this.dialog.find(".edt_fim_real"),this.edt_total_horas=this.dialog.find(".edt_total_horas"),this.edt_valor_km=this.dialog.find(".edt_valor_km"),this.edt_valor_pedagio=this.dialog.find(".edt_valor_pedagio"),this.edt_valor_refeicao=this.dialog.find(".edt_valor_refeicao"),this.edt_outras_despesas=this.dialog.find(".edt_outras_despesas"),this.edt_km_padrao=this.dialog.find(".edt_km_padrao"),this.edt_traslado=this.dialog.find(".edt_traslado"),this.chk_permite_alterar_padrao_apontamento=this.dialog.find(".chk_permite_alterar_padrao_apontamento"),this.chk_sugerir_despesas_no_apontamento_atividades=this.dialog.find(".chk_sugerir_despesas_no_apontamento_atividades"),this.cbo_tipo_valor_padrao_refeicao=this.dialog.find(".cbo_tipo_valor_padrao_refeicao"),this.cbo_tipo_relatorio_despesas_cliente_refeicao=this.dialog.find(".cbo_tipo_relatorio_despesas_cliente_refeicao"),this.edt_valor_orcamento_previsto=this.dialog.find(".edt_valor_orcamento_previsto"),this.edt_valor_orcamento_realizado=this.dialog.find(".edt_valor_orcamento_realizado"),this.edt_valor_orcamento_disponivel=this.dialog.find(".edt_valor_orcamento_disponivel"),this.edt_saldo_orcamento_disponivel=this.dialog.find(".edt_saldo_orcamento_disponivel"),this.chk_considerar_traslado=this.dialog.find(".chk_considerar_traslado"),this.chk_tipo_cancelamento_ignorar_prev_real=this.dialog.find(".chk_tipo_cancelamento_ignorar_prev_real"),this.div_pasta=this.dialog.find(".div_pasta"),this.selectPasta=e.createElement(a,null,null),this.cbo_apontamento_realizado_por=this.dialog.find(".cbo_apontamento_realizado_por"),this.dxTipoBaseline=this.dialog.find("#dxTipoBaseline"),this.chk_enviar_posicionamento=this.dialog.find(".chk_enviar_posicionamento"),this.chk_enviar_posicionamento_executores=this.dialog.find(".chk_enviar_posicionamento_executores"),this.chk_enviar_posicionamento_ultimas_concluidas=this.dialog.find(".chk_enviar_posicionamento_ultimas_concluidas"),this.edt_posicionamento_qtd_ultimas_concluidas=this.dialog.find(".edt_posicionamento_qtd_ultimas_concluidas"),this.chk_enviar_posicionamento_dias_ultimas_concluidas=this.dialog.find(".chk_enviar_posicionamento_dias_ultimas_concluidas"),this.edt_posicionamento_qtd_dias_ultimas_concluidas=this.dialog.find(".edt_posicionamento_qtd_dias_ultimas_concluidas"),this.chk_enviar_posicionamento_em_atraso=this.dialog.find(".chk_enviar_posicionamento_em_atraso"),this.chk_enviar_posicionamento_data_prazo=this.dialog.find(".chk_enviar_posicionamento_data_prazo"),this.edt_posicionamento_qtd_dias_data_prazo=this.dialog.find(".edt_posicionamento_qtd_dias_data_prazo"),this.chk_enviar_posicionamento_previsao_inicio=this.dialog.find(".chk_enviar_posicionamento_previsao_inicio"),this.edt_posicionamento_qtd_dias_previsao_inicio=this.dialog.find(".edt_posicionamento_qtd_dias_previsao_inicio"),this.div_componente_movimentacao_financeira=this.dialog.find(".div_componente_movimentacao_financeira"),this.btn_add_usuario_responsavel=this.dialog.find(".btn_add_usuario_responsavel"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.btn_excluir=this.dialog.find(".btn_excluir"),this.edt_descricao=this.dialog.find(".edt_descricao"),this.chk_utiliza_peso_atividades=this.dialog.find(".chk_utiliza_peso_atividades"),this.info_peso_atividades=this.dialog.find(".info_peso_atividades"),this.template="S",this.projeto_id=null,this.usuarios_responsaveis={},this.grupo_responsavel={},this.equipe=[],this.grupo_usuarios_equipe=[],this.valor=null,this.cliente_id=null,this.template_projetos=[],this.equipe_toda=null,this.limite=0,this.continua_revisao=!0,this.projeto_categoria_id=null,this.permissoes_usuario_logado={},this.parametro_busca_automatica=null,this.projeto_classificacoes=!1,this.documento_pasta_id=null,this.projeto_categoria=null,this.projeto_tipo_baseline=null,this.projeto_categoria=null,this.datasource_movimentacao_financeira=null,this.instanceMovimentacaoFinanceira=null,this.edt_equipe=null,this.formularioGetPostParams=null,this.formularioValidar=null,this.formularioMain={},this.formularioReadOnly=!1,this.referencia_tabela=null,this.referencia_id=null,this.show=function(e,a,i,t,r,s,_={referencia_tabela:null,referencia_id:null}){if(n.definir_id_abas(),o.render(n.selectPasta,n.div_pasta[0]),o.render(n.cboEquipe,n.div_componente_usuario[0]),n.cboEquipe.props.setFunctionSelect(n.evt_alterar_supervisor),n.parametro_busca_automatica="N"==App.sessao.dados.busca_automatica,"object"==typeof e&&null!=e){var d=clone_obj(e);e=null!=d.projeto_id&&""!=d.projeto_id?d.projeto_id:null,a=null!=d.tipo&&""!=d.tipo?d.tipo:FORMULARIO.NOVO,i=null!=d.cliente_id&&""!=d.cliente_id?d.cliente_id:null,t=null!=d.cliente_nome&&""!=d.cliente_nome?d.cliente_nome:null,_=d.referencia||{},n.referencia_tabela=_.referencia_tabela||null,n.referencia_id=_.referencia_id||null}else null!==_&&"object"==typeof _&&(n.referencia_tabela=_.referencia_tabela||null,n.referencia_id=_.referencia_id||null);switch(n.edt_valor_km.maskMoney({thousands:"",decimal:",",allowZero:!0,suffix:"",precision:2}),n.edt_valor_pedagio.maskMoney({thousands:"",decimal:",",allowZero:!0,suffix:"",precision:2}),n.edt_valor_refeicao.maskMoney({thousands:"",decimal:",",allowZero:!0,suffix:"",precision:2}),n.edt_outras_despesas.maskMoney({thousands:"",decimal:",",allowZero:!0,suffix:"",precision:2}),n.edt_valor_orcamento_disponivel.maskMoney({thousands:".",decimal:",",allowZero:!0,suffix:"",precision:2}),n.edt_valor_orcamento_realizado.maskMoney({thousands:".",decimal:",",allowZero:!0,suffix:"",precision:2}),n.edt_valor_orcamento_previsto.maskMoney({thousands:".",decimal:",",allowZero:!0,suffix:"",precision:2}),n.edt_saldo_orcamento_disponivel.maskMoney({thousands:".",allowNegative:!0,decimal:",",allowZero:!0,suffix:"",precision:2}),n.edt_valor_orcamento_disponivel.maskMoney("mask",0),n.edt_valor_orcamento_realizado.maskMoney("mask",0),n.edt_valor_orcamento_previsto.maskMoney("mask",0),n.edt_saldo_orcamento_disponivel.maskMoney("mask",0),n.edt_descricao.attr("id","edt_descricao"+n.html_id),n.cliente_id=i,set_datepicker(n.edt_inicio),set_datepicker(n.edt_fim),set_datepicker(n.edt_inicio_real),set_datepicker(n.edt_fim_real),n.edt_total_horas.mask("000:00"),create_combobox(n.cbo_cliente,n.listar_clientes),n.criar_events_cliente(n.cbo_cliente),n.tipo=a,n.tipo!=FORMULARIO.EDITAR||r||App.sessao.dados.admin||(n.tipo=FORMULARIO.VISUALIZAR),n.tipo){case FORMULARIO.NOVO:App.titulo_aba(n.html_id,"Novo projeto"),n.cbo_status.val(0).trigger("change"),n.cbo_tipo.val(0).trigger("change"),set_value_combobox(n.cbo_cliente,i,t),n.listar_templates(),n.btn_salvar.show(),n.btn_excluir.hide(),n.div_template.removeClass("hidden"),n.permite_alterar(!0),setTimeout(function(){var e={};e.usuario_id=App.sessao.dados.usuario_id.toString(),e.nome=App.sessao.dados.nome,e.tipo="usuarios",e.gerente_projeto=!0,e.planejamento_financeiro=!0,e.planejamento_atividade=!0,e.planejamento_recursos=!0,e.planejamento_datas=!0,e.planejamento_relatorio=!0,n.equipe.push(e),n.render_equipe()},150),n.chk_enviar_posicionamento_executores.prop("checked",!1).change(),n.chk_enviar_posicionamento_ultimas_concluidas.prop("checked",!1).change(),n.edt_posicionamento_qtd_ultimas_concluidas.val(5),n.chk_enviar_posicionamento_dias_ultimas_concluidas.prop("checked",!0).change(),n.edt_posicionamento_qtd_dias_ultimas_concluidas.val(7),n.chk_enviar_posicionamento_em_atraso.prop("checked",!0).change(),n.chk_enviar_posicionamento_data_prazo.prop("checked",!0).change(),n.edt_posicionamento_qtd_dias_data_prazo.val(7),n.chk_enviar_posicionamento_previsao_inicio.prop("checked",!0).change(),n.edt_posicionamento_qtd_dias_previsao_inicio.val(7);break;case FORMULARIO.EDITAR:n.btn_excluir.hide(),n.div_total_horas.removeClass("hidden"),n.permite_alterar(!0);break;case FORMULARIO.VISUALIZAR:n.btn_salvar.hide(),n.btn_excluir.hide(),n.div_total_horas.removeClass("hidden"),n.permite_alterar(!1);break;case FORMULARIO.EXCLUIR:n.btn_salvar.hide(),n.btn_excluir.show(),n.div_total_horas.removeClass("hidden"),n.permite_alterar(!1)}s&&n.btn_salvar.show(),n.get_configuracoes(),WS.get("projeto_classificacao/get_parametros/",null,function(e){n.projeto_classificacoes="true"==e.projeto_classificacoes,1==n.projeto_classificacoes?(n.div_classificacao.removeClass("hidden"),a==FORMULARIO.NOVO&&n.listar_classificacao()):n.div_classificacao.addClass("hidden"),set_focus(n.edt_codigo_projeto)}),n.render_tipo_baseline(),void 0!==e&&e?(n.projeto_id=e,n.lbl_tab_revisao.removeClass("hidden"),n.preencher()):(n.lbl_tab_revisao.addClass("hidden"),n.sugerir_codigo(!1),set_tinymce(n.edt_descricao,""),n.listar_documento_pasta(),n.listar_status(),n.listar_calendario_trabalho()),n.cbo_status.selectpicker("refresh"),n.cbo_tipo.selectpicker("refresh"),n.projeto_categoria=n.dx_dropdown_projeto_categoria.dxDropDownBox({readOnly:!n.valor,valueExpr:"id",placeholder:"Selecione um valor",displayExpr:"descricao",showClearButton:!0,dataSource:DevExpress.data.AspNet.createStore({key:"id",loadUrl:WS_URI+"projeto_categoria/listar/",onBeforeSend:function(e,o){o.xhrFields={withCredentials:XHR_WITH_CREDENTIALS},o.headers=WS.dxHeaders()}}),contentTemplate:function(e){var o=e.component.option("value"),a=$("<div>").dxDataGrid({dataSource:e.component.getDataSource(),columns:[{dataField:"descricao",width:200},{dataField:"bloqueado",dataType:"boolean",calculateCellValue:function(e){return!0===e.bloqueado||"S"==e.bloqueado},width:100}],hoverStateEnabled:!0,paging:{enabled:!0,pageSize:10},filterRow:{visible:!0},scrolling:{mode:"infinite"},height:345,selection:{mode:"single"},selectedRowKeys:o,onSelectionChanged:function(o){if(void 0!==o.selectedRowsData[0]&&"S"!=o.selectedRowsData[0].bloqueado){var a=o.selectedRowKeys;e.component.option("value",a)}}}),i=a.dxDataGrid("instance");return e.component.on("valueChanged",function(e){var o=e.value;i.selectRows(o,!1)}),a}}).dxDropDownBox("instance"),n.formularioReadOnly=!s&&n.tipo==FORMULARIO.VISUALIZAR,n.render_formulario(),n.info_peso_atividades.on("click",e=>{alertaPopUp("Pesos de Atividades","Ativando esta configuração o sistema irá liberar, na edição da atividade, um novo campo onde será possível informar o peso (%) que aquela atividade possui para o projeto. <br><br> Quando a atividade for concluída, o percentual de conclusão do projeto será calculado a partir do peso da atividade. Por exemplo, caso uma atividade de 15% seja concluída, a porcentagem de conclusão do projeto será de 15%. Caso outra atividade de 25% de peso seja concluída, a porcentagem de conclusão do projeto será de 40%. <br><br> <strong>IMPORTANTE:</strong> caso a soma dos pesos de todas as atividades do projeto não resulte em 100%, o sistema não irá calcular o percentual de conclusão do projeto, ficando apenas com valor 0 (zero).","Ok",()=>{},"",()=>{},800,280)})},this.definir_id_abas=function(){n.tab_geral.attr("id","tab_geral"+n.html_id),n.tab_equipe.attr("id","tab_equipe"+n.html_id),n.tab_financeiro.attr("id","tab_financeiro"+n.html_id),n.tab_movimentacao_financeira.attr("id","tab_movimentacao_financeira"+n.html_id),n.tab_revisao.attr("id","tab_revisao"+n.html_id),n.tab_rel_posicionamento.attr("id","tab_rel_posicionamento"+n.html_id),n.tab_config.attr("id","tab_config"+n.html_id),n.tab_personalizado.attr("id","tab_personalizado"+n.html_id),n.tab_referencias.attr("id","tab_referencias"+n.html_id),n.menu_geral.attr("href","#"+n.tab_geral.attr("id")),n.menu_equipe.attr("href","#"+n.tab_equipe.attr("id")),n.menu_financeiro.attr("href","#"+n.tab_financeiro.attr("id")),n.menu_movimentacao_financeira.attr("href","#"+n.tab_movimentacao_financeira.attr("id")),n.menu_revisao.attr("href","#"+n.tab_revisao.attr("id")),n.menu_rel_posicionamento.attr("href","#"+n.tab_rel_posicionamento.attr("id")),n.menu_config.attr("href","#"+n.tab_config.attr("id")),n.menu_personalizado.attr("href","#"+n.tab_personalizado.attr("id")),n.menu_referencias.attr("href","#"+n.tab_referencias.attr("id"))},this.get_configuracoes=function(){n.tipo==FORMULARIO.NOVO&&n.chk_tipo_cancelamento_ignorar_prev_real.prop("checked","N"!=App.sessao.dados.parametro_projeto.tipo_cancelamento_ignorar_prev_real).trigger("change")},this.alterar_equipe=function(e){n.cboEquipe.props.setObjParam({ExibirTecnicos:!0,ExibirGrupos:!0,Clientes:!0,ClienteId:e,EmpresaId:App.temp.empresa})},this.evt_alterar_supervisor=function(){var e=!1;"usuarios"==n.cboEquipe.props.UsuarioSelecionado.tipo||"usuario_cliente"==n.cboEquipe.props.UsuarioSelecionado.tipo||"usuario_fornecedor"==n.cboEquipe.props.UsuarioSelecionado.tipo?($(n.equipe).each(function(o,a){a.usuario_id===n.cboEquipe.props.UsuarioSelecionado.id&&(e=!0)}),setTimeout(function(){if(!e){var o={};o.usuario_id=n.cboEquipe.props.UsuarioSelecionado.id,o.nome=n.cboEquipe.props.UsuarioSelecionado.nome,o.tipo=n.cboEquipe.props.UsuarioSelecionado.tipo,o.gerente_projeto=!1,o.planejamento_financeiro=!1,o.planejamento_atividade=!1,o.planejamento_recursos=!1,o.planejamento_datas=!1,o.planejamento_relatorio=!1,n.equipe.push(o)}n.render_equipe()},150)):"grupo_usuarios"==n.cboEquipe.props.UsuarioSelecionado.tipo&&($(n.grupo_usuarios_equipe).each(function(o,a){a.grupo_usuarios_id===n.cboEquipe.props.UsuarioSelecionado.id&&(e=!0)}),setTimeout(function(){if(!e){var o={};o.grupo_usuarios_id=n.cboEquipe.props.UsuarioSelecionado.id,o.nome=n.cboEquipe.props.UsuarioSelecionado.nome,o.gerente_projeto=!1,o.planejamento_financeiro=!1,o.planejamento_atividade=!1,o.planejamento_recursos=!1,o.planejamento_datas=!1,o.planejamento_relatorio=!1,n.grupo_usuarios_equipe.push(o)}n.render_equipe()},150)),n.cboEquipe.props.setUsuario({usuario_id:null,usuario_nome:""})},this.listar_calendario_trabalho=function(e){n.cbo_calendario_trabalho.find("option").remove(),add_option(n.cbo_calendario_trabalho,"","Nenhum"),WS.get("calendario_trabalho/listar/",null,function(o){for(var a=0;a<o.length;a++){var i=o[a];add_option(n.cbo_calendario_trabalho,i.calendario_trabalho_id,i.nome)}e&&n.cbo_calendario_trabalho.val(e).trigger("change")})},this.sugerir_codigo=function(e){var o={projeto_template:e};WS.get("projeto/get_next_codigo/",o,function(e){n.edt_codigo.val(e)})},this.listar_status=function(e){n.cbo_status.find("option").remove(),add_option(n.cbo_status,"","- Selecione -"),WS.get("projeto_status/listar/",null,function(o){for(var a=0;a<o.length;a++){var i=o[a];add_option(n.cbo_status,i.projeto_status_id,i.descricao)}e&&n.cbo_status.val(e).trigger("change"),n.cbo_status.selectpicker("refresh")},null,null,null,null,null,n.html_id)},this.close=function(){void 0!==n.onclose&&n.onclose&&n.onclose()},this.unload=function(){n.close(),View.unload(this.html_id)},this.permite_alterar=function(e){var o=n.cbo_cliente.parent(),a=o.find(".edt_combobox"),i=o.find(".btn_combobox");n.edt_nome.prop("readonly",!e),n.edt_destinatarios.prop("readonly",!e),n.cbo_projetos_template.prop("disabled",!e),n.chk_template.prop("disabled",!e),n.edt_codigo.prop("readonly",!e),a.prop("disabled",!e),i.prop("disabled",!e),n.edt_inicio.prop("readonly",!e),n.edt_fim.prop("readonly",!e),n.edt_inicio_real.prop("readonly",!e),n.edt_fim_real.prop("readonly",!e),n.cbo_status.prop("disabled",!e),n.cbo_tipo.prop("disabled",!e),n.cboEquipe.props.setCampoUsuarioLeitura(!e),n.btn_revisao.prop("disabled",!e),n.btn_refresh_revisao.prop("disabled",!e),n.chk_sugerir_codigo.prop("disabled",!e),n.chk_considerar_traslado.prop("disabled",!e),n.chk_tipo_cancelamento_ignorar_prev_real.prop("disabled",!e),n.chk_enviar_posicionamento.prop("disabled",!e),n.chk_enviar_posicionamento_executores.prop("disabled",!e),n.chk_enviar_posicionamento_ultimas_concluidas.prop("disabled",!e),n.edt_posicionamento_qtd_ultimas_concluidas.prop("readonly",!e),n.chk_enviar_posicionamento_dias_ultimas_concluidas.prop("disabled",!e),n.edt_posicionamento_qtd_dias_ultimas_concluidas.prop("readonly",!e),n.chk_enviar_posicionamento_em_atraso.prop("disabled",!e),n.chk_enviar_posicionamento_data_prazo.prop("disabled",!e),n.edt_posicionamento_qtd_dias_data_prazo.prop("readonly",!e),n.chk_enviar_posicionamento_previsao_inicio.prop("disabled",!e),n.edt_posicionamento_qtd_dias_previsao_inicio.prop("readonly",!e),n.chk_bloquear_codigo.prop("disabled",!e),n.chk_bloquear_novos_apontamentos_concluidos.prop("disabled",!e),n.chk_validar_predecessoras_no_apontamento.prop("disabled",!e),n.selectPasta.props.setDesabilitado(!e),n.cbo_apontamento_realizado_por.prop("disabled",!e),n.edt_valor_pedagio.prop("disabled",!e),n.edt_valor_km.prop("disabled",!e),n.edt_valor_refeicao.prop("disabled",!e),n.edt_km_padrao.prop("disabled",!e),n.edt_traslado.prop("disabled",!e),n.chk_permite_alterar_padrao_apontamento.prop("disabled",!e),n.chk_sugerir_despesas_no_apontamento_atividades.prop("disabled",!e),n.cbo_tipo_valor_padrao_refeicao.prop("disabled",!e),n.cbo_tipo_relatorio_despesas_cliente_refeicao.prop("disabled",!e),n.edt_outras_despesas.prop("disabled",!e),n.edt_valor_orcamento_disponivel.prop("disabled",!e),n.cbo_classificacao.prop("disabled",!e),n.cbo_calendario_trabalho.prop("disabled",!e),n.valor=e},this.preencher=function(e=!1){WS.get("projeto/objeto/",{projeto_id:n.projeto_id},function(o){if(App.titulo_aba(n.html_id,o.nome),n.datasource_movimentacao_financeira=o.movimentacao_financeira,n.equipe_toda=object_to_array(o.equipe_toda),!App.sessao.dados.admin)for(var a=0;a<n.equipe_toda.length;a++){var i=n.equipe_toda[a];i.usuario_id==App.sessao.dados.usuario_id&&(n.permissoes_usuario_logado=i)}1==n.projeto_classificacoes&&n.listar_classificacao(o.classificacao_projeto_id),n.listar_status(o.projeto_status_id),n.listar_calendario_trabalho(o.calendario_trabalho_id),set_tinymce(n.edt_descricao,o.descricao,!(n.tipo==FORMULARIO.EDITAR&&(App.sessao.dados.admin||"S"==n.permissoes_usuario_logado.gerente_projeto))),n.lbl_nome_projeto.text(o.nome),n.edt_nome.val(o.nome),n.edt_destinatarios.val(o.destinatarios),n.projeto_id=o.id,n.edt_codigo.val(o.codigo),n.edt_total_horas.val(null!=o.horas_previstas?format_time(o.horas_previstas):"000:00"),n.chk_considerar_traslado.prop("checked","S"==o.considerar_traslado).change(),n.chk_tipo_cancelamento_ignorar_prev_real.prop("checked","S"==o.tipo_cancelamento_ignorar_prev_real).change(),n.chk_enviar_posicionamento.prop("checked","S"==o.enviar_posicionamento).change(),n.chk_enviar_posicionamento_executores.prop("checked","S"==o.enviar_posicionamento_executores).change(),n.chk_enviar_posicionamento_ultimas_concluidas.prop("checked","S"==o.enviar_posicionamento_ultimas_concluidas).change(),n.edt_posicionamento_qtd_ultimas_concluidas.val(o.posicionamento_qtd_ultimas_concluidas),n.chk_enviar_posicionamento_dias_ultimas_concluidas.prop("checked","S"==o.enviar_posicionamento_dias_ultimas_concluidas).change(),n.edt_posicionamento_qtd_dias_ultimas_concluidas.val(o.posicionamento_qtd_dias_ultimas_concluidas),n.chk_enviar_posicionamento_em_atraso.prop("checked","S"==o.enviar_posicionamento_em_atraso).change(),n.chk_enviar_posicionamento_data_prazo.prop("checked","S"==o.enviar_posicionamento_data_prazo).change(),n.edt_posicionamento_qtd_dias_data_prazo.val(o.posicionamento_qtd_dias_data_prazo),n.chk_enviar_posicionamento_previsao_inicio.prop("checked","S"==o.enviar_posicionamento_previsao_inicio).change(),n.edt_posicionamento_qtd_dias_previsao_inicio.val(o.posicionamento_qtd_dias_previsao_inicio),n.chk_bloquear_novos_apontamentos_concluidos.prop("checked","S"==o.bloquear_apontamento_atividade_concluida).change(),n.chk_validar_predecessoras_no_apontamento.prop("checked","S"==o.validar_predecessoras_no_apontamento).change(),n.chk_template.prop("checked","S"==o.template).change(),n.chk_on(),n.render_revisoes();var t={valor_km:o.valor_km,valor_pedagio:o.valor_pedagio,valor_refeicao:o.valor_refeicao,outras_despesas:o.outras_despesas,quantidade_km_padrao:o.quantidade_km_padrao,traslado_padrao:o.traslado_padrao,permite_alterar_padrao_apontamento:o.permite_alterar_padrao_apontamento,sugerir_despesas_no_apontamento_atividades:o.sugerir_despesas_no_apontamento_atividades,tipo_valor_padrao_refeicao:o.tipo_valor_padrao_refeicao,tipo_relatorio_despesas_cliente_refeicao:o.tipo_relatorio_despesas_cliente_refeicao,valor_orcamento_previsto:o.valor_orcamento_previsto,valor_orcamento_realizado:o.valor_orcamento_realizado,valor_orcamento_disponivel:o.valor_orcamento_disponivel,saldo_orcamento_disponivel:o.saldo_orcamento_disponivel};n.render_financeiro(t),n.projeto_categoria_id=o.projeto_categoria_id,null!=n.projeto_categoria_id&&n.projeto_categoria.option("value",[n.projeto_categoria_id.toString()]),setTimeout(function(){set_datepicker(n.edt_inicio,o.inicio),set_datepicker(n.edt_fim,o.fim),set_datepicker(n.edt_inicio_real,o.inicio_real),set_datepicker(n.edt_fim_real,o.fim_real)},150),n.equipe=o.equipe,n.grupo_usuarios_equipe=o.grupo_usuarios_equipe,n.render_equipe(),n.cbo_tipo.val(o.tipo).trigger("change"),n.cbo_status.val(o.projeto_status_id).trigger("change"),n.cbo_apontamento_realizado_por.val(o.apontamento_por).trigger("change"),set_value_combobox(n.cbo_cliente,o.cliente_id,""==o.cliente_nome||null==o.cliente_nome?o.cliente_razao_social:o.cliente_nome),n.chk_sugerir_codigo.prop("checked","S"==o.sugerir_codigo).change(),n.chk_bloquear_codigo.prop("checked","S"==o.bloquear_codigo).change(),n.documento_pasta_id=o.documento_pasta_id,n.listar_documento_pasta(o.documento_pasta_id,o.documento_pasta_path),n.projeto_tipo_baseline.option("value",o.controle_baseline.toString()),n.renderizarComponenteMovimentacaoFinanceira(),n.chk_utiliza_peso_atividades.prop("checked","S"===o.utiliza_peso_atividades||!0===o.utiliza_peso_atividades).trigger("change"),e&&n.render_formulario()})},this.render_revisoes=function(){var e=n.tbl_revisao.find("tbody"),o=$(e.find('[template-row="tr_revisao"]'));e.find("tr:not([template-row])").remove();WS.get("projeto_revisao/listar/",{projeto_id:n.projeto_id,limite:n.limite},function(a){a.length<11&&(n.continua_revisao=!1),$(a).each(function(a,i){!function(a,i){var t=$(o.clone()).css("display","").addClass("rows").removeAttr("template-row");$(t.find('[template-field="sequencia"]')).text(i.sequencia),$(t.find('[template-field="revisao"]')).html(i.revisao),t.find('[template-field="data"]').html(i.data.format_date()),t.find('[template-field="gerente"]').html(i.nome);var r=t.find(".btn_revisao_editar"),s=t.find(".btn_revisao_excluir");!0===App.sessao.dados.admin||"S"==n.permissoes_usuario_logado.gerente_projeto?(r.unbind("click").click(function(e){View.load("projeto/revisao",function(e,o){o.onclose=function(){n.render_revisoes()},o.projeto_revisao_id=i.projeto_revisao_id,o.show(FORMULARIO.EDITAR,n.projeto_id)})}),s.unbind("click").click(function(e){View.load("projeto/revisao",function(e,o){o.onclose=function(){n.render_revisoes()},o.projeto_revisao_id=i.projeto_revisao_id,o.show(FORMULARIO.EXCLUIR,n.projeto_id)})})):r.parents(".btn-group").addClass("hidden"),t.appendTo(e)}(0,i)})})},this.render_equipe=function(e,o){var a=n.tabela_equipe.find("tbody"),i=a.find("tr:first"),t=function(t,r,s){var _=i.clone();_.removeAttr("template-row"),_.css("display","");var d=$(_.find("[template-field='tipo']"));r?(d.text("GU"),d.attr("title","Grupo de Usuários"),d.addClass("label-warning")):"usuario_cliente"==t.tipo||t.tipo==USUARIO_TIPO.CLIENTE?(d.text("C"),d.attr("title","Usuário Cliente"),d.addClass("label-primary")):"usuario_prospect"==t.tipo||t.tipo==USUARIO_TIPO.ORGANIZACAO?(d.text("F"),d.attr("title","Usuário Organização"),d.addClass("label-primary")):"usuario_fornecedor"==t.tipo||t.tipo==USUARIO_TIPO.FORNECEDOR?(d.text("F"),d.attr("title","Usuário Fornecedor"),d.addClass("label-primary")):(d.text("U"),d.attr("title","Usuário"),d.addClass("label-info")),d.attr("data-original-title",d.attr("title")),d.tooltip(),t.bloqueado&&"S"==t.bloqueado&&(_.attr("data-original-title","Usuário Bloqueado"),_.tooltip()),$(_.find("[template-field='nome']")).text(t.nome);var c=$(_.find(".btn_usuario_remover")),l=$(_.find(".chk_atividade"));l.attr("type","checkbox"),l.addClass("checkbox_bootstrap_toggle");var p=$(_.find(".chk_recursos"));p.attr("type","checkbox"),p.addClass("checkbox_bootstrap_toggle");var u=$(_.find(".chk_datas"));u.attr("type","checkbox"),u.addClass("checkbox_bootstrap_toggle");var m=$(_.find(".chk_financeiro"));m.attr("type","checkbox"),m.addClass("checkbox_bootstrap_toggle");var h=$(_.find(".chk_gerente"));h.attr("type","checkbox"),h.addClass("checkbox_bootstrap_toggle");var v=$(_.find(".chk_relatorio"));v.attr("type","checkbox"),v.addClass("checkbox_bootstrap_toggle");var f=$(_.find(".chk_formulario"));f.attr("type","checkbox"),f.addClass("checkbox_bootstrap_toggle"),1==t.planejamento_financeiro&&m.prop("checked",!0),1==t.planejamento_datas&&u.prop("checked",!0),1==t.planejamento_recursos&&p.prop("checked",!0),1==t.planejamento_atividade&&l.prop("checked",!0),1==t.planejamento_relatorio&&v.prop("checked",!0),1==t.planejamento_formulario&&f.prop("checked",!0);var b=$(_.find(".div_esconder"));if(!t.bloqueado||"S"!==t.bloqueado&&t.bloqueado?1==t.gerente_projeto&&(h.prop("checked",!0),_.addClass("bg-info"),_.find("td").addClass("bg-info"),h.prop("checked")?b.addClass("hidden"):b.removeClass("hidden")):(_.addClass("bg-danger"),_.find("td").addClass("bg-danger")),$(l).prop("disabled",!n.valor),$(p).prop("disabled",!n.valor),$(u).prop("disabled",!n.valor),$(m).prop("disabled",!n.valor),$(h).prop("disabled",!n.valor),$(v).prop("disabled",!n.valor),$(f).prop("disabled",!n.valor),$(c).prop("disabled",!n.valor),n.valor||$(c).addClass("hidden"),l.unbind("change"),l.change(function(){(r?n.grupo_usuarios_equipe[s]:n.equipe[s]).planejamento_atividade=$(this).prop("checked")}),p.unbind("change"),p.change(function(){(r?n.grupo_usuarios_equipe[s]:n.equipe[s]).planejamento_recursos=$(this).prop("checked")}),u.unbind("change"),u.change(function(){(r?n.grupo_usuarios_equipe[s]:n.equipe[s]).planejamento_datas=$(this).prop("checked")}),m.unbind("change"),m.change(function(){(r?n.grupo_usuarios_equipe[s]:n.equipe[s]).planejamento_financeiro=$(this).prop("checked")}),v.on("change",function(){(r?n.grupo_usuarios_equipe[s]:n.equipe[s]).planejamento_relatorio=$(this).prop("checked")}),f.on("change",function(){(r?n.grupo_usuarios_equipe[s]:n.equipe[s]).planejamento_formulario=$(this).prop("checked")}),h.unbind("change"),h.change(function(){var e=r?n.grupo_usuarios_equipe[s]:n.equipe[s];!t.bloqueado||"S"!==t.bloqueado&&t.bloqueado?$(this).prop("checked")?(_.addClass("bg-info"),_.find("td").addClass("bg-info"),b.addClass("hidden")):(_.removeClass("bg-info"),_.find("td").removeClass("bg-info"),b.removeClass("hidden")):(b.removeClass("hidden"),_.removeClass("bg-info"),_.find("td").removeClass("bg-info"),_.addClass("bg-danger"),_.find("td").addClass("bg-danger")),e.gerente_projeto=$(this).prop("checked")}),!0!==e?(c.unbind("click"),c.click(function(){r?alert_modal("Atenção","Deseja remover o Grupo de Usuários?","Remover",function(){$(n.grupo_usuarios_equipe).each(function(e,o){o.grupo_usuarios_id==t.grupo_usuarios_id&&(_.remove(),n.grupo_usuarios_equipe.splice(e,1),n.render_equipe())})},!0):alert_modal("Atenção","Deseja remover o Usuário?","Remover",function(){$(n.equipe).each(function(e,o){o.usuario_id==t.usuario_id&&(_.remove(),n.equipe.splice(e,1),n.render_equipe())})},!0)})):!0===e&&c.addClass("hidden"),n.tipo!==FORMULARIO.NOVO)if(App.sessao.dados.admin||"S"==n.permissoes_usuario_logado.planejamento_financeiro){if(n.lbl_tab_financeiro.show(),n.lbl_tab_movimentacao_financeira.show(),o){var g={valor_km:o.valor_km,valor_pedagio:o.valor_pedagio,valor_refeicao:o.valor_refeicao,outras_despesas:o.outras_despesas,quantidade_km_padrao:o.quantidade_km_padrao,traslado_padrao:response.traslado_padrao,permite_alterar_padrao_apontamento:response.permite_alterar_padrao_apontamento,sugerir_despesas_no_apontamento_atividades:response.sugerir_despesas_no_apontamento_atividades};n.render_financeiro(g)}}else m.parent().parent().addClass("hidden"),n.lbl_tab_financeiro.hide(),n.lbl_tab_movimentacao_financeira.hide();_.appendTo(a)};n.tabela_equipe.find("tr:gt(1)").remove(),$(n.equipe).each(function(e,o){t(o,!1,e)}),$(n.grupo_usuarios_equipe).each(function(e,o){t(o,!0,e)}),App.aplicar_checkbox(a)},this.listar_clientes=function(e,o){var a=o.parent(),i=a.find(".edt_combobox");WS.get("cliente/listar/",{bloqueado:"N",pesquisa_varias_colunas:i.val(),limite:0},function(i){limpar_combobox(o);var t=$(window).width();$(i).each(function(e,a){var i=[];i["Nome/Razão Social Cliente"]=""==a.nome_fantasia||null==a.nome_fantasia?a.razao_social:a.nome_fantasia,null!=i["Nome/Razão Social Cliente"]&&""!=i["Nome/Razão Social Cliente"]||(i["Nome/Razão Social Cliente"]="-"),parseInt(t)>=992&&(i["CNPJ/CPF"]=""==a.cnpj||null==a.cnpj?"-":a.cnpj),i["Cod Cliente"]=""==a.codigo||null==a.codigo?"-":a.codigo,i.Unidade=""==a.unidade||null==a.unidade?"-":a.unidade,add_option_combobox(o,e,a.cliente_id>0?a.cliente_id:null,i,null,JSON.stringify(a))}),e(!0);a.find(".ul_row").click(function(){var e=$(this).parent().attr("id_registro");n.cliente_id=e})})},this.criar_events_cliente=function(e){var o=e.parent().find(".edt_combobox");o.keypress(function(a){13==a.keyCode?setTimeout(function(){var a=e.parent().find(".ncbo_scroll").find(".row_selected");if(""==o.val().trim())n.cliente_id=null;else{var i=a.attr("id_registro");i>0&&(n.cliente_id=i)}set_focus(o),n.alterar_equipe(n.cliente_id)},150):13==a.tecla_value&&(n.cliente_id=$(this).attr("selected-value"),n.alterar_equipe(n.cliente_id))})},this.listar_templates=function(){n.cbo_projetos_template.find("option").remove(),add_option(n.cbo_projetos_template,"","-- Selecione --"),WS.get("projeto/get_projeto_template/",null,function(e){for(var o=0;o<e.length;o++){var a=e[o];n.template_projetos=e,add_option(n.cbo_projetos_template,a.id,a.nome,"id="+(null!=a.horas_previstas?a.horas_previstas:"000:00"))}n.cbo_projetos_template.selectpicker("refresh")})},this.listar_documento_pasta=function(e,o){if(e){var a=void 0===o||""===o;n.selectPasta.props.setDocumentoPastaID(e,a)}void 0!==o&&""!==o&&n.selectPasta.props.setDocumentoPastaPath(o),n.selectPasta.props.handleSelecionar=function(){n.documento_pasta_id=n.selectPasta.props.documentoPastaID}},this.chk_on=function(){n.chk_template.prop("checked")?(n.edt_inicio.val(""),n.edt_inicio_real.val(""),n.edt_fim.val(""),n.edt_fim_real.val(""),n.cbo_cliente.val(""),n.div_projeto_status.hide(),n.div_status.hide(),n.div_clientes.hide(),n.div_datas.hide(),n.lbl_tab_revisao.hide(),n.lbl_tab_rel_posicionamento.hide(),n.lbl_tab_config.hide()):(n.div_status.show(),n.div_projeto_status.show(),n.div_clientes.show(),n.div_datas.show(),n.edt_inicio_real.val(""),n.edt_fim_real.val(""),n.lbl_tab_revisao.show(),n.lbl_tab_rel_posicionamento.show(),n.lbl_tab_config.show())},this.render_tipo_baseline=function(){n.projeto_tipo_baseline=n.dxTipoBaseline.dxSelectBox({dataSource:[{ID:"1",Name:"Projeto"},{ID:"2",Name:"Atividade"}],displayExpr:"Name",valueExpr:"ID",placeholder:"Selecione um valor"}).dxSelectBox("instance")},this.chk_bloquear_codigo.change(function(){!0===$(this).prop("checked")&&n.chk_sugerir_codigo.prop("checked",!0).change()}),this.chk_sugerir_codigo.change(function(){!1===$(this).prop("checked")&&!0===n.chk_bloquear_codigo.prop("checked")&&n.chk_bloquear_codigo.prop("checked",!1).change()}),this.edt_nome.unbind("keyup"),this.edt_nome.keyup(function(){n.lbl_nome_projeto.text(n.edt_nome.val())}),this.edt_km_padrao.unbind("keyup"),this.edt_km_padrao.keyup(function(){somenteNumeros(this.value,this)}),this.btn_add_usuario_responsavel.unbind("click"),this.btn_add_usuario_responsavel.click(function(){View.load("usuario/selecionar",function(e,o){o.show(function(e){var o=!1;$(n.equipe).each(function(a,i){i.usuario_id==e.usuario_id&&(o=!0)}),o||(n.usuarios_responsaveis=e,n.usuarios_responsaveis.gerente_projeto=!1,n.usuarios_responsaveis.planejamento_financeiro=!1,n.usuarios_responsaveis.planejamento_atividade=!1,n.usuarios_responsaveis.planejamento_recursos=!1,n.usuarios_responsaveis.planejamento_datas=!1,n.usuarios_responsaveis.planejamento_relatorio=!1,n.equipe.push(n.usuarios_responsaveis)),n.render_equipe()})})}),this.cbo_status.unbind("change"),this.cbo_status.change(function(){n.cbo_status.selectpicker("refresh")}),this.btn_revisao.unbind("click"),this.btn_revisao.click(function(){View.load("projeto/revisao",function(e,o){o.onclose=function(){n.render_revisoes()},o.show(FORMULARIO.NOVO,n.projeto_id)})}),this.btn_refresh_revisao.unbind("click"),this.btn_refresh_revisao.click(function(){n.limite=0,n.continua_revisao=!0,n.tbl_revisao.find(".rows").remove(),n.render_revisoes()}),this.cbo_tipo.unbind("change"),this.cbo_tipo.change(function(){n.cbo_tipo.selectpicker("refresh")}),this.chk_template.change(function(){n.tipo==FORMULARIO.NOVO&&n.sugerir_codigo(n.chk_template.prop("checked")),n.chk_on()}),this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){n.unload()}),this.btn_salvar.unbind("click"),this.btn_salvar.click(function(e){var o={projeto_id:n.projeto_id,codigo:n.edt_codigo.val(),nome:n.edt_nome.val(),destinatarios:n.edt_destinatarios.val(),cliente_id:n.cliente_id,inicio:get_datepicker(n.edt_inicio),inicio_real:get_datepicker(n.edt_inicio_real),fim:get_datepicker(n.edt_fim),fim_real:get_datepicker(n.edt_fim_real),template:n.chk_template.prop("checked"),template_id:n.cbo_projetos_template.val(),projeto_status_id:n.cbo_status.val(),tipo:n.cbo_tipo.val(),equipe:JSON.stringify(n.equipe),equipe_toda:JSON.stringify(n.equipe_toda),descricao:get_tinymce(n.edt_descricao),grupo_usuarios_equipe:JSON.stringify(n.grupo_usuarios_equipe),sugerir_codigo:n.chk_sugerir_codigo.prop("checked"),bloquear_codigo:n.chk_bloquear_codigo.prop("checked"),bloquear_apontamento_atividade_concluida:n.chk_bloquear_novos_apontamentos_concluidos.prop("checked"),validar_predecessoras_no_apontamento:n.chk_validar_predecessoras_no_apontamento.prop("checked"),considerar_traslado:n.chk_considerar_traslado.prop("checked"),tipo_cancelamento_ignorar_prev_real:n.chk_tipo_cancelamento_ignorar_prev_real.prop("checked"),enviar_posicionamento:n.chk_enviar_posicionamento.prop("checked"),enviar_posicionamento_executores:n.chk_enviar_posicionamento_executores.prop("checked"),enviar_posicionamento_ultimas_concluidas:n.chk_enviar_posicionamento_ultimas_concluidas.prop("checked"),posicionamento_qtd_ultimas_concluidas:n.edt_posicionamento_qtd_ultimas_concluidas.val(),enviar_posicionamento_dias_ultimas_concluidas:n.chk_enviar_posicionamento_dias_ultimas_concluidas.prop("checked"),posicionamento_qtd_dias_ultimas_concluidas:n.edt_posicionamento_qtd_dias_ultimas_concluidas.val(),enviar_posicionamento_em_atraso:n.chk_enviar_posicionamento_em_atraso.prop("checked"),enviar_posicionamento_data_prazo:n.chk_enviar_posicionamento_data_prazo.prop("checked"),posicionamento_qtd_dias_data_prazo:n.edt_posicionamento_qtd_dias_data_prazo.val(),enviar_posicionamento_previsao_inicio:n.chk_enviar_posicionamento_previsao_inicio.prop("checked"),posicionamento_qtd_dias_previsao_inicio:n.edt_posicionamento_qtd_dias_previsao_inicio.val(),documento_pasta_id:n.documento_pasta_id,projeto_categoria_id:null!==n.projeto_categoria.option("value")?n.projeto_categoria.option("value")[0]:null,valor_km:n.edt_valor_km.maskMoney("unmasked")[0],valor_pedagio:n.edt_valor_pedagio.maskMoney("unmasked")[0],valor_refeicao:n.edt_valor_refeicao.maskMoney("unmasked")[0],outras_despesas:n.edt_outras_despesas.maskMoney("unmasked")[0],quantidade_km_padrao:n.edt_km_padrao.val(),traslado_padrao:n.edt_traslado.val(),permite_alterar_padrao_apontamento:n.chk_permite_alterar_padrao_apontamento.prop("checked"),sugerir_despesas_no_apontamento_atividades:n.chk_sugerir_despesas_no_apontamento_atividades.prop("checked"),tipo_valor_padrao_refeicao:n.cbo_tipo_valor_padrao_refeicao.val(),tipo_relatorio_despesas_cliente_refeicao:n.cbo_tipo_relatorio_despesas_cliente_refeicao.val(),valor_orcamento_disponivel:n.edt_valor_orcamento_disponivel.maskMoney("unmasked")[0],apontamento_por:n.cbo_apontamento_realizado_por.val(),classificacao_projeto_id:n.cbo_classificacao.val(),calendario_trabalho_id:n.cbo_calendario_trabalho.val(),controle_baseline:n.projeto_tipo_baseline.option("value"),arr_movimentacao_financeira:n.instanceMovimentacaoFinanceira&&n.instanceMovimentacaoFinanceira.getController("editing").getChanges().length?CircularJSON.stringify(n.instanceMovimentacaoFinanceira.getController("editing").getChanges()):null,utiliza_peso_atividades:n.chk_utiliza_peso_atividades.prop("checked"),referencia_tabela:n.referencia_tabela,referencia_id:n.referencia_id};o=Object.assign(o,n.formularioGetPostParams()),WS.post("projeto/salvar",o,function(o){n.projeto_id=o.id,alert_saved(o.nome+" salvo com sucesso"),void 0!==n.onconfirm&&n.onconfirm&&n.onconfirm(o),e.currentTarget.classList.contains("salvar-e-sair")?n.unload():n.preencher(!0)},[n.btn_salvar])}),this.render_financeiro=function(e){n.lbl_tab_financeiro.hide();(App.sessao.dados.admin||"S"==n.permissoes_usuario_logado.planejamento_financeiro)&&(!0&&e?(n.lbl_tab_financeiro.show(),n.edt_valor_km.maskMoney("mask",parseFloat(e.valor_km)),n.edt_valor_pedagio.maskMoney("mask",parseFloat(e.valor_pedagio)),n.edt_valor_refeicao.maskMoney("mask",parseFloat(e.valor_refeicao)),n.edt_outras_despesas.maskMoney("mask",parseFloat(e.outras_despesas)),n.edt_km_padrao.val(e.quantidade_km_padrao),n.edt_traslado.val(e.traslado_padrao).mask("00:00"),n.chk_permite_alterar_padrao_apontamento.prop("checked","S"==e.permite_alterar_padrao_apontamento).change(),n.chk_sugerir_despesas_no_apontamento_atividades.prop("checked","S"==e.sugerir_despesas_no_apontamento_atividades).change(),n.cbo_tipo_valor_padrao_refeicao.val(e.tipo_valor_padrao_refeicao).selectpicker("refresh"),n.cbo_tipo_relatorio_despesas_cliente_refeicao.val(e.tipo_relatorio_despesas_cliente_refeicao).selectpicker("refresh"),n.edt_valor_orcamento_previsto.maskMoney("mask",+parseFloat(e.valor_orcamento_previsto)),n.edt_valor_orcamento_disponivel.maskMoney("mask",+parseFloat(e.valor_orcamento_disponivel)),n.edt_valor_orcamento_realizado.maskMoney("mask",+parseFloat(e.valor_orcamento_realizado)),n.edt_saldo_orcamento_disponivel.maskMoney("mask",+parseFloat(e.saldo_orcamento_disponivel))):(n.edt_valor_km.text("0,00"),n.edt_valor_pedagio.text("0,00"),n.edt_valor_refeicao.text("0,00"),n.edt_outras_despesas.text("0,00"),n.edt_km_padrao.text("0"),n.edt_traslado.text("00:00"),n.chk_permite_alterar_padrao_apontamento.prop("checked",!1).change(),n.chk_sugerir_despesas_no_apontamento_atividades.prop("checked",!1).change(),n.cbo_tipo_valor_padrao_refeicao.val(0).selectpicker("refresh"),n.cbo_tipo_relatorio_despesas_cliente_refeicao.val(0).selectpicker("refresh"),n.edt_valor_orcamento_previsto.text("0,00"),n.edt_valor_orcamento_disponivel.text("0,00"),n.edt_valor_orcamento_realizado.text("0,00"),n.edt_saldo_orcamento_disponivel.text("0,00"),n.edt_valor_km.prop("readonly",!0),n.edt_valor_pedagio.prop("readonly",!0),n.edt_valor_refeicao.prop("readonly",!0),n.edt_outras_despesas.prop("readonly",!0),n.edt_km_padrao.prop("readonly",!0),n.edt_traslado.prop("disabled",!0),n.chk_permite_alterar_padrao_apontamento.prop("disabled",!0),n.chk_sugerir_despesas_no_apontamento_atividades.prop("disabled",!0),n.cbo_tipo_valor_padrao_refeicao.prop("disabled",!0),n.cbo_tipo_relatorio_despesas_cliente_refeicao.prop("disabled",!0),n.edt_valor_orcamento_disponivel.prop("readonly",!0)))},this.renderizarComponenteMovimentacaoFinanceira=function(){var e={projetoId:n.projeto_id,dataSource:n.datasource_movimentacao_financeira,instanceMovimentacaoFinanceira:function(e){n.instanceMovimentacaoFinanceira=e}};ReactDOM.unmountComponentAtNode(n.div_componente_movimentacao_financeira[0]),ReactDOM.render(React.createElement(window.components.MovimentacaoFinanceira.default,e),n.div_componente_movimentacao_financeira[0])},this.cbo_projetos_template.unbind("change"),this.cbo_projetos_template.change(function(){if(n.cbo_projetos_template.val()>0){$(n.template_projetos).each(function(e,o){o.id==n.cbo_projetos_template.val()&&(n.equipe=o.equipe,n.grupo_usuarios_equipe=o.grupo_usuarios_equipe,n.render_equipe(!0,o))}),n.permissoes_usuario_logado&&"S"==n.permissoes_usuario_logado.planejamento_financeiro||!0===App.sessao.dados.admin?n.lbl_tab_financeiro.show():n.lbl_tab_financeiro.hide(),n.div_total_horas.removeClass("hidden");var e=n.cbo_projetos_template.find("option[value='"+n.cbo_projetos_template.val()+"']");n.edt_total_horas.val(null!=e.attr("id")?e.attr("id"):"000:00")}else n.render_financeiro(),n.div_total_horas.addClass("hidden"),n.tabela_equipe.find("tr:gt(1)").remove(),n.equipe=[],n.grupo_usuarios_equipe=[],n.lbl_tab_financeiro.show()}),this.div_revisao.unbind("scroll"),this.div_revisao.scroll(function(){1==n.continua_revisao&&n.div_revisao.scrollTop()+n.div_revisao.height()==n.div_revisao.get(0).scrollHeight&&(n.limite=n.limite+11,n.render_revisoes())}),this.btn_excluir.unbind("click"),this.btn_excluir.click(function(){WS.post("projeto/excluir",{projeto_id:n.projeto_id},function(e){alert_saved(e.nome+" excluido com sucesso"),n.unload()},[n.btn_excluir])}),this.edt_valor_orcamento_disponivel.unbind("keyup").keyup($.debounce(300,function(){var e;e=(+n.edt_valor_orcamento_disponivel.maskMoney("unmasked")[0]||0)-(+n.edt_valor_orcamento_realizado.maskMoney("unmasked")[0]||0),n.edt_saldo_orcamento_disponivel.maskMoney("mask",e)})),this.listar_classificacao=function(e){n.cbo_classificacao.find("option").remove(),add_option(n.cbo_classificacao,"","- Selecione -"),WS.get("projeto_classificacao/listar/",null,function(o){for(var a=0;a<o.length;a++){var i=o[a];add_option(n.cbo_classificacao,i.projeto_classificacao_id,i.nome)}e&&n.cbo_classificacao.val(e).trigger("change"),n.cbo_classificacao.selectpicker("refresh")},null,null,null,null,null,n.html_id)},this.render_formulario=function(){ReactDOM.render(React.createElement(window.components.FormularioPersonalizado.default,{main:n.formularioMain,abaFormularioPersonalizado:n.menu_personalizado,urlGet:"/formulario_projeto/get_formulario/",urlGetParams:{projeto_id:n.projeto_id},readOnly:n.formularioReadOnly,callbackGetPostParams:function(e){n.formularioGetPostParams=e},callbackValidar:function(e){n.formularioValidar=e}}),n.divFormularioPersonalizado[0])},this.render_referencias=function(){ReactDOM.unmountComponentAtNode(n.gridReferencias[0]),ReactDOM.render(React.createElement(window.components.Referencias.default,{tabela:"projeto",id:n.projeto_id,callbackBtns(){n.unload()}}),n.gridReferencias[0])},this.edt_posicionamento_qtd_ultimas_concluidas.unbind("keyup"),this.edt_posicionamento_qtd_ultimas_concluidas.keyup(function(){somenteNumeros(this.value,this)}),this.edt_posicionamento_qtd_dias_ultimas_concluidas.unbind("keyup"),this.edt_posicionamento_qtd_dias_ultimas_concluidas.keyup(function(){somenteNumeros(this.value,this)}),this.edt_posicionamento_qtd_dias_data_prazo.unbind("keyup"),this.edt_posicionamento_qtd_dias_data_prazo.keyup(function(){somenteNumeros(this.value,this)}),this.edt_posicionamento_qtd_dias_previsao_inicio.unbind("keyup"),this.edt_posicionamento_qtd_dias_previsao_inicio.keyup(function(){somenteNumeros(this.value,this)}),this.lbl_tab_movimentacao_financeira.off("click").on("click",function(e){App.sessao.dados.admin||"S"==n.permissoes_usuario_logado.planejamento_financeiro?n.renderizarComponenteMovimentacaoFinanceira():e.stopPropagation()}),this.lbl_tab_referencias.on("click",()=>{n.render_referencias()})}});