var valid_licenca_exibindo=!1;function ajaxError(e,a,t){var o,n="",r=(o=document.createElement("div"),function(e){return e&&"string"==typeof e&&(e=(e=e.replace(/<script[^>]*>([\S\s]*?)<\/script>/gim,"")).replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gim,""),o.innerHTML=e,e=o.textContent,o.textContent=""),e});void 0!==e.ignore_error&&0!=e.ignore_error&&"object"!=typeof e.ignore_error||(0===e.status&&"abort"!==a?"GET"==this.type.toUpperCase()&&try_again(this,()=>alert_modal_internet(!0))||alert_modal_internet():404==e.status?alert_modal_404():500==e.status||203==e.status?e.responseJSON&&e.responseJSON.validation?response_validation(e.responseJSON):e.responseText?(n="Ocorreu uma falha na operação.<br>",n+="Response Text: <pre>"+r(e.responseText)+"</pre>",alertaPopUp(e.statusText,n)):alert_modal_500():503==e.status?"GET"==this.type.toUpperCase()&&try_again(this,()=>alert_modal_503(!0))||alert_modal_503():504==e.status?"GET"==this.type.toUpperCase()&&try_again(this,()=>alert_modal_504(!0))||alert_modal_504():"parsererror"===a?(n="Ocorreu uma falha na operação.<br>",n+="Response Text: <pre>"+r(e.responseText)+"</pre>",alertaPopUp("JSON parse failed",n)):"timeout"===a?"GET"==this.type.toUpperCase()&&try_again(this,()=>alert_modal_timeout(!0))||alert_modal_timeout():"abort"===a||(n+="Status: "+a,n+="<br>",n+=t,n+="<br>","Next Business Process"===r(e.responseText).substring(0,21)?n+="Servidor não encontrado. Houve algum bloqueio de acesso ao servidor. Tente novamente.":n+="Response Text: <pre>"+r(e.responseText)+"</pre>",alertaPopUp("Ajax Error",n)))}function try_again(e,a){return e.tryCount++,e.tryCount<=e.retryLimit&&(e.tryCount<e.retryLimit&&a(),setTimeout(function(){$.ajax(e),console.log("Tentando novamente a requisição: "+e.url+" - Tentativa: "+e.tryCount+" - Horário: "+(new Date).toLocaleTimeString())},e.tryCount*e.msInterval),!0)}function response_validation(e,a){if(e&&e.validation){$(".dx-loadpanel-content").hide();var t=new Validation;if(e.validation.messages){for(var o=0;o<e.validation.messages.length;o++)if(2==e.validation.messages[o].code){if(App.sessao_expirada||!App.sessao||App.sessao.sessao_login_anonimo)if(!App.sessao_anonima_expirada&&App.sessao&&App.sessao.sessao_login_anonimo){App.sessao_anonima_expirada=!0,WS.token=null;DevExpress.ui.dialog.custom({title:"Aviso",messageHtml:"Sua sessão expirou ou ocorreu alguma falha. Você será retornado à tela de autenticação.",buttons:[{text:"Ok",onClick:function(e){App.logout_anonimo()}}]}).show()}else console.log(new ValidationMessage(e.validation.messages[o].code,e.validation.messages[o].message));else App.sessao_expirada=!0,WS.token=null,View.load("login/sessao_expirada",function(e,a){a.show()});void 0!==a&&a||(a=function(){})}else{if(10==e.validation.messages[o].code)return t.add(new ValidationMessage(e.validation.messages[o].code,e.validation.messages[o].message)),a=function(){valid_licenca_exibindo=!1},valid_licenca_exibindo||(valid_licenca_exibindo=!0,alertaPopUp(App.lang?App.lang.msg_padrao.validacao:"",t,"Ok",a)),!1;t.add(new ValidationMessage(e.validation.messages[o].code,e.validation.messages[o].message))}t.is_valid()||alertaPopUp(App.lang?App.lang.msg_padrao.validacao:"",t,"Ok",a)}return!1}return!0}function getScriptError(e,a,t){var o="";o+="Script Exception: ",o+="<br>",o+="<pre>"+t.stack+"</pre>",alertaPopUp("Ajax Error",o)}var WS=function(){WS.TYPE={POST:"post",GET:"get"},WS.token=null,WS.arr_xhr=[],WS.abort_request=function(e,a,t){if(WS.arr_xhr.length>0)for(var o=0;o<WS.arr_xhr.length;o++){var n=WS.arr_xhr[o];n.html_id==e&&n.route==a&&(t||n.obj_xhr.abort(),WS.arr_xhr.splice(o,1))}},WS.abort_requests=function(){if(WS.arr_xhr.length>0){for(var e=0;e<WS.arr_xhr.length;e++){WS.arr_xhr[e].obj_xhr.abort()}WS.arr_xhr=[]}},WS.dxHeaders=function(){var e={"X-Auth-Token":WS.token};return void 0!==App.temp.empresa&&(e["X-Emp"]=App.temp.empresa),App.idioma&&(e["X-Lang"]=App.idioma),e},WS.request=function(e,a,t,o,n,r,s,i,l,p,d){var u={route:e,type:a,data:t,func_response:o,disable_buttons:n,final_route:r,data_files:s,ignore_error:void 0!==i&&i,func_fail:void 0!==d?d:null,html_id:p};"object"==typeof e&&((u=e).type||(u.type=a)),WS.abort_request(u.html_id,u.route),$.ajaxSetup({cache:!1});let c={};void 0!==u.data&&u.data&&(c={...u.data});let _=[];App.sessao&&App.sessao.dados&&!0===App.sessao.dados.ws_params_base64&&(Object.keys(c).forEach(e=>{"string"==typeof c[e]&&c[e]&&(_.push(e),c[e]=cripto(c[e]))}),_.length>0&&(c._ws_params_base64=_.join(",")));var m=WS_URI;void 0!==u.final_route&&1==u.final_route&&(m=""),void 0!==u.data_files&&u.data_files||(u.data_files=!1),void 0!==u.disable_buttons&&u.disable_buttons||(u.disable_buttons=[]);var f=null,v=[];WS.token&&(v.push({nome:"X-Auth-Token",valor:WS.token}),void 0!==App.temp.empresa&&v.push({nome:"X-Emp",valor:App.temp.empresa}),v.push({nome:"X-View-Code",valor:View.get_id_tela_ativa()?View.get_id_tela_ativa():null}),App.idioma&&v.push({nome:"X-Lang",valor:App.idioma}),!0===WS.login_anonimo&&v.push({nome:"X-Login-Anonimo",valor:!0})),v.length>0&&(f=function(t){t.url=e,t.request_type=a,t.ignore_error=u.ignore_error;for(var o=0;o<v.length;o++)t.setRequestHeader(v[o].nome,v[o].valor)}),$(u.disable_buttons).each(function(e,a){void 0===a?alert("Validação Botão não encontrado"):(a.addClass("disabled").css("pointer-events","none"),a.hasClass("select-multi-column")&&(a.parent().find(".edt_combobox").prop("readonly",!0),a.parent().find(".btn").addClass("disable").css("pointer-events","none")))});var g=new FormData,h=!0,b="application/x-www-form-urlencoded; charset=UTF-8";if(!0===u.data_files){h=!1,b=!1;for(var x=Object.keys(c),S=0;S<x.length;S++)if(void 0!==c[x[S]]&&null!=c[x[S]]&&c[x[S]][0]&&c[x[S]][0].size)for(var y=0;y<c[x[S]].length;y++)g.append(x[S]+"[]",c[x[S]][y]);else g.append(x[S],c[x[S]])}else if(Array.isArray(u.data_files)){h=!1,b=!1;for(x=Object.keys(c),S=0;S<x.length;S++){var W=c[x[S]];"object"==typeof W&&(W=window.CircularJSON.stringify(W)),g.append(x[S],W)}u.data_files.forEach(e=>{const a=e.split("."),t=a[0],o=a[1];for(var n=0;n<x.length;n++)if(x[n]==t){const e=c[t];for(var r=0;r<e.length;r++)e[r]&&e[r].data&&"object"==typeof e[r].data[o]?g.append(t+"__"+r+"__"+o,e[r].data[o].arquivoSelecionado):e[r]&&e[r].oldData&&"object"==typeof e[r].oldData[o]&&g.append(t+"__"+r+"__"+o,e[r].oldData[o].arquivoSelecionado)}})}var T={html_id:u.html_id,route:u.route,obj_xhr:null};T.obj_xhr=$.ajax({xhrFields:{withCredentials:XHR_WITH_CREDENTIALS},beforeSend:f,error:ajaxError,type:u.type,url:m+u.route,data:u.data_files?g:c,dataType:"json",cache:!1,processData:h,contentType:b,tryCount:0,retryLimit:3,msInterval:2e3,xhr:function(){var e=new window.XMLHttpRequest;return e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var a=e.loaded/e.total;a=parseInt(100*a),l&&void 0!==l&&l(a)}},!1),e},complete:function(e,a){!u.func_fail||500!=e.status&&203!=e.status||u.func_fail(a),$(u.disable_buttons).each(function(e,a){a.removeClass("disabled").css("pointer-events","all"),a.hasClass("select-multi-column")&&(a.parent().find(".edt_combobox").prop("readonly",!1),a.parent().find(".btn").removeClass("disable").css("pointer-events","all"))})},success:function(d){response_validation(d,function(){u.func_fail&&u.func_fail(d)})&&u.func_response&&u.func_response(d),App.sessao_expirada&&App.fila.push({route:e,type:a,data:t,func_response:o,disable_buttons:n,final_route:r,data_files:s,ignore_error:i,uploadProgress:l,html_id:p}),WS.abort_request(u.html_id,u.route,!0)}}),void 0!==T.html_id&&WS.arr_xhr.push(T)},WS.get=function(e,a,t,o,n,r,s,i,l,p){let d={};if("object"==typeof e&&(d=e),p||d.awaitReturn){let t=new Promise(function(t,p){var u=function(e){t(e)};"object"==typeof e&&(d.func_response=u),WS.request(e,WS.TYPE.GET,a,u,o,n,null,r,s,i,l)});return t}WS.request(e,WS.TYPE.GET,a,t,o,n,null,r,s,i,l)},WS.post=function(e,a,t,o,n,r,s,i,l,p,d){if(d){return new Promise(function(t,d){WS.request(e,WS.TYPE.POST,a,function(e){t(e)},o,n,r,s,i,l,p)})}WS.request(e,WS.TYPE.POST,a,t,o,n,r,s,i,l,p)},WS.asyncGet=async function(e,a,t,o,n,r,s,i,l){return await WS.get(e,a,t,o,n,r,s,i,l,!0)},WS.asyncPost=async function(e,a,t,o,n,r,s,i,l,p){return await WS.post(e,a,t,o,n,r,s,i,l,p,!0)}},WS_pg_files=function(){WS_pg_files.post=function(e,a,t,o,n){var r=[],s=[],i=[];o&&$(n).each(function(e,a){i.push(a),a.addClass("disabled")});$.each(a.documentos,function(i,l){var p=null;"string"==typeof l?p=JSON.parse(l):"object"==typeof l&&(p=l);var d=p.name+"_"+i,u=p.mimeType,c=u.split("/")[0],_=u.split("/")[1],m=!1,f="";d.indexOf(".")>-1&&(m=!0,f=d.substring(d.lastIndexOf(".")).indexOf("_")>-1?d.substring(d.lastIndexOf(".")).split("_")[0]:d.substring(d.lastIndexOf("."))),d="image"===c?"image_"+md5(d)+(!1===m?"jpeg"===_?".jpg":".png":f):"video"===c?"video_"+md5(d)+(!1===m?"mp4"===_?".mp4":"ogg"===_?".ogv":"avi"===_||"msvideo"===_||"x-msvideo"===_?".avi":"quicktime"===_?".mov":"mpeg"===_?".mpeg":".wmv":f):"audio"===c?"audio_"+md5(d)+(!1===m?"mp3"===_?".mp3":"amr"===_?".amr":"wav":f):"text"===c?"docs_"+md5(d)+(!1===m?"plain"===_?".txt":"html"===_?".html":".doc":f):_.indexOf("excel")>-1?"sheets_"+md5(d)+(!1===m?"excel"===_?".xls":".csv":f):_.indexOf("powerpoint")>-1?"slide_"+md5(d)+(!1===m?(_.indexOf("powerpoint"),".ppt"):f):"pdf"===_?"pdf_"+md5(d)+(!1===m?".pdf":f):"file_"+md5(d)+(!1===m?".":f);var v=new FileUploadOptions;v.fileKey=a.optionsFileKey,v.fileName=d,r.push(d),v.mimeType=p.mimeType,v.chunkedMode=!0;var g={};for(var h in a)"optionsFileKey"!=h&&"documentos"!=h&&(g[h]=a[h]);l.id&&(g.arquivo_id=l.id);var b=new FileTransfer;v.params=g,b.upload(p.localURL,encodeURI(WS_URI+e),function(e){s.push("carregado"),timer=setTimeout(function(){var e,i=s.length,l=a.documentos.length;i<=a.documentos.length&&(e=100*i/l,navigator.notification.progressValue(e)),100==e&&navigator.notification.progressStop(),a.documentos.length===s.length&&(o&&$(n).each(function(e,a){a.removeClass("disabled")}),t('{ "result": "success" , "returnValue": "'+r.join()+'" }'),clearTimeout(timer))},300)},function(e){console.log(e),alert("Upload com falha! "),"1"===e.code&&alert("Erro no servidor. CODE: 404"),"5"===e.code&&alert("Error ao enviar o arquivo. CODE:"+e.code,e)},v)})}};new WS,new WS_pg_files;