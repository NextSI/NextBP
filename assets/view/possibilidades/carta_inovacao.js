define([],function(){return function(a){"use strict";var i=this;this.html_id=a,this.dialog=$("#"+this.html_id),this.title="Carta de Inovação",this.onclose=null,this.btn_incluir_despesa=this.dialog.find(".btn_incluir_despesa"),this.btn_incluir_receita=this.dialog.find(".btn_incluir_receita"),this.tab_listagem_despesas=this.dialog.find(".tab_listagem_despesas"),this.tab_listagem_receitas=this.dialog.find(".tab_listagem_receitas"),this.btn_confirmar=this.dialog.find(".btn_confirmar"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_salvar_enviar=this.dialog.find(".btn_salvar_enviar"),this.btn_avaliar=this.dialog.find(".btn_avaliar"),this.btn_aprovar_gerar_chamado=this.dialog.find(".btn_aprovar_gerar_chamado"),this.floating=this.dialog.find(".floating-menu"),this.edt_data_carta=this.dialog.find(".edt_data_carta"),this.edt_nome=this.dialog.find(".edt_nome"),this.edt_titulo_ideia=this.dialog.find(".edt_titulo_ideia"),this.edt_descricao=this.dialog.find(".edt_descricao"),this.edt_justificativa=this.dialog.find(".edt_justificativa"),this.edt_data_inicio_operacional=this.dialog.find(".edt_data_inicio_operacional"),this.edt_net_profit_12_meses=this.dialog.find(".edt_net_profit_12_meses"),this.edt_net_profit_24_meses=this.dialog.find(".edt_net_profit_24_meses"),this.edt_contribuicao=this.dialog.find(".edt_contribuicao"),this.edt_responsavel=this.dialog.find(".edt_responsavel"),this.edt_data_avaliacao_carta=this.dialog.find(".edt_data_avaliacao_carta"),this.edt_responsavel=this.dialog.find(".edt_responsavel"),this.cbo_situacao=this.dialog.find(".cbo_situacao"),this.edt_obervacao_avaliacao=this.dialog.find(".edt_obervacao_avaliacao"),this.edt_resposta_avaliacao=this.dialog.find(".edt_resposta_avaliacao"),this.edt_primeiro_passo=this.dialog.find(".edt_primeiro_passo"),this.edt_segundo_passo=this.dialog.find(".edt_segundo_passo"),this.edt_terceiro_passo=this.dialog.find(".edt_terceiro_passo"),this.edt_quarto_passo=this.dialog.find(".edt_quarto_passo"),this.edt_quinto_passo=this.dialog.find(".edt_quinto_passo"),this.edt_objetivos_metas=this.dialog.find(".edt_objetivos_metas"),this.edt_desc_recursos=this.dialog.find(".edt_desc_recursos"),this.edt_acomp_resultados=this.dialog.find(".edt_acomp_resultados"),this.carta_inovacao_id="",this.arr_receitas=[],this.arr_despesas=[],this.possibilidade_id=0,this.situacao=0,this.usuario_id=0,this.usuario_nome="",this.carta_inovacao_avaliacao=0,this.show=function(a){"S"!=App.sessao.dados.supervisor_inovacao&&1!=App.sessao.dados.admin||(i.btn_avaliar.addClass("hidden"),a.situacao==CARTA_INOVACAO_SITUACAO.APROVADA?(i.permite_alterar(!1),i.btn_avaliar.addClass("hidden"),i.btn_aprovar_gerar_chamado.addClass("hidden")):a.usuario_id==App.sessao.dados.usuario_id&&i.btn_aprovar_gerar_chamado.removeClass("hidden")),i.edt_titulo_ideia.val(a.possibilidade).prop("disabled",!0)},this.listar=function(a){i.title="Carta de Inovação - "+a.usuario_nome,i.possibilidade_id=a.possibilidade_id,i.carta_inovacao_id=a.carta_inovacao_id,i.usuario_id=a.usuario_id,i.situacao=a.situacao,i.edt_nome.val(a.usuario_nome),i.edt_nome.attr("readonly",!0),null==a.situacao&&(i.situacao=-1),i.edt_responsavel.val(App.sessao.dados.nome).prop("readonly",!0),"S"==App.sessao.dados.supervisor_inovacao||1==App.sessao.dados.admin?(i.situacao!=CARTA_INOVACAO_SITUACAO.AGUARDANDO_AVALIACAO&&i.situacao!=CARTA_INOVACAO_SITUACAO.STANDBY||i.btn_avaliar.removeClass("hidden"),i.situacao!=CARTA_INOVACAO_SITUACAO.APROVADA&&i.situacao!=CARTA_INOVACAO_SITUACAO.REPROVADA||(i.btn_avaliar.removeClass("hidden"),i.btn_confirmar.addClass("hidden"),i.btn_avaliar.html("Histórico")),i.btn_salvar_enviar.addClass("hidden")):(i.situacao==CARTA_INOVACAO_SITUACAO.APROVADA?(i.btn_salvar_enviar.addClass("hidden"),i.btn_confirmar.addClass("hidden"),i.permite_alterar(!1)):i.situacao==CARTA_INOVACAO_SITUACAO.AGUARDANDO_AVALIACAO||i.situacao==CARTA_INOVACAO_SITUACAO.STANDBY?(i.btn_confirmar.addClass("hidden"),i.btn_salvar_enviar.addClass("hidden"),i.permite_alterar(!1)):i.situacao==CARTA_INOVACAO_SITUACAO.REPROVADA&&i.permite_alterar(!1),i.btn_cancelar.removeClass("hidden")),i.edt_net_profit_12_meses.maskMoney({thousands:".",decimal:",",allowZero:!0,suffix:"",precision:2}),i.edt_net_profit_24_meses.maskMoney({thousands:".",decimal:",",allowZero:!0,suffix:"",precision:2}),i.render_carta()},this.render_carta=function(){WS.get({route:"carta_inovacao/objeto/",data:{carta_inovacao_id:i.carta_inovacao_id},func_response:function(a){i.edt_data_carta.val(a.dados_carta_inovacao.data_carta),i.edt_descricao.val(a.dados_carta_inovacao.descricao),i.edt_justificativa.val(a.dados_carta_inovacao.justificativa),i.edt_primeiro_passo.val(a.dados_carta_inovacao.primeiro_passo),i.edt_segundo_passo.val(a.dados_carta_inovacao.segundo_passo),i.edt_terceiro_passo.val(a.dados_carta_inovacao.terceiro_passo),i.edt_quarto_passo.val(a.dados_carta_inovacao.quarto_passo),i.edt_quinto_passo.val(a.dados_carta_inovacao.quinto_passo),i.edt_objetivos_metas.val(a.dados_carta_inovacao.objetivos_metas),i.edt_desc_recursos.val(a.dados_carta_inovacao.recursos),i.edt_acomp_resultados.val(a.dados_carta_inovacao.resultados),i.edt_data_inicio_operacional.val(a.dados_carta_inovacao.data_inicio_operacional),i.edt_net_profit_12_meses.maskMoney("mask",parseFloat(a.dados_carta_inovacao.lucro_liquido_12)),i.edt_net_profit_24_meses.maskMoney("mask",parseFloat(a.dados_carta_inovacao.lucro_liquido_24)),i.edt_contribuicao.val(a.dados_carta_inovacao.contribuicao),i.arr_despesas=a.dados_carta_inovacao_despesa,i.arr_receitas=a.dados_carta_inovacao_receita,i.edt_desc_recursos.val(a.dados_carta_inovacao.recursos),i.edt_acomp_resultados.val(a.dados_carta_inovacao.resultados),i.edt_objetivos_metas.val(a.dados_carta_inovacao.objetivos_metas);for(var e=0;e<$(i.arr_despesas).length;e++)void 0!==i.arr_despesas[e]&&null!=i.arr_despesas[e].id&&i.add_row_despesa(i.arr_despesas[e]);for(e=0;e<$(i.arr_receitas).length;e++)void 0!==i.arr_receitas[e]&&null!=i.arr_receitas[e].id&&i.add_row_receita(i.arr_receitas[e])}})},this.permite_alterar=function(a,e){i.edt_data_carta.prop("readonly",!a),i.edt_nome.prop("readonly",!a),i.edt_titulo_ideia.prop("readonly",!a),i.edt_descricao.prop("readonly",!a),i.edt_justificativa.prop("readonly",!a),i.edt_data_inicio_operacional.prop("readonly",!a),i.edt_net_profit_12_meses.prop("readonly",!a),i.edt_net_profit_24_meses.prop("readonly",!a),i.edt_contribuicao.prop("readonly",!a),i.edt_responsavel.prop("readonly",!a),i.edt_responsavel.prop("readonly",!a),i.edt_primeiro_passo.prop("readonly",!a),i.edt_segundo_passo.prop("readonly",!a),i.edt_terceiro_passo.prop("readonly",!a),i.edt_quarto_passo.prop("readonly",!a),i.edt_quinto_passo.prop("readonly",!a),i.edt_desc_recursos.prop("readonly",!a),i.edt_objetivos_metas.prop("readonly",!a),i.edt_acomp_resultados.prop("readonly",!a),i.btn_incluir_despesa.prop("disabled",!a),i.btn_incluir_receita.prop("disabled",!a),i.tab_listagem_despesas.prop("disabled",!a),i.tab_listagem_receitas.prop("disabled",!a),setTimeout(function(){i.tab_listagem_receitas.find("tbody tr:not('[template-row]') td input, button").prop("readonly",!0).prop("disabled",!a),i.tab_listagem_despesas.find("tbody tr:not('[template-row]') td input, button").prop("readonly",!0).prop("disabled",!a)},2e3)},i.btn_aprovar_gerar_chamado.unbind("click"),i.btn_aprovar_gerar_chamado.click(function(a){i.incluir_despesa(),i.incluir_receita();var e={id:i.carta_inovacao_id,possibilidade_id:i.possibilidade_id,titulo:i.edt_titulo_ideia.val(),data_carta:i.edt_data_carta.val(),usuario_id:i.usuario_id,situacao:i.situacao,descricao:i.edt_descricao.val(),justificativa:i.edt_justificativa.val(),primeiro_passo:i.edt_primeiro_passo.val(),segundo_passo:i.edt_segundo_passo.val(),terceiro_passo:i.edt_terceiro_passo.val(),quarto_passo:i.edt_quarto_passo.val(),quinto_passo:i.edt_quinto_passo.val(),data_inicio_operacional:i.edt_data_inicio_operacional.val(),lucro_liquido_12:i.edt_net_profit_12_meses.maskMoney("unmasked")[0],lucro_liquido_24:i.edt_net_profit_24_meses.maskMoney("unmasked")[0],contribuicao:i.edt_contribuicao.val(),objetivos_metas:i.edt_objetivos_metas.val(),recursos:i.edt_desc_recursos.val(),resultados:i.edt_acomp_resultados.val(),receitas:JSON.stringify(i.arr_receitas),despesas:JSON.stringify(i.arr_despesas)};WS.post("carta_inovacao/salvar",e,function(a){WS.post("carta_inovacao_avaliacao/salvar",{carta_inovacao_id:a.id,responsavel_id:App.sessao.dados.usuario_id,possibilidade_id:i.possibilidade_id,situacao:CARTA_INOVACAO_SITUACAO.APROVADA,data_avaliacao:getDateNow(!0).format_date(!0),observacao:"Aprovada pelo Gestor",aprovar_gerar_chamado:!0},function(a){alert_saved("Chamado gerado com sucesso!"),i.unload()})})}),i.btn_avaliar.unbind("click"),i.btn_avaliar.click(function(a){View.load("possibilidades/carta_inovacao_avaliacao",function(a,e){e.show(i.carta_inovacao_id,i.usuario_id,i.edt_nome.val(),i.possibilidade_id,i.situacao);e.onsave=function(){i.unload()}},View.ABA.NAO)}),i.btn_incluir_despesa.unbind("click").click(function(a){i.add_row_despesa()}),i.btn_incluir_receita.unbind("click").click(function(a){i.add_row_receita()}),i.btn_cancelar.unbind("click").click(function(a){i.unload()}),this.add_row_despesa=function(a){var e=i.tab_listagem_despesas.find("tbody"),t=e.find("tr:first").clone();t.removeAttr("template-row"),t.css("display","");var s=$(t.find('[template-field="descricao"] input')),o=$(t.find('[template-field="valor_despesa"] input'));o.maskMoney({thousands:".",decimal:",",allowZero:!0,suffix:"",precision:2}),a&&(s.val(a.descricao),o.val(a.valor),t.attr("data-id-despesa",a.id));var d=$(t.find(".btn_deletar_despesa"));d.unbind("click"),d.click(function(){alert_modal("Despesa","Tem certeza que deseja remover esta despesa?","Remover",function(){var a=$(t).attr("data-id-despesa");a>0?WS.post("carta_inovacao_despesa/excluir/",{carta_inovacao_despesa_id:a},function(a){alert_saved("Despesa excluída com sucesso"),$(t).remove()}):$(t).remove()},!0)}),t.appendTo(e)},this.add_row_receita=function(a){var e=i.tab_listagem_receitas.find("tbody"),t=e.find("tr:first").clone();t.removeAttr("template-row"),t.css("display","");var s=$(t.find('[template-field="descricao"] input')),o=$(t.find('[template-field="valor_receita"] input'));o.maskMoney({thousands:".",decimal:",",allowZero:!0,suffix:"",precision:2}),a&&(s.val(a.descricao),o.val(a.valor),t.attr("data-id-receita",a.id));var d=$(t.find(".btn_deletar_receita"));d.unbind("click"),d.click(function(){alert_modal("Receita","Tem certeza que deseja excluir esta Receita?","Remover",function(){var a=$(t).attr("data-id-receita");a>0?WS.post("carta_inovacao_receita/excluir/",{carta_inovacao_receita_id:a},function(a){alert_saved("Receita excluída com sucesso"),$(t).remove()}):$(t).remove()},!0)}),t.appendTo(e)},this.incluir_despesa=function(){var a=i.tab_listagem_despesas.find("tbody tr").not("[template-row]");i.arr_despesas=[],$.each(a,function(a,e){var t=$(e).find("[template-field='descricao'] input").val(),s=$(e).find("[template-field='valor_despesa'] input").maskMoney("unmasked")[0],o=void 0===$(e).attr("data-id-despesa")?"":$(e).attr("data-id-despesa");""!=t&&i.arr_despesas.push({despesa_id:o,descricao:t,valor:s})})},this.incluir_receita=function(){var a=i.tab_listagem_receitas.find("tbody tr").not("[template-row]");i.arr_receitas=[],$.each(a,function(a,e){var t=$(e).find("[template-field='descricao'] input").val(),s=$(e).find("[template-field='valor_receita'] input").maskMoney("unmasked")[0],o=void 0===$(e).attr("data-id-receita")?"":$(e).attr("data-id-receita");""!=t&&i.arr_receitas.push({receita_id:o,descricao:t,valor:s})})},i.btn_salvar_enviar.unbind("click"),i.btn_salvar_enviar.click(function(a){i.situacao=CARTA_INOVACAO_SITUACAO.AGUARDANDO_AVALIACAO,i.salva_carta()}),i.btn_confirmar.unbind("click"),i.btn_confirmar.click(function(a){"S"!=App.sessao.dados.supervisor_inovacao&&1!=App.sessao.dados.admin||(i.cbo_situacao.val()==CARTA_INOVACAO_SITUACAO.REPROVADA?i.situacao=CARTA_INOVACAO_SITUACAO.REPROVADA:i.cbo_situacao.val()==CARTA_INOVACAO_SITUACAO.APROVADA&&(i.situacao=CARTA_INOVACAO_SITUACAO.APROVADA)),i.salva_carta()}),this.salva_carta=function(){i.incluir_despesa(),i.incluir_receita();var a={id:i.carta_inovacao_id,possibilidade_id:i.possibilidade_id,titulo:i.edt_titulo_ideia.val(),data_carta:i.edt_data_carta.val(),usuario_id:i.usuario_id,situacao:i.situacao,descricao:i.edt_descricao.val(),justificativa:i.edt_justificativa.val(),primeiro_passo:i.edt_primeiro_passo.val(),segundo_passo:i.edt_segundo_passo.val(),terceiro_passo:i.edt_terceiro_passo.val(),quarto_passo:i.edt_quarto_passo.val(),quinto_passo:i.edt_quinto_passo.val(),data_inicio_operacional:i.edt_data_inicio_operacional.val(),lucro_liquido_12:i.edt_net_profit_12_meses.maskMoney("unmasked")[0],lucro_liquido_24:i.edt_net_profit_24_meses.maskMoney("unmasked")[0],contribuicao:i.edt_contribuicao.val(),objetivos_metas:i.edt_objetivos_metas.val(),recursos:i.edt_desc_recursos.val(),resultados:i.edt_acomp_resultados.val(),receitas:JSON.stringify(i.arr_receitas),despesas:JSON.stringify(i.arr_despesas)};WS.post("carta_inovacao/salvar",a,function(a){alert_saved("Carta salva com sucesso!"),i.unload()})},this.unload=function(){i.close(),View.unload(this.html_id)},this.close=function(){void 0!==i.onclose&&i.onclose&&i.onclose()},$(document).scroll(function(){i.floating.css("top",$(this).scrollTop())})}});