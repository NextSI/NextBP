/**
 * Next Business Process
 * www.nextsi.com.br
 * @copyright Copyright © 2014-2020 Next Soluções Inteligentes
 */
define([],function(){return function(a){"use strict";var e=this;this.html_id=a,this.dialog=$("#"+this.html_id),this.datagrid=this.dialog.find(".datagrid"),this.dx_kanban=this.dialog.find(".dx_kanban"),this.dx_dropdown_responsavel=this.dialog.find(".dx_dropdown_responsavel"),this.dx_dropdown_responsavel_instance=null,this.dx_dropdown_etiqueta=this.dialog.find(".dx_dropdown_etiqueta"),this.dx_dropdown_situacao=this.dialog.find(".dx_dropdown_situacao"),this.dx_toolbar_quadros=this.dialog.find(".dx_toolbar_quadros"),this.dx_textbox_nome_pesquisado=this.dialog.find(".dx_textbox_nome_pesquisado"),this.dx_button_export=this.dialog.find(".dx_button_export"),this.dx_button_refresh=this.dialog.find(".dx_button_refresh"),this.tarefa_quadro_id=null,this.arr_listas=[],this.arr_cartoes=[],this.arr_offset={},this.arr_usuarios_equipe=[],this.responsavel=null,this.etiqueta=null,this.situacao=null,this.dataGridResponsavel=null,this.dataGridEtiqueta=null,this.dataGridSituacao=null,this.nome_pesquisado=null,this.flag_criacao_lista=!0,this.flag_criacao_cartao=!0,this.flag_drag=!0,this.flag_salvar_lista=!0,this.ultima_atualizacao_realizada=null,this.documento_id=null,this.tipo_permissao=null,this.carregar_background=!0,this.carregar_background_anticache=!1,this.dataGrid=null,this.arr_paginacao=[],this.take=50,this.redimensionar_colunas=null,this.particular=null,this.parametroUsuario=null,this.show=function(a){e.tarefa_quadro_id=a.id,this.title=a.nome,e.parametroUsuario=App.get_parametro_usuario("filtro_quadro_"+e.tarefa_quadro_id),e.renderDropDownResponsavel(),e.listar(),setInterval(function(){View.get_md5_tela_ativa()===e.html_id&&e.flag_criacao_lista&&e.flag_criacao_cartao&&e.flag_drag&&e.verificar_alteracoes()},5e3)},this.listar=function(){e.flag_criacao_lista=!0,e.flag_criacao_cartao=!0,e.flag_drag=!0,WS.get("tarefa_quadro/detalhar/",{tarefa_quadro_id:e.tarefa_quadro_id,arr_responsavel:e.responsavel?e.responsavel.option("value"):null,arr_etiqueta:e.etiqueta?e.etiqueta.option("value"):null,arr_situacao:e.situacao?e.situacao.option("value"):[TAREFA_QUADRO_LISTA_CARTAO_SITUACAO.ATRASADO,TAREFA_QUADRO_LISTA_CARTAO_SITUACAO.ANDAMENTO],nome_pesquisado:e.nome_pesquisado?e.nome_pesquisado.option("value"):null},function(a){e.flag_salvar_lista=!0,e.documento_id=a.imagem_id,e.definir_background(),e.arr_listas=a.arr_listas,e.arr_cartoes=a.arr_cartoes,e.arr_usuarios_equipe=a.arr_usuarios_equipe,e.tipo_permissao=a.tipo_permissao,e.ultima_atualizacao_realizada=a.ultima_atualizacao_realizada,e.redimensionar_colunas="S"==a.redimensionar_colunas,e.particular="S"==a.particular,e.preencher(),e.responsavel.option("dataSource",new DevExpress.data.CustomStore.default({loadMode:"raw",key:"id",load:function(){return e.arr_usuarios_equipe.filter(function(a){return"N"===a.bloqueado})}})),e.dataGrid=dx_Listagem_Padrao({div_html:e.datagrid,coluna_chave:"id",colunas:dx_Quadro_Colunas(),datasource:e.arr_cartoes,nome:e.title}),e.renderToolbarQuadros()})},this.salvar_lista=function(a,t){e.flag_salvar_lista=!1,WS.post("tarefa_quadro_lista/salvar/",a,function(a){e.ultima_atualizacao_realizada=a.update_hora?a.update_hora:a.insert_hora,alert_saved(a.nome+App.lang.alert_saved.salvo),t&&e.listar()})},this.salvar_cartao=function(a,t){WS.post("tarefa_quadro_lista_cartao/salvar/",a,function(a){e.ultima_atualizacao_realizada=a.update_hora?a.update_hora:a.insert_hora,alert_saved(a.nome+App.lang.alert_saved.salvo),t&&e.listar()})},this.preencher=function(){$(function(){function a(a,o){var i=$("<div>").addClass("list").addClass("listDrop").attr("id",o.id).appendTo(a);i.css("height","calc(100vh - 118px)");var r=e.arr_cartoes.filter(function(a){return a.tarefa_quadro_lista_id==o.id});o.qtde=r.length,o.total_horas_previstas=0,o.total_horas_realizadas=0;for(var n=0;n<r.length;n++){var d=r[n],s=d.nome.match(/\[(.*?)\]/),l=d.nome.match(/\((.*?)\)/);o.total_horas_previstas+=s&&!isNaN(s[1])?parseInt(s[1]):0,o.total_horas_realizadas+=l&&!isNaN(l[1])?parseInt(l[1]):0}!function(a,t){var o=$("<div>");$("<div>").addClass("col-md-12").addClass("opcoes_titulo_lista").css({padding:"0px","padding-top":"2px","text-align":"right"}).html('<span class="label label-info" style="margin-right: 2px" title="Previsto">'+t.total_horas_previstas+'</span><span class="label label-success" style="margin-right: 2px" title="Realizado">'+t.total_horas_realizadas+'</span><span class="label label-default" title="Quantidade">'+t.qtde+"</span>").appendTo(o),$("<div>").css({padding:"0px 10px"}).addClass("titulo_lista").addClass("col-md-10").addClass("dx-theme-text-color").text(t.nome).attr("title",t.nome).appendTo(o).unbind("click").click(function(){$(this).addClass("hidden"),$(this).parent().find(".opcoes_titulo_lista").addClass("hidden"),$(this).parent().find(".dx_titulo_lista").removeClass("hidden"),$(this).parent().find(".dx_titulo_lista").dxTextArea("instance").focus()}),$("<div>").addClass("dx_titulo_lista").addClass("hidden").dxTextArea({value:t.nome,readOnly:!(App.sessao.dados.admin||e.tipo_permissao==TAREFA_QUADRO_TIPO_PERMISSAO.GERENTE),autoResizeEnabled:!0,maxHeight:300,onKeyDown:function(a){if((App.sessao.dados.admin||e.tipo_permissao==TAREFA_QUADRO_TIPO_PERMISSAO.GERENTE)&&13==a.event.keyCode){var o={nome:a.component.option("text"),tarefa_quadro_id:e.tarefa_quadro_id,lista_id:t.id};e.salvar_lista(o,!0),a.event.preventDefault()}},onKeyUp:function(a){a.component.option("text")?e.flag_criacao_lista=!1:e.flag_criacao_lista=!0},onFocusOut:function(a){a.component._changedValue&&e.flag_salvar_lista?$(function(){DevExpress.ui.dialog.confirm("<i>"+App.lang.generico.questionar_salvar_registro+"</i>",App.lang.generico.salvar_registro).done(function(t){if(t){var o={nome:a.component.option("text"),tarefa_quadro_id:e.tarefa_quadro_id,lista_id:a.element.parents(".list").attr("id")};e.salvar_lista(o,!0)}else a.element.addClass("hidden"),a.element.parent().find(".titulo_lista").removeClass("hidden"),a.element.parent().find(".opcoes_titulo_lista").removeClass("hidden")})}):(a.element.addClass("hidden"),a.element.parent().find(".titulo_lista").removeClass("hidden"),a.element.parent().find(".opcoes_titulo_lista").removeClass("hidden"))}}).appendTo(o);var i=$("<div>").addClass("opcoes_titulo_lista").addClass("col-md-2").appendTo(o).dxDropDownButton({icon:"fa fa-ellipsis-h",disabled:!(App.sessao.dados.admin||e.tipo_permissao==TAREFA_QUADRO_TIPO_PERMISSAO.GERENTE),showArrowIcon:!1,dropDownOptions:{width:230},onItemClick:function(a){a.itemData.fn_onclick(t)},dataSource:[{id:"1",descricao:"Apagar Lista",icon:"trash",type:"danger",fn_onclick:function(a){DevExpress.ui.dialog.confirm("<i>"+App.lang.generico.questionar_apagar_registro+"</i>",App.lang.generico.apagar_registro).done(function(t){t&&WS.post("tarefa_quadro_lista/excluir/",{lista_id:a.id},function(a){e.ultima_atualizacao_realizada=a.update_hora?a.update_hora:a.delete_hora?a.delete_hora:a.insert_hora,alert_saved(a.nome+" "+App.lang.alert_saved.registro_excluido),e.listar()})})}},{id:"2",descricao:"Editar",icon:"edit",fn_onclick:function(){var a=i.element().parent().find(".titulo_lista");a.addClass("hidden"),a.parent().find(".opcoes_titulo_lista").addClass("hidden"),a.parent().find(".dx_titulo_lista").removeClass("hidden"),a.parent().find(".dx_titulo_lista").dxTextArea("instance").focus()}}],valueExpr:"id",displayExpr:"descricao"}).dxDropDownButton("instance");i.element().find(".dx-button-content").css("padding-right","10px").parent().css("border","none"),o.appendTo(a)}(i,o),e.arr_paginacao[o.id]={skip:e.arr_paginacao[o.id]?e.arr_paginacao[o.id].skip:0,take:e.arr_paginacao[o.id]?e.arr_paginacao[o.id].take:e.take,total:r.length},function(a,o,i){!function(a){$("<div>").addClass("card").addClass("dx-card").addClass("dx-theme-text-color").addClass("dx-theme-background-color").appendTo(a).dxTextArea({placeholder:"Adicionar um Cartão",autoResizeEnabled:!0,minHeight:50,readOnly:!(App.sessao.dados.admin||e.tipo_permissao==TAREFA_QUADRO_TIPO_PERMISSAO.GERENTE),onKeyDown:function(a){if((App.sessao.dados.admin||e.tipo_permissao==TAREFA_QUADRO_TIPO_PERMISSAO.GERENTE)&&13==a.event.keyCode){var t=a.component.option("text"),o=t.split("\n").length,i=function(){var o={nome:t,tarefa_quadro_lista_cartao_id:null,tarefa_quadro_id:e.tarefa_quadro_id,tarefa_quadro_lista_id:a.element.parents(".list").attr("id"),tarefa_quadro_lista_id_old:null};e.salvar_cartao(o,!0)};o>1?alertaPopUp("Criação de cartão","Se desejar, podemos criar um cartão para cada linha nova ("+o+"). Você também pode criar um cartão com um título longo.","Criar "+o+" cartões",function(){t=t.split("\n");for(var o=0;o<t.length;o++){var i={nome:t[o],tarefa_quadro_lista_cartao_id:null,tarefa_quadro_id:e.tarefa_quadro_id,tarefa_quadro_lista_id:a.element.parents(".list").attr("id"),tarefa_quadro_lista_id_old:null};e.salvar_cartao(i,!0)}},"Criar apenas um cartão",function(){i()},null,"200px"):i(),a.event.preventDefault()}},onKeyUp:function(a){a.component.option("text")?e.flag_criacao_cartao=!1:e.flag_criacao_cartao=!0}})}(a);var r=$("<div>").appendTo(a),n=$("<div>").appendTo(r);r.css("height","calc(100vh - 220px)");var d=function(a){for(var r=e.arr_paginacao[o.id].take<e.arr_paginacao[o.id].total?e.arr_paginacao[o.id].take:e.arr_paginacao[o.id].total,d=a?0:e.arr_paginacao[o.id].skip;d<r;d++){var l=i[d];t(n,l),d+1==e.arr_paginacao[o.id].total&&s.release(!0)}},s=r.addClass("scrollable-list").dxScrollView({direction:"vertical",onScroll:function(a){var t=a.element.parents(".list").attr("id");e.arr_offset[t]=s.scrollOffset()},onReachBottom:function(a){e.arr_paginacao[o.id].skip+=e.take,e.arr_paginacao[o.id].take+=e.take,d(!1),e.arr_paginacao[o.id].take<e.arr_paginacao[o.id].total?a.component.release():a.component.release(!0)}}).dxScrollView("instance");e.arr_paginacao[o.id].total?d(!0):s.release(!0);n.addClass("sortable-cards").dxSortable({group:"tasksGroup",moveItemOnDrop:!0,data:i,onDragStart:function(a){e.flag_drag=!1;var t=!1;if(!App.sessao.dados.admin&&e.tipo_permissao!=TAREFA_QUADRO_TIPO_PERMISSAO.GERENTE){if(e.tipo_permissao!=TAREFA_QUADRO_TIPO_PERMISSAO.ACOMPANHAMENTO)for(var o=a.itemElement.attr("id"),i=0;i<a.fromData.length;i++){var r=a.fromData[i];if(r.id==o){a.itemData=r;for(var n=0;n<r.arr_responsavel.length;n++){if(r.arr_responsavel[n].usuario_id==App.sessao.dados.usuario_id){t=!0;break}}}if(t)break}t||(a.cancel=!0)}},onDragEnd:function(a){var t={cartao_id:a.itemElement.attr("id"),tarefa_quadro_lista_id:a.toComponent.element().parents(".list").attr("id"),tarefa_quadro_lista_id_old:a.fromComponent.element().parents(".list").attr("id"),ordem:$(a.element.find(".card")[a.toIndex]).attr("ordem"),ordem_old:$(a.element.find(".card")[a.fromIndex]).attr("ordem")};t.alteracao_lista=t.tarefa_quadro_lista_id!=t.tarefa_quadro_lista_id_old,e.salvar_cartao(t,!0),e.flag_drag=!0}}),n.css("min-height","calc(100vh - 220px)"),setTimeout(function(){var a=e.arr_offset[o.id];a&&s.scrollTo(a)})}(i,o,r)}function t(a,t){var o=$("<div>").addClass("card").addClass("dx-card").addClass("dx-theme-text-color").addClass("dx-theme-background-color").attr("id",t.id).attr("ordem",t.ordem).appendTo(a);o.unbind("click").click(function(){View.load("tarefa/detalhes_cartao",function(a,t){t.show(o.attr("id"),e.verificar_alteracoes)},View.ABA.MULTIPLAS,null,null,{cartaoId:o.attr("id")})});var i=t.nome;t.nome.indexOf("[")>0&&t.nome.indexOf("]")>0&&(i=(i=i.replace("[",'<span class="label label-info">')).replace("]","</span>")),t.nome.indexOf("(")>0&&t.nome.indexOf(")")>0&&(i=(i=i.replace("(",'<span class="label label-success">')).replace(")","</span>")),$("<div>").addClass("card-subject").html(i).appendTo(o);for(var r="",n=0;n<t.arr_etiqueta.length;n++){var d=t.arr_etiqueta[n];r+='<span class="label" style="margin-right: 5px; display: inline-block; background: '+d.cor_fundo+"; color: "+d.cor_fonte+'; width: 180px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" title="'+d.nome+'">'+d.nome+"</span>"}r&&$("<div style='margin-bottom: 5px;'>").addClass("etiqueta_cartao").html(r).prependTo(o);var s="";for(n=0;n<t.arr_responsavel.length;n++){var l=t.arr_responsavel[n];if(l.foto_id)s+='<img style="height: 28px; width: 28px; border-radius: 25em; margin: 0 0 0 4px;" class="imagem_responsavel" src="'+(WS_URI+"documento/midia/?&tamanho=28&documento_id="+l.foto_id+"&token_midia="+App.sessao.token_midia)+'" title="'+l.nome+'">';else s+='<div style="width: 28px; height: 28px; background-color: #dfe1e6; border-radius: 25em; color: #172b4d; line-height: 28px; text-align: center; display: inline-block; margin: 0 0 0 4px; vertical-align: middle;"><span style="font-weight: 600;" title="'+l.nome+'">'+obter_iniciais(l.nome)+"</span></div>"}$("<div>").addClass("responsavel_cartao").html(s).appendTo(o);var c="";"S"==t.possui_descricao&&(c+='<div class="row col-md-2"><i class="fa fa-comments" aria-hidden="true"></i></div>'),t.data_prazo&&(c+='<div class="'+("N"==t.possui_descricao?"row ":"")+'col-md-6"><i class="fa fa-clock" aria-hidden="true"></i>&nbsp;'+formatar_data_humano(t.data_prazo)+"</div>"),t.data_conclusao&&(c+='<div class="row col-md-6 pull-right"><i class="fa fa-check-circle" aria-hidden="true"></i>&nbsp;'+formatar_data_humano(t.data_conclusao)+"</div>"),c&&$("<div>").addClass("data_prazo_cartao").html(c).css("font-size","10px").appendTo(o)}!function(){var t=document.createElement("div");t.className="div_kanban",t.style="min-width: 100%;",e.dx_kanban.find(".div_kanban").remove(),e.dx_kanban[0].appendChild(t);var o=e.dx_kanban.find(".div_kanban");if(o.css("height","calc(100vh - 100px)"),e.arr_listas.length){for(var i=0;i<e.arr_listas.length;i++){a(o,e.arr_listas[i])}if(e.redimensionar_colunas){var r=e.dx_kanban.width()-10*e.arr_listas.length;r=(r/=e.arr_listas.length).toFixed(2),e.dx_kanban.find(".listDrop").css({width:r,margin:5,"min-width":"250px"})}}!function(a){var t=$("<div>").addClass("list").appendTo(a);$("<div>").addClass("titulo_lista").addClass("dx-theme-text-color").appendTo(t);var o=$("<div>").appendTo(t);$("<div>").addClass("card").addClass("dx-card").addClass("dx-theme-text-color").addClass("dx-theme-background-color").appendTo(o).dxTextArea({placeholder:"Adicionar uma Lista",autoResizeEnabled:!0,minHeight:50,readOnly:!(App.sessao.dados.admin||e.tipo_permissao==TAREFA_QUADRO_TIPO_PERMISSAO.GERENTE),onKeyDown:function(a){if((App.sessao.dados.admin||e.tipo_permissao==TAREFA_QUADRO_TIPO_PERMISSAO.GERENTE)&&13==a.event.keyCode){var t={nome:a.component.option("text"),tarefa_quadro_id:e.tarefa_quadro_id};e.salvar_lista(t,!0),a.event.preventDefault()}},onKeyUp:function(a){a.component.option("text")?e.flag_criacao_lista=!1:e.flag_criacao_lista=!0}})}(o);var n=o.addClass("scrollable-board").dxScrollView({direction:"horizontal",onScroll:function(a){e.arr_offset["scrollable-board"]=this.scrollOffset()}}).dxScrollView("instance");setTimeout(function(){var a=e.arr_offset["scrollable-board"];a&&n.scrollTo(a)}),o.addClass("sortable-lists").dxSortable({filter:".listDrop",itemOrientation:"horizontal",handle:".titulo_lista",moveItemOnDrop:!0,onDragStart:function(a){e.flag_drag=!1,App.sessao.dados.admin||e.tipo_permissao==TAREFA_QUADRO_TIPO_PERMISSAO.GERENTE||(a.cancel=!0)},onDragEnd:function(a){var t={nome:a.itemElement.find(".titulo_lista").text(),lista_id:a.itemElement.attr("id"),tarefa_quadro_id:e.tarefa_quadro_id,ordem:a.toIndex,ordem_old:a.fromIndex};e.salvar_lista(t,!0),e.flag_drag=!0}})}()})},this.verificar_alteracoes=function(){WS.get("tarefa_quadro/ping/",{tarefa_quadro_id:e.tarefa_quadro_id},function(a){a>e.ultima_atualizacao_realizada&&e.listar()})},this.definir_background=function(){if(e.documento_id&&e.carregar_background){var a=cripto(WS.token);const o=e.carregar_background_anticache?"&anticache="+(new Date).getTime():"";var t=WS_URI+"documento/download/?documento_id="+e.documento_id+"&token_publico="+a+"&tipo=S&acao=abrir"+o;e.dialog.css({background:"url("+t+")","background-position":"50%","background-size":"cover"}),e.carregar_background=!1,e.carregar_background_anticache=!1}},this.renderTextBoxNome=function(){const a=$("<div>").dxTextBox({showClearButton:!0,placeholder:App.lang.tarefa.filtro_nome,value:e.parametroUsuario.nome_pesquisado,onValueChanged:function(a){App.set_parametro_usuario("filtro_quadro_"+e.tarefa_quadro_id,{nome_pesquisado:a.value}),e.listar()}});return e.nome_pesquisado=a.dxTextBox("instance"),a.css({width:200})},this.renderDropDownResponsavel=function(){e.dropDownResponsavel=$("<div>").dxDropDownBox({valueExpr:"id",placeholder:App.lang.tarefa.filtro_responsavel,displayExpr:"nome",showClearButton:!0,value:e.parametroUsuario.arr_responsavel,dataSource:[],contentTemplate:function(a){const t=a.component.option("value"),o=$("<div>").dxDataGrid({keyExpr:"id",dataSource:a.component.option("dataSource"),columns:[{dataField:"nome",width:200},{dataField:"tipo_permissao",lookup:{dataSource:TAREFA_QUADRO_TIPO_PERMISSAO_LOOKUP,displayExpr:"descricao",valueExpr:"id"},width:200}],hoverStateEnabled:!0,paging:{enabled:!0,pageSize:10},filterRow:{visible:!0},scrolling:{mode:"infinite"},height:345,selection:{mode:"multiple"},selectedRowKeys:t,onSelectionChanged:function(e){const t=e.selectedRowKeys;a.component.option("value",t)}});return e.dataGridResponsavel=o,o},onValueChanged:function(a){App.set_parametro_usuario("filtro_quadro_"+e.tarefa_quadro_id,{arr_responsavel:a.value}),null===a.value&&e.dataGridResponsavel.dxDataGrid("instance").option("selectedRowKeys",null),e.listar()}}),e.responsavel=e.dropDownResponsavel.dxDropDownBox("instance")},this.renderDropDownEtiqueta=function(){const a=$("<div>").dxDropDownBox({valueExpr:"id",placeholder:App.lang.tarefa.filtro_etiqueta,displayExpr:"nome",showClearButton:!0,value:e.parametroUsuario.arr_etiquetas,dataSource:DevExpress.data.AspNet.createStore({key:"id",loadUrl:`${WS_URI}/etiqueta/listar/tarefa_quadro/${e.tarefa_quadro_id}`,onBeforeSend:function(a,e){e.xhrFields={withCredentials:XHR_WITH_CREDENTIALS},e.headers=WS.dxHeaders()}}),contentTemplate:function(a){const t=a.component.option("value"),o=$("<div>").dxDataGrid({dataSource:a.component.getDataSource(),columns:[{dataField:"nome",sortOrder:"asc"}],hoverStateEnabled:!0,paging:{enabled:!0,pageSize:10},filterRow:{visible:!0},scrolling:{mode:"infinite"},height:345,selection:{mode:"multiple"},selectedRowKeys:t,onSelectionChanged:function(e){const t=e.selectedRowKeys;a.component.option("value",t)},onRowPrepared:function(a){"data"==a.rowType&&(a.rowElement.find("td").css("background-color",a.data.cor_fundo),a.rowElement.find("td").css("color",a.data.cor_fonte))}});return e.dataGridEtiqueta=o,o},onValueChanged:function(a){App.set_parametro_usuario("filtro_quadro_"+e.tarefa_quadro_id,{arr_etiquetas:a.value}),null===a.value&&e.dataGridEtiqueta.dxDataGrid("instance").option("selectedRowKeys",null),e.listar()}});return e.etiqueta=a.dxDropDownBox("instance"),a.css({width:200})},this.renderDropDownSituacao=function(){const a=$("<div>").dxDropDownBox({valueExpr:"id",placeholder:App.lang.tarefa.filtro_situacao,displayExpr:"descricao",showClearButton:!0,value:e.parametroUsuario.arr_situacao,dataSource:new DevExpress.data.CustomStore.default({loadMode:"raw",key:"id",load:function(){return TAREFA_QUADRO_LISTA_CARTAO_SITUACAO_LOOKUP}}),contentTemplate:function(a){const t=a.component.option("value"),o=$("<div>").dxDataGrid({dataSource:a.component.getDataSource(),columns:[{dataField:"descricao",width:200}],hoverStateEnabled:!0,paging:{enabled:!0,pageSize:10},filterRow:{visible:!0},scrolling:{mode:"infinite"},height:345,selection:{mode:"multiple"},selectedRowKeys:t,onSelectionChanged:function(e){const t=e.selectedRowKeys;a.component.option("value",t)}});return e.dataGridSituacao=o,o},onValueChanged:function(a){App.set_parametro_usuario("filtro_quadro_"+e.tarefa_quadro_id,{arr_situacao:a.value}),null===a.value&&e.dataGridSituacao.dxDataGrid("instance").option("selectedRowKeys",null),e.listar()}});return e.situacao=a.dxDropDownBox("instance"),a.css({width:200})},this.renderToolbarQuadros=function(){if(e.dx_toolbar_quadros_instance)return!1;const a=e.tarefa_quadro_id&&!e.particular&&(App.sessao.dados.admin||e.tipo_permissao==TAREFA_QUADRO_TIPO_PERMISSAO.GERENTE);e.dx_toolbar_quadros_instance=e.dx_toolbar_quadros.dxToolbar({items:[{location:"after",widget:"dxButton",locateInMenu:"never",showText:"inMenu",options:{icon:"fa fa-tags",hint:"Etiquetas",text:"Etiquetas",onClick:function(a){View.loadReact(views.etiqueta.Listagem.default,{pai_tabela:"tarefa_quadro",pai_id:e.tarefa_quadro_id,titulo:e.title},a=>{},View.ABA.MULTIPLAS)},visible:e.tarefa_quadro_id&&(App.sessao.dados.admin||e.tipo_permissao==TAREFA_QUADRO_TIPO_PERMISSAO.GERENTE)}},{location:"after",widget:"dxButton",locateInMenu:"never",showText:"inMenu",options:{icon:"fa fa-users",hint:"Gerenciar Equipe",text:"Gerenciar Equipe",onClick:function(a){View.load("tarefa/detalhes_equipe_quadro",function(a,t){t.show(e.tarefa_quadro_id,e.title)},View.ABA.MULTIPLAS)},visible:a}},{location:"after",widget:"dxButton",locateInMenu:"never",showText:"inMenu",options:{icon:"fa fa-link",hint:"Referências",text:"Referências",onClick(){View.loadReact(window.views.Referencias.ReferenciasQuadroTarefas.default,{quadro_id:e.tarefa_quadro_id,abaTitulo:`Referências - ${e.title}`,html_id:e.html_id})},visible:e.tarefa_quadro_id>0}},{location:"after",widget:"dxButton",locateInMenu:"never",showText:"inMenu",options:{icon:"fa fa-image",hint:"Alterar Imagem",text:"Alterar Imagem",onClick:function(a){View.load("tarefa/alterar_imagem",function(a,t){t.onclose=()=>{e.carregar_background=!0,e.carregar_background_anticache=!0,e.listar()},t.show(FORMULARIO.NOVO,e.tarefa_quadro_id,e.documento_id)})},visible:e.tarefa_quadro_id&&(App.sessao.dados.admin||e.tipo_permissao==TAREFA_QUADRO_TIPO_PERMISSAO.GERENTE)}},{location:"after",widget:"dxButton",locateInMenu:"auto",showText:"inMenu",options:{icon:"exportxlsx",hint:"Exportar Excel",text:"Exportar Excel",onClick:function(){e.dataGrid.exportToExcel()}}},{location:"after",widget:"dxButton",locateInMenu:"never",showText:"inMenu",options:{icon:"refresh",hint:"Recarregar",text:"Recarregar",onClick:function(){e.listar()}}},{location:"before",locateInMenu:"auto",template:function(){return e.renderTextBoxNome()}},{location:"before",locateInMenu:"auto",template:function(){return e.dropDownResponsavel.css({width:200})},visible:a},{location:"before",locateInMenu:"auto",template:function(){return e.renderDropDownSituacao()}},{location:"before",locateInMenu:"auto",template:function(){return e.renderDropDownEtiqueta()}}]}).dxToolbar("instance")}}});