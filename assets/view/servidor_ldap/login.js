define([],function(){return function(i){"use strict";var a=this;this.html_id=i,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.tipo=null,this.onclose=null,this.dados=null,this.main_pai=null,this.cbo_servidor_ldap=this.dialog.find(".cbo_servidor_ldap"),this.edt_base=this.dialog.find(".edt_base"),this.edt_filtro=this.dialog.find(".edt_filtro"),this.edt_usuario_ldap=this.dialog.find(".edt_usuario_ldap"),this.edt_senha_ldap=this.dialog.find(".edt_senha_ldap"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_autenticar=this.dialog.find(".btn_autenticar"),this.show=function(i,d){this.main_pai=i,this.limpar_preencher_cbo_usuario=d,show_modal(a.modal.attr("id")),a.preencher_dados_ldap(a.main_pai.servidor_ldap_id)},this.close=function(){close_modal(a.modal.attr("id")),void 0!==a.onclose&&a.onclose&&a.onclose()},this.unload=function(){a.close(),View.unload(this.html_id)},this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){a.unload()}),this.btn_autenticar.unbind("click"),this.btn_autenticar.click(function(){a.validar_login_ldap(a.edt_usuario_ldap.val(),a.edt_senha_ldap.val(),a.cbo_servidor_ldap.val())}),this.validar_login_ldap=function(i,d,o){a.main_pai.login_ldap=i,a.main_pai.senha_ldap=d,a.main_pai.servidor_ldap_id=o;const t=a.edt_base.val(),s=a.edt_filtro.val();WS.get("servidor_ldap/validar_login/",{usuario_ldap:i,senha_ldap:d,servidor_ldap:o},function(l){l[0].autenticado?(a.listar_usuarios_ldap(i,d,o,t,s),a.unload()):alert_modal("Falha de autenticação","Verifique os seguintes itens: <br><br> - Usuário e/ou senha estão corretos <br> - Servidor do LDAP está ativo")})},this.listar_usuarios_ldap=function(i,d,o,t,s){WS.get("servidor_ldap/listar_usuarios/",{login_ldap:i,senha_ldap:d,servidor_ldap:o,servidor_base_dn:t,servidor_filtro_conexao:s},function(t){if(a.limpar_preencher_cbo_usuario){a.main_pai.cbo_usuario_ldap.find("option").remove(),a.main_pai.div_username_senha.show();for(var s=0,l=t.usuarios.length;s<l;s++){var _=t.usuarios[s];_&&add_option(a.main_pai.cbo_usuario_ldap,_.id_usuario,_.usuario)}a.main_pai.cbo_usuario_ldap.selectpicker("refresh")}else a.main_pai.lista_usuarios_ldap=t,a.main_pai.login_ldap=i,a.main_pai.senha_ldap=d,a.main_pai.servidor_ldap_id=o,a.main_pai.show()})},this.preencher_dados_ldap=function(i){var d="";WS.get("servidor_ldap/listar/",null,function(o){a.servidores_ldap=o,a.cbo_servidor_ldap.find("option").remove(),add_option(a.cbo_servidor_ldap,"","Nenhum",d);for(var t=0;t<o.length;t++)d=o[0].id_servidor_ldap==o[t].id?"selected":"",add_option(a.cbo_servidor_ldap,o[t].id,o[t].nome,d);i&&a.cbo_servidor_ldap.val(i).trigger("change")})},this.cbo_servidor_ldap.on("change",function(){var i=a.cbo_servidor_ldap.val();a.servidores_ldap.forEach(function(d){if(d.id==i)return a.edt_base.val(d.base_dn),a.edt_filtro.val(d.filtro_conexao),void a.edt_usuario_ldap.val(d.usuario_ldap)})})}});