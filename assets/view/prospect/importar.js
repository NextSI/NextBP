define([],function(){var Importar_Excel=function(html_id){"use strict";var main=this;this.html_id=html_id,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.tipo=null,this.onclose=null,this.div_cadastro_prospect=this.dialog.find(".div_cadastro_prospect"),this.primeira_etapa=this.dialog.find(".primeira_etapa"),this.segunda_etapa=this.dialog.find(".segunda_etapa"),this.terceira_etapa=this.dialog.find(".terceira_etapa"),this.quarta_etapa=this.dialog.find(".quarta_etapa"),this.edt_quantidade_linhas=this.dialog.find(".edt_quantidade_linhas"),this.planilha=this.dialog.find(".planilha"),this.tab_listagem=this.dialog.find(".tab_listagem"),this.add_coluna_planilha=this.dialog.find(".add_coluna_planilha"),this.cbo_codigo=this.dialog.find(".cbo_codigo"),this.cbo_unidade=this.dialog.find(".cbo_unidade"),this.cbo_razao_social=this.dialog.find(".cbo_razao_social"),this.cbo_nome_fantasia=this.dialog.find(".cbo_nome_fantasia"),this.cbo_bloqueado=this.dialog.find(".cbo_bloqueado"),this.cbo_tipo_pessoa=this.dialog.find(".cbo_tipo_pessoa"),this.cbo_tipo_cadastro=this.dialog.find(".cbo_tipo_cadastro"),this.cbo_cep=this.dialog.find(".cbo_cep"),this.cbo_endereco=this.dialog.find(".cbo_endereco"),this.cbo_numero=this.dialog.find(".cbo_numero"),this.cbo_complemento=this.dialog.find(".cbo_complemento"),this.cbo_bairro=this.dialog.find(".cbo_bairro"),this.cbo_municipio=this.dialog.find(".cbo_municipio"),this.cbo_pais=this.dialog.find(".cbo_pais"),this.cbo_cnpj=this.dialog.find(".cbo_cnpj"),this.cbo_inscricao_estadual=this.dialog.find(".cbo_inscricao_estadual"),this.cbo_inscricao_municipal=this.dialog.find(".cbo_inscricao_municipal"),this.cbo_id_estrangeiro=this.dialog.find(".cbo_id_estrangeiro"),this.cbo_tipo_orgao=this.dialog.find(".cbo_tipo_orgao"),this.cbo_data_fundacao=this.dialog.find(".cbo_data_fundacao"),this.cbo_telefone1=this.dialog.find(".cbo_telefone1"),this.cbo_telefone2=this.dialog.find(".cbo_telefone2"),this.cbo_telefone3=this.dialog.find(".cbo_telefone3"),this.cbo_telefone4=this.dialog.find(".cbo_telefone4"),this.cbo_site=this.dialog.find(".cbo_site"),this.cbo_email_principal=this.dialog.find(".cbo_email_principal"),this.cbo_email_agenda=this.dialog.find(".cbo_email_agenda"),this.cbo_observacoes=this.dialog.find(".cbo_observacoes"),this.cbo_classificacao=this.dialog.find(".cbo_classificacao"),this.codigo=this.dialog.find(".codigo"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_confirmar=this.dialog.find(".btn_confirmar"),this.btn_proxima_etapa=this.dialog.find(".btn_proxima_etapa"),this.btn_voltar=this.dialog.find(".btn_voltar"),this.arr_indice=[],this.var_response=[],this.arr_planilha=[],this.prospects_existentes=[],this.prospect_codigo_automatico=!1,this.show=function(){main.limpar_formulario_importar_atividade(),show_modal(main.modal.attr("id")),WS.get("prospect/get_parametros/",null,function(a){main.prospect_codigo_automatico="S"==a.prospect_codigo_automatico,1==main.prospect_codigo_automatico&&main.codigo.addClass("hidden")}),main.primeira_etapa_func(!1)},this.limpar_formulario_importar_atividade=function(){main.edt_quantidade_linhas.val(""),main.planilha.val("")},this.close=function(){close_modal(main.modal.attr("id")),void 0!==main.onclose&&main.onclose&&main.onclose()},this.unload=function(){main.close(),View.unload(this.html_id)},this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){main.unload()}),this.primeira_etapa_func=function(a){var i=new Array;i=[".xls"];var e=null;main.btn_proxima_etapa.unbind("click"),main.btn_proxima_etapa.click(function(){var a=main.planilha[0].files.length,n=new Validation;if(0==a&&n.add(new ValidationMessage(Validation.CODES.ERR,"Selecionar uma planilha.")),a>0){var o=main.planilha[0].files[0].name;e=o.substring(o.lastIndexOf(".")).toLowerCase(),-1==jQuery.inArray(e,i)&&n.add(new ValidationMessage(Validation.CODES.ERR,'Selecionar planilha no formato "xls".'))}""==main.edt_quantidade_linhas.val()&&n.add(new ValidationMessage(Validation.CODES.ERR,"Informe a linha que começará a importação.")),n.is_valid()?WS.post("prospect/importar_excel/",{quantidade_linhas:main.edt_quantidade_linhas.val(),planilha:main.planilha[0].files[0]},function(a){a&&($.each(a,function(a,i){$.map(i,function(a,i){-1==main.arr_indice.indexOf(i)&&main.arr_indice.push(i)})}),main.var_response=a,main.btn_voltar.removeClass("hidden"),main.segunda_etapa_func(!1))},[main.btn_proxima_etapa,main.btn_cancelar,main.btn_voltar],null,!0):alert_modal("Validação",n)})},this.segunda_etapa_func=function(retorno){main.arr_planilha=[],main.primeira_etapa.addClass("hidden"),main.segunda_etapa.removeClass("hidden"),retorno||(main.add_coluna_planilha.find("option").remove(),add_option(main.add_coluna_planilha,"","-- Selecione --"),$.each(main.arr_indice,function(a,i){add_option(main.add_coluna_planilha,i,i)}),main.add_coluna_planilha.selectpicker("refresh")),main.btn_voltar.unbind("click"),main.btn_voltar.click(function(){main.primeira_etapa_func(!0),main.primeira_etapa.removeClass("hidden"),main.segunda_etapa.addClass("hidden"),main.btn_voltar.addClass("hidden")}),main.btn_proxima_etapa.unbind("click"),main.btn_proxima_etapa.click(function(){main.validation()&&($.each(main.var_response,function(i,item){var codigo_valor=main.cbo_codigo.val().length>0?eval("item."+main.cbo_codigo.val()):null,unidade_valor=main.cbo_unidade.val().length>0?eval("item."+main.cbo_unidade.val()):null,razao_social_valor=main.cbo_razao_social.val().length>0?eval("item."+main.cbo_razao_social.val()):null,nome_fantasia_valor=main.cbo_nome_fantasia.val().length>0?eval("item."+main.cbo_nome_fantasia.val()):null,bloqueado_valor=main.cbo_bloqueado.val().length>0?eval("item."+main.cbo_bloqueado.val()):null,tipo_pessoa_valor=main.cbo_tipo_pessoa.val().length>0?eval("item."+main.cbo_tipo_pessoa.val()):null,tipo_cadastro_valor=main.cbo_tipo_cadastro.val().length>0?eval("item."+main.cbo_tipo_cadastro.val()):null,cep_valor=main.cbo_cep.val().length>0?eval("item."+main.cbo_cep.val()):null,endereco_valor=main.cbo_endereco.val().length>0?eval("item."+main.cbo_endereco.val()):null,numero_valor=main.cbo_numero.val().length>0?eval("item."+main.cbo_numero.val()):null,complemento_valor=main.cbo_complemento.val().length>0?eval("item."+main.cbo_complemento.val()):null,bairro_valor=main.cbo_bairro.val().length>0?eval("item."+main.cbo_bairro.val()):null,municipio_valor=main.cbo_municipio.val().length>0?eval("item."+main.cbo_municipio.val()):null,pais_valor=main.cbo_pais.val().length>0?eval("item."+main.cbo_pais.val()):null,cnpj_valor=main.cbo_cnpj.val().length>0?eval("item."+main.cbo_cnpj.val()):null,inscricao_estadual_valor=main.cbo_inscricao_estadual.val().length>0?eval("item."+main.cbo_inscricao_estadual.val()):null,inscricao_municipal_valor=main.cbo_inscricao_municipal.val().length>0?eval("item."+main.cbo_inscricao_municipal.val()):null,id_estrangeiro_valor=main.cbo_id_estrangeiro.val().length>0?eval("item."+main.cbo_id_estrangeiro.val()):null,tipo_orgao_valor=main.cbo_tipo_orgao.val().length>0?eval("item."+main.cbo_tipo_orgao.val()):null,data_fundacao_valor=main.cbo_data_fundacao.val().length>0?eval("item."+main.cbo_data_fundacao.val()):null,telefone1_valor=main.cbo_telefone1.val().length>0?eval("item."+main.cbo_telefone1.val()):null,telefone2_valor=main.cbo_telefone2.val().length>0?eval("item."+main.cbo_telefone2.val()):null,telefone3_valor=main.cbo_telefone3.val().length>0?eval("item."+main.cbo_telefone3.val()):null,telefone4_valor=main.cbo_telefone4.val().length>0?eval("item."+main.cbo_telefone4.val()):null,site_valor=main.cbo_site.val().length>0?eval("item."+main.cbo_site.val()):null,email_principal_valor=main.cbo_email_principal.val().length>0?eval("item."+main.cbo_email_principal.val()):null,email_agenda_valor=main.cbo_email_agenda.val().length>0?eval("item."+main.cbo_email_agenda.val()):null,observacoes_valor=main.cbo_observacoes.val().length>0?eval("item."+main.cbo_observacoes.val()):null,classificacao_valor=main.cbo_classificacao.val().length>0?eval("item."+main.cbo_classificacao.val()):null,importar=!0;if(null!=tipo_pessoa_valor&&tipo_pessoa_valor[0]&&(tipo_pessoa_valor=tipo_pessoa_valor[0].toUpperCase().trim(),""==tipo_pessoa_valor&&(importar=!1)),null!=tipo_cadastro_valor){var F="C"==tipo_cadastro_valor[0]||"c"==tipo_cadastro_valor[0]?"F":"",R="R"==tipo_cadastro_valor[0]||"r"==tipo_cadastro_valor[0]?"R":"",S="S"==tipo_cadastro_valor[0]||"s"==tipo_cadastro_valor[0]?"S":"",E="E"==tipo_cadastro_valor[0]||"e"==tipo_cadastro_valor[0]?"E":"",N="N"==tipo_cadastro_valor[0]||"n"==tipo_cadastro_valor[0]?"N":"";tipo_cadastro_valor=F+R+S+E+N,tipo_cadastro_valor=tipo_cadastro_valor.trim()}if(null!=tipo_orgao_valor){var N="N"==tipo_orgao_valor[0]||"n"==tipo_orgao_valor[0]?"N":"",M="M"==tipo_orgao_valor[0]||"m"==tipo_orgao_valor[0]?"M":"",O="O"==tipo_orgao_valor[0]||"o"==tipo_orgao_valor[0]?"O":"",S="S"==tipo_orgao_valor[0]||"s"==tipo_orgao_valor[0]?"S":"";tipo_orgao_valor=M+O+S+N,tipo_orgao_valor=tipo_orgao_valor.trim()}if(null!=classificacao_valor){var L="L"==classificacao_valor[0]||"l"==classificacao_valor[0]?"L":"",S="S"==classificacao_valor[0]||"s"==classificacao_valor[0]?"S":"",P="P"==classificacao_valor[0]||"p"==classificacao_valor[0]?"P":"";classificacao_valor=P+L+S,classificacao_valor=classificacao_valor.trim()}(codigo_valor||unidade_valor||razao_social_valor||nome_fantasia_valor||bloqueado_valor||tipo_pessoa_valor||tipo_cadastro_valor||cep_valor||endereco_valor||numero_valor||complemento_valor||bairro_valor||municipio_valor||pais_valor||cnpj_valor||inscricao_estadual_valor||inscricao_municipal_valor||id_estrangeiro_valor||tipo_orgao_valor||data_fundacao_valor||telefone1_valor||telefone2_valor||telefone3_valor||telefone4_valor||site_valor||email_principal_valor||email_agenda_valor||observacoes_valor||classificacao_valor)&&main.arr_planilha.push({codigo:codigo_valor,unidade:unidade_valor,razao_social:razao_social_valor,nome_fantasia:nome_fantasia_valor,bloqueado:bloqueado_valor,tipo_pessoa:tipo_pessoa_valor,tipo_cadastro:tipo_cadastro_valor,cep:cep_valor,endereco:endereco_valor,numero:numero_valor,complemento:complemento_valor,bairro:bairro_valor,municipio:municipio_valor,pais:pais_valor,cnpj:cnpj_valor,inscricao_estadual:inscricao_estadual_valor,inscricao_municipal:inscricao_municipal_valor,id_estrangeiro:id_estrangeiro_valor,tipo_orgao:tipo_orgao_valor,data_fundacao:data_fundacao_valor,telefone1:telefone1_valor,telefone2:telefone2_valor,telefone3:telefone3_valor,telefone4:telefone4_valor,site:site_valor,email_principal:email_principal_valor,email_agenda:email_agenda_valor,observacoes:observacoes_valor,cod_municipio:null,cod_pais:null,importar:importar,classificacao:classificacao_valor})}),main.terceira_etapa_func(!1))})},this.validation=function(){var a=new Validation;return main.prospect_codigo_automatico||(0==main.cbo_codigo.val().length&&a.add(new ValidationMessage(Validation.CODES.ERR,"Informe a coluna do Código.")),0==main.cbo_unidade.val().length&&a.add(new ValidationMessage(Validation.CODES.ERR,"Informe a coluna da Unidade."))),0==main.cbo_razao_social.val().length&&a.add(new ValidationMessage(Validation.CODES.ERR,"Informe a coluna da Razão Social.")),0==main.cbo_nome_fantasia.val().length&&a.add(new ValidationMessage(Validation.CODES.ERR,"Informe a coluna do Nome Fantasia.")),0==main.cbo_classificacao.val().length&&a.add(new ValidationMessage(Validation.CODES.ERR,"Informe a coluna da Classificação.")),!!a.is_valid()||(alert_modal("Validação",a),!1)},this.terceira_etapa_func=function(a){main.segunda_etapa.addClass("hidden"),main.terceira_etapa.removeClass("hidden"),main.btn_voltar.unbind("click"),main.btn_voltar.click(function(){main.segunda_etapa_func(!0),main.segunda_etapa.removeClass("hidden"),main.terceira_etapa.addClass("hidden")});var i=main.terceira_etapa.find('[template-row="cadastro_prospect"]');main.div_cadastro_prospect.find(".cadastro_prospect").remove(),$(main.arr_planilha).each(function(a,e){!function(a,e){var n=i.clone();n.removeAttr("template-row").remove(),n.css("display",""),$(n.find("[template-field='nome']")).text((null!=e.codigo?e.codigo:"")+" "+(null!=e.nome_fantasia&&""!=e.nome_fantasia?e.nome_fantasia:"Nome não informado"));var o=$(n.find("[template-field='municipio']"));o.val(e.municipio?e.municipio:"");var l=$(n.find("[template-field='pais']"));null!=e.pais&&""!=e.pais?l.val(e.pais):(l.val("BRASIL"),e.pais="BRASIL",e.cod_pais="1058",main.arr_planilha[a]=e);var t=$(n.find("[template-button='btn_municipio']"));t.unbind("click"),t.click(function(){View.load("municipio/selecionar",function(i,n){n.show(function(i){e.cod_municipio=i.cod_municipio,e.municipio=i.municipio,o.val(i.municipio),main.arr_planilha[a]=e})})});var r=$(n.find("[template-button='btn_add_municipio']"));r.unbind("click"),r.click(function(){View.load("municipio/detalhes",function(i,n){n.onsave=function(i){e.cod_municipio=i.cod_municipio,e.municipio=i.municipio,o.val(i.municipio),main.arr_planilha[a]=e},n.show(null,FORMULARIO.NOVO)})});var c=$(n.find("[template-button='btn_pais']"));c.unbind("click"),c.click(function(){View.load("pais/selecionar",function(i,n){n.show(function(i){e.cod_pais=i.cod_pais,e.pais=i.nome,l.val(i.nome),main.arr_planilha[a]=e})})}),n.appendTo(main.div_cadastro_prospect)}(a,e)}),main.btn_proxima_etapa.unbind("click"),main.btn_proxima_etapa.click(function(){main.quarta_etapa_func(!1)})},this.quarta_etapa_func=function(a){main.terceira_etapa.addClass("hidden"),main.quarta_etapa.removeClass("hidden"),main.btn_proxima_etapa.css("display","none"),main.btn_confirmar.css("display",""),main.btn_voltar.unbind("click"),main.btn_voltar.click(function(){main.btn_confirmar.css("display","none"),main.btn_proxima_etapa.css("display",""),main.tab_listagem.find("tr:gt(1)").remove(),main.terceira_etapa_func(!0),main.terceira_etapa.removeClass("hidden"),main.quarta_etapa.addClass("hidden")}),WS.get("prospect/listar/",null,function(a){main.prospects_existentes=a});var i=main.tab_listagem.find("tbody").find("tr:first"),e=function(a,n,o,l,t){var r=i.clone();r.removeAttr("template-row").remove(),r.css("display",""),r.attr("id",""+a),r.addClass("tr_prospect");var c=$(r.find(".valida"));(function(a,i,e){var n=!0;return $(main.prospects_existentes).each(function(o,l){l.cnpj&&l.cnpj.length>1&&(l.cnpj=l.cnpj.toString(),l.cnpj=l.cnpj.replace(".",""),l.cnpj=l.cnpj.replace("/",""),l.cnpj=l.cnpj.replace("-",""),(a=(a=(a=(a=a.toString()).replace(".","")).replace("/","")).replace("-",""))==l.cnpj&&(n=!1)),main.prospect_codigo_automatico||parseInt(l.unidade,10)==e&&i==parseInt(l.codigo,10)&&(n=!1)}),n})(n.cnpj,n.codigo,n.unidade)||c.addClass("bg-warning");var s=$(r.find("[template-field='importar']"));s.attr("type","checkbox"),s.bootstrapSwitch(!0),s.bootstrapSwitch(!0),!0===n.importar?(s.bootstrapSwitch("state",!0),s.prop("checked",!0)):(s.bootstrapSwitch("state",!1),s.prop("checked",!1)),s.unbind("click"),s.bootstrapSwitch("onSwitchChange",function(i,e){n.importar=s.prop("checked"),main.arr_planilha[a]=n});var d=$(r.find("[template-field='codigo']"));if(!main.prospect_codigo_automatico){if(null!=n.codigo&&n.codigo.toString().length>6)c.addClass("bg-danger"),d.html('<span class="label label-danger">Estourou</span><br><div class="form-group"><input class="form-control edt_new_codigo" maxlenght="6" type="text"></div>'),(_=d.find(".edt_new_codigo")).val(n.codigo),_.unbind("change"),_.change(function(){n.codigo=_.val(),main.arr_planilha[a]=n,r.remove(),e(a,n,!0)});else if(isNaN(parseInt(n.codigo,10))){var _;c.addClass("bg-danger"),d.html('<span class="label label-danger">Apenas números</span><br><div class="form-group"><input class="form-control edt_new_codigo" maxlenght="6" type="text"></div>'),(_=d.find(".edt_new_codigo")).val(n.codigo),_.unbind("change"),_.change(function(){n.codigo=_.val(),main.arr_planilha[a]=n,r.remove(),e(a,n,!0)})}else d.text(null!=n.codigo?n.codigo:"");var p=$(r.find("[template-field='unidade']"));if(null!=n.unidade&&n.unidade.toString().length>6){c.addClass("bg-danger"),p.html('<span class="label label-danger">Estourou</span><br><div class="form-group"><input class="form-control edt_new_unidade" maxlenght="6" type="text"></div>');var m=p.find(".edt_new_unidade");m.val(n.unidade),m.unbind("change"),m.change(function(){n.codigo=m.val(),main.arr_planilha[a]=n,r.remove(),e(a,n,!0)})}else p.text(null!=n.unidade?n.unidade:"")}var v=$(r.find("[template-field='nome_fantasia']"));if(null!=n.nome_fantasia&&n.nome_fantasia.toString().length>80){c.addClass("bg-danger"),v.html('<span class="label label-danger">Estourou</span><br><div class="form-group"><input class="form-control edt_new_nome" maxlenght="80" type="text"></div>');var u=v.find(".edt_new_nome");u.val(n.nome_fantasia),u.unbind("change"),u.change(function(){n.nome_fantasia=u.val(),main.arr_planilha[a]=n,r.remove(),e(a,n,!0)})}else v.text(null!=n.nome_fantasia?n.nome_fantasia:"");var f=$(r.find("[template-field='razao_social']"));if(null!=n.razao_social&&n.razao_social.toString().length>80){c.addClass("bg-danger"),f.html('<span class="label label-danger">Estourou</span><br><div class="form-group"><input class="form-control edt_new_razao_social" maxlenght="80" type="text"></div>');var g=f.find(".edt_new_razao_social");g.val(n.razao_social),g.unbind("change"),g.change(function(){n.razao_social=g.val(),main.arr_planilha[a]=n,r.remove(),e(a,n,!0)})}else f.text(null!=n.razao_social?n.razao_social:"");$(r.find("[template-field='bloqueado']")).html(str_yes_no(n.bloqueado));var h=$(r.find("[template-field='cnpj']"));if(null!=n.cnpj&&n.cnpj.toString().length>18){c.addClass("bg-danger"),h.html('<span class="label label-danger">Estourou</span><br><div class="form-group"><input class="form-control edt_cnpj" maxlenght="18" type="text"></div>');var b=h.find(".edt_cnpj");b.val(n.cnpj),b.unbind("change"),b.change(function(){n.cnpj=b.val(),main.arr_planilha[a]=n,r.remove(),e(a,n,!0)})}else h.text(null!=n.cnpj?n.cnpj:"");var x=$(r.find("[template-field='id_estrangeiro']"));if(null!=n.id_estrangeiro&&n.id_estrangeiro.toString().length>20){c.addClass("bg-danger"),x.html('<span class="label label-danger">Estourou</span><br><div class="form-group"><input class="form-control edt_id_estrangeiro" maxlenght="20" type="text"></div>');var S=x.find(".edt_id_estrangeiro");S.val(n.id_estrangeiro),S.unbind("change"),S.change(function(){n.id_estrangeiro=S.val(),main.arr_planilha[a]=n,r.remove(),e(a,n,!0)})}else x.text(null!=n.id_estrangeiro?n.id_estrangeiro:"");var C=$(r.find("[template-field='inscricao_estadual']"));if(null!=n.inscricao_estadual&&n.inscricao_estadual.toString().length>18){c.addClass("bg-danger"),C.html('<span class="label label-danger">Estourou</span><br><div class="form-group"><input class="form-control edt_inscricao_estadual" maxlenght="18" type="text"></div>');var w=C.find(".edt_inscricao_estadual");w.val(n.inscricao_estadual),w.unbind("change"),w.change(function(){n.inscricao_estadual=w.val(),main.arr_planilha[a]=n,r.remove(),e(a,n,!0)})}else C.text(null!=n.inscricao_estadual?n.inscricao_estadual:"");var E=$(r.find("[template-field='inscricao_municipal']"));if(null!=n.inscricao_municipal&&n.inscricao_municipal.toString().length>15){c.addClass("bg-danger"),E.html('<span class="label label-danger">Estourou</span><br><div class="form-group"><input class="form-control edt_inscricao_municipal" maxlenght="15" type="text"></div>');var y=E.find(".edt_inscricao_municipal");y.val(n.inscricao_municipal),y.unbind("change"),y.change(function(){n.inscricao_municipal=y.val(),main.arr_planilha[a]=n,r.remove(),e(a,n,!0)})}else E.text(null!=n.inscricao_municipal?n.inscricao_municipal:"");var k=$(r.find("[template-field='tipo_orgao']")),j=n.tipo_orgao;null!=j&&("N"==(j=j.trim())?j="Normal":"M"==j?j="MEI":"O"==j?j="Órgão Público":"S"==j&&(j="Simples Nacional"),k.text(j));var R=$(r.find("[template-field='tipo_pessoa']"));if("J"==n.tipo_pessoa)R.text("Pessoa Jurídica");else if("F"==n.tipo_pessoa)R.text("Pessoa Física");else{c.addClass("bg-danger"),R.html('<span class="label label-danger">Não Existente</span><br><div class="form-group"><select class="form-control edt_new_tipo_pessoa selectpicker"><option value="">Selecione</option><option value="J">Jurídica</option><option value="F">Física</option></select></div>');var V=R.find(".edt_new_tipo_pessoa");V.selectpicker("refresh"),V.unbind("change"),V.change(function(){null!=V.val()&&""!=V.val()&&(n.tipo_pessoa=V.val()),main.arr_planilha[a]=n,r.remove(),e(a,n,!0)})}var q=$(r.find("[template-field='tipo_cadastro']"));if("F"==n.tipo_cadastro)q.text("Consumidor Final");else if("R"==n.tipo_cadastro)q.text("Revendedor");else if("S"==n.tipo_cadastro)q.text("Solidário");else if("E"==n.tipo_cadastro)q.text("Exportação");else if("N"==n.tipo_cadastro)q.text("Não contribuinte");else{c.addClass("bg-danger"),q.html('<span class="label label-danger">Não Existente</span><br><div class="form-group"><select class="form-control edt_new_tipo_cadastro selectpicker"><option value="">Selecione</option><option value="F">Consumidor Final</option><option value="R">Revendedor</option><option value="S">Solidário</option><option value="E">Exportação</option><option value="N">Não contribuinte</option></select></div>');var N=q.find(".edt_new_tipo_cadastro");N.selectpicker("refresh"),N.unbind("change"),N.change(function(){null!=N.val()&&""!=N.val()&&(n.tipo_cadastro=N.val()),main.arr_planilha[a]=n,r.remove(),e(a,n,!0)})}var z=$(r.find("[template-field='classificacao']"));if("S"==n.classificacao)z.text("Suspect");else if("P"==n.classificacao)z.text("Organização");else if("L"==n.classificacao)z.text("Lead");else{c.addClass("bg-danger"),z.html('<span class="label label-danger">Não Existente</span><br><div class="form-group"><select class="form-control edt_new_classificacao selectpicker"><option value="">Selecione</option><option value="L">Lead</option><option value="S">Suspect</option><option value="P">Prospect</option></select></div>');var O=z.find(".edt_new_classificacao");O.selectpicker("refresh"),O.unbind("change"),O.change(function(){null!=O.val()&&""!=O.val()&&(n.classificacao=O.val()),main.arr_planilha[a]=n,r.remove(),e(a,n,!0)})}$(r.find("[template-field='pais']")).text(n.pais?n.pais:""),$(r.find("[template-field='municipio']")).val(n.municipio?n.municipio:"");var I=$(r.find("[template-field='cep']"));if(null!=n.cep&&n.cep.toString().length>10){c.addClass("bg-danger"),I.html('<span class="label label-danger">Estourou</span><br><div class="form-group"><input class="form-control edt_cep" maxlenght="10" type="text"></div>');var M=I.find(".edt_cep");M.val(n.cep),M.unbind("change"),M.change(function(){n.cep=M.val(),main.arr_planilha[a]=n,r.remove(),e(a,n,!0)})}else I.text(null!=n.cep?n.cep:"");var F=$(r.find("[template-field='numero']"));if(null!=n.numero&&n.numero.toString().length>15){c.addClass("bg-danger"),F.html('<span class="label label-danger">Estourou</span><br><div class="form-group"><input class="form-control edt_numero" maxlenght="15" type="text"></div>');var L=F.find(".edt_numero");L.val(n.numero),L.unbind("change"),L.change(function(){n.numero=L.val(),main.arr_planilha[a]=n,r.remove(),e(a,n,!0)})}else F.text(null!=n.numero?n.numero:"");var P=$(r.find("[template-field='endereco']"));if(null!=n.endereco&&n.endereco.toString().length>80){c.addClass("bg-danger"),P.html('<span class="label label-danger">Estourou</span><br><div class="form-group"><input class="form-control edt_endereco" maxlenght="80" type="text"></div>');var A=P.find(".edt_endereco");A.val(n.endereco),A.unbind("change"),A.change(function(){n.endereco=A.val(),main.arr_planilha[a]=n,r.remove(),e(a,n,!0)})}else P.text(null!=n.endereco?n.endereco:"");var D=$(r.find("[template-field='complemento']"));if(null!=n.complemento&&n.complemento.toString().length>100){c.addClass("bg-danger"),D.html('<span class="label label-danger">Estourou</span><br><div class="form-group"><input class="form-control edt_complemento" maxlenght="100" type="text"></div>');var J=D.find(".edt_complemento");J.val(n.complemento),J.unbind("change"),J.change(function(){n.complemento=J.val(),main.arr_planilha[a]=n,r.remove(),e(a,n,!0)})}else D.text(null!=n.complemento?n.complemento:"");var W=$(r.find("[template-field='bairro']"));if(null!=n.bairro&&n.bairro.toString().length>60){c.addClass("bg-danger"),W.html('<span class="label label-danger">Estourou</span><br><div class="form-group"><input class="form-control edt_bairro" maxlenght="60" type="text"></div>');var T=W.find(".edt_bairro");T.val(n.bairro),T.unbind("change"),T.change(function(){n.bairro=T.val(),main.arr_planilha[a]=n,r.remove(),e(a,n,!0)})}else W.text(null!=n.bairro?n.bairro:"");var U=$(r.find("[template-field='email_principal']"));if(null!=n.email_principal&&n.email_principal.toString().length>60){c.addClass("bg-danger"),U.html('<span class="label label-danger">Estourou</span><br><div class="form-group"><input class="form-control edt_email_principal" maxlenght="60" type="text"></div>');var B=U.find(".edt_email_principal");B.val(n.email_principal),B.unbind("change"),B.change(function(){n.email_principal=B.val(),main.arr_planilha[a]=n,r.remove(),e(a,n,!0)})}else U.text(null!=n.email_principal?n.email_principal:"");var Q=$(r.find("[template-field='email_agenda']"));if(null!=n.email_agenda&&n.email_agenda.toString().length>500){c.addClass("bg-danger"),Q.html('<span class="label label-danger">Estourou</span><br><div class="form-group"><input class="form-control edt_email_agenda" maxlenght="500" type="text"></div>');var G=Q.find(".edt_email_agenda");G.val(n.email_agenda),G.unbind("change"),G.change(function(){n.email_agenda=G.val(),main.arr_planilha[a]=n,r.remove(),e(a,n,!0)})}else Q.text(null!=n.email_agenda?n.email_agenda:"");var H=$(r.find("[template-field='site']"));if(null!=n.site&&n.site.toString().length>60){c.addClass("bg-danger"),H.html('<span class="label label-danger">Estourou</span><br><div class="form-group"><input class="form-control edt_site" type="text" maxlenght="60"></div>');var K=H.find(".edt_site");K.val(n.site),K.unbind("change"),K.change(function(){n.site=K.val(),main.arr_planilha[a]=n,r.remove(),e(a,n,!0)})}else H.text(null!=n.site?n.site:"");var X=$(r.find("[template-field='tel1']"));if(null!=n.telefone1&&n.telefone1.toString().length>15){c.addClass("bg-danger"),X.html('<span class="label label-danger">Estourou</span><br><div class="form-group"><input class="form-control edt_tel1" maxlenght="15" type="text"></div>');var Y=X.find(".edt_tel1");Y.val(n.telefone1),Y.unbind("change"),Y.change(function(){n.telefone1=Y.val(),main.arr_planilha[a]=n,r.remove(),e(a,n,!0)})}else X.text(null!=n.telefone1?n.telefone1:"");var Z=$(r.find("[template-field='tel2']"));if(null!=n.telefone2&&n.telefone2.toString().length>15){c.addClass("bg-danger"),Z.html('<span class="label label-danger">Estourou</span><br><div class="form-group"><input class="form-control edt_tel2" maxlenght="15" type="text"></div>');var aa=Z.find(".edt_tel2");aa.val(n.telefone2),aa.unbind("change"),aa.change(function(){n.telefone2=aa.val(),main.arr_planilha[a]=n,r.remove(),e(a,n,!0)})}else Z.text(null!=n.telefone2?n.telefone2:"");var ia=$(r.find("[template-field='tel3']"));if(null!=n.telefone3&&n.telefone3.toString().length>15){c.addClass("bg-danger"),ia.html('<span class="label label-danger">Estourou</span><br><div class="form-group"><input class="form-control edt_tel3" maxlenght="15" type="text"></div>');var ea=ia.find(".edt_tel3");ea.val(n.telefone3),ea.unbind("change"),ea.change(function(){n.telefone3=ea.val(),main.arr_planilha[a]=n,r.remove(),e(a,n,!0)})}else ia.text(null!=n.telefone3?n.telefone3:"");var na=$(r.find("[template-field='tel4']"));if(null!=n.telefone4&&n.telefone4.toString().length>15){c.addClass("bg-danger"),na.html('<span class="label label-danger">Estourou</span><br><div class="form-group"><input class="form-control edt_tel4" maxlenght="15" type="text"></div>');var oa=na.find(".edt_tel4");oa.val(n.telefone4),oa.unbind("change"),oa.change(function(){n.telefone4=oa.val(),main.arr_planilha[a]=n,r.remove(),e(a,n,!0)})}else na.text(null!=n.telefone4?n.telefone4:"");var la=$(r.find("[template-field='observacao']"));if(null!=n.observacoes&&n.observacoes.toString().length>500){c.addClass("bg-danger"),la.html('<span class="label label-danger">Estourou</span><br><div class="form-group"><textarea class="form-control edt_observacoes" maxlenght="500" rows="4" type="text"></textarea></div>');var ta=la.find(".edt_observacoes");ta.val(n.observacoes),ta.unbind("change"),ta.change(function(){n.observacoes=ta.val(),main.arr_planilha[a]=n,r.remove(),e(a,n,!0)})}else la.text(null!=n.observacoes?n.observacoes:"");c.hasClass("bg-danger")||c.hasClass("bg-warning")?(n.valida=!1,main.arr_planilha[a]=n):(n.valida=!0,main.arr_planilha[a]=n),o?a==$(".tab_listagem > tbody>tr.tr_prospect:not([template-row])").length?r.appendTo(main.tab_listagem):$(".tab_listagem > tbody>tr.tr_prospect:not([template-row])").eq(a).before(r):r.appendTo(main.tab_listagem)};$(main.arr_planilha).each(function(a,i){e(a,i)}),main.btn_confirmar.unbind("click"),main.btn_confirmar.click(function(){WS.post("prospect/salvar_importacao/",{prospects:JSON.stringify(main.arr_planilha)},function(a){alert_saved("Importação realizada com sucesso"),main.unload()},[main.btn_confirmar,main.btn_cancelar])})}};return Importar_Excel});