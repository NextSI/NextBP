define([],function(){return function(a){"use strict";var o=this;this.html_id=a,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.tipo=null,this.onclose=null,this.painel_detalhes=this.dialog.find(".painel_detalhes"),this.lbl_tab_seguranca=this.dialog.find(".lbl_tab_seguranca"),this.painel_seguranca=this.dialog.find(".painel_seguranca"),this.chk_controle_acessos=this.dialog.find(".chk_controle_acessos"),this.div_permissoes=this.dialog.find(".div_permissoes"),this.tab_permissoes=this.dialog.find(".tab_permissoes"),this.tab_permissoes_grupo=this.dialog.find(".tab_permissoes_grupo"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.btn_excluir=this.dialog.find(".btn_excluir"),this.btn_add_usuario=this.dialog.find(".btn_add_usuario"),this.btn_add_grupo=this.dialog.find(".btn_add_grupo"),this.div_descricao=this.dialog.find(".div_descricao"),this.edt_descricao=this.dialog.find(".edt_descricao"),this.grupos=new Object,this.grupos_array=new Array,this.usuarios=new Object,this.usuarios_array=new Array,this.assunto_id=null,this.permite_alterar_seguranca=!1,this.valor=null;let s=[];this.adicionarBotao=((a,o,s)=>({toolbar:"bottom",location:"center",widget:"dxButton",options:{text:a,hint:o,onClick:s}})),this.show=function(a,r){switch(o.tipo=r,void 0!==a&&a?(o.assunto_id=a,o.div_descricao.hide(),o.preencher()):(o.div_descricao.show(),o.permite_alterar()),o.tipo){case FORMULARIO.NOVO:case FORMULARIO.EDITAR:s.push(this.adicionarBotao("Salvar","Salvar",o.salvar));break;case FORMULARIO.EXCLUIR:s.push(this.adicionarBotao("Excluir","Excluir",o.excluir))}s.push(this.adicionarBotao("Cancelar","Cancelar",()=>o.unload())),alertaPopUp({titulo:"Segurança do Assunto",conteudo:(a,s)=>{setTimeout(()=>{o.popup=s,o.dialog.css("padding","0px"),a.replaceWith(o.dialog),o.dialog.closest(".dx-popup-content").css("padding","0px")})},largura:"calc(100% - 20px)",larguraMinima:"300px",larguraMaxima:"1200px",botaoConfirmarTexto:null,botaoConfirmarFuncao:null,arrBotoes:s})},this.close=function(){close_modal(o.modal.attr("id")),void 0!==o.onclose&&o.onclose&&o.onclose()},this.unload=function(){o.close(),View.unload(this.html_id),o.popup.hide()},this.permite_alterar=function(){var a=!1;switch(o.tipo){case FORMULARIO.NOVO:case FORMULARIO.EDITAR:o.btn_salvar.show(),o.btn_excluir.hide(),a=!0,o.valor=!0,o.permite_alterar_seguranca=!0;break;case FORMULARIO.VISUALIZAR:o.btn_salvar.hide(),o.btn_excluir.hide(),a=!1,o.valor=!1,o.permite_alterar_seguranca=!1;break;case FORMULARIO.EXCLUIR:o.btn_salvar.hide(),o.btn_excluir.show(),a=!1,o.valor=!1,o.permite_alterar_seguranca=!1}o.btn_add_grupo.prop("disabled",!a),o.btn_add_usuario.prop("disabled",!a),o.chk_controle_acessos.prop("disabled",!a)},this.preencher=function(){WS.get("assunto/objeto/",{assunto_id:o.assunto_id},function(a){o.permite_alterar(),o.usuarios_array=a.usuarios_permissoes,o.render_usuarios(),o.grupos_array=a.grupos_permissoes,o.render_grupos(),o.chk_controle_acessos.prop("checked",!0===a.controle_acessos).change()})},this.render_usuarios=function(){var a=o.tab_permissoes.find("tbody"),s=a.find("tr:first"),r=function(a,s,r){$(o.usuarios_array).each(function(e,i){i.usuario_id==r.usuario_id&&(o.usuarios=i,"visualizacao"==s?o.usuarios.visualizacao=a.prop("checked"):"download"==s?o.usuarios.download=a.prop("checked"):"exclusao"==s?o.usuarios.exclusao=a.prop("checked"):"escrita"==s?o.usuarios.escrita=a.prop("checked"):"manutencao_revisoes"==s?o.usuarios.manutencao_revisoes=a.prop("checked"):"seguranca"==s&&(o.usuarios.seguranca=a.prop("checked")),o.usuarios_array[e]=o.usuarios)})};o.tab_permissoes.find("tr:gt(1)").remove(),$(o.usuarios_array).each(function(e,i){!function(e){var i=s.clone();i.removeAttr("template-row"),i.css("display","");var c=$(i.find(".btn_usuario_remover"));i.find(".img_usuario"),i.find(".lbl_nome").text(e.nome);var t=i.find(".chk_visualizacao");t.attr("type","checkbox"),t.addClass("checkbox_bootstrap_toggle"),t.prop("checked",1==e.visualizacao);var n=i.find(".chk_download");n.attr("type","checkbox"),n.addClass("checkbox_bootstrap_toggle"),n.prop("checked",1==e.download);var u=i.find(".chk_escrita");u.attr("type","checkbox"),u.addClass("checkbox_bootstrap_toggle"),u.prop("checked",1==e.escrita);var d=i.find(".chk_exclusao");d.attr("type","checkbox"),d.addClass("checkbox_bootstrap_toggle"),d.prop("checked",1==e.exclusao);var l=i.find(".chk_manutencao_revisoes");l.attr("type","checkbox"),l.addClass("checkbox_bootstrap_toggle"),l.prop("checked",1==e.manutencao_revisoes);var p=i.find(".chk_seguranca");p.attr("type","checkbox"),p.addClass("checkbox_bootstrap_toggle"),p.prop("checked",1==e.seguranca),$(t).prop("disabled",!o.valor),$(n).prop("disabled",!o.valor),$(u).prop("disabled",!o.valor),$(d).prop("disabled",!o.valor),$(l).prop("disabled",!o.valor),$(p).prop("disabled",!o.valor),$(c).prop("disabled",!o.valor),t.change(function(){r(t,"visualizacao",e)}),n.change(function(){r(n,"download",e)}),u.change(function(){r(u,"escrita",e)}),d.change(function(){r(d,"exclusao",e)}),l.change(function(){r(l,"manutencao_revisoes",e)}),p.change(function(){r(p,"seguranca",e)}),c.unbind("click"),c.click(function(){alertaPopUp("Remover Usuário","Deseja remover o usuário?","Remover",function(){$(o.usuarios_array).each(function(a,s){s.usuario_id==e.usuario_id&&(i.remove(),o.usuarios_array.splice(a,1),o.render_usuarios())})},"Cancelar")}),i.appendTo(a)}(i)}),App.aplicar_checkbox(a)},this.render_grupos=function(){var a=o.tab_permissoes_grupo.find("tbody"),s=a.find("tr:first"),r=function(a,s,r){$(o.grupos_array).each(function(e,i){i.grupo_usuarios_id==r.grupo_usuarios_id&&(o.grupos=i,"visualizacao"==s?o.grupos.visualizacao=a.prop("checked"):"download"==s?o.grupos.download=a.prop("checked"):"exclusao"==s?o.grupos.exclusao=a.prop("checked"):"escrita"==s?o.grupos.escrita=a.prop("checked"):"manutencao_revisoes"==s?o.grupos.manutencao_revisoes=a.prop("checked"):"seguranca"==s&&(o.grupos.seguranca=a.prop("checked")),o.grupos_array[e]=o.grupos)})};o.tab_permissoes_grupo.find("tr:gt(1)").remove(),$(o.grupos_array).each(function(e,i){!function(e){var i=s.clone();i.removeAttr("template-row"),i.css("display",""),i.find(".lbl_nome").text(e.nome);var c=i.find(".chk_visualizacao");c.attr("type","checkbox"),c.addClass("checkbox_bootstrap_toggle"),c.prop("checked",1==e.visualizacao);var t=i.find(".chk_download");t.attr("type","checkbox"),t.addClass("checkbox_bootstrap_toggle"),t.prop("checked",1==e.download);var n=i.find(".chk_escrita");n.attr("type","checkbox"),n.addClass("checkbox_bootstrap_toggle"),n.prop("checked",1==e.escrita);var u=i.find(".chk_exclusao");u.attr("type","checkbox"),u.addClass("checkbox_bootstrap_toggle"),u.prop("checked",1==e.exclusao);var d=i.find(".chk_manutencao_revisoes");d.attr("type","checkbox"),d.addClass("checkbox_bootstrap_toggle"),d.prop("checked",1==e.manutencao_revisoes);var l=i.find(".chk_seguranca");l.attr("type","checkbox"),l.addClass("checkbox_bootstrap_toggle"),l.prop("checked",1==e.seguranca),$(c).prop("disabled",!o.valor),$(t).prop("disabled",!o.valor),$(n).prop("disabled",!o.valor),$(u).prop("disabled",!o.valor),$(d).prop("disabled",!o.valor),$(l).prop("disabled",!o.valor),$(p).prop("disabled",!o.valor),c.change(function(){r(c,"visualizacao",e)}),t.change(function(){r(t,"download",e)}),n.change(function(){r(n,"escrita",e)}),u.change(function(){r(u,"exclusao",e)}),d.change(function(){r(d,"manutencao_revisoes",e)}),l.change(function(){r(l,"seguranca",e)});var p=$(i.find(".btn_grupo_remover"));p.unbind("click"),p.click(function(){alertaPopUp("Remover Grupo","Deseja remover o grupo?","Remover",function(){$(o.grupos_array).each(function(a,s){s.grupo_usuarios_id==e.grupo_usuarios_id&&(i.remove(),o.grupos_array.splice(a,1),o.render_grupos())})},"Cancelar")}),i.appendTo(a)}(i)}),App.aplicar_checkbox(a)},this.salvar=(()=>{WS.post("assunto/salvar",{assunto_id:o.assunto_id,descricao:o.edt_descricao.val(),usuarios_permissoes:JSON.stringify(o.usuarios_array),grupos_permissoes:JSON.stringify(o.grupos_array),controle_acessos:o.chk_controle_acessos.prop("checked")},function(a){o.assunto_id=a.id,alert_saved(a.descricao+" salvo com sucesso"),o.unload()},[o.btn_cancelar,o.btn_excluir,o.btn_salvar])}),this.excluir=(()=>{WS.post("assunto/excluir",{assunto_id:o.assunto_id},function(a){alert_saved(a.descricao+" excluido com sucesso"),o.unload()},[o.btn_cancelar,o.btn_excluir,o.btn_salvar])}),this.chk_controle_acessos.change(function(){$(this).prop("checked")?o.div_permissoes.fadeIn():(o.div_permissoes.fadeOut(),o.usuarios_array=[],o.grupos_array=[],o.tab_permissoes.find("tr:gt(1)").remove(),o.tab_permissoes_grupo.find("tr:gt(1)").remove())}),this.btn_add_usuario.unbind("click"),this.btn_add_usuario.click(function(){View.load("usuario/selecionar",function(a,s){s.show(function(a){var s=!1;$(o.usuarios_array).each(function(o,r){r.usuario_id==a.usuario_id&&(s=!0)}),s||(o.usuarios=a,o.usuarios.visualizacao=!1,o.usuarios.download=!1,o.usuarios.escrita=!1,o.usuarios.exclusao=!1,o.usuarios.manutencao_revisoes=!1,o.usuarios.seguranca=!1,o.usuarios_array.push(o.usuarios)),o.render_usuarios(o.usuarios_array)})})}),this.btn_add_grupo.unbind("click"),this.btn_add_grupo.click(function(){View.load("grupo_usuarios/selecionar",function(a,s){s.show(function(a){var s=!1;$(o.grupos_array).each(function(o,r){r.grupo_usuarios_id==a.grupo_usuarios_id&&(s=!0)}),s||(o.grupos=a,o.grupos.visualizacao=!1,o.grupos.download=!1,o.grupos.escrita=!1,o.grupos.exclusao=!1,o.grupos.manutencao_revisoes=!1,o.grupos.seguranca=!1,o.grupos_array.push(o.grupos)),o.render_grupos(o.grupos_array)},MODULOS.DOCUMENTO)})})}});