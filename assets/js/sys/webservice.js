var valid_licenca_exibindo=!1;function ajaxError(e,a,o){var t,n="",r=(t=document.createElement("div"),function(e){return e&&"string"==typeof e&&(e=(e=e.replace(/<script[^>]*>([\S\s]*?)<\/script>/gim,"")).replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gim,""),t.innerHTML=e,e=t.textContent,t.textContent=""),e});void 0!==e.ignore_error&&0!=e.ignore_error&&"object"!=typeof e.ignore_error||(0===e.status&&"abort"!==a?"GET"==this.type.toUpperCase()&&try_again(this)||alert_modal_internet():404==e.status?alert_modal_404():500==e.status||203==e.status?e.responseJSON.validation?response_validation(e.responseJSON):alert_modal_500():503==e.status?"GET"==this.type.toUpperCase()&&try_again(this)||alert_modal_503():"parsererror"===a?(n="Ocorreu uma falha na operação.<br>",n+="Response Text: <pre>"+r(e.responseText)+"</pre>",alert_modal("JSON parse failed",n)):"timeout"===a?"GET"==this.type.toUpperCase()&&try_again(this)||alert_modal_timeout():"abort"===a||(n+="Status: "+a,n+="<br>",n+=o,n+="<br>","Next Business Process"===r(e.responseText).substring(0,21)?n+="Servidor não encontrado. Houve algum bloqueio de acesso ao servidor. Tente novamente.":n+="Response Text: <pre>"+r(e.responseText)+"</pre>",alert_modal("Ajax Error",n)))}function try_again(e){return e.tryCount++,e.tryCount<=e.retryLimit&&(setTimeout(function(){$.ajax(e)},2e3),!0)}function response_validation(e,a){if(e&&e.validation){$(".dx-loadpanel-content").hide();var o=new Validation;if(e.validation.messages){for(var t=0;t<e.validation.messages.length;t++)if(2==e.validation.messages[t].code){if(App.sessao_expirada||!App.sessao||App.sessao.sessao_login_anonimo)if(!App.sessao_anonima_expirada&&App.sessao&&App.sessao.sessao_login_anonimo){App.sessao_anonima_expirada=!0,WS.token=null;DevExpress.ui.dialog.custom({title:"Aviso",messageHtml:"Sua sessão expirou ou ocorreu alguma falha. Você será retornado à tela de autenticação.",buttons:[{text:"Ok",onClick:function(e){App.logout_anonimo()}}]}).show()}else console.log(new ValidationMessage(e.validation.messages[t].code,e.validation.messages[t].message));else App.sessao_expirada=!0,WS.token=null,View.load("login/sessao_expirada",function(e,a){a.show()});void 0!==a&&a||(a=function(){})}else{if(10==e.validation.messages[t].code)return o.add(new ValidationMessage(e.validation.messages[t].code,e.validation.messages[t].message)),a=function(){valid_licenca_exibindo=!1},valid_licenca_exibindo||(valid_licenca_exibindo=!0,alert_modal(App.lang?App.lang.msg_padrao.validacao:"",o,"Ok",a)),!1;o.add(new ValidationMessage(e.validation.messages[t].code,e.validation.messages[t].message))}o.is_valid()||alert_modal(App.lang?App.lang.msg_padrao.validacao:"",o,"Ok",a)}return!1}return!0}function getScriptError(e,a,o){var t="";t+="Script Exception: ",t+="<br>",t+="<pre>"+o.stack+"</pre>",alert_modal("Ajax Error",t)}var WS=function(){WS.TYPE={POST:"post",GET:"get"},WS.token=null,WS.arr_xhr=[],WS.abort_request=function(e,a,o){if(WS.arr_xhr.length>0)for(var t=0;t<WS.arr_xhr.length;t++){var n=WS.arr_xhr[t];n.html_id==e&&n.route==a&&(o||n.obj_xhr.abort(),WS.arr_xhr.splice(t,1))}},WS.abort_requests=function(){if(WS.arr_xhr.length>0){for(var e=0;e<WS.arr_xhr.length;e++){WS.arr_xhr[e].obj_xhr.abort()}WS.arr_xhr=[]}},WS.dxHeaders=function(){var e={"X-Auth-Token":WS.token};return void 0!==App.temp.empresa&&(e["X-Emp"]=App.temp.empresa),App.idioma&&(e["X-Lang"]=App.idioma),e},WS.request=function(e,a,o,t,n,r,s,i,l,d,p){var u={route:e,type:a,data:o,func_response:t,disable_buttons:n,final_route:r,data_files:s,ignore_error:void 0!==i&&i,func_fail:void 0!==p?p:null,html_id:d};"object"==typeof e&&((u=e).type||(u.type=a)),WS.abort_request(u.html_id,u.route),$.ajaxSetup({cache:!1});let c={};void 0!==u.data&&u.data&&(c={...u.data});let _=[];App.sessao&&App.sessao.dados&&!0===App.sessao.dados.ws_params_base64&&(Object.keys(c).forEach(e=>{"string"==typeof c[e]&&c[e]&&(_.push(e),c[e]=cripto(c[e]))}),_.length>0&&(c._ws_params_base64=_.join(",")));var m=WS_URI;void 0!==u.final_route&&1==u.final_route&&(m=""),void 0!==u.data_files&&u.data_files||(u.data_files=!1),void 0!==u.disable_buttons&&u.disable_buttons||(u.disable_buttons=[]);var f=null,v=[];WS.token&&(v.push({nome:"X-Auth-Token",valor:WS.token}),void 0!==App.temp.empresa&&v.push({nome:"X-Emp",valor:App.temp.empresa}),v.push({nome:"X-View-Code",valor:View.get_id_tela_ativa()?View.get_id_tela_ativa():null}),App.idioma&&v.push({nome:"X-Lang",valor:App.idioma}),!0===WS.login_anonimo&&v.push({nome:"X-Login-Anonimo",valor:!0})),v.length>0&&(f=function(o){o.url=e,o.request_type=a,o.ignore_error=u.ignore_error;for(var t=0;t<v.length;t++)o.setRequestHeader(v[t].nome,v[t].valor)}),$(u.disable_buttons).each(function(e,a){void 0===a?alert("Validação Botão não encontrado"):(a.addClass("disabled").css("pointer-events","none"),a.hasClass("select-multi-column")&&(a.parent().find(".edt_combobox").prop("readonly",!0),a.parent().find(".btn").addClass("disable").css("pointer-events","none")))});var g=new FormData,h=!0,b="application/x-www-form-urlencoded; charset=UTF-8";if(!0===u.data_files){h=!1,b=!1;for(var S=Object.keys(c),x=0;x<S.length;x++)if(void 0!==c[S[x]]&&null!=c[S[x]]&&c[S[x]][0]&&c[S[x]][0].size)for(var y=0;y<c[S[x]].length;y++)g.append(S[x]+"[]",c[S[x]][y]);else g.append(S[x],c[S[x]])}else if(Array.isArray(u.data_files)){h=!1,b=!1;for(S=Object.keys(c),x=0;x<S.length;x++){var W=c[S[x]];"object"==typeof W&&(W=window.CircularJSON.stringify(W)),g.append(S[x],W)}u.data_files.forEach(e=>{const a=e.split("."),o=a[0],t=a[1];for(var n=0;n<S.length;n++)if(S[n]==o){const e=c[o];for(var r=0;r<e.length;r++)e[r]&&e[r].data&&"object"==typeof e[r].data[t]?g.append(o+"__"+r+"__"+t,e[r].data[t].arquivoSelecionado):e[r]&&e[r].oldData&&"object"==typeof e[r].oldData[t]&&g.append(o+"__"+r+"__"+t,e[r].oldData[t].arquivoSelecionado)}})}var w={html_id:u.html_id,route:u.route,obj_xhr:null};w.obj_xhr=$.ajax({xhrFields:{withCredentials:XHR_WITH_CREDENTIALS},beforeSend:f,error:ajaxError,type:u.type,url:m+u.route,data:u.data_files?g:c,dataType:"json",cache:!1,processData:h,contentType:b,tryCount:0,retryLimit:3,xhr:function(){var e=new window.XMLHttpRequest;return e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var a=e.loaded/e.total;a=parseInt(100*a),l&&void 0!==l&&l(a)}},!1),e},complete:function(e,a){!u.func_fail||500!=e.status&&203!=e.status||u.func_fail(a),$(u.disable_buttons).each(function(e,a){a.removeClass("disabled").css("pointer-events","all"),a.hasClass("select-multi-column")&&(a.parent().find(".edt_combobox").prop("readonly",!1),a.parent().find(".btn").removeClass("disable").css("pointer-events","all"))})},success:function(p){response_validation(p,function(){u.func_fail&&u.func_fail(p)})&&u.func_response(p),App.sessao_expirada&&App.fila.push({route:e,type:a,data:o,func_response:t,disable_buttons:n,final_route:r,data_files:s,ignore_error:i,uploadProgress:l,html_id:d}),WS.abort_request(u.html_id,u.route,!0)}}),void 0!==w.html_id&&WS.arr_xhr.push(w)},WS.get=function(e,a,o,t,n,r,s,i,l,d){let p={};if("object"==typeof e&&(p=e),d||p.awaitReturn){let o=new Promise(function(o,d){var u=function(e){o(e)};"object"==typeof e&&(p.func_response=u),WS.request(e,WS.TYPE.GET,a,u,t,n,null,r,s,i,l)});return o}WS.request(e,WS.TYPE.GET,a,o,t,n,null,r,s,i,l)},WS.post=function(e,a,o,t,n,r,s,i,l,d,p){if(p){return new Promise(function(o,p){WS.request(e,WS.TYPE.POST,a,function(e){o(e)},t,n,r,s,i,l,d)})}WS.request(e,WS.TYPE.POST,a,o,t,n,r,s,i,l,d)},WS.asyncGet=async function(e,a,o,t,n,r,s,i,l){return await WS.get(e,a,o,t,n,r,s,i,l,!0)},WS.asyncPost=async function(e,a,o,t,n,r,s,i,l,d){return await WS.post(e,a,o,t,n,r,s,i,l,d,!0)}},WS_pg_files=function(){WS_pg_files.post=function(e,a,o,t,n){var r=[],s=[],i=[];t&&$(n).each(function(e,a){i.push(a),a.addClass("disabled")});$.each(a.documentos,function(i,l){var d=null;"string"==typeof l?d=JSON.parse(l):"object"==typeof l&&(d=l);var p=d.name+"_"+i,u=d.mimeType,c=u.split("/")[0],_=u.split("/")[1],m=!1,f="";p.indexOf(".")>-1&&(m=!0,f=p.substring(p.lastIndexOf(".")).indexOf("_")>-1?p.substring(p.lastIndexOf(".")).split("_")[0]:p.substring(p.lastIndexOf("."))),p="image"===c?"image_"+md5(p)+(!1===m?"jpeg"===_?".jpg":".png":f):"video"===c?"video_"+md5(p)+(!1===m?"mp4"===_?".mp4":"ogg"===_?".ogv":"avi"===_||"msvideo"===_||"x-msvideo"===_?".avi":"quicktime"===_?".mov":"mpeg"===_?".mpeg":".wmv":f):"audio"===c?"audio_"+md5(p)+(!1===m?"mp3"===_?".mp3":"amr"===_?".amr":"wav":f):"text"===c?"docs_"+md5(p)+(!1===m?"plain"===_?".txt":"html"===_?".html":".doc":f):_.indexOf("excel")>-1?"sheets_"+md5(p)+(!1===m?"excel"===_?".xls":".csv":f):_.indexOf("powerpoint")>-1?"slide_"+md5(p)+(!1===m?(_.indexOf("powerpoint"),".ppt"):f):"pdf"===_?"pdf_"+md5(p)+(!1===m?".pdf":f):"file_"+md5(p)+(!1===m?".":f);var v=new FileUploadOptions;v.fileKey=a.optionsFileKey,v.fileName=p,r.push(p),v.mimeType=d.mimeType,v.chunkedMode=!0;var g={};for(var h in a)"optionsFileKey"!=h&&"documentos"!=h&&(g[h]=a[h]);l.id&&(g.arquivo_id=l.id);var b=new FileTransfer;v.params=g,b.upload(d.localURL,encodeURI(WS_URI+e),function(e){s.push("carregado"),timer=setTimeout(function(){var e,i=s.length,l=a.documentos.length;i<=a.documentos.length&&(e=100*i/l,navigator.notification.progressValue(e)),100==e&&navigator.notification.progressStop(),a.documentos.length===s.length&&(t&&$(n).each(function(e,a){a.removeClass("disabled")}),o('{ "result": "success" , "returnValue": "'+r.join()+'" }'),clearTimeout(timer))},300)},function(e){console.log(e),alert("Upload com falha! "),"1"===e.code&&alert("Erro no servidor. CODE: 404"),"5"===e.code&&alert("Error ao enviar o arquivo. CODE:"+e.code,e)},v)})}};new WS,new WS_pg_files;