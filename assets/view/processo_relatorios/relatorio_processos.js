define([],function(){return function(o){"use strict";var e=this;this.html_id=o,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.onselect=null,this.onclose=null,this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_excel=this.dialog.find(".btn_excel"),this.cbo_processo=this.dialog.find(".cbo_processo"),this.btn_refresh_cbo_processo=this.dialog.find(".btn_refresh_cbo_processo"),this.cbo_versao=this.dialog.find(".cbo_versao"),this.btn_refresh_cbo_versao=this.dialog.find(".btn_refresh_cbo_versao"),this.cbo_atividades=this.dialog.find(".cbo_atividades"),this.cbo_campos=this.dialog.find(".cbo_campos"),this.div_versao_processo=this.dialog.find(".div_versao_processo"),this.table_condicao_integracao=this.dialog.find(".table_condicao_integracao"),this.btn_add_filtro=this.dialog.find(".btn_add_filtro"),this.btn_excluir_condicao=this.dialog.find(".btn_excluir_condicao"),this.processo_id=null,this.versao_processo_id=null,this.atividades=null,this.campos=null,this.grupos_versao_processo=null,this.campos_versao_processo=new Array,this.filtros_personalizados=new Array,this.show=function(){show_modal(e.modal.attr("id")),e.listar_processos()},this.close=function(){close_modal(e.modal.attr("id")),void 0!==e.onclose&&e.onclose&&e.onclose()},this.unload=function(){e.close(),View.unload(this.html_id)},this.listar_processos=function(){WS.get(App.sessao.dados.admin?"processo/listar/":"processo/listar_processos_supervisionados/",null,function(o){e.cbo_processo.find("option").remove();for(var s=0,i=o.length;s<i;s++){var a=o[s];add_option(e.cbo_processo,a.processo_id,a.nome)}e.cbo_processo.selectpicker("refresh")})},e.cbo_processo.change(function(o){var s=$(this);""!=s.val()&&(e.processo_id=s.val(),e.listar_versoes())}),this.btn_refresh_cbo_processo.unbind("click"),this.btn_refresh_cbo_processo.click(function(){e.listar_processos(),e.cbo_versao.find("option").remove(),e.cbo_versao.selectpicker("refresh")}),this.listar_versoes=function(){e.versao_processo_id=null,e.listar_atividade_campos(),WS.get("processo/listar_versoes/",{processo_id:e.processo_id,tipo_versao:VERSAO_PROCESSO_TIPO_VERSAO.AUTOMACAO},function(o){e.cbo_versao.find("option").remove();for(var s=0,i=o.length;s<i;s++){var a=o[s];add_option(e.cbo_versao,a.versao_processo_id,"Versão "+a.sequencia+" -  Publicação: "+a.publicacao.format_date_time())}e.cbo_versao.selectpicker({countSelectedText:function(o,e){return o+" versões selecionadas"}}),e.cbo_versao.selectpicker("refresh")})},e.cbo_versao.change(function(o){var s=$(this);""!=s.val()&&(e.versao_processo_id=s.val(),e.listar_atividade_campos())}),this.btn_refresh_cbo_versao.unbind("click"),this.btn_refresh_cbo_versao.click(function(){e.listar_versoes()}),this.listar_atividade_campos=function(){WS.get("processo/listar_atividade_campos/",{versao_processo_id:JSON.stringify(e.versao_processo_id)},function(o){if(null!=o){e.atividades=null,e.campos=null,e.campos_versao_processo.solicitacao_id={tipo_campo:window.ELEMENTO_TIPO.INTEIRO,nome_campo:"Nº solicitação"},e.campos_versao_processo.data_solicitacao={tipo_campo:window.ELEMENTO_TIPO.DATA,nome_campo:"Data solicitação"},e.campos_versao_processo.usuario_solicitacao_nome={tipo_campo:window.ELEMENTO_TIPO.TEXTO,nome_campo:"Solicitante"},e.campos_versao_processo.atividade_descricao={tipo_campo:window.ELEMENTO_TIPO.TEXTO,nome_campo:"Nome da atividade"},e.campos_versao_processo.data_etapa={tipo_campo:window.ELEMENTO_TIPO.DATA,nome_campo:"Data criação da atividade"},e.campos_versao_processo.data_aprovacao_etapa={tipo_campo:window.ELEMENTO_TIPO.DATA,nome_campo:"Data entrega da atividade"},e.campos_versao_processo.data_retorno_etapa={tipo_campo:window.ELEMENTO_TIPO.DATA,nome_campo:"Data retorno da atividade"},e.campos_versao_processo.retorno_motivo={tipo_campo:window.ELEMENTO_TIPO.TEXTO,nome_campo:"Motivo do retorno"},e.campos_versao_processo.usuario_grupos_responsavel_atividade={tipo_campo:window.ELEMENTO_TIPO.TEXTO,nome_campo:"Responsável"},e.campos_versao_processo.situacao={tipo_campo:window.ELEMENTO_TIPO.OPCOES,nome_campo:"Situação da Atividade"},e.cbo_atividades.children().remove();for(var s=0;s<o.atividades.length;s++){var i=o.atividades[s];add_option(e.cbo_atividades,i.id,i.descricao)}e.cbo_atividades.selectpicker({countSelectedText:function(o,e){return o+" atividades selecionadas"}}),e.cbo_atividades.selectpicker("refresh"),e.cbo_campos.children().remove(),e.grupos_versao_processo=o.grupos;for(s=0;s<o.grupos.length;s++){var a=JSON.parse(o.grupos[s].elementos);e.cbo_campos.add_group_opt("optgrp_"+o.grupos[s].formulario_grupo_id,o.grupos[s].nome,80);for(var t=0;t<a.length;t++){var c=a[t];e.cbo_campos.add_opt_to_group("optgrp_"+o.grupos[s].formulario_grupo_id,c.elem_key+" - "+c.nome,c.nome,"","",80),c.tipo!=ELEMENTO_TIPO.TEXTO&&c.tipo!=ELEMENTO_TIPO.OPCOES&&c.tipo!=ELEMENTO_TIPO.MASCARA&&c.tipo!=ELEMENTO_TIPO.INTEIRO&&c.tipo!=ELEMENTO_TIPO.DECIMAL&&c.tipo!=ELEMENTO_TIPO.DATA&&c.tipo!=ELEMENTO_TIPO.INTEGRACAO||(e.campos_versao_processo[c.elem_key+" - "+c.nome]={tipo_campo:c.tipo,nome_campo:c.nome})}}e.cbo_campos.selectpicker({countSelectedText:function(o,e){return o+" campos selecionados"}}),e.cbo_campos.selectpicker("refresh"),e.div_versao_processo.removeClass("hidden")}})},this.adicionar_filtro=function(){var o=e.table_condicao_integracao.find("tbody"),s=$(o.find("[template-row]")),i=function(o){for(var s in o.children().remove(),e.campos_versao_processo)e.campos_versao_processo.hasOwnProperty(s)&&add_option(o,s,e.campos_versao_processo[s].nome_campo)};!function(){let a=s.clone();a.addClass("rows").css("display","").removeAttr("template-row");let t=$(a.find(".cbo_campos_filtro")),c=$(a.find(".cbo_expressao")),r=$(a.find(".edt_filtro")),_=$(a).find(".edt_filtro_situacao");i(t),t.addClass("selectpicker").selectpicker("refresh"),t.change(function(){!function(o,e,s,i){o.children().remove(),s.removeAttr("type"),add_option(o,"","Selecione","selected"),add_option(o,"0","Igual A"),add_option(o,"1","Diferente De");let a=[window.ELEMENTO_TIPO.TEXTO,window.ELEMENTO_TIPO.MASCARA],t=[window.ELEMENTO_TIPO.DATA],c=[window.ELEMENTO_TIPO.INTEIRO,window.ELEMENTO_TIPO.DECIMAL,window.ELEMENTO_TIPO.DATA],r=[window.ELEMENTO_TIPO.OPCOES];s.removeClass("hidden"),i.closest(".div_filtro_situacao").addClass("hidden"),a.includes(e.tipo_campo)?(add_option(o,"6","Contem o Trecho"),s.attr("type","text")):t.includes(e.tipo_campo)||c.includes(e.tipo_campo)?(add_option(o,"2","Maior Que"),add_option(o,"3","Menor Que"),add_option(o,"4","Maior ou Igual A"),add_option(o,"5","Menor ou Igual A"),t.includes(e.tipo_campo)?s.attr("type","date"):s.attr("type","number")):r.includes(e.tipo_campo)&&(s.addClass("hidden"),i.closest(".div_filtro_situacao").removeClass("hidden"))}(c,e.campos_versao_processo[t.val()],r,_),c.addClass("selectpicker").selectpicker("refresh"),_.addClass("selectpicker").selectpicker("refresh")});let n=$(a.find(".btn_excluir_condicao"));n.unbind("click"),n.click(function(){i(t),a.remove()}),e.cbo_processo.change(function(){a.remove()}),e.cbo_versao.change(function(){a.remove()}),a.appendTo(o)}()},e.cbo_atividades.change(function(o){var s=$(this);if(""!=s.val()){var i=[];$(s.val()).each(function(o,e){$(e.split(",")).each(function(o,e){i.push(e)})}),e.atividades=i}}),this.btn_add_filtro.unbind("click"),this.btn_add_filtro.click(function(){e.adicionar_filtro()}),e.cbo_campos.change(function(o){var s=$(this);""!=s.val()&&(e.campos=s.val())}),this.btn_excel.unbind("click"),this.btn_excel.click(function(){let o=clone_obj(e.campos),s=e.table_condicao_integracao.find(".rows");e.filtros_personalizados=[];for(let o=0,i=s.length;o<i;o++){let i=s[o],a=$(i).find(".cbo_campos_filtro").find("select").val(),t=$(i).find(".edt_filtro").val(),c=$(i).find(".edt_filtro_situacao").find("select").val();e.filtros_personalizados[o]={cbo_campos_filtro:a,cbo_expressao:$(i).find(".cbo_expressao").find("select").val(),edt_filtro:"situacao"===a?c:t}}return null!=o&&(o.push("solicitacao_id"),o.push("data_solicitacao"),o.push("usuario_solicitacao_nome"),o.push("atividade_descricao"),o.push("data_etapa"),o.push("usuario_grupos_responsavel_atividade"),o.push("entrega")),e.processo_id?e.versao_processo_id?e.atividades?void App.obter_token_publico(function(s){let i={processo_id:e.processo_id,versao_processo_id:e.versao_processo_id,atividades:e.atividades,campos:o,filtros_personalizados:e.filtros_personalizados,token_publico:s},a=Date.now();WS.post("parametro_usuario/set/",{nome:"relatorio_processos_"+a,valor:JSON.stringify(i)},function(o){App.download(WS_URI+"processo/gerar_excel_dados_processo/?token_publico="+s+"&ts="+a)})}):(alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',"Informe quais atividades deseja exportar"),!1):(alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',"Informe a Versão do Processo"),!1):(alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',"Informe o Processo"),!1)}),this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){e.unload()})}});