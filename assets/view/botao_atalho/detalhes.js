define([],function(){return function(o){"use strict";var a=this;this.html_id=o,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.tipo=null,this.onclose=null,this.onsave=null,this.edt_nome=this.dialog.find(".edt_nome"),this.cbo_tela=this.dialog.find(".cbo_tela"),this.btn_add_option=this.dialog.find(".btn_add_option"),this.tbl_opcoes=this.dialog.find(".tbl_opcoes"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.btn_excluir=this.dialog.find(".btn_excluir"),this.opcoes_salvas=[],this.count=null,this.valor=!1,this.botao_atalho={botao_atalho_id:null,excluido:"N",nome:null,codigo_tela:null,opcoes:new Array},this.show=function(o,e,t){switch(a.botao_atalho.botao_atalho_id=t,e){case FORMULARIO.NOVO:case FORMULARIO.EDITAR:a.btn_salvar.show(),a.btn_excluir.hide(),a.permite_alterar(!0);break;case FORMULARIO.VISUALIZAR:a.btn_salvar.hide(),a.btn_excluir.hide(),a.permite_alterar(!1);break;case FORMULARIO.EXCLUIR:a.btn_salvar.hide(),a.btn_excluir.show(),a.permite_alterar(!1)}a.tipo=e,void 0!==o&&o?(a.botao_atalho=o,a.preencher()):a.listar_telas(),show_modal(a.modal.attr("id")),set_focus(a.edt_nome)},this.carrega_opcoes=function(o,e,t,i){OPTIONS.NOVA_SOLICITACAO_PROCESSO.codigo==e&&WS.get("processo/listar/",null,function(e){o.find("option").remove(),add_option(o,"","Selecione","selected"),$(e).each(function(a,e){add_option(o,e.processo_id,e.nome)}),o.change(function(){a.opcoes_salvas[i].valor=$(this).val()}),t&&o.val(t).trigger("change"),o.selectpicker("refresh")}),OPTIONS.FILTRO_CLIENTE.codigo==e&&WS.get("cliente/listar/",null,function(e){o.find("option").remove(),add_option(o,"","Selecione","selected"),$(e).each(function(a,e){add_option(o,e.cliente_id,e.nome_fantasia)}),o.change(function(){a.opcoes_salvas[i].valor=$(this).val()}),t&&o.val(t).trigger("change"),o.selectpicker("refresh")}),OPTIONS.FILTRO_SOLICITANTE.codigo==e&&WS.get("usuario/listar/",null,function(e){o.find("option").remove(),add_option(o,"","Selecione","selected"),$(e).each(function(a,e){add_option(o,e.usuario_id,e.nome)}),o.change(function(){a.opcoes_salvas[i].valor=$(this).val()}),t&&o.val(t).trigger("change"),o.selectpicker("refresh")}),OPTIONS.FILTRO_RESPONSAVEL.codigo==e&&WS.get("usuario/listar/",null,function(e){o.find("option").remove(),add_option(o,"","Selecione","selected"),$(e).each(function(a,e){add_option(o,e.usuario_id,e.nome)}),o.change(function(){a.opcoes_salvas[i].valor=$(this).val()}),t&&o.val(t).trigger("change"),o.selectpicker("refresh")}),OPTIONS.ABERTURA_CHAMADO_MOTIVO.codigo==e&&WS.get("chamado_motivo/listar/",null,function(e){o.find("option").remove(),add_option(o,"","Selecione","selected"),$(e).each(function(a,e){add_option(o,e.chamado_motivo_id,e.nome)}),o.change(function(){a.opcoes_salvas[i].valor=$(this).val()}),t&&o.val(t).trigger("change"),o.selectpicker("refresh")})},this.listar_telas=function(o){for(var e in a.cbo_tela.find("option").remove(),add_option(a.cbo_tela,"","Selecione a tela","selected"),TELAS){var t=TELAS[e];t.tipo==MODULOS.CHAMADO?add_option(a.cbo_tela.find(".opt_chamado"),t.codigo,t.nome):t.tipo==MODULOS.PROCESSO?add_option(a.cbo_tela.find(".opt_processo"),t.codigo,t.nome):t.tipo==MODULOS.DOCUMENTO&&add_option(a.cbo_tela.find(".opt_documento"),t.codigo,t.nome)}o&&a.cbo_tela.val(o).trigger("change"),a.cbo_tela.selectpicker("refresh")},this.listar_options=function(o){a.count--;var e=a.tbl_opcoes.find("tbody"),t=e.find("tr:first");a.tbl_opcoes.find("tr:gt(1)").remove(),$(a.opcoes_salvas).each(function(i,n){!function(i,n){var l=t.clone();l.removeAttr("template-row"),l.css("display","");var c=$(l.find('[template-select="cbo_opcoes"]'));add_option(c,"","Selecione as opções","selected");for(var s=0;s<o.length;s++){var d=o[s];add_option(c,d.codigo,d.nome)}c.selectpicker("refresh");var r=$(l.find('[template-select="cbo_valor"]'));c.change(function(){a.carrega_opcoes(r,$(this).val(),n.valor,i),a.opcoes_salvas[i].codigo_opcao=$(this).val()}),n.codigo_opcao>0&&c.val(n.codigo_opcao).trigger("change");var _=$(l.find(".btn_remover"));_.unbind("click"),_.click(function(){a.opcoes_salvas.splice(1,i),l.remove()}),_.prop("disabled",!a.valor),c.prop("disabled",!a.valor),r.prop("disabled",!a.valor),l.appendTo(e)}(i,n)})},this.close=function(){close_modal(a.modal.attr("id")),void 0!==a.onclose&&a.onclose&&a.onclose()},this.unload=function(){a.close(),View.unload(this.html_id)},this.permite_alterar=function(o){a.valor=o,a.edt_nome.prop("readonly",!o),a.cbo_tela.prop("disabled",!o),a.btn_add_option.prop("disabled",!o)},this.preencher=function(){a.edt_nome.val(a.botao_atalho.nome),a.listar_telas(a.botao_atalho.codigo_tela),a.opcoes_salvas=a.botao_atalho.opcoes;var o=[];for(var e in OPTIONS)for(var t=OPTIONS[e],i=t.codigo_tela.length-1;i>=0;i--){var n=t.codigo_tela[i];if(n==a.cbo_tela.val())if("number"==typeof t.codigo&&"string"==typeof t.nome)o.push(t);else for(e=0;e<t.codigo.length;e++){var l={codigo:t.codigo[e],nome:t.nome[e],codigo_tela:n};o.push(l)}}a.count=null==a.count?0==o.length?null:o.length:a.count,a.count>0&&a.listar_options(o)},this.validar_botao=function(o){var a=new Validation,e=!1;return null!=o.nome&&""!=o.nome||(e=!0,a.add(new ValidationMessage(Validation.CODES.ERR_FIELD,"Informe o Nome do Botão."))),0!=o.codigo_tela&&""!=o.codigo_tela&&null!=o.codigo_tela||(e=!0,a.add(new ValidationMessage(Validation.CODES.ERR_FIELD,"Informe a Tela do Sistema."))),!0===e&&alert_modal("Validação",a),e},this.cbo_tela.unbind("change"),this.cbo_tela.change(function(){a.count=null,a.opcoes_salvas=[],a.tbl_opcoes.find("tr:gt(1)").remove()}),this.btn_add_option.unbind("click"),this.btn_add_option.click(function(){var o={codigo_opcao:null,codigo_tela:null,valor:null};a.opcoes_salvas.push(o);var e,t=[];for(var i in OPTIONS)for(var n=OPTIONS[i],l=n.codigo_tela.length-1;l>=0;l--){var c=n.codigo_tela[l];if(c==a.cbo_tela.val())if("number"==typeof n.codigo&&"string"==typeof n.nome)t.push(n);else for(i=0;i<n.codigo.length;i++){o={codigo:n.codigo[i],nome:n.nome[i],codigo_tela:c};t.push(o)}}if(a.count=null==a.count?0==t.length?null:t.length:a.count,!(a.count>0))return"number"==typeof a.count?((e=new Validation).add(new ValidationMessage(Validation.CODES.ERR_FIELD,"Não existem mais opções disponiveis!")),void alert_modal("Validação",e)):((e=new Validation).add(new ValidationMessage(Validation.CODES.ERR_FIELD,"Não existem opções!")),void alert_modal("Validação",e));a.listar_options(t)}),this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){a.unload()}),this.btn_salvar.unbind("click"),this.btn_salvar.click(function(){a.botao_atalho.nome=a.edt_nome.val(),a.botao_atalho.codigo_tela=a.cbo_tela.val(),a.botao_atalho.opcoes=a.opcoes_salvas,a.validar_botao(a.botao_atalho)||void 0!==a.onsave&&a.onsave&&(a.onsave(a.botao_atalho),alert_saved(a.botao_atalho.nome+" salvo com sucesso"),a.unload())}),this.btn_excluir.unbind("click"),this.btn_excluir.click(function(){a.botao_atalho.nome=a.edt_nome.val(),a.botao_atalho.codigo_tela=a.cbo_tela.val(),a.botao_atalho.opcoes=a.opcoes_salvas,a.botao_atalho.excluido="S",a.validar_botao(a.botao_atalho)||void 0!==a.onsave&&a.onsave&&(a.onsave(a.botao_atalho),alert_saved(a.botao_atalho.nome+" excluido com sucesso"),a.unload())})}});