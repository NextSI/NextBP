define(["react","react-dom","./../componentes_react/CboUsuarios","./../central_documentos/SelectPasta","./../componentes_react/CboAssunto","./../componentes_react/CboTipoDocumento"],function(o,i,a,s,t,e){return function(r){"use strict";var n=this;this.html_id=r,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.file_importacao_processo=this.dialog.find(".file_importacao_processo"),this.cbo_categoria_processos=this.dialog.find(".cbo_categoria_processos"),this.btn_categoria_processos_visualizar=this.dialog.find(".btn_categoria_processos_visualizar"),this.btn_categoria_processos_recarregar=this.dialog.find(".btn_categoria_processos_recarregar"),this.btn_categoria_processos_novo=this.dialog.find(".btn_categoria_processos_novo"),this.cbo_calendario_trabalho=this.dialog.find(".cbo_calendario_trabalho"),this.btn_calendario_trabalho_visualizar=this.dialog.find(".btn_calendario_trabalho_visualizar"),this.btn_calendario_trabalho_recarregar=this.dialog.find(".btn_calendario_trabalho_recarregar"),this.btn_calendario_trabalho_novo=this.dialog.find(".btn_calendario_trabalho_novo"),this.tab_listagem=this.dialog.find(".tab_listagem"),this.tab_listagem_anexo=this.dialog.find(".tab_listagem_anexo"),this.div_componente_usuario=this.dialog.find(".div_componente_usuario"),this.div_pasta=this.dialog.find(".div_pasta"),this.div_componente_pasta=this.dialog.find(".div_componente_pasta"),this.selectPasta=o.createElement(s,null,null),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.envolvidos=null,this.documento_pasta_id=null,this.anexos=null,this.show=function(){n.listar_categoria_processos(),n.listar_calendario_trabalho(),i.render(n.selectPasta,n.div_componente_pasta[0]),n.selectPasta.props.setDesabilitado(!1),show_modal(n.modal.attr("id"))},this.close=function(){close_modal(n.modal.attr("id")),void 0!==n.onclose&&n.onclose&&n.onclose()},this.listar_categoria_processos=function(o){n.cbo_categoria_processos.find("option").remove(),add_option(n.cbo_categoria_processos,"","Nenhum"),WS.get("categoria_processos/listar/",null,function(i){for(var a=0;a<i.length;a++){var s=i[a];add_option(n.cbo_categoria_processos,s.categoria_processos_id,s.nome)}o&&n.cbo_categoria_processos.val(o).trigger("change")})},this.listar_calendario_trabalho=function(o){n.cbo_calendario_trabalho.find("option").remove(),add_option(n.cbo_calendario_trabalho,"","Nenhum"),WS.get("calendario_trabalho/listar/",null,function(i){for(var a=0;a<i.length;a++){var s=i[a];add_option(n.cbo_calendario_trabalho,s.calendario_trabalho_id,s.nome)}o&&n.cbo_calendario_trabalho.val(o).trigger("change")})},this.render_anexos=function(){var a=n.tab_listagem_anexo.find("tbody"),s=a.find("tr:first");n.tab_listagem_anexo.find("tr:gt(1)").remove();n.anexos&&$(n.anexos).each(function(r,_){_.indice=r,function(r){var _=s.clone();_.removeAttr("template-row"),_.css("display","");var c=_.find("[template-field='assunto']");c.text(r.assunto_descricao?r.assunto_descricao:"Não informado"),c.attr("assunto_id",r.assunto_id),_.find('[template-field="campo"]').text(r.campo),_.find('[template-field="grupo"]').text(r.grupo),_.find("[template-field='tipo_documento']").text(r.tipo_documento_descricao?r.tipo_documento_descricao:"Não Informado");var u=_.find(".div_componente_tipo_documento"),d=o.createElement(e,null,null);i.render(d,u[0]),d.props.setParams({OnSelect:function(o){n.anexos=n.anexos.map(function(i,a){return r.indice==i.indice&&(i.tipo_documento_id_substituto=o.tipo_documento_id),i})}});var l=_.find(".div_componente_assunto"),p=o.createElement(t,null,null);i.render(p,l[0]),p.props.setParams({OnSelect:function(o){n.anexos=n.anexos.map(function(i,a){return r.indice==i.indice&&(i.assunto_id_substituto=o.assunto_id),i})}}),r.tipo_documento_id_sugerido&&d.props.setTipoDocumento({tipo_documento_id:r.tipo_documento_id_sugerido,nome:r.tipo_documento_nome_sugerido}),r.assunto_id_sugerido&&p.props.setAssunto({assunto_id:r.assunto_id_sugerido,descricao:r.assunto_descricao_sugerido}),_.appendTo(a)}(_)})},this.render_envolvidos=function(){var s=n.tab_listagem.find("tbody"),t=s.find("tr:first");n.tab_listagem.find("tr:gt(1)").remove();var e=function(e){var r=t.clone();r.removeAttr("template-row"),r.css("display","");var _=$(r.find("[template-field='nome']"));_.text(e.nome),_.attr("usuario_id",e.usuario_id);var c=$(r.find(".div_componente_usuario")),u=o.createElement(a,null,null);i.render(u,c[0]),u.props.setObjParam({EquipeInterna:!0,Clientes:!0,Fornecedores:!0,ExibirGrupos:!0,EmpresaId:App.temp.empresa}),e.usuario_id_sugestao?(u.props.setUsuario({usuario_id:e.usuario_id_sugestao,usuario_nome:e.nome_sugestao}),n.envolvidos.usuarios_envolvidos[e.usuario_id].usuario_id_substituto=e.usuario_id_sugestao):e.grupo_usuarios_id_sugestao&&(u.props.setUsuario({usuario_id:e.grupo_usuarios_id_sugestao,usuario_nome:e.grupo_usuarios_nome_sugestao}),n.envolvidos.grupo_usuarios_envolvidos[e.grupo_usuarios_id].grupo_usuarios_id_substituto=e.grupo_usuarios_id_sugestao);u.props.setFunctionSelect(function(){"usuarios"==u.props.UsuarioSelecionado.tipo||"usuario_cliente"==u.props.UsuarioSelecionado.tipo||"usuario_fornecedor"==u.props.UsuarioSelecionado.tipo?e.usuario_id?(delete n.envolvidos.usuarios_envolvidos[e.usuario_id].grupo_usuarios_id_substituto,n.envolvidos.usuarios_envolvidos[e.usuario_id].usuario_id_substituto=u.props.UsuarioSelecionado.id):e.grupo_usuarios_id&&(delete n.envolvidos.grupo_usuarios_envolvidos[e.grupo_usuarios_id].grupo_usuarios_id_substituto,n.envolvidos.grupo_usuarios_envolvidos[e.grupo_usuarios_id].usuario_id_substituto=u.props.UsuarioSelecionado.id):"grupo_usuarios"==u.props.UsuarioSelecionado.tipo&&(e.usuario_id?(delete n.envolvidos.usuarios_envolvidos[e.usuario_id].usuario_id_substituto,n.envolvidos.usuarios_envolvidos[e.usuario_id].grupo_usuarios_id_substituto=u.props.UsuarioSelecionado.id):e.grupo_usuarios_id&&(delete n.envolvidos.grupo_usuarios_envolvidos[e.grupo_usuarios_id].usuario_id_substituto,n.envolvidos.grupo_usuarios_envolvidos[e.grupo_usuarios_id].grupo_usuarios_id_substituto=u.props.UsuarioSelecionado.id))}),r.appendTo(s)};n.envolvidos&&(Object.keys(n.envolvidos.usuarios_envolvidos).map(function(o){e(n.envolvidos.usuarios_envolvidos[o])}),Object.keys(n.envolvidos.grupo_usuarios_envolvidos).map(function(o){e(n.envolvidos.grupo_usuarios_envolvidos[o])}))},this.btn_categoria_processos_visualizar.unbind("click"),this.btn_categoria_processos_visualizar.click(function(){""!=n.cbo_categoria_processos.val()&&View.load("categoria_processos/detalhes",function(o,i){i.show(n.cbo_categoria_processos.val(),FORMULARIO.VISUALIZAR)})}),this.btn_categoria_processos_recarregar.unbind("click"),this.btn_categoria_processos_recarregar.click(function(){n.listar_categoria_processos(n.cbo_categoria_processos.val())}),this.btn_categoria_processos_novo.unbind("click"),this.btn_categoria_processos_novo.click(function(){View.load("categoria_processos/detalhes",function(o,i){i.onclose=function(){i.categoria_processos_id&&n.listar_categoria_processos(i.categoria_processos_id)},i.show(null,FORMULARIO.NOVO)})}),this.btn_calendario_trabalho_visualizar.unbind("click"),this.btn_calendario_trabalho_visualizar.click(function(){""!=n.cbo_calendario_trabalho.val()&&View.load("calendario_trabalho/detalhes",function(o,i){i.show(n.cbo_calendario_trabalho.val(),FORMULARIO.VISUALIZAR)})}),this.btn_calendario_trabalho_recarregar.unbind("click"),this.btn_calendario_trabalho_recarregar.click(function(){n.listar_calendario_trabalho(n.cbo_calendario_trabalho.val())}),this.btn_calendario_trabalho_novo.unbind("click"),this.btn_calendario_trabalho_novo.click(function(){View.load("calendario_trabalho/detalhes",function(o,i){i.onclose=function(){i.calendario_trabalho_id&&n.listar_calendario_trabalho(i.calendario_trabalho_id)},i.show(null,FORMULARIO.NOVO)})}),n.selectPasta.props.handleSelecionar=function(){n.documento_pasta_id=n.selectPasta.props.documentoPastaID},this.unload=function(){n.close(),View.unload(this.html_id)},this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){n.unload()}),n.file_importacao_processo.change(function(){var o=null;this.files.length?(o=this.files[0].name,WS.post("processo/get_envolvidos/",{arquivo_processo:n.file_importacao_processo[0].files[0]},function(o){n.envolvidos=o,n.anexos=o.anexos,n.render_anexos(),n.render_envolvidos(),o.permite_anexos&&n.div_pasta.removeClass("hidden")},null,null,!0)):o="Arraste seu arquivo aqui ou clique nesta área",$(this).parent().find("span").text(o)}),this.btn_salvar.unbind("click"),this.btn_salvar.click(function(){WS.post("processo/importar/",{arquivo_processo:n.file_importacao_processo[0].files[0],categoria_processos_id:n.cbo_categoria_processos.val(),calendario_trabalho_id:n.cbo_calendario_trabalho.val(),documento_pasta_id:n.documento_pasta_id,envolvidos:JSON.stringify(n.envolvidos),anexos:JSON.stringify(n.anexos)},function(o){alert_saved(o.nome+" importado com sucesso"),n.unload()},null,null,!0)})}});