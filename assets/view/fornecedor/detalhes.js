define(["react","react-dom","./../componentes_react/InputCEP"],function(o,i,e){return function(a){"use strict";var t=this;this.html_id=a,this.dialog=$("#"+this.html_id),this.title="Fornecedor",this.onclose=null,this.onsave=null,this.edt_nome=this.dialog.find(".edt_nome"),this.edt_razao_social=this.dialog.find(".edt_razao_social"),this.edt_email_agenda=this.dialog.find(".edt_email_agenda"),this.edt_dominio_interacao=this.dialog.find(".edt_dominio_interacao"),this.edt_telefone1=this.dialog.find(".edt_telefone1"),this.edt_telefone2=this.dialog.find(".edt_telefone2"),this.edt_telefone3=this.dialog.find(".edt_telefone3"),this.edt_telefone4=this.dialog.find(".edt_telefone4"),this.files=this.dialog.find(".files"),this.carrega_img=this.dialog.find(".carrega_img"),this.edt_codigo=this.dialog.find(".edt_codigo"),this.edt_unidade=this.dialog.find(".edt_unidade"),this.chk_bloqueado=this.dialog.find(".chk_bloqueado"),this.cbo_tipo_pessoa=this.dialog.find(".cbo_tipo_pessoa"),this.cbo_tipo_cadastro=this.dialog.find(".cbo_tipo_cadastro"),this.edt_endereco=this.dialog.find(".edt_endereco"),this.edt_numero=this.dialog.find(".edt_numero"),this.edt_complemento=this.dialog.find(".edt_complemento"),this.edt_bairro=this.dialog.find(".edt_bairro"),this.edt_municipio=this.dialog.find(".edt_municipio"),this.btn_municipio=this.dialog.find(".btn_municipio"),this.edt_pais=this.dialog.find(".edt_pais"),this.btn_pais=this.dialog.find(".btn_pais"),this.div_componente_cnpj=this.dialog.find(".div_componente_cnpj"),this.edt_inscricao_estadual=this.dialog.find(".edt_inscricao_estadual"),this.edt_id_estrangeiro=this.dialog.find(".edt_id_estrangeiro"),this.edt_incricao_municipal=this.dialog.find(".edt_incricao_municipal"),this.cbo_tipo_orgao=this.dialog.find(".cbo_tipo_orgao"),this.edt_data_fundacao=this.dialog.find(".edt_data_fundacao"),this.edt_site=this.dialog.find(".edt_site"),this.edt_email_principal=this.dialog.find(".edt_email_principal"),this.edt_observacoes=this.dialog.find(".edt_observacoes"),this.edt_uf=this.dialog.find(".edt_uf"),this.razao_social_obrig=this.dialog.find(".razao_social_obrig"),this.nome_fantasia_obrig=this.dialog.find(".nome_fantasia_obrig"),this.tipo_obrig=this.dialog.find(".tipo_obrig"),this.endereco_obrig=this.dialog.find(".endereco_obrig"),this.numero_obrig=this.dialog.find(".numero_obrig"),this.bairro_obrig=this.dialog.find(".bairro_obrig"),this.municipio_obrig=this.dialog.find(".municipio_obrig"),this.pais_obrig=this.dialog.find(".pais_obrig"),this.cnpj_obrig=this.dialog.find(".cnpj_obrig"),this.inscricao_estadual_obrig=this.dialog.find(".inscricao_estadual_obrig"),this.menu_geral=this.dialog.find(".menu_geral"),this.menu_contatos=this.dialog.find(".menu_contatos"),this.aba_geral=this.dialog.find(".aba_geral"),this.aba_contatos=this.dialog.find(".aba_contatos"),this.menu_formulario_personalizado=this.dialog.find(".menu_formulario_personalizado"),this.aba_formulario_personalizado=this.dialog.find(".aba_formulario_personalizado"),this.divFormularioPersonalizado=this.dialog.find(".divFormularioPersonalizado"),this.tab_listagem_contato=this.dialog.find(".tab_listagem_contato"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.btn_excluir=this.dialog.find(".btn_excluir"),this.btn_alterar_logo=this.dialog.find(".btn_alterar_logo"),this.btn_remover_logo=this.dialog.find(".btn_remover_logo"),this.dx_contato=this.dialog.find(".dx_contato"),this.cbo_classificacao=this.dialog.find(".cbo_classificacao"),this.div_componente_cep=this.dialog.find(".div_componente_cep"),this.inputCEP=o.createElement(e,null,null);var n={aoAlterar:(o,i)=>{window.functions.CNPJ.preencherCampos(t,i)}};i.render(o.createElement(window.components.TextBoxCPFCNPJ.default,n),t.div_componente_cnpj[0]),this.btn_historico_entidade=this.dialog.find(".btn_historico_entidade"),this.fornecedor_codigo_automatico=!1,this.logo_id=null,this.fornecedor_id=null,this.tipo=null,this.cod_municipio=null,this.cod_pais=null,this.codigo=null,this.tipo_operacao=null,this.OPERACAO_CRIAR_UNIDADE=4,this.PESSOA_JURIDICA="J",this.arr_contatos=[],this.arr_contatos_filtrados=[],this.formularioGetPostParams=null,this.formularioValidar=null,this.formularioMain={},this.componenteCnpjInstance=t.div_componente_cnpj.children().dxTextBox("instance"),this.show=function(o,e,a,n){t.aba_geral.attr("id","aba_geral"+t.html_id),t.aba_contatos.attr("id","aba_contatos"+t.html_id),t.aba_formulario_personalizado.attr("id","aba_formulario_personalizado"+t.html_id),t.menu_geral.attr("href","#"+t.aba_geral.attr("id")),t.menu_contatos.attr("href","#"+t.aba_contatos.attr("id")),t.menu_formulario_personalizado.attr("href","#"+t.aba_formulario_personalizado.attr("id")),t.get_parametros(),t.tipo=e,t.codigo=a,set_datepicker(t.edt_data_fundacao),t.render_dx_contato(o),i.render(t.inputCEP,t.div_componente_cep[0]),t.inputCEP.props.setCampoEndereco(t.edt_endereco),t.inputCEP.props.setCampoBairro(t.edt_bairro),t.inputCEP.props.setCampoCidade(t.edt_municipio,t.edt_uf,t.alterar_cod_municipio),t.inputCEP.props.setCampoPais(t.edt_pais,t.alterar_cod_pais),t.btn_historico_entidade.tooltip({title:"HistÃ³rico do cliente",placement:"auto"}),void 0!==o&&o?(t.fornecedor_id=o,t.preencher()):(App.titulo_aba(t.html_id,"Fornecedor - Novo"),void 0!==n&&"undefined"!=n&&null!=n&&(t.edt_nome.val(n),t.edt_razao_social.val(n),set_focus(t.edt_nome)),t.componenteCnpjInstance.option("value","")),t.render_formulario()},this.alterar_cod_municipio=function(){t.cod_municipio=t.inputCEP.props.CodigoMunicipio},this.alterar_cod_pais=function(){t.cod_pais=t.inputCEP.props.CodigoPais},this.get_parametros=function(){WS.get("fornecedor/get_parametros/",null,function(o){switch(!App.sessao.dados.admin&&App.verifica_permissao(App.sessao.dados.empresa_filial_id,"fornecedor_somente_leitura")&&(t.tipo=FORMULARIO.VISUALIZAR),t.tipo){case FORMULARIO.NOVO:t.btn_salvar.show(),t.btn_excluir.hide(),t.permite_alterar(!0),t.cod_pais="1058",t.edt_pais.val("BRASIL");break;case FORMULARIO.EDITAR:t.btn_salvar.show(),t.btn_excluir.hide(),t.permite_alterar(!0);break;case FORMULARIO.VISUALIZAR:t.btn_salvar.hide(),t.btn_excluir.hide(),t.permite_alterar(!1);break;case FORMULARIO.EXCLUIR:t.btn_salvar.hide(),t.btn_excluir.show(),t.permite_alterar(!1);break;case FORMULARIO.CRIAR_UNIDADE:t.btn_salvar.show(),t.btn_excluir.hide(),t.permite_alterar(!0),t.tipo_operacao=t.OPERACAO_CRIAR_UNIDADE,t.edt_codigo.val(t.codigo),t.cod_pais="1058",t.edt_pais.val("BRASIL")}t.fornecedor_codigo_automatico="S"==o.fornecedor_codigo_automatico,!1!==o.fornecedor_obrig_nome_fantasia&&"N"!=o.fornecedor_obrig_nome_fantasia||t.nome_fantasia_obrig.remove(),!1!==o.fornecedor_obrig_razao_social&&"N"!=o.fornecedor_obrig_razao_social||t.razao_social_obrig.remove(),!1!==o.fornecedor_obrig_tipo&&"N"!=o.fornecedor_obrig_tipo||t.tipo_obrig.remove(),t.inputCEP.props.set_cepObrigatorio(!0===o.fornecedor_obrig_cep||"S"==o.fornecedor_obrig_cep),!1!==o.fornecedor_obrig_endereco&&"N"!=o.fornecedor_obrig_endereco||t.endereco_obrig.remove(),!1!==o.fornecedor_obrig_numero&&"N"!=o.fornecedor_obrig_numero||t.numero_obrig.remove(),!1!==o.fornecedor_obrig_bairro&&"N"!=o.fornecedor_obrig_bairro||t.bairro_obrig.remove(),!1!==o.fornecedor_obrig_municipio&&"N"!=o.fornecedor_obrig_municipio||t.municipio_obrig.remove(),!1!==o.fornecedor_obrig_pais&&"N"!=o.fornecedor_obrig_pais||t.pais_obrig.remove(),!1!==o.fornecedor_obrig_cnpj&&"N"!=o.fornecedor_obrig_cnpj||t.cnpj_obrig.remove(),!1!==o.fornecedor_obrig_inscricao_estadual&&"N"!=o.fornecedor_obrig_inscricao_estadual||t.inscricao_estadual_obrig.remove(),t.permite_alterar_chave()})},this.close=function(){void 0!==t.onclose&&t.onclose&&t.onclose()},this.unload=function(){t.close(),View.unload(this.html_id)},this.permite_alterar=function(o){t.files.prop("disabled",!o),t.edt_nome.prop("readonly",!o),t.edt_razao_social.prop("readonly",!o),t.edt_email_agenda.prop("readonly",!o),t.edt_dominio_interacao.prop("readonly",!o),t.edt_telefone1.prop("readonly",!o),t.edt_telefone2.prop("readonly",!o),t.edt_telefone3.prop("readonly",!o),t.edt_telefone4.prop("readonly",!o),t.edt_codigo.prop("readonly",!o),t.edt_unidade.prop("readonly",!o),t.chk_bloqueado.prop("readonly",!o),t.cbo_tipo_pessoa.prop("disabled",!o),t.cbo_tipo_cadastro.prop("disabled",!o),t.cbo_classificacao.prop("disabled",!o),t.inputCEP.props.setCampoCepLeitura(!o),t.edt_endereco.prop("readonly",!o),t.edt_numero.prop("readonly",!o),t.edt_complemento.prop("readonly",!o),t.edt_bairro.prop("readonly",!o),t.edt_municipio.prop("readonly",!o),t.btn_municipio.prop("disabled",!o),t.edt_pais.prop("readonly",!o),t.btn_pais.prop("disabled",!o),t.componenteCnpjInstance.option("readOnly",!o),t.edt_inscricao_estadual.prop("readonly",!o),t.edt_id_estrangeiro.prop("readonly",!o),t.edt_incricao_municipal.prop("readonly",!o),t.cbo_tipo_orgao.prop("disabled",!o),t.edt_data_fundacao.prop("readonly",!o),t.edt_site.prop("readonly",!o),t.edt_email_principal.prop("readonly",!o)},this.permite_alterar_chave=function(o){t.tipo==FORMULARIO.NOVO?(t.edt_codigo.prop("readonly",t.fornecedor_codigo_automatico),t.edt_unidade.prop("readonly",t.fornecedor_codigo_automatico)):t.tipo==FORMULARIO.EDITAR?(t.edt_codigo.prop("readonly",!0),t.edt_unidade.prop("readonly",!0),""==t.edt_codigo.val().trim()&&""==t.edt_unidade.val().trim()&&(t.edt_codigo.prop("readonly",!1),t.edt_unidade.prop("readonly",!1))):t.tipo==FORMULARIO.CRIAR_UNIDADE&&(t.edt_codigo.prop("readonly",!0),t.edt_unidade.prop("readonly",t.fornecedor_codigo_automatico))},this.preencher=function(){WS.get("fornecedor/objeto/",{fornecedor_id:t.fornecedor_id},function(o){null!=o.nome_fantasia&&App.titulo_aba(t.html_id,"Fornecedor - "+o.nome_fantasia.substring(0,15)),t.edt_nome.val(o.nome_fantasia),t.edt_razao_social.val(o.razao_social),t.edt_email_agenda.val(o.email_agenda),t.edt_dominio_interacao.val(o.dominio_interacao),t.edt_telefone1.val(o.telefone1),t.edt_telefone2.val(o.telefone2),t.edt_telefone3.val(o.telefone3),t.edt_telefone4.val(o.telefone4),t.edt_codigo.val(o.codigo),t.edt_unidade.val(o.unidade),t.chk_bloqueado.bootstrapSwitch("state","N"!=o.bloqueado),t.cbo_tipo_pessoa.val(o.tipo_pessoa),t.cbo_tipo_cadastro.val(o.tipo_cadastro),t.cbo_classificacao.val(o.classificacao),t.inputCEP.props.setCampoCep(o.cep),t.edt_endereco.val(o.endereco),t.edt_numero.val(o.numero),t.edt_complemento.val(o.complemento),t.edt_bairro.val(o.bairro),t.cod_municipio=o.cod_municipio,t.cod_pais=o.cod_pais,t.edt_municipio.val(o.municipio),t.edt_pais.val(o.pais),t.componenteCnpjInstance.option("value",o.cnpj),t.edt_inscricao_estadual.val(o.inscricao_estadual),t.edt_id_estrangeiro.val(o.id_estrangeiro),t.edt_incricao_municipal.val(o.inscricao_municipal),t.cbo_tipo_orgao.val(o.tipo_orgao),t.edt_uf.text(o.uf_sigla),t.arr_contatos=o.arr_contatos,t.render_contatos(),setTimeout(function(){set_datepicker(t.edt_data_fundacao,o.data_fundacao)},150),t.edt_site.val(o.site),t.edt_email_principal.val(o.email_principal),t.edt_observacoes.val(o.observacoes),null!=o.logo_id&&0==o.logo_id.excluido?"S"==o.logo_id.midia&&(t.logo_id=o.logo_id.id,t.carrega_img.attr("src",WS_URI+"documento/midia/?tipo=v&tamanho=60&documento_id="+o.logo_id.id+"&token_midia="+App.sessao.token_midia+"&considera_excluido=S&anticache="+(new Date).getTime())):t.carrega_img.attr("src","assets/img/icones_bp/img.svg"),t.permite_alterar_chave()})},this.preview_logo=function(o){var i=o.target.files[0],e=new FileReader;e.onload=function(o){t.carrega_img.attr("src",o.target.result)},e.readAsDataURL(i)},this.render_contatos=function(){var o=t.tab_listagem_contato.find("tbody"),i=o.find("tr:first");$(t.arr_contatos).each(function(o,i){void 0===t.arr_contatos[o].removido&&(t.arr_contatos[o].removido=!1)}),t.arr_contatos_filtrados=t.arr_contatos.filter(function(o){var i=!0;return!0===o.removido&&(i=!1),i}),t.tab_listagem_contato.find("tr:gt(1)").remove(),$(t.arr_contatos_filtrados).each(function(e,a){!function(e){var a=i.clone();a.removeAttr("template-row"),a.css("display","");var n=$(a.find("[template-field='nome']"));n.text(e.nome);var r=$(a.find("[template-field='email']"));r.text(e.email);var d=$(a.find("[template-field='telefone1']"));d.text(e.telefone1);var _=$(a.find("[template-field='telefone2']"));_.text(e.telefone2);var c=$(a.find("[template-field='telefone3']"));c.text(e.telefone3);var l=$(a.find("[template-field='telefone4']"));l.text(e.telefone4);var s=$(a.find(".btn_editar_contato")),p=function(){View.load("contato/detalhes",function(o,i){i.show(e.contato_id,FORMULARIO.EDITAR,function(o){n.text(o.nome),r.text(o.email),d.text(o.telefone1),_.text(o.telefone2),c.text(o.telefone3),l.text(o.telefone4)})},View.ABA.MULTIPLAS)};s.unbind("click"),s.click(p),a.dblclick(p);var f=$(a.find(".btn_deletar_contato"));f.unbind("click"),f.click(function(){alert_modal("Contato","Deseja remover o seguimento?","Remover",function(){$(t.arr_contatos).each(function(o,i){i.contato_id==e.contato_id&&(t.arr_contatos[o].removido=!0,t.render_contatos())})},!0)}),a.appendTo(o)}(a)}),App.aplicar_mascaras(o)},this.render_formulario=function(){ReactDOM.render(React.createElement(window.components.FormularioPersonalizado.default,{main:t.formularioMain,abaFormularioPersonalizado:t.menu_formulario_personalizado,urlGet:"/formulario_fornecedor/get_formulario/",urlGetParams:{fornecedor_id:t.fornecedor_id},readOnly:t.tipo===FORMULARIO.VISUALIZAR,callbackGetPostParams:function(o){t.formularioGetPostParams=o},callbackValidar:function(o){t.formularioValidar=o}}),t.divFormularioPersonalizado[0])},this.btn_municipio.unbind("click"),this.btn_municipio.click(function(){View.load("municipio/selecionar",function(o,i){i.show(function(o){t.cod_municipio=o.cod_municipio,t.edt_municipio.val(o.municipio),t.edt_uf.text(o.uf_sigla)})})}),this.btn_pais.unbind("click"),this.btn_pais.click(function(){View.load("pais/selecionar",function(o,i){i.show(function(o){t.cod_pais=o.cod_pais,t.edt_pais.val(o.nome)})})}),this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){t.unload()}),this.btn_salvar.unbind("click"),this.btn_salvar.click(function(){if(t.formularioValidar()){$.each(t.files,function(o,i){i.files.length>0&&(t.logo_id=i.files[0])});var o={fornecedor_id:t.fornecedor_id,nome:t.edt_nome.val(),razao_social:t.edt_razao_social.val(),email_agenda:t.edt_email_agenda.val(),dominio_interacao:t.edt_dominio_interacao.val(),telefone1:t.edt_telefone1.val(),telefone2:t.edt_telefone2.val(),telefone3:t.edt_telefone3.val(),telefone4:t.edt_telefone4.val(),logo_id:t.logo_id,codigo:t.edt_codigo.val(),unidade:t.edt_unidade.val(),bloqueado:t.chk_bloqueado.bootstrapSwitch("state"),tipo_pessoa:t.cbo_tipo_pessoa.val(),tipo_cadastro:t.cbo_tipo_cadastro.val(),classificacao:t.cbo_classificacao.val(),cep:t.inputCEP.props.CampoCep,endereco:t.edt_endereco.val(),numero:t.edt_numero.val(),complemento:t.edt_complemento.val(),bairro:t.edt_bairro.val(),cod_municipio:t.cod_municipio,cod_pais:t.cod_pais,cnpj:t.componenteCnpjInstance.option("value"),inscricao_estadual:t.edt_inscricao_estadual.val(),id_estrangeiro:t.edt_id_estrangeiro.val(),inscricao_municipal:t.edt_incricao_municipal.val(),tipo_orgao:t.cbo_tipo_orgao.val(),data_fundacao:get_datepicker(t.edt_data_fundacao),site:t.edt_site.val(),email_principal:t.edt_email_principal.val(),observacoes:t.edt_observacoes.val(),tipo_operacao:t.tipo_operacao,arr_contatos:JSON.stringify(t.arr_contatos_filtrados)};o=Object.assign(o,t.formularioGetPostParams()),WS.post("fornecedor/salvar",o,function(o){t.fornecedor_id=o.id,alert_saved(o.nome_fantasia+" salvo com sucesso"),void 0!==t.onsave&&t.onsave&&t.onsave(o,"F"),t.unload()},[t.btn_excluir,t.btn_salvar,t.btn_cancelar],null,!0)}}),this.btn_excluir.unbind("click"),this.btn_excluir.click(function(){WS.post("fornecedor/excluir",{fornecedor_id:t.fornecedor_id},function(o){alert_saved(o.nome_fantasia+" excluido com sucesso"),t.unload()})}),this.btn_historico_entidade.unbind("click"),this.btn_historico_entidade.click(function(){t.fornecedor_id&&View.load("entidade_historico/listar",function(o,i){i.show(t.fornecedor_id,"F")},View.ABA.MULTIPLAS)}),this.btn_alterar_logo.unbind("click"),this.btn_alterar_logo.click(function(){t.files.click()}),this.btn_remover_logo.unbind("click"),this.btn_remover_logo.click(function(){alert_modal("Remover Logo","Deseja remover este logo?","Remover",function(){WS.post("documento/excluir",{documento_id:t.logo_id,excluir:!0,excluir_foto_fornecedor:!0,fornecedor_id:t.fornecedor_id},function(o){t.carrega_img.attr("src","assets/img/icones_bp/img.svg"),alert_saved("Logo removido com sucesso")},null,null,!0)},!0)}),this.render_dx_contato=(o=>{ReactDOM.render(React.createElement(window.components.SelecaoContato.default,{entidadeTipo:"F",entidadeId:o,readOnly:t.tipo==FORMULARIO.VISUALIZAR||t.tipo==FORMULARIO.EXCLUIR,dataGridSearchPanelEnabled:!1,dataGridExportEnabled:!1,dataGridColumnChooserEnabled:!1,aoAlterar:(o,i)=>{t.arr_contatos.filter(i=>+i.contato_id==+o&&(void 0===i.removido||!1===i.removido)).length>0||(t.arr_contatos.push(i),t.render_contatos())}}),t.dx_contato[0])}),t.files[0].addEventListener("change",t.preview_logo,!1)}});