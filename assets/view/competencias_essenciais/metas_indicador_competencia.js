define([],function(){return function(a){"use strict";var i=this;this.html_id=a,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.tipo=null,this.onclose=null,this.onsave=null,this.competencias_essenciais_id=null,this.habilidade_id=0,this.usuario_id=0,this.edt_nome=this.dialog.find(".edt_nome"),this.cbo_novo_indicador=this.dialog.find(".cbo_novo_indicador"),this.radio_indicador=this.dialog.find(".radio_indicador"),this.edt_indicador=this.dialog.find(".edt_indicador"),this.div_selecao_indicador=this.dialog.find(".div_selecao_indicador"),this.btn_avaliar=this.dialog.find(".btn_avaliar"),this.optradio_sete_dias=this.dialog.find("[name=optradio_sete_dias]"),this.radio_informativa_sete_dias=this.dialog.find(".radio_informativa_sete_dias"),this.radio_percentual_sete_dias=this.dialog.find(".radio_percentual_sete_dias"),this.radio_valor_sete_dias=this.dialog.find(".radio_valor_sete_dias"),this.cbo_informativa_sete_dias=this.dialog.find(".cbo_informativa_sete_dias"),this.percentual_sete_dias=this.dialog.find(".percentual_sete_dias"),this.valor_sete_dias=this.dialog.find(".valor_sete_dias"),this.cbo_informativa_sete_dias=this.dialog.find(".cbo_informativa_sete_dias"),this.edt_percentual_sete_dias=this.dialog.find(".edt_percentual_sete_dias"),this.edt_valor_sete_dias=this.dialog.find(".edt_valor_sete_dias"),this.edt_acao_sete_dias=this.dialog.find(".edt_acao_sete_dias"),this.data_sete_dias=this.dialog.find(".data_sete_dias"),this.tab_objetivo=this.dialog.find(".tab_objetivo"),this.btn_incluir_objetivo=this.dialog.find(".btn_incluir_objetivo"),this.div_aprovador=this.dialog.find(".div_aprovador"),this.btn_aprovar=this.dialog.find(".btn_aprovar"),this.btn_reprovar=this.dialog.find(".btn_reprovar"),this.btn_refazer=this.dialog.find(".btn_refazer"),this.txt_observacoes=this.dialog.find(".txt_observacoes"),this.mensagem_aprovacao=this.dialog.find(".mensagem_aprovacao"),this.template_rows=this.dialog.find("[template-rows]"),this.btn_salvar_enviar=this.dialog.find(".btn_salvar_enviar"),this.btn_aprovar_gerar_agenda=this.dialog.find(".btn_aprovar_gerar_agenda"),this.responsabilidade_escolhida=this.dialog.find(".responsabilidade_escolhida"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.btn_excluir=this.dialog.find(".btn_excluir"),this.competencias_essenciais_id=0,this.habilidade_id=0,this.avaliacao_id=0,this.status=0,this.possibilidade_acao_id=0,this.dataAtual=new Date,this.selected_cbo_competencias_essenciais_id=null,this.competencias_essenciais_avaliacao_status=0,this.show=function(a,e,s,d,t,o,n){i.title.html("Ação ["+o+"]"),1==App.sessao.dados.admin||"S"==App.sessao.dados.supervisor_empenho?(t==STATUS_INDICADORES.EM_APROVACAO&&(i.div_aprovador.removeClass("hidden"),i.btn_salvar.addClass("hidden"),i.btn_salvar_enviar.addClass("hidden"),$(".btn_deletar_objetivo").prop("disabled",!0),i.btn_incluir_objetivo.prop("disabled",!0)),t!=STATUS_INDICADORES.EM_ELABORACAO&&t!=STATUS_INDICADORES.REFAZER&&void 0===t&&(i.mensagem_aprovacao.removeClass("hidden"),i.btn_salvar_enviar.addClass("hidden"),i.btn_incluir_objetivo.prop("disabled",!1)),t==STATUS_INDICADORES.EM_ANDAMENTO&&(i.div_aprovador.addClass("hidden"),i.btn_salvar.addClass("hidden"),i.btn_salvar_enviar.addClass("hidden"),$(".btn_deletar_objetivo").prop("disabled",!0),i.btn_incluir_objetivo.prop("disabled",!0))):t!=STATUS_INDICADORES.EM_ELABORACAO&&t!=STATUS_INDICADORES.REFAZER&&void 0!==t&&null!=t&&(i.btn_salvar.addClass("hidden"),i.btn_salvar_enviar.addClass("hidden"),$(".btn_deletar_objetivo").prop("disabled",!0),i.btn_incluir_objetivo.prop("disabled",!0)),i.possibilidade_acao_id=a,i.competencias_essenciais_id=e,i.habilidade_id=s,i.avaliacao_id=d,i.status=t,i.usuario_id=n,i.carrega_acoes_metas(),show_modal(i.modal.attr("id")),set_focus(i.edt_nome)},this.carrega_acoes_metas=function(){WS.get("competencias_essenciais_resultado_esperado/listar/",{habilidade_id:i.habilidade_id,avaliacao_id:i.avaliacao_id,acao_id:i.possibilidade_acao_id,usuario_id:i.usuario_id},function(a){a.length>0&&($.each(a,function(a,e){i.add_row(e)}),i.status!=STATUS_INDICADORES.EM_APROVACAO&&i.status!=STATUS_INDICADORES.NAO_APROVADO&&i.status!=STATUS_INDICADORES.EM_ANDAMENTO||i.template_rows.find(".row_acao:not([template-row-acao])").find("textarea, select, input, button").prop("disabled",!0))})},this.avaliar=function(a){WS.post("competencias_essenciais_avaliacao/salvar/",{competencias_essenciais_avaliacao_id:i.avaliacao_id,competencias_essenciais_id:i.competencias_essenciais_id,habilidade_id:i.habilidade_id,status:a,observacao:i.txt_observacoes.val(),possibilidade_acao_id:i.possibilidade_acao_id,usuario_id:i.usuario_id},function(a){alert_saved("Avaliação salva com sucesso!"),void 0!==i.onsave&&i.onsave&&i.onsave(a.status),i.unload(a.status)})},this.salva_dados_acoes_metas=function(a,e){var s=[],d=i.template_rows.find(".row_acao").not("[template-row-acao]");$.each(d,function(a,i){if(""!==$(i).find("[template-field='descricao']").val()){var e=$(i).find(".div_dt_inicio input"),d=$(i).find(".div_dt_fim input");s.push({id:$(this).attr("competencias_essenciais_resultado_esperado_id"),descricao:$(i).find("[template-field='descricao']").val(),tipo:$(i).find("[template-field='tipo']").val(),valor:$(i).find("[template-field='valor']").val(),data_inicio:get_datepicker(e),data_fim:get_datepicker(d),agenda_gerada:"S"!=$(i).attr("agenda_gerada")?"N":"S",depende_de_aprovacao:1!=$(i).find("[template-field='chk_padrao']").prop("checked")?"N":"S"})}}),$.each(s,function(a,i){i.id?"N"==i.depende_de_aprovacao&&"S"!=i.agenda_gerada&&(e=!0):"N"==i.depende_de_aprovacao&&(e=!0)});var t=function(){s.length>0?WS.post("competencias_essenciais_resultado_esperado/salvar/",{acoes:JSON.stringify(s),competencias_essenciais_id:i.competencias_essenciais_id,habilidade_id:i.habilidade_id,status:a,competencias_essenciais_resultado_esperado_id:i.competencias_essenciais_resultado_esperado_id,competencias_essenciais_acao_id:i.possibilidade_acao_id,avaliacao_id:i.avaliacao_id,observacao:i.txt_observacoes.val(),gerar_agenda:e,usuario_id:i.usuario_id},function(e){alert_saved("Salvo com sucesso"),void 0!==i.onsave&&i.onsave&&i.onsave(a),i.unload(a)}):i.unload()};e?alert_modal("Gerar Agenda","Tem certeza que deseja gerar agenda para os itens marcados?","Sim",function(){t()},!0,"Não",null,function(){}):t()},this.add_row=function(a){var e=$("[template-row-acao]").clone();e.removeAttr("template-row-acao"),e.css("display","");var s=$(e.find('[template-field="descricao"]')),d=$(e.find('[template-field="tipo"]')),t=$(e.find('[template-field="valor"]')),o=$(e.find('[template="div_checkbox"]')),n=$(e.find(".btn_deletar_objetivo")),_=e.find(".div_dt_inicio"),c=e.find(".div_dt_fim");_.append("<input type='date' class='form-control'>"),c.append("<input type='date' class='form-control'>");var r=$(_.find("input")),l=$(c.find("input"));t.attr("disabled",!0);var p=$(e.find('[template-field="chk_padrao"]'));if(p.removeClass("template_switch"),App.aplicar_checkbox(o),a){if("S"==a.agenda_gerada){var v=e.find(".lbl_info_agenda");e.attr("agenda_gerada","S"),v.removeClass("hidden")}if("S"==a.realizado)e.find(".lbl_realizado").removeClass("hidden");p.prop("checked","S"==a.depende_de_aprovacao).change(),e.attr("competencias_essenciais_resultado_esperado_id",a.competencias_essenciais_resultado_esperado_id),s.val(a.descricao_acao),d.val(a.tipo).trigger("change"),a.tipo==TIPO_OBJETIVO.INFORMATIVO?(t.val(""),t.prop("disabled",!0)):a.tipo==TIPO_OBJETIVO.VALOR?(t.prop("disabled",!1),t.val(a.valor),t.maskMoney({thousands:".",decimal:",",allowZero:!0,suffix:"",precision:2})):a.tipo==TIPO_OBJETIVO.PERCENTUAL&&(t.prop("disabled",!1),t.val(a.valor)),set_datepicker(r,a.data_inicio),set_datepicker(l,a.data_fim)}else set_datepicker(r),set_datepicker(l);d.change(function(a){t.attr("disabled",!1),t.val(""),$(this).val()==TIPO_OBJETIVO.INFORMATIVO?(t.attr("disabled",!0),t.val("")):$(this).val()==TIPO_OBJETIVO.PERCENTUAL?($(t).removeAttr("type"),$(t).prop("type","number")):$(this).val()==TIPO_OBJETIVO.VALOR&&($(t).removeAttr("type"),$(t).prop("type","text"),t.maskMoney({thousands:".",decimal:",",allowZero:!0,suffix:"",precision:2}))}),1!=App.sessao.dados.admin&&"S"!=App.sessao.dados.supervisor_empenho||n.removeClass("hidden"),a&&("S"!=a.agenda_gerada&&"S"!=a.realizado||(e.find("textarea, select, input, button").prop("disabled",!0),n.addClass("hidden"))),n.unbind("click"),n.click(function(){$(e).attr("competencias_essenciais_resultado_esperado_id")>0?alert_modal("Objetivo","Deseja remover este objetivo?","Remover",function(){$(e).attr("competencias_essenciais_resultado_esperado_id")>0?WS.post("atuacao_efetiva_indicador_principal/excluir/",{competencias_essenciais_resultado_esperado_id:a.competencias_essenciais_resultado_esperado_id},function(a){alert_saved("Indicador excluído com sucesso"),$(e).remove()}):$(e).remove()},!0):$(e).remove()}),e.appendTo(i.template_rows),s.focus()},i.btn_incluir_objetivo.unbind("click").click(function(a){i.add_row()}),this.close=function(){close_modal(i.modal.attr("id")),void 0!==i.onclose&&i.onclose&&i.onclose()},i.cbo_novo_indicador.change(function(a){i.selected_cbo_competencias_essenciais_id=$(this).find("option:selected").attr("data-id-atuacao")}),this.unload=function(a){i.close(a),View.unload(this.html_id)},this.preencher=function(){WS.get("atuacao_efetiva/objeto/",{competencias_essenciais_id:i.competencias_essenciais_id},function(a){i.edt_indicador.val(a.indicador)})},this.close=function(a){close_modal(i.modal.attr("id")),void 0!==i.onclose&&i.onclose&&i.onclose(a)},this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){i.unload()}),this.btn_salvar.unbind("click"),this.btn_salvar.click(function(){i.salva_dados_acoes_metas()}),this.btn_salvar_enviar.unbind("click"),this.btn_salvar_enviar.click(function(){i.salva_dados_acoes_metas(STATUS_INDICADORES.EM_APROVACAO)}),this.btn_aprovar_gerar_agenda.unbind("click"),this.btn_aprovar_gerar_agenda.click(function(){i.salva_dados_acoes_metas(STATUS_INDICADORES.EM_ANDAMENTO,!0)}),this.btn_aprovar.unbind("click"),this.btn_aprovar.click(function(){i.avaliar(STATUS_INDICADORES.EM_ANDAMENTO)}),this.btn_reprovar.unbind("click"),this.btn_reprovar.click(function(){i.avaliar(STATUS_INDICADORES.NAO_APROVADO)}),this.btn_refazer.unbind("click"),this.btn_refazer.click(function(){i.avaliar(STATUS_INDICADORES.REFAZER)})}});