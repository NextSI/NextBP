define(["react","react-dom","./../componentes_react/InputArquivo","./campo"],function(amdReact,amdReactDOM,InputArquivo,Formulario_Campo){var Formulario_Util=function(html_id){"use strict";var main=this;function add_row_table_form(table_id,valores,add_inicio){if("string"==typeof valores)try{valores=JSON.parse(valores)}catch(e){return void console.log("%cJSON inválido",e)}var table=$('[table_id="'+table_id+'"]'),qtd_tr=table.find("tbody > tr:not(.bg-info)").length,obj_tabela=table.data("obj-tabela"),template=table.data("template"),obj_formulario=table.data("obj_formulario"),obj_grupo_index=table.data("obj_grupo_index"),obj_campo_index=table.data("obj_campo_index"),md5_remover=md5(new Date+Math.random()+md5(new Date));if("function"==typeof main.render_tabela){main.render_tabela(template,"number"==typeof valores?valores:valores.length,table,add_inicio);var total=1==add_inicio?valores.length:parseInt(qtd_tr,10)+valores.length;obj_formulario.grupos[obj_grupo_index].elementos[obj_campo_index].tamanho>0&&(obj_formulario.grupos[obj_grupo_index].elementos[obj_campo_index].tamanho=parseInt(obj_tabela.tamanho,10)+valores.length),obj_formulario.grupos[obj_grupo_index].elementos[obj_campo_index].tamanho_render>0&&(obj_formulario.grupos[obj_grupo_index].elementos[obj_campo_index].tamanho_render=parseInt(obj_tabela.tamanho_render,10)+valores.length);for(var i=1==add_inicio?0:qtd_tr;i<total;i++){var td_pos=1==add_inicio?parseInt(i+1,10):i,td=$(table.find("tbody > tr:not(.bg-info)")[td_pos]).find("td"),pos_valor=1==add_inicio?i:total-i-1;if(td.length==Object.keys(valores[pos_valor]).length||1==td.find("button").hasClass("btn_exclui_linha")&&parseInt(td.length,10)-1==Object.keys(valores[pos_valor]).length)for(var j=0;j<td.length;j++){var item=$(td[j]).find("input, textarea, select"),valor=eval("valores[pos_valor]."+Object.keys(valores[pos_valor])[j]);if("checkbox"==item.attr("type"))1!=valor&&"S"!=valor&&"checked"!=valor||item.attr("value","S");else if("date"==item.attr("type"))set_datepicker(item,valor.format_date(!0));else if("select"==item.attr("type"))item.find('option[value="'+valor+'"]').length>0&&item.val(valor);else if("inteiro"==item.attr("type_campo"))item.maskMoney(),isNaN(parseFloat(valor))||item.val(parseFloat(valor));else if("decimal"==item.attr("type_campo")){var valor=parseFloat(valor);item.maskMoney(),item.maskMoney("mask",valor)}else if("radio"==item.attr("type")){var elem=$(item.parent().find('[value="'+valor+'"]'));elem.length>0&&elem.prop("checked",!0).trigger("change")}else item.val(valor);"radio"!=item.attr("type")&&item.trigger("click").trigger("change")}else $(table.find("tbody > tr")[td_pos]).addClass("remover_"+md5_remover)}$(table).find(".remover_"+md5_remover).remove()}}function exibir_mult_elements_form(e,o){if("string"==typeof e)(t=e).indexOf("campos.elemento_html_")>-1&&(t=t.replace("campos.elemento_html_","")),(t=$('[id_elemento="'+t+'"]')).length>0&&((r=t.parent()).hasClass("input-group")&&(r=r.parent()),"show"==o?(r.show(),t[0].hasAttribute("ret_required")&&(t.prop("required",!0),t.removeAttr("ret_required"),r.find(".lbl_obrigatorio").show())):"hide"==o&&(r.hide(),t[0].hasAttribute("required")&&(t.removeAttr("required"),t.prop("ret_required",!0),r.find(".lbl_obrigatorio").hide())));else if(e instanceof Array)for(var a=0;a<e.length;a++){var t,r;if("string"==typeof(t=e[a])&&(t.indexOf("campos.elemento_html_")>-1&&(t=t.replace("campos.elemento_html_","")),t=$('[id_elemento="'+t+'"]')),t.length>0)(r=t.parent()).hasClass("input-group")&&(r=r.parent()),"show"==o?(r.show(),t[0].hasAttribute("ret_required")&&(t.prop("required",!0),t.removeAttr("ret_required"),r.find(".lbl_obrigatorio").show())):"hide"==o&&(r.hide(),t[0].hasAttribute("required")&&(t.removeAttr("required"),t.prop("ret_required",!0),r.find(".lbl_obrigatorio").hide()))}}this.obj_solicitacao=null,this.div_formulario=null,this.render_tabela=null,this.render_btn_add=null,this.cliquei_deletar=!1,this.id_linha_del=0,this.id_linha_del_arquivo=0,this.inputs_arquivo=[],this.campos_integracao_tabela=[],this.set_obrigatorio=function(e,o){if("string"==typeof e){var a={};$(main.div_formulario.form_grupos.find("[id_elemento]")).each(function(e,o){a[$(o).attr("id_elemento")]=$(main.div_formulario.form_grupos.find('[id_elemento="'+$(o).attr("id_elemento")+'"]'))}),e=a[e]}if(null!=e)for(var t=0;t<e.not("#td_total").length;t++){var r=$(e[t]),i=null,n="radio"==r.attr("type"),l="checkbox"==r.attr("type"),s=r.hasClass("input_consulta_integracao");if($(r.parents("tr")).hasClass("linha_count"))for(var _=r.parents("td").index(),d=r.parents("table").find("th"),p=0;p<d.length;p++){var m=d[p];if($(m)[0].cellIndex==_){i=$(m);break}}else i=r.parents(".div_campo");var c=i.find(".lbl_obrigatorio");o?(n?r.parent().addClass("vld_lista_radio"):l?r.parent().addClass("vld_lista_check"):s?r.children().dxValidator("instance").option("validationRules",[{type:"required"}]):r.prop("required",!0),r.attr("set_obrigatorio",!0),c.show()):(l||n?(i.find(".lbl_nome").tooltip("destroy"),n?r.parent().removeClass("vld_lista_radio"):l&&r.parent().removeClass("vld_lista_check")):s?r.children().dxValidator("instance").option("validationRules",[]):(r.removeAttr("required"),r.tooltip("destroy")),r.attr("set_obrigatorio",!1),c.hide())}},this.encontrar_form_grupo_campo=function(e){for(var o=1,a=null,t=null;o<10&&null==t;)(a=null==a?e.parent():a.parent()).hasClass("form-grupo-campo")&&(t=a),o++;return t},this.tinyMCEget=function(e,o){let a=tinyMCE.get(e.attr("id"));const t=()=>a.setMode(o?"readonly":"design");a?t():setTimeout(()=>{a=tinyMCE.get(e.attr("id")),t()})},this.set_propriedade=function(e,o,a,t){if("string"==typeof e){var r={};$(main.div_formulario.form_grupos.find("[id_elemento]")).each(function(e,o){r[$(o).attr("id_elemento")]=$(main.div_formulario.form_grupos.find('[id_elemento="'+$(o).attr("id_elemento")+'"]'))}),e=r[e]}if(null==e)return;var i="";let n=[],l=[],s=!1;e:for(var _=0;_<e.not("#td_total").length;_++){var d=$(e[_]),p=$(d.parents("tr")).hasClass("linha_count"),m=d.hasClass("input_consulta_integracao"),c="editor_texto"==d.attr("type"),u="radio"==d.attr("type"),f="checkbox"==d.attr("type"),v=d.hasClass("div_input_arquivo"),h=void 0!==d.attr("maskmoney"),g=d.is("select"),b="button"==d.attr("type");if(i=d.attr("ref"),p){var O=d.parents("table").find("[col_id_elemento='"+d.attr("id_elemento")+"']"),I=d.parents("table").attr("elem-key"),E=$(d.parents("tr")).attr("linha_count");if("visivel"==o){!0===a?(O.removeClass("hidden"),O.find("input, select, textarea, button, .div_input_arquivo").css("display","")):(O.addClass("hidden"),O.find("input, select, textarea, button, .div_input_arquivo").css("display","none"));var A=d.parents("table").find("[col_id_elemento]").length;d.parents("table").find("[col_id_elemento].hidden").length===A?$(O).closest(".form-grupos-campos").addClass("hidden"):$(O).closest(".form-grupos-campos").removeClass("hidden")}else if("bloqueado"==o)if(void 0!==main.inputs_arquivo[I]&&void 0!==main.inputs_arquivo[I][i]){var T=main.inputs_arquivo[I][i];Array.isArray(T)&&T.forEach(function(e,o){o==E&&e.props.setDesabilitado(a)})}else m?d.children().dxDropDownBox("instance").option("readOnly",a):c?main.tinyMCEget(d,a):u||f?d.prop("disabled",a):(O.find("input,select.selectpicker").prop("readonly",a),O.find('button,input[type="file"],input[maskmoney]').prop("disabled",a),O.find("select").not(".selectpicker").prop("disabled",a));else if("valor"==o)m?(d.find(".input_consulta_integracao").attr("objeto",JSON.stringify(t)),d.find(".dx-dropdownbox").dxDropDownBox("instance").option("value",a),d.find(".dx-dropdownbox").dxDropDownBox("instance").option("onChange")()):h?d.maskMoney("mask",parseFloat(a)).trigger("change"):d.val(a).trigger("change");else if("getValor"==o){if($(d).parent().parent().hasClass("hidden"))continue e;if(m){let e=d.find(".dx-dropdownbox").dxDropDownBox("instance").option("value");s=!0,n.push({linha:E,valor:e})}else if(h){let e=d.maskMoney("unmasked")[0];s=!0,n.push({linha:E,valor:e})}else if(c){let e=get_tinymce(d);s=!0,n.push({linha:E,valor:e})}else if(u){if(!l.includes(E)){s=!0;let e=d.parent().find("input:checked"),o=null;if(e.length>0){let a=(e=$(e[0])).attr("id");o=e.parent().find("label[for="+a+"]").text()}n.push({linha:E,valor:o}),l.push(E)}}else if(f){if(d.hasClass("caixa_verificacao")){let e="S"==d.attr("value");s=!0,n.push({linha:E,valor:e})}else if(!l.includes(E)){s=!0;let e=[],o=d.parent().find("input:checked");if(o.length>0)for(let a=0;a<o.length;a++){let t=$(o[a]),r=t.attr("id"),i=t.parent().find("label[for="+r+"]");e.push(i.text())}n.push({linha:E,valor:e}),l.push(E)}}else if(v){let e=d.find("input").val();s=!0,n.push({linha:E,valor:e})}else{let e=d.val();s=!0,n.push({linha:E,valor:e})}}else if("getDadosIntegracao"==o){if(m){let e=d.attr("objeto");s=!0,n.push({linha:E,dados:JSON.parse(e)})}}else if("getTotalizador"==o){if(e.not("#td_total").length&&e.not("#td_total")[0].hasAttribute("totalizador")){let o=$(e).attr("totalizador");if(null!==o&&""!==o.trim()){let e=o.includes(",");return o=e?parseFloat(o.replace(/\./g,"").replace(",",".")):parseFloat(o)}}return 0}}else if("visivel"==o)!0===a?("editor_texto"!=d.attr("type")&&d.show(),main.encontrar_form_grupo_campo(d).show()):("editor_texto"!=d.attr("type")&&d.hide(),main.encontrar_form_grupo_campo(d).hide());else if("bloqueado"==o)if(h||g)d.prop("disabled",a),d.hasClass("selectpicker")&&d.parent().find("button").prop("disabled",a);else if(v){if(i&&void 0!==main.inputs_arquivo[i])main.inputs_arquivo[i].props.setDesabilitado(a)}else u||f?d.prop("disabled",a):m?d.children().dxDropDownBox("instance").option("readOnly",a):c?main.tinyMCEget(d,a):b?d.prop("disabled",a):d.prop("readonly",a);else if("valor"==o)m?(d.find(".input_consulta_integracao").attr("objeto",JSON.stringify(t)),d.find(".dx-dropdownbox").dxDropDownBox("instance").option("value",a),d.find(".dx-dropdownbox").dxDropDownBox("instance").option("onChange")(),d.find("input").val(a)):h?d.maskMoney("mask",parseFloat(a)).trigger("change"):d.val(a).trigger("change");else{if("getValor"==o){if(m){return d.find(".dx-dropdownbox").dxDropDownBox("instance").option("value")}if(h){return d.maskMoney("unmasked")[0]}if(c){return get_tinymce(d)}if(u){let e=null,o=d.parent().find("input:checked");if(o.length>0){let a=o.attr("id");e=o.parent().find("label[for="+a+"]").text()}return e}if(f){if(d.hasClass("caixa_verificacao")){return"S"==d.attr("value")}{let e=[],o=d.parent().find("input:checked");if(o.length>0)for(let a=0;a<o.length;a++){let t=$(o[a]),r=t.attr("id"),i=t.parent().find("label[for="+r+"]");e.push(i.text())}return e}}if(v){return d.find("input").val()}return d.val()}if("getDadosIntegracao"==o){if(m){let e=d.attr("objeto");return JSON.parse(e)}}else if("getTotalizador"==o)return 0}}return s?n:void 0},this.set_visivel=function(e,o){main.set_propriedade(e,"visivel",o)},this.set_bloqueado=function(e,o){main.set_propriedade(e,"bloqueado",o)},this.set_valor=function(e,o,a){main.set_propriedade(e,"valor",o,a)},this.get_valor=function(e){return main.set_propriedade(e,"getValor")},this.get_dados_integracao=function(e){return main.set_propriedade(e,"getDadosIntegracao")},this.get_totalizador=function(e){return main.set_propriedade(e,"getTotalizador")},this.contar_linhas_tabela=function(e,o=1){let a=0;return(void 0!==e&&Array.isArray(e)?e:[]).forEach(e=>{if(void 0!==e.excluido&&(!0===e.excluido||"S"===e.excluido))return!1;+e.linha>a&&(a=+e.linha)}),o>=++a?o:a},this.render_previsao=function(){var parametros={div_formulario:null,template_campo:null,template_grupo:null,obj_formulario:null,permissoes_formulario:null,obj_solicitacao:null,disabled_all:null,persistencia_ao_editar:!0,clicksign_ativo:!1,certsign_ativo:!1,permite_retrair_exibir_grupos:!1,liberar_campos:!1,d4sign_ativo:!1,esconder_grupos_campos_vazios:!1};if(0==arguments.length)throw new Error("Nenhum parâmetro foi informado.");for(var i=0;i<arguments.length;i++)switch(i){case 0:void 0!==arguments[i].html_id?parametros.div_formulario=arguments[i]:"object"==typeof arguments[i]&&spread(parametros,arguments[i]);break;case 1:parametros.template_campo=arguments[i];break;case 2:parametros.template_grupo=arguments[i];break;case 3:parametros.obj_formulario=arguments[i];break;case 4:parametros.permissoes_formulario=arguments[i];break;case 5:parametros.obj_solicitacao=arguments[i];break;case 6:parametros.disabled_all=arguments[i];break;case 8:parametros.clicksign_ativo=arguments[i];break;case 9:parametros.permite_retrair_exibir_grupos=arguments[i];break;case 10:parametros.certsign_ativo=arguments[i];break;case 11:parametros.liberar_campos=arguments[i];break;case 12:parametros.d4sign_ativo=arguments[i];break;case 13:parametros.esconder_grupos_campos_vazios=arguments[i]}if(main.reprocessar_evento_alterar_iniciar(parametros),App.PE.formulario_render_antes)try{App.PE.formulario_render_antes(parametros)}catch(e){console.log(e)}parametros.obj_formulario.style&&parametros.div_formulario.form_editor.attr("style",parametros.obj_formulario.style),parametros.div_formulario.lbl_nome.text(parametros.obj_formulario.nome),parametros.div_formulario.form_grupos.html(""),parametros.obj_formulario.formulario_id&&parametros.div_formulario.form_grupos.attr("formulario_id",parametros.obj_formulario.formulario_id),main.obj_solicitacao=parametros.obj_solicitacao,parametros.div_formulario&&(main.div_formulario=parametros.div_formulario);var executar_evento=function(obj_campo,div_formulario,tipo,id_elemento,form_start,handler){var execute="",converter_construtor_js=function(e){var o="";return e&&Object.keys(e).map(function(a,t){var r=a.split("_"),i=r[0];r.shift();var n=r.join("_");n&&("obrigatorio"===i?o+="typeof("+n+') != "undefined" ? (set_obrigatorio('+n+","+localizar_condicao(e[a])+')) : "";\n':"bloqueado"===i?o+="typeof("+n+') != "undefined" ? (set_bloqueado('+n+","+localizar_condicao(e[a])+')) : "";\n':"oculto"===i&&(o+="typeof("+n+') != "undefined" ? (set_visivel('+n+", !"+localizar_condicao(e[a])+')) : "";\n'))}),o};if("selecionar"==tipo?execute=obj_campo.evento_selecionar:"limpar"==tipo?execute=obj_campo.evento_limpar:"alterar"==tipo?execute=obj_campo.evento_alterar:"iniciar"==tipo?execute=obj_campo.evento_iniciar:"iniciar_construtor"==tipo?execute=converter_construtor_js(obj_campo.evento_iniciar_construtor):"clicar"==tipo?execute=obj_campo.evento_clicar:"alterar_construtor"==tipo&&(execute=converter_construtor_js(obj_campo.evento_alterar_construtor)),!execute||""==execute)return;let array_prop=[],campos={};App.PE.formulario_ao_executar_evento&&App.PE.formulario_ao_executar_evento(parametros.obj_solicitacao,obj_campo,div_formulario,tipo,id_elemento,form_start,handler,execute);let erro_formulario=!1,str_campos="";App.form_debugger&&(str_campos="debugger;\n"),str_campos+="// elemento id "+id_elemento+"\n",str_campos+="// evento "+tipo+"\n",str_campos+="var set_obrigatorio = main.set_obrigatorio; ",str_campos+="var set_visivel = main.set_visivel; ",str_campos+="var set_bloqueado = main.set_bloqueado; ",str_campos+="var set_valor = main.set_valor; ",str_campos+="var get_valor = main.get_valor; ",str_campos+="var get_dados_integracao = main.get_dados_integracao; ",str_campos+="var get_totalizador = main.get_totalizador; ",str_campos+="var obj_solicitacao = main.obj_solicitacao; ",str_campos+="var encontrar_form_grupo_campo = main.encontrar_form_grupo_campo; ";let array_elementos={};$(div_formulario.form_grupos.find("[id_elemento]")).each(function(e,o){array_elementos[$(o).attr("id_elemento")]=$(div_formulario.form_grupos.find('[id_elemento="'+$(o).attr("id_elemento")+'"]'))});for(let e in array_elementos)if(void 0!==e&&"undefined"!=e&&""!=e.trim())if(isNaN(e[0]))str_campos+="var "+e+' = array_elementos["'+e+'"]; ';else if(campos["elemento_html_"+e]=$(array_elementos[e]),null!=execute&&void 0!==execute&&execute.indexOf(e)>-1){if(array_prop.push(e),new RegExp("var\\s*\\b"+e+"\\b").test(execute)){alert_modal("Atenção","A variável <strong>"+e+"</strong> já existe, favor verificar","OK",null,!0),erro_formulario=!0;break}new RegExp("\\b"+e+"\\b").test(execute)&&(execute=execute.split(new RegExp("\\b"+e+"\\b")).join("campos.elemento_html_"+e))}execute=str_campos+"\n\n\n"+execute;let count=0;for(let e in array_elementos)""!=e.trim()&&count++;if(count>0)try{erro_formulario||eval(execute)}catch(e){console.log("Erro: "+execute),console.error(e)}},aplicar_mascaras=function(){$(parametros.div_formulario.form_grupos).find("[maskmoney]").each(function(e,o){var a=$(o);void 0===$(o).attr("mascara")&&$(o).attr("mascara","true"),a.maskMoney({thousands:a.attr("data-thousands"),decimal:a.attr("data-decimal"),allowZero:"true"===a.attr("data-allow-zero"),allowNegative:"true"===a.attr("data-allow-negative"),suffix:a.attr("data-suffix"),precision:a.attr("data-precision")})}),$(parametros.div_formulario.form_grupos).find("[masktext]").each(function(e,o){if(void 0===$(o).attr("mascara")){$(o).attr("mascara","true");var a=$(o);a.mask(a.attr("data-mask"))}})};if($(parametros.obj_formulario.grupos).each(function(e,o){if(!0!==o.removido){var a=parametros.template_grupo.clone();a.css("display",""),a.attr("elem-key",o.elem_key),a.attr("sequencia",o.sequencia),a.attr("formulario_grupo_id",o.formulario_grupo_id),a.attr("nome",o.nome);var t=md5(new Date+Math.random()),r=$('<div style="padding-left: 8px; padding-right: 8px;">'),i=$('<div class="form-grupos-campos row" div_elem_key="'+t+'"    >');r.append(i),a.append(r);var n=a.find(".lbl_grupo_nome");if(n.text(o.nome),parametros.permite_retrair_exibir_grupos){var l=!0;$(parametros.permissoes_formulario).each(function(e,a){if(o.versao_formulario_grupo_id==a.versao_formulario_grupo_id){if(a.permissao!=PROCESSO_ATIVIDADE_FORMULARIO_PERMISSAO.VISUALIZAR)return l=!1,!1;$(o.elementos).each(function(e,o){const a=void 0!==o.valor&&""!=o.valor&&null!=o.valor,t=void 0!==o.historico&&Array.isArray(o.historico)&&o.historico.length>0;if(a||t)return l=!1,!1})}}),n.prepend('<div class="btn_expandir_retrair" style="float:left; cursor:pointer"><span class="glyphicon '+(l?"glyphicon-plus-sign":"glyphicon-minus-sign")+'">&nbsp;</span></div>');let e=n.find(".btn_expandir_retrair"),a=e.closest(".form-grupo"),t=e.closest(".form-grupo").find(".form-grupos-campos").parent();"S"===parametros.esconder_grupos_campos_vazios||!0===parametros.esconder_grupos_campos_vazios?a.toggle(!l):(t.toggle(!l),e.click(function(){let e=$(this).closest(".form-grupo").find(".form-grupos-campos").parent();var o=$(this).find("span");o.hasClass("glyphicon-plus-sign")?(o.removeClass("glyphicon-plus-sign").addClass("glyphicon-minus-sign"),e.show()):(o.removeClass("glyphicon-minus-sign").addClass("glyphicon-plus-sign"),e.hide())}))}var s=0;void 0!==o.elementos&&o.elementos&&$(o.elementos).each(function(o,r){var n=parametros.template_campo.clone(),l=parseInt(r.tipo,10),_="campo_"+String((new Date).getTime())+String(Math.round(1e4*Math.random()))+String((new Date).getTime())+String(Math.round(1e4*Math.random()));if(n.css("display",""),n.attr("elem-key",r.elem_key),s=parseInt(s,10)+parseInt(r.colunas,10),parseInt(s,10)>12){var d=t;if(t=md5(new Date+s+Math.random()),i=$('<div class="form-grupos-campos row" div_elem_key="'+t+'">'),a.find('[div_elem_key="'+d+'"]').after(i),s=0,i.append(n),12==parseInt(r.colunas,10)){d=t;t=md5(new Date+s+Math.random()),i=$('<div class="form-grupos-campos row" div_elem_key="'+t+'">'),a.find('[div_elem_key="'+d+'"]').after(i)}}else if(i.append(n),12==parseInt(s,10)){d=t;t=md5(new Date+s+Math.random()),i=$('<div class="form-grupos-campos row" div_elem_key="'+t+'">'),a.find('[div_elem_key="'+d+'"]').after(i),s=0}n.addClass("col-sm-"+r.colunas);var p=n.find(".lbl_obrigatorio");r.obrigatorio&&"true"===r.obrigatorio.toString()?p.show():p.hide();var m=n.find(".lbl_nome"),c=n.find(".div_campo");switch(""==r.nome.trim()?l==ELEMENTO_TIPO.TABELA?m.hide():m.html("&nbsp;"):r.ajuda?m.html(r.nome+'&nbsp;<i class="fas fa-question-circle" title="'+r.ajuda+'"></i>'):m.text(r.nome),l==ELEMENTO_TIPO.TEXTO_FIXO&&m.remove(),l!=ELEMENTO_TIPO.ANEXO&&m.attr("for",_),main.render_btn_add=function(e){if($(e).find("#td_total").parent().append('<td class="td_formulario_campo td_total bg-info text-center" id="td_total"><button type="button" class="btn btn-default btn_add_linha pull-right" style="margin-bottom: 5px;" data-toggle="tooltip" title="Adicionar linha"><span class="glyphicon glyphicon-plus"></span></button></td>'),$(e).find(".btn_add_linha").length>1&&$(e).find(".btn_add_linha").last().click(function(e){var o=$(this).parents()[4];$(o).find(".btn_add_linha").first().trigger("click")}),App.PE.formulario_render_btn_add)try{App.PE.formulario_render_btn_add(e,parametros.obj_solicitacao,main)}catch(e){console.log(e)}},main.render_tabela=function(e,o,a,t,i){var n=a.data("obj_formulario"),l=a.data("obj_grupo_index"),s=a.data("obj_campo_index");const d=(e,o,a)=>{if(o.tipo_totalizador){const t=$(e.find('.td_total[ref="'+a+'"]')[0]);let r=$(e).find('[ref="'+a+'"]').not(".td_total").attr("id_elemento"),i=$(e).find('[ref="'+a+'"]').closest("tr.linha_count").not(".hidden").not(".td_total").length;switch(parseInt(o.tipo_totalizador,10)){case CAMPO_TOTALIZADOR.CONTAGEM:let e=main.get_valor(r),a=0;if(parseInt(o.tipo,10)==ELEMENTO_TIPO.CAIXA_VERIFICACAO)for(let o=0;o<e.length;o++){let t=e[o];!0!==t.valor&&"S"!==t.valor||a++}else for(let o=0;o<e.length;o++){let t=e[o];(t.valor.length||null!==t.valor&&""!==t.valor&&0!==t.valor)&&a++}$(t).text(a),o.totalizador=a;break;case CAMPO_TOTALIZADOR.CONTAGEM_DISTINCAO:let n=main.get_valor(r).map(e=>e.valor),l=0;null!==$(t).text()&&""!==$(t).text()&&(l=$(t).text());let s=n.filter(e=>o.valor==e);s.length&&1!==s.length||l++,$(t).text(l),o.totalizador=l;break;case CAMPO_TOTALIZADOR.SOMA:let _=0;if(main.get_valor(r)&&(_=main.get_valor(r).reduce((e,o)=>e+o.valor,0)),parseInt(o.tipo,10)==ELEMENTO_TIPO.DECIMAL){let e=2;parseInt(o.decimais,10)>0&&(e=parseInt(o.decimais,10)),_=_.arredondar(e),$(t).text(_.format_number(e,!0)),o.totalizador=_.format_number(e,!0)}else $(t).text(_.format_number(null,!0)),o.totalizador=_.format_number(null,!0);break;case CAMPO_TOTALIZADOR.MEDIA:let d=main.get_valor(r).reduce((e,o)=>e+o.valor,0),p=0;if(parseInt(o.tipo,10)==ELEMENTO_TIPO.DECIMAL){let e=2;parseInt(o.decimais,10)>0&&(e=parseInt(o.decimais,10)),p=(p=(p=(d=d.arredondar(e))/i).arredondar(e)).format_number(e,!0)}else p=(p=d/i).format_number(null,!0);$(t).text(p),o.totalizador=p,o.media=p}$(e).find('[ref="'+a+'"]').attr("totalizador",o.totalizador),void 0!==o.media&&$(e).find('[ref="'+a+'"]').attr("media",o.media)}},p=function(e,o){$(n.grupos[l].elementos[s].campos).each(function(a,t){if(t.tipo_totalizador){const i=$(e.find('.td_total[ref="'+t.elem_key+'"]')[0]);if($(i).attr("ref")==t.elem_key&&void 0!==o){o==t.elem_key&&(t.totalizador=0);var r=[];void 0!==n.grupos[l].elementos[s].valor&&n.grupos[l].elementos[s].valor&&$(n.grupos[l].elementos[s].valor.filter(function(e){return e.elem_key==o})).each(function(_,d){if(void 0!==o&&null!=d&&null!=d.valor&&void 0!==d.valor&&o==d.elem_key&&d.elem_key==t.elem_key){switch(parseInt(t.tipo_totalizador)){case CAMPO_TOTALIZADOR.CONTAGEM:parseInt(t.tipo,10)==ELEMENTO_TIPO.CAIXA_VERIFICACAO?"N"!=d.valor&&t.totalizador++:t.totalizador++;break;case CAMPO_TOTALIZADOR.CONTAGEM_DISTINCAO:r[_]=d.valor;var p=r.filter(function(e,o){if(""!=e&&null!=e)return r.indexOf(e)==o});t.totalizador=p.length;break;case CAMPO_TOTALIZADOR.SOMA:parseInt(t.tipo,10)==ELEMENTO_TIPO.DECIMAL?(t.totalizador=parseFloat(t.totalizador)+parseFloat(d.valor),t.totalizador=t.totalizador.arredondar(t.decimais)):t.totalizador=parseInt(t.totalizador,10)+parseInt(d.valor,10);break;case CAMPO_TOTALIZADOR.MEDIA:parseInt(t.tipo,10)==ELEMENTO_TIPO.DECIMAL?(t.totalizador=parseFloat(t.totalizador)+parseFloat(d.valor),t.totalizador=t.totalizador.arredondar(t.decimais)):t.totalizador=parseInt(t.totalizador,10)+parseInt(d.valor,10),t.media=parseFloat(t.totalizador)/parseInt(n.grupos[l].elementos[s].tamanho_render,10)}parseInt(t.tipo_totalizador,10)&&(CAMPO_TOTALIZADOR.SOMA==parseInt(t.tipo_totalizador,10)?parseInt(t.tipo,10)==ELEMENTO_TIPO.DECIMAL?$(i).text(t.totalizador.format_number(parseInt(t.decimais,10)>0?parseInt(t.decimais,10):2,!0)):$(i).text(t.totalizador.format_number(null,!0)):parseInt(t.tipo,10)==ELEMENTO_TIPO.DECIMAL&&CAMPO_TOTALIZADOR.MEDIA==parseInt(t.tipo_totalizador,10)?$(i).text(t.media.format_number(parseInt(t.decimais)>0?parseInt(t.decimais):2,!0)):parseInt(t.tipo,10)==ELEMENTO_TIPO.INTEIRO&&CAMPO_TOTALIZADOR.MEDIA==parseInt(t.tipo_totalizador,10)?$(i).text(t.media.format_number(0)):$(i).text(t.totalizador),$(e).find('[ref="'+o+'"]').attr("totalizador",t.totalizador),n.grupos[l].elementos[s].campos[a]=t)}void 0===o&&(parseInt(t.tipo,10)==ELEMENTO_TIPO.INTEIRO&&CAMPO_TOTALIZADOR.SOMA==parseInt(t.tipo_totalizador,10)?$(i).text(t.totalizador.format_number(null,!0)):CAMPO_TOTALIZADOR.MEDIA==parseInt(t.tipo_totalizador,10)?$(i).text(t.media.format_number(parseInt(t.decimais,10)>0?parseInt(t.decimais,10):2,!0)):$(i).text(t.totalizador)),0==e.find("tr.linha_count").length&&$(i).text(0)})}}})};for(var m=0;m<=o;m++){var c=$("<tr>");$(e).each(function(e,t){!function(e){var p=t.clone();if(p.hasClass("td_total")&&o==e&&o>=1)c.addClass("bg-info"),c.append(p);else if(!p.hasClass("td_total")&&e<o){var m=null,u=p.find(".div_input_arquivo"),f=p.find(".input_consulta_integracao"),v=p.find(".editor_texto");if(void 0!==u[0]){var h=a.attr("elem-key"),g=u.attr("ref");$(n.grupos[l].elementos[s].campos).each(function(e,o){o.elem_key==g&&(m=o)});var b=a.find(".linha_count").length;void 0===main.inputs_arquivo[h]&&(main.inputs_arquivo[h]=[]),void 0===main.inputs_arquivo[h][g]&&(main.inputs_arquivo[h][g]=[]),void 0===main.inputs_arquivo[h][g][b]&&(main.inputs_arquivo[h][g][b]=amdReact.createElement(InputArquivo,null,null));var O=main.inputs_arquivo[h][g][b];if(void 0===O.props&&(O=amdReact.createElement(InputArquivo,null,null)),amdReactDOM.render(O,u[0]),O.props.setClicksignAtivo(parametros.clicksign_ativo),O.props.setCertsignAtivo(parametros.certsign_ativo),O.props.setD4SignAtivo(parametros.d4sign_ativo),O.props.setElemKey(g),void 0!==parametros.obj_solicitacao&&parametros.obj_solicitacao&&void 0!==parametros.obj_solicitacao.solicitacao_id&&(O.props.setSolicitacaoID(parametros.obj_solicitacao.solicitacao_id),O.props.setSolicitacaoNumero(parametros.obj_solicitacao.numero)),O.props.setLinhaTabela(b),parametros.permissoes_formulario&&n.grupos[l].versao_formulario_grupo_id){var I=PROCESSO_ATIVIDADE_FORMULARIO_PERMISSAO.NAO_EXIBIR;switch($(parametros.permissoes_formulario).each(function(e,o){n.grupos[l].versao_formulario_grupo_id==o.versao_formulario_grupo_id&&(I=parseInt(o.permissao,10))}),parametros.liberar_campos?I=PROCESSO_ATIVIDADE_FORMULARIO_PERMISSAO.EDITAR:(parametros.disabled_all||void 0!==main.obj_solicitacao&&"S"==main.obj_solicitacao.cancelada||void 0!==main.obj_solicitacao&&main.obj_solicitacao.entrega)&&(I=PROCESSO_ATIVIDADE_FORMULARIO_PERMISSAO.VISUALIZAR),I){case PROCESSO_ATIVIDADE_FORMULARIO_PERMISSAO.NAO_EXIBIR:case PROCESSO_ATIVIDADE_FORMULARIO_PERMISSAO.VISUALIZAR:O.props.setDesabilitado(!0);break;case PROCESSO_ATIVIDADE_FORMULARIO_PERMISSAO.EDITAR:O.props.setDesabilitado(!1)}}else O.props.setDesabilitado(!0===parametros.disabled_all);"true"!==m.obrigatorio&&!0!==m.obrigatorio||O.props.setObrigatorio(!0),O.props.setExibirPrevisao((m.exibir_previsao_imagem,m.exibir_previsao_imagem));O.props.objCampoTabela=m,O.props.handleAlterado=function(e,o){var a=e.props.arquivoSelecionado||null,t=null,r=null;if(void 0===parametros.obj_formulario.grupos[l].elementos[s].valor)parametros.obj_formulario.grupos[l].elementos[s].valor=[];else for(var i=0;i<parametros.obj_formulario.grupos[l].elementos[s].valor.length;i++)if(parametros.obj_formulario.grupos[l].elementos[s].valor[i].linha==e.props.linhaTabela&&parametros.obj_formulario.grupos[l].elementos[s].valor[i].elem_key==o.elem_key){t=parametros.obj_formulario.grupos[l].elementos[s].valor[i],r=i;break}null==r&&(r=parametros.obj_formulario.grupos[l].elementos[s].valor.length,parametros.obj_formulario.grupos[l].elementos[s].valor[r]=null,t={linha:e.props.linhaTabela,elem_key:o.elem_key,anexo:null}),t.anexo=a,t.arquivo_validacao_tamanho=a?a.size:null,t.valor=e.props.documentoRevisaoID,t.excluido=!e.props.arquivoSelecionado,parametros.obj_formulario.grupos[l].elementos[s].valor[r]=t,executar_evento(o,parametros.div_formulario,"alterar",o.id_elemento,null,e),executar_evento(o,parametros.div_formulario,"alterar_construtor",o.id_elemento,null,e),main.div_formulario.dados_modificados=!0}}else if(void 0!==f[0]){h=a.attr("elem-key"),b=a.find(".linha_count").length,g=f.attr("ref");var E=n.grupos[l].elementos[s].campos.filter(function(e,o){return e.elem_key==g})[0],A="0"==$(a).data().objTabela.tamanho&&E.selecao_multipla_integracao;main.renderizar_campo_integracao(f,parametros,l,s,executar_evento,null,g,b,a,h,A)}else if(void 0!==v[0]){h=a.attr("elem-key"),g=v.attr("ref"),b=a.find(".linha_count").length;v.attr("id",_+"_"+b);var T=function(){if(main.div_formulario.dados_modificados=!0,$(v.parents("tr")).hasClass("linha_count")){var e={linha:b,elem_key:g,valor:get_tinymce(v)};void 0!==parametros.obj_formulario.grupos[l].elementos[s].valor&&"string"!=typeof parametros.obj_formulario.grupos[l].elementos[s].valor&&null!=parametros.obj_formulario.grupos[l].elementos[s].valor||(parametros.obj_formulario.grupos[l].elementos[s].valor=[]);var o=!1;$(parametros.obj_formulario.grupos[l].elementos[s].valor).each(function(a,t){null!=t&&t.elem_key==D&&t.linha==e.linha&&(o=!0,parametros.obj_formulario.grupos[l].elementos[s].valor[a]=e)}),o||parametros.obj_formulario.grupos[l].elementos[s].valor.push(e)}else parametros.obj_formulario.grupos[l].elementos[s].valor=W;executar_evento(r,parametros.div_formulario,"alterar",r.id_elemento,null,c),executar_evento(r,parametros.div_formulario,"alterar_construtor",r.id_elemento,null,c)};setTimeout(function(){if(W=null,void 0!==parametros.obj_formulario.grupos[l].elementos[s].valor)for(var e=0;e<parametros.obj_formulario.grupos[l].elementos[s].valor.length;e++){var o=parametros.obj_formulario.grupos[l].elementos[s].valor[e];o.elem_key==g&&o.linha==b&&(W=o.valor)}if(parametros.permissoes_formulario&&n.grupos[l].versao_formulario_grupo_id){var a=PROCESSO_ATIVIDADE_FORMULARIO_PERMISSAO.NAO_EXIBIR;$(parametros.permissoes_formulario).each(function(e,o){n.grupos[l].versao_formulario_grupo_id==o.versao_formulario_grupo_id&&(a=parseInt(o.permissao,10))}),parametros.liberar_campos?a=PROCESSO_ATIVIDADE_FORMULARIO_PERMISSAO.EDITAR:(parametros.disabled_all||void 0!==main.obj_solicitacao&&"S"==main.obj_solicitacao.cancelada||void 0!==main.obj_solicitacao&&main.obj_solicitacao.entrega)&&(a=PROCESSO_ATIVIDADE_FORMULARIO_PERMISSAO.VISUALIZAR);var t=void 0!==a&&a!=PROCESSO_ATIVIDADE_FORMULARIO_PERMISSAO.EDITAR}set_tinymce(v,W,t,null,T,parametros.obj_formulario.grupos[l].elementos[s].style)})}const o=e=>{e.on("click",function(o){$(a).find(".btn_exclui_linha").prop("disabled",!0),function(){var t=$(e).parent().parent();t.addClass("hidden");const r=parseInt($(e).closest("tr").attr("linha_count")||0);$(e).closest("table").find("tr").each(function(e,o){const a=parseInt($(o).attr("linha_count")||0);a>r&&$(o).attr("linha_count",a-1)});for(let e=0;e<main.campos_integracao_tabela.length;e++){const o=main.campos_integracao_tabela[e];o.tabela_elem_key==a.attr("elem-key")&&(o.linha===r?main.campos_integracao_tabela[e]=null:o.linha>r&&(main.campos_integracao_tabela[e].linha=o.linha-1))}main.campos_integracao_tabela=main.campos_integracao_tabela.filter(e=>!!e),main.id_linha_del=t[0].rowIndex-1,main.id_linha_del_arquivo=t[0].rowIndex-1;for(var i=$(t).filter(function(){return $(t)[0].rowIndex-1===main.id_linha_del}).find("input, textarea, select"),p=null,m=null,c=0;c<=i.length;c++)p=i[c],(m=$(p).attr("ref"))||$(p).parents().closest("div.div_input_arquivo").length>0&&(m=$(p).parents().closest("div.div_input_arquivo").attr("ref")),$(n.grupos[l].elementos[s]).each(function(e,t){$(t.campos).each(function(e,t){if(t.elem_key==m)return executar_evento(t,parametros.div_formulario,"alterar",t.id_elemento,null,o),executar_evento(t,parametros.div_formulario,"alterar_construtor",t.id_elemento,null,o),void(t.tipo_totalizador&&d(a,t,m))})});tinyMCE.get(_+"_"+main.id_linha_del_arquivo)&&tinyMCE.get(_+"_"+main.id_linha_del_arquivo).remove();$(e).parent().parent().remove(),void 0!==main.inputs_arquivo[a.attr("elem-key")]&&Array.isArray(main.inputs_arquivo[a.attr("elem-key")])&&(Object.keys(main.inputs_arquivo[a.attr("elem-key")]).forEach(function(e,o){var t=main.inputs_arquivo[a.attr("elem-key")][e];Array.isArray(t)&&(t.forEach(function(e,o){o==main.id_linha_del_arquivo&&(t[o]={}),o>parseInt(main.id_linha_del_arquivo,10)&&(t[o-1]=t[o],void 0!==t[o-1].props&&t[o-1].props.setLinhaTabela(o-1))}),t[t.length-1]={})}),main.id_linha_del_arquivo=null);0==a.find("tr.linha_count").length&&(n.grupos[l].elementos[s].valor=[],$(a).find("td").each(function(e,o){$(o).hasClass("td_total")&&$(n.grupos[l].elementos[s].campos).each(function(e,a){$(o).text("")})}));"undefined"!=typeof linha_deletada&&linha_deletada||$(t.find("input, textarea, select")).each(function(e,a){var t=$(a).attr("ref");$(n.grupos[l].elementos[s]).each(function(e,a){void 0!==a.campos&&$(a.campos).each(function(e,a){a.elem_key==t&&(executar_evento(a,parametros.div_formulario,"alterar",a.id_elemento,null,o),executar_evento(a,parametros.div_formulario,"alterar_construtor",a.id_elemento,null,o))})})});var u=parseInt(n.grupos[l].elementos[s].tamanho_render,10)-1;n.grupos[l].elementos[s].tamanho_render=u,main.div_formulario.dados_modificados=!0;let f=parametros.obj_formulario.grupos[l].elementos[s].valor;f&&f.length&&(f.forEach((e,o)=>{e.linha==main.id_linha_del&&(f[o]=null),e.linha>main.id_linha_del&&(f[o].linha-=1,f[o].linha=f[o].linha.toString())}),f=f.filter(e=>!!e&&Object.keys(e).length>0),parametros.obj_formulario.grupos[l].elementos[s].valor=f);$(a).attr("tipo_linha")==FORMULARIO_TABELA_TIPO_LINHA.MINIMO&&$(a).attr("total_linhas")>0&&$(a).find("tr.linha_count").length<=$(a).attr("total_linhas")&&$(a).find(".btn_exclui_linha").addClass("hidden")}(),$(a).find(".btn_exclui_linha").prop("disabled",!1)})};var y=$(p.find(".btn_exclui_linha"));o(y),$(a).attr("tipo_linha")==FORMULARIO_TABELA_TIPO_LINHA.MINIMO&&$(a).attr("total_linhas")>0&&$(a).find("tr.linha_count").length<$(a).attr("total_linhas")&&$(y).addClass("hidden");var k=$(p.find(".btn_tabela"));k.unbind("click"),k.click(function(e){$(n.grupos[l].elementos[s].campos).each(function(o,a){a.elem_key==k.attr("ref")&&(a.objeto=null,n.grupos[l].elementos[s].campos[o]=a,executar_evento(a,parametros.div_formulario,"clicar",a.id_elemento,null,e))})});var x=$(p.find(".input_doc")),S=$(p.find(".button_limpar_doc")),M=$(p.find(".btn_download")),C=$(p.find(".btn_documento"));$(p.find(".btn_assinatura")).addClass("btn_assinatura_"+e.toString()),$(p.find(".btn_assinatura_"+e.toString())),S.unbind("click"),S.click(function(e){x.val("").trigger("change"),x.attr("objeto",""),$(n.grupos[l].elementos[s].campos).each(function(o,a){a.elem_key==x.attr("ref")&&(a.valor=null,n.grupos[l].elementos[s].campos[o]=a,executar_evento(a,parametros.div_formulario,"limpar",a.id_elemento,null,e),main.div_formulario.dados_modificados=!0)}),S.addClass("hidden"),M.addClass("hidden"),C.removeClass("hidden")}),C.unbind("click"),C.click(function(e){View.load("central_documentos/selecionar",function(o,a){a.show(function(o){S.removeClass("hidden"),M.removeClass("hidden"),C.addClass("hidden"),x.attr("objeto",JSON.stringify(o)),executar_evento(r,parametros.div_formulario,"selecionar",r.id_elemento,null,e),x.val(o.nome).trigger("change"),$(n.grupos[l].elementos[s].campos).each(function(a,t){t.elem_key==x.attr("ref")&&(t.valor=o,n.grupos[l].elementos[s].campos[a]=t,executar_evento(t,parametros.div_formulario,"selecionar",t.id_elemento,null,e),main.div_formulario.dados_modificados=!0)}),M.click(function(){var e=$($(this).parent().parent().find("input")).attr("objeto");e=""!=e?JSON.parse(e):"",App.obter_token_publico(function(o){App.download(WS_URI+"documento/download/?documento_revisao_id="+e.documento_revisao_id+"&solicitacao=true&token_publico="+o)},e.documento_revisao_id)})},p.attr("documento_pasta_id"))})}),p.find("input, textarea, select").on("change",function(e){void 0!==n.grupos[l].elementos[s].valor&&"string"!=typeof n.grupos[l].elementos[s].valor&&null!=n.grupos[l].elementos[s].valor||(n.grupos[l].elementos[s].valor=[]);var o=$(this).attr("ref"),t=void 0!==$($(this).parent().parent().parent()).attr("linha_count")?$($(this).parent().parent().parent()).attr("linha_count"):$($(this).parent().parent()).attr("linha_count"),r={linha:t,elem_key:o},i=null;if($(n.grupos[l].elementos[s].campos).each(function(e,a){a.elem_key==o&&(i=a)}),i&&t){switch(parseInt(i.tipo,10)){case ELEMENTO_TIPO.TEXTO:r.valor=this.value,i.valor=this.value,i.linha=t;break;case ELEMENTO_TIPO.SELECAO_DOCUMENTO:r.valor=""!=$(this).attr("objeto")?JSON.parse($(this).attr("objeto")):"",i.valor=""!=$(this).attr("objeto")?JSON.parse($(this).attr("objeto")):"",i.linha=t;break;case ELEMENTO_TIPO.INTEIRO:r.valor=null!==this.value&&""!==this.value.trim()?this.value.replace(/[^-?0-9]/g,""):null,i.valor=null!==this.value&&""!==this.value.trim()?this.value.replace(/[^-?0-9]/g,""):null,i.linha=t;break;case ELEMENTO_TIPO.DECIMAL:r.valor=null!==$(this).val()&&""!==$(this).val().trim()?$(this).maskMoney("unmasked")[0]:null,i.valor=null!==$(this).val()&&""!==$(this).val().trim()?$(this).maskMoney("unmasked")[0]:null,i.linha=t;break;case ELEMENTO_TIPO.OPCOES:parseInt(i.tipo_lista_opcoes,10)==TIPO_LISTA_OPCOES.OPTION_MULTIPLAS||parseInt(i.tipo_lista_opcoes,10)==TIPO_LISTA_OPCOES.OPTION||parseInt(i.tipo_lista_opcoes,10)==TIPO_LISTA_OPCOES.RADIO?(r.valor=$(this).val(),i.valor=$(this).val(),i.linha=t):parseInt(i.tipo_lista_opcoes,10)==TIPO_LISTA_OPCOES.CHECKBOX?(r.valor=[],$(this).parent().find('input[type="checkbox"]:checked').each(function(e,o){r.valor.push($(this).val()),i.valor=$(this).val(),i.linha=t})):(r.valor=$(this).val(),i.valor=$(this).val(),i.linha=t);break;case ELEMENTO_TIPO.MASCARA:r.valor=this.value,i.valor=this.value,i.linha=t;break;case ELEMENTO_TIPO.DATA:Modernizr.inputtypes.date,r.valor=get_datepicker($(this)),i.valor=get_datepicker($(this)),i.linha=t;break;case ELEMENTO_TIPO.CAIXA_VERIFICACAO:$(this).attr("value",1==$(this).prop("checked")?"S":""),r.valor=1==$(this).prop("checked")?"S":"N",i.valor=1==$(this).prop("checked")?"S":"N",i.linha=t;break;case ELEMENTO_TIPO.ANEXO:}var _=!1;main.cliquei_deletar?($(n.grupos[l].elementos[s].valor).each(function(e,a){void 0!==n.grupos[l].elementos[s].valor[e].linha&&(parseInt(n.grupos[l].elementos[s].valor[e].linha,10)>0&&parseInt(n.grupos[l].elementos[s].valor[e].linha,10)>parseInt(main.id_linha_del,10)&&(n.grupos[l].elementos[s].valor[e].linha=(parseInt(a.linha,10)-1).toString()),a==a!=null&&a.elem_key==o&&a.linha==r.linha&&(_=!0,null!=n.grupos[l].elementos[s].valor[e].valor&&(n.grupos[l].elementos[s].valor[e]=r)))}),main.cliquei_deletar=!1):$(n.grupos[l].elementos[s].valor).each(function(e,a){null!=a&&a.elem_key==o&&a.linha==r.linha&&(_=!0,n.grupos[l].elementos[s].valor[e]=r)}),_||n.grupos[l].elementos[s].valor.push(r),d(a,i,o),executar_evento(i,parametros.div_formulario,"alterar",i.id_elemento,null,e),executar_evento(i,parametros.div_formulario,"alterar_construtor",i.id_elemento,null,e)}}),p.find("input, textarea, select").bind("keyup",function(e){main.div_formulario.dados_modificados=!0}),c.addClass("linha_count").attr("linha_count",a.find(".linha_count").length).append(p)}var P=!1;if(!0!==i&&void 0!==r.valor&&Array.isArray(r.valor))for(var R=0;R<r.valor.length;R++)if(void 0!==r.valor[R].linha&&r.valor[R].linha==e&&p.attr("elem_key")===r.valor[R].elem_key){P=!0;break}if(!1===P){m=null;var D=p.find("select, radio, input").attr("ref");if($(n.grupos[l].elementos[s].campos).each(function(e,o){o.elem_key==D&&(m=o)}),m&&m.tipo==ELEMENTO_TIPO.OPCOES&&void 0!==m.opcoes_padrao&&m.opcoes_padrao&&m.opcoes_padrao.length>0){var j=m.tipo_lista_opcoes==TIPO_LISTA_OPCOES.RADIO?p:p.find("select");if(m.tipo_lista_opcoes==TIPO_LISTA_OPCOES.OPTION_MULTIPLAS)j.val(m.opcoes_padrao).trigger("change").selectpicker("refresh");else if(m.tipo_lista_opcoes==TIPO_LISTA_OPCOES.CHECKBOX){if(m.opcoes_padrao&&Array.isArray(m.opcoes_padrao))for(var L=0;L<m.opcoes_padrao.length;L++)p.find("input").each(function(e,o){m.opcoes_padrao[L]==o.value&&$(o).prop("checked",!0)}).trigger("change")}else m.tipo_lista_opcoes==TIPO_LISTA_OPCOES.RADIO?j.find('[value="'+m.opcoes_padrao[0]+'"]').prop("checked",!0).trigger("click"):j.val(m.opcoes_padrao[0]).trigger("change")}}}(m)});var u=$(a.find(".linha_count")).filter(function(e,o){return e+1==$(a.find(".linha_count")).length});u=u.attr("linha_count");var f=$(a.find("tbody").find("tr")[parseInt(u,10)+1]);f.hasClass("bg-info")&&$(f).remove(),c.find(".radio_block").each(function(e,o){const a=$(o),t=a.find("input"),r=a.find("label");t.attr("name",md5(new Date+Math.random()+Math.random())),t.each(function(e,o){const a=$(o),t=md5(new Date+Math.random()+Math.random());a.attr("id",t),$(r[e]).attr("for",t)})}),t?c.prependTo(a):c.appendTo(a);var v=[];$(n.grupos[l].elementos[s].valor).each(function(e,o){v.push(o.elem_key)}),v=v.filter(function(e,o){if(""!=e&&null!=e)return v.indexOf(e)==o});for(var h=0;h<v.length;h++){var g=v[h];p(a,g)}}if(a.find("select.selectpicker").selectpicker("refresh"),App.PE.formulario_render_tabela_depois)try{App.PE.formulario_render_tabela_depois(a,parametros.obj_solicitacao)}catch(e){console.log(e)}},l){case ELEMENTO_TIPO.TEXTO:(parseInt(r.linhas,10)||1)>1?(c.append('<textarea class="formulario_campo formulario_textarea form-control id_elemento" id_elemento="'+r.id_elemento+'" id_elemento_vm="campos.elemento_html_'+r.id_elemento+'" id="'+_+'" rows="'+r.linhas+'" maxlength="'+r.tamanho+'" style="'+r.style+'"></textarea>'),c.find("textarea").change(function(a){parametros.obj_formulario.grupos[e].elementos[o].valor=this.value,executar_evento(r,parametros.div_formulario,"alterar",r.id_elemento,null,a),executar_evento(r,parametros.div_formulario,"alterar_construtor",r.id_elemento,null,a)}),c.find("textarea").keyup(function(e){main.div_formulario.dados_modificados=!0})):(c.append('<input type="text" class="formulario_campo form-control id_elemento" style="'+r.style+'" id_elemento="'+r.id_elemento+'" id_elemento_vm="campos.elemento_html_'+r.id_elemento+'" id="'+_+'" maxlength="'+r.tamanho+'">'),c.find("input").change(function(a){this.value!=parametros.obj_formulario.grupos[e].elementos[o].valor&&(parametros.obj_formulario.grupos[e].elementos[o].valor=this.value,executar_evento(r,parametros.div_formulario,"alterar",r.id_elemento,null,a),executar_evento(r,parametros.div_formulario,"alterar_construtor",r.id_elemento,null,a))}),c.find("input").keyup(function(e){main.div_formulario.dados_modificados=!0}));break;case ELEMENTO_TIPO.TEXTO_FIXO:c.append('<div class="formulario_campo text_fixo id_elemento" type="text" style="'+r.style+'" id_elemento="'+r.id_elemento+'" id_elemento_vm="campos.elemento_html_'+r.id_elemento+'" id="'+_+'" >'+nl2br(r.nome)+"</div>");break;case ELEMENTO_TIPO.INTEIRO:c.append('<input type="text" type_campo="inteiro" class="formulario_campo form-control text-right id_elemento" style="'+r.style+'" id_elemento="'+r.id_elemento+'" id_elemento_vm="campos.elemento_html_'+r.id_elemento+'" id="'+_+'" data-thousands="." data-allow-zero="true" data-allow-negative="true" data-precision="0" maskmoney>'),c.find("input").bind("change",function(a){parametros.obj_formulario.grupos[e].elementos[o].valor=this.value.replace(/[^0-9]/g,""),executar_evento(r,parametros.div_formulario,"alterar",r.id_elemento,null,a),executar_evento(r,parametros.div_formulario,"alterar_construtor",r.id_elemento,null,a)}),c.find("input").keyup(function(e){main.div_formulario.dados_modificados=!0});break;case ELEMENTO_TIPO.DECIMAL:let a=parseInt(r.decimais,10),t=".",i=",",n="true",s="true",d=`<input type="text" \n                                        type_campo="decimal" \n                                        qtd_decimais="${a}" \n                                        class="formulario_campo form-control"\n                                        style="${r.style}"\n                                        id_elemento="${r.id_elemento}" \n                                        id_elemento_vm="campos.elemento_html_${r.id_elemento}" \n                                        id="${_}" \n                                        data-thousands="${t}" \n                                        data-decimal="${i}" \n                                        data-allow-zero="${n}" \n                                        data-allow-negative="${s}" \n                                        data-precision="${a}" \n                                        maskmoney>\n                                    `;c.append(d),c.find("input").bind("change",function(a){parametros.obj_formulario.grupos[e].elementos[o].valor=""!=$(this).val()?$(this).maskMoney("unmasked")[0]:null,executar_evento(r,parametros.div_formulario,"alterar",r.id_elemento,null,a),executar_evento(r,parametros.div_formulario,"alterar_construtor",r.id_elemento,null,a)}),c.find("input").keyup(function(e){main.div_formulario.dados_modificados=!0});break;case ELEMENTO_TIPO.OPCOES:if(r.tipo_lista_opcoes==TIPO_LISTA_OPCOES.CHECKBOX){var u=md5(Math.random()+Math.random()+new Date),f=$('<div class="radio_block text-left">');"true"!==r.obrigatorio&&!0!==r.obrigatorio||f.addClass("vld_lista_check"),$(r.opcoes).each(function(e,o){var a=$('<input type="checkbox" class="template_switch formulario_campo id_elemento" style="'+r.style+'" id_elemento="'+r.id_elemento+'" id_elemento_vm="campos.elemento_html_'+r.id_elemento+'" id="'+_+e+'" name="'+u+'" value="'+o+'"><label for="'+_+e+'" style="padding: 3px; width: calc(100% - 13px);">'+o+"</label></input>");f.append(a).append("<br>")}),f.appendTo(c)}else if(r.tipo_lista_opcoes==TIPO_LISTA_OPCOES.RADIO){u=md5(Math.random()+Math.random()+new Date),f=$('<div class="radio_block text-left">');"true"!==r.obrigatorio&&!0!==r.obrigatorio||f.addClass("vld_lista_radio"),$(r.opcoes).each(function(e,o){var a=$('<input type="radio" class="formulario_campo id_elemento" style="'+r.style+'" id_elemento="'+r.id_elemento+'" id_elemento_vm="campos.elemento_html_'+r.id_elemento+'" id="'+_+e+'" name="'+u+'" value="'+o+'"><label for="'+_+e+'" style="padding-left:4px">'+o+"</label></input>");f.append(a).append("<br>")}),f.appendTo(c)}else if(r.tipo_lista_opcoes==TIPO_LISTA_OPCOES.OPTION_MULTIPLAS){c.append('<select title="" type="select" class="formulario_campo form-control id_elemento selectpicker vld_lista_option_multiplas" multiple style="'+r.style+'" id_elemento="'+r.id_elemento+'" id_elemento_vm="campos.elemento_html_'+r.id_elemento+'" id="'+_+'">');var v=c.find("select");$(r.opcoes).each(function(e,o){add_option(v,o,o)}),v.selectpicker("refresh")}else{c.append('<select type="select" class="formulario_campo form-control id_elemento vld_lista_option" style="'+r.style+'" id_elemento="'+r.id_elemento+'" id_elemento_vm="campos.elemento_html_'+r.id_elemento+'" id="'+_+'">');v=c.find("select");add_option(v,"",""),$(r.opcoes).each(function(e,o){add_option(v,o,o)})}r.tipo_lista_opcoes==TIPO_LISTA_OPCOES.RADIO?c.find('input[type="radio"]').click(function(a){""!=this.value&&(parametros.obj_formulario.grupos[e].elementos[o].valor=$(this).val(),executar_evento(r,parametros.div_formulario,"alterar",r.id_elemento,null,a),executar_evento(r,parametros.div_formulario,"alterar_construtor",r.id_elemento,null,a))}):r.tipo_lista_opcoes==TIPO_LISTA_OPCOES.CHECKBOX?(c.find('input[type="checkbox"]').on("change change_constructor",function(a){parametros.obj_formulario.grupos[e].elementos[o].valor=[],$(this).parent().find('input[type="checkbox"]:checked').each(function(a,t){parametros.obj_formulario.grupos[e].elementos[o].valor.push($(this).val())}),"change_constructor"===a.type?executar_evento(r,parametros.div_formulario,"alterar_construtor",r.id_elemento,null,a):(executar_evento(r,parametros.div_formulario,"alterar",r.id_elemento,null,a),executar_evento(r,parametros.div_formulario,"alterar_construtor",r.id_elemento,null,a))}),c.find('input[type="checkbox"]').keyup(function(e){main.div_formulario.dados_modificados=!0})):(r.tipo_lista_opcoes,TIPO_LISTA_OPCOES.OPTION,c.find("select").on("change change_constructor",function(a){parametros.obj_formulario.grupos[e].elementos[o].valor=$(this).val(),"change_constructor"===a.type?executar_evento(r,parametros.div_formulario,"alterar_construtor",r.id_elemento,null,a):(executar_evento(r,parametros.div_formulario,"alterar",r.id_elemento,null,a),executar_evento(r,parametros.div_formulario,"alterar_construtor",r.id_elemento,null,a))}),c.find("select").keyup(function(e){main.div_formulario.dados_modificados=!0}));break;case ELEMENTO_TIPO.MASCARA:c.append('<input type="text" class="formulario_campo form-control id_elemento" style="'+r.style+'" id_elemento="'+r.id_elemento+'" id_elemento_vm="campos.elemento_html_'+r.id_elemento+'" id="'+_+'" maxlength="'+r.tamanho+'" data-mask="'+r.mascara+'" masktext>'),c.find("input").change(function(a){parametros.obj_formulario.grupos[e].elementos[o].valor=this.value,executar_evento(r,parametros.div_formulario,"alterar",r.id_elemento,null,a),executar_evento(r,parametros.div_formulario,"alterar_construtor",r.id_elemento,null,a)}),c.find("input").keyup(function(e){main.div_formulario.dados_modificados=!0});break;case ELEMENTO_TIPO.DATA:var h="1900-01-01",g=new Date,b=("0"+g.getDate()).slice(-2),O=("0"+(g.getMonth()+1)).slice(-2);!r.data_retroativa||!0!==r.data_retroativa&&"true"!==r.data_retroativa||(h=g.getFullYear()+"-"+O+"-"+b),!r.data_retroativa_igual||!0!==r.data_retroativa_igual&&"true"!==r.data_retroativa_igual||(h=g.getFullYear()+"-"+O+"-"+(b?parseInt(b,10)+1:"")),c.append('<input type="date" style="'+r.style+'" data_retroativa_igual="'+(!0===r.data_retroativa_igual?"S":"N")+'" data_retroativa="'+(!0===r.data_retroativa?"S":"N")+'" min="'+h+'" max="2222-12-31" id_elemento="'+r.id_elemento+'" id_elemento_vm="campos.elemento_html_'+r.id_elemento+'" class="id_elemento formulario_campo form-control" id="'+_+'">'),set_datepicker(c.find("input")),c.find("input").change(function(a){parametros.obj_formulario.grupos[e].elementos[o].valor=get_datepicker($(this)),executar_evento(r,parametros.div_formulario,"alterar",r.id_elemento,null,a),executar_evento(r,parametros.div_formulario,"alterar_construtor",r.id_elemento,null,a)}),c.find("input").keyup(function(e){main.div_formulario.dados_modificados=!0});break;case ELEMENTO_TIPO.CAIXA_VERIFICACAO:let p="S"===r.valor||!0===r.valor?"S":"";c.prepend('<input type="checkbox" style="'+r.style+'" id_elemento="'+r.id_elemento+'" id_elemento_vm="campos.elemento_html_'+r.id_elemento+'" class="id_elemento formulario_campo template_switch caixa_verificacao" id="'+_+'" value="'+p+'" >'),c.find("input").change(function(a){$(this).attr("value",1==$(this).prop("checked")?"S":""),parametros.obj_formulario.grupos[e].elementos[o].valor=1==$(this).prop("checked")?"S":"N",executar_evento(r,parametros.div_formulario,"alterar",r.id_elemento,null,a),executar_evento(r,parametros.div_formulario,"alterar_construtor",r.id_elemento,null,a)}),c.find("input").keyup(function(e){main.div_formulario.dados_modificados=!0});break;case ELEMENTO_TIPO.BOTAO:c.children().remove(),c.prepend('<button type="button" style="'+r.style+'" value="" id_elemento="'+r.id_elemento+'" id_elemento_vm="campos.elemento_html_'+r.id_elemento+'" class="id_elemento formulario_campo formulario_botao btn_form btn btn-default" id="'+_+'">'+r.nome+"</button>"),c.find("button").click(function(e){executar_evento(r,parametros.div_formulario,"clicar",r.id_elemento,null,e)});break;case ELEMENTO_TIPO.SELECAO_DOCUMENTO:var I=$('<div class="input-group">'),E=$('<input type="text" class="formulario_campo form-control id_elemento input_doc" readonly id_elemento="'+r.id_elemento+'" id_elemento_vm="campos.elemento_html_'+r.id_elemento+'" id="'+_+'" maxlength="'+r.tamanho+'">'),A=$('<div class="input-group-btn">'),T=$('<button type="button" class="btn_documento btn btn-default" data-toggle="tooltip" title="Pesquisar">'),y=$('<span class="glyphicon glyphicon-search"></span>'),k=$('<button type="button" class="btn_download hidden btn btn-default" data-toggle="tooltip" title="Download">'),x=$('<span class="glyphicon glyphicon-download-alt"></span>'),S=$('<button type="button" class="button_limpar_doc btn btn-default hidden" data-toggle="tooltip" title="Limpar Campo">'),M=$('<span class="glyphicon glyphicon-remove"></span>');S.unbind("click"),S.click(function(a){E.val("").trigger("change"),E.attr("objeto",""),parametros.obj_formulario.grupos[e].elementos[o].valor=null,executar_evento(r,parametros.div_formulario,"limpar",r.id_elemento,null,a),S.addClass("hidden"),k.addClass("hidden"),T.removeClass("hidden"),main.div_formulario.dados_modificados=!0}),T.unbind("click"),T.click(function(a){View.load("central_documentos/selecionar",function(t,i){i.show(function(t){S.removeClass("hidden"),k.removeClass("hidden"),T.addClass("hidden"),executar_evento(r,parametros.div_formulario,"selecionar",r.id_elemento,null,a),E.val(t.nome),E.attr("objeto",JSON.stringify(t)),parametros.obj_formulario.grupos[e].elementos[o].valor=t,k.click(function(){var e=$($(this).parent().parent().find("input")).attr("objeto");e=""!=e?JSON.parse(e):"",App.obter_token_publico(function(o){App.download(WS_URI+"documento/download/?documento_revisao_id="+e.documento_revisao_id+"&solicitacao=true&token_publico="+o)},e.documento_revisao_id)}),main.div_formulario.dados_modificados=!0},r.documento_pasta_id)})}),y.appendTo(T),T.appendTo(A),M.appendTo(S),S.appendTo(A),x.appendTo(k),k.appendTo(A),E.appendTo(I),A.appendTo(I),c.append(I);break;case ELEMENTO_TIPO.INTEGRACAO:const J=parametros.div_formulario&&parametros.div_formulario.html_id?parametros.div_formulario.html_id:null;var C=$('<div class="input_consulta_integracao formulario_campo id_elemento" id_elemento="'+r.id_elemento+'" id_elemento_vm="campos.elemento_html_'+r.id_elemento+'" id="'+_+'" maxlength="'+r.tamanho+'" view_html_id="'+J+'">');c.append(C),main.renderizar_campo_integracao(C,parametros,e,o,executar_evento,r);break;case ELEMENTO_TIPO.ANEXO:var P=$('<div class="div_input_arquivo" id_elemento="'+r.id_elemento+'" ref="'+r.elem_key+'">');main.inputs_arquivo[r.elem_key]=amdReact.createElement(InputArquivo,null,null);var R=main.inputs_arquivo[r.elem_key];if(amdReactDOM.render(R,P[0]),R.props.setClicksignAtivo(parametros.clicksign_ativo),R.props.setCertsignAtivo(parametros.certsign_ativo),R.props.setD4SignAtivo(parametros.d4sign_ativo),r.documento_revisao&&R.props.setDocumentoRevisaoID(r.valor,r.documento_revisao.mime_type,r.documento_revisao.nome_arquivo,r.documento_revisao.tamanho),R.props.setElemKey(r.elem_key),void 0!==parametros.obj_solicitacao&&parametros.obj_solicitacao&&void 0!==parametros.obj_solicitacao.solicitacao_id&&(R.props.setSolicitacaoID(parametros.obj_solicitacao.solicitacao_id),R.props.setSolicitacaoNumero(parametros.obj_solicitacao.numero)),parametros.permissoes_formulario&&parametros.obj_formulario.grupos[e].versao_formulario_grupo_id){var D=PROCESSO_ATIVIDADE_FORMULARIO_PERMISSAO.NAO_EXIBIR;switch($(parametros.permissoes_formulario).each(function(o,a){parametros.obj_formulario.grupos[e].versao_formulario_grupo_id==a.versao_formulario_grupo_id&&(D=parseInt(a.permissao,10))}),parametros.liberar_campos?D=PROCESSO_ATIVIDADE_FORMULARIO_PERMISSAO.EDITAR:(parametros.disabled_all||void 0!==main.obj_solicitacao&&"S"==main.obj_solicitacao.cancelada||void 0!==main.obj_solicitacao&&main.obj_solicitacao.entrega)&&(D=PROCESSO_ATIVIDADE_FORMULARIO_PERMISSAO.VISUALIZAR),D){case PROCESSO_ATIVIDADE_FORMULARIO_PERMISSAO.NAO_EXIBIR:case PROCESSO_ATIVIDADE_FORMULARIO_PERMISSAO.VISUALIZAR:R.props.setDesabilitado(!0);break;case PROCESSO_ATIVIDADE_FORMULARIO_PERMISSAO.EDITAR:R.props.setDesabilitado(!1)}}else R.props.setDesabilitado(!1);"true"!==r.obrigatorio&&!0!==r.obrigatorio||R.props.setObrigatorio(!0),R.props.setExibirPrevisao((r.exibir_previsao_imagem,r.exibir_previsao_imagem));R.props.handleAlterado=function(a){var t=a.props.arquivoSelecionado||null;parametros.obj_formulario.grupos[e].elementos[o].anexo=t,parametros.obj_formulario.grupos[e].elementos[o].arquivo_validacao_tamanho=t?t.size:null,parametros.obj_formulario.grupos[e].elementos[o].valor=a.props.documentoRevisaoID,parametros.obj_formulario.grupos[e].elementos[o].excluido=!a.props.arquivoSelecionado,executar_evento(r,parametros.div_formulario,"alterar",r.id_elemento,null,a),executar_evento(r,parametros.div_formulario,"alterar_construtor",r.id_elemento,null,a),main.div_formulario.dados_modificados=!0},c.append(P);break;case ELEMENTO_TIPO.TABELA:var j=$('<table class="table table-striped" elem-key="'+r.elem_key+'" id_elemento="'+r.id_elemento+'" id_elemento_vm="campos.elemento_html_'+r.id_elemento+'" table_id="'+r.id_elemento+'" id="'+_+'" tipo_linha="'+r.tipo_linha+'" total_linhas="'+r.tamanho+'">'),L=$("<thead><tr></tr></thead>"),N=r.tamanho;let H=r.tipo_linha;r.tamanho_render=r.tamanho_render?r.tamanho_render:1,N>0&&(r.tamanho_render=N),void 0!==r.valor&&Array.isArray(r.valor)&&r.valor.length>0&&(r.tamanho_render=main.contar_linhas_tabela(r.valor,r.tamanho_render));var w=[];if($(r.campos).each(function(e,o){if(o.tipo!=ELEMENTO_TIPO.TEXTO_FIXO){var a;a='<span class="lbl_obrigatorio text-danger" '+(1==o.obrigatorio?"":'style="display: none"')+">* </span>";const e=o.ajuda?'&nbsp;<i class="fas fa-question-circle" title="'+o.ajuda+'"></i>':"";$("<th>").html(a+o.nome+e).attr("col_id_elemento",o.id_elemento).appendTo($(L.find("tr")))}else $("<th>&nbsp;</th>").appendTo($(L.find("tr")))}),0==N||null==N||""==N||Number(N)>0&&H==FORMULARIO_TABELA_TIPO_LINHA.MINIMO){var z=$('<button type="button" class="btn btn-default btn_add_linha pull-right" style="margin-bottom: 5px;" data-toggle="tooltip" title="Adicionar linha"></button>'),q=(y=$('<span class="glyphicon glyphicon-plus">'),$('<th class="text-right" style="padding-right: 8px;" id="btn_add_linha">'));z.unbind("click"),z.click(function(a){r.tamanho_render=parseInt(r.tamanho_render,10)+1,$(j).find(".td_total").parent().remove(),F?main.render_tabela(w,1,j,!1,!0):main.render_tabela(w,1,j,!1,!1),main.valida_propriedades_campos(r,c),aplicar_mascaras(),parametros.obj_formulario.grupos[e].elementos[o]=r,executar_evento(parametros.obj_formulario,parametros.div_formulario,"iniciar_construtor",null,!0),main.render_btn_add(j),setTimeout(function(){set_datepicker(j.find('input[type="date"]'))},150),$(j).attr("tipo_linha")==FORMULARIO_TABELA_TIPO_LINHA.MINIMO&&$(j).attr("total_linhas")>0&&$(j).find("tr.linha_count").length>$(j).attr("total_linhas")&&$(j).find(".btn_exclui_linha").removeClass("hidden")}),y.appendTo(z),q.append(z),q.appendTo($(L.find("tr")))}j.prepend(L),j.data("obj-tabela",r),j.data("obj_formulario",parametros.obj_formulario),j.data("obj_grupo_index",e),j.data("obj_campo_index",o);var F=!1,U=100/r.campos.length;if(U+="%",$(r.campos).each(function(e,o){void 0!==o.tamanho_coluna&&(U=o.tamanho_coluna,new RegExp(/^[0-9]{1,}$/g).test(U)&&(U+="px"));var a=$('<td class="td_formulario_campo" style="min-width: '+U+"; width: "+U+'">');switch(a.attr("col_id_elemento",o.id_elemento),a.attr("elem_key",o.elem_key),parseInt(o.tipo,10)){case ELEMENTO_TIPO.TEXTO:o.tipo_totalizador!=CAMPO_TOTALIZADOR.CONTAGEM&&o.tipo_totalizador!=CAMPO_TOTALIZADOR.CONTAGEM_DISTINCAO||(F=!0),(parseInt(o.linhas,10)||1)>1?a.append('<textarea class="formulario_campo formulario_textarea form-control id_elemento " elem_type="'+o.tipo_totalizador+'" id_elemento="'+o.id_elemento+'" id_elemento_vm="campos.elemento_html_'+o.id_elemento+'" ref="'+o.elem_key+'" rows="'+o.linhas+'" maxlength="'+o.tamanho+'" style="'+o.style+'"></textarea>'):a.append('<input type="text" class="formulario_campo form-control id_elemento" elem_type="'+o.tipo_totalizador+'" id_elemento="'+o.id_elemento+'" id_elemento_vm="campos.elemento_html_'+o.id_elemento+'" ref="'+o.elem_key+'" maxlength="'+o.tamanho+'" style="'+o.style+'">');break;case ELEMENTO_TIPO.TEXTO_FIXO:a.append('<div class="formulario_campo div_texto_fixo id_elemento" elem_type="'+o.tipo_totalizador+'" id_elemento="'+o.id_elemento+'" id_elemento_vm="campos.elemento_html_'+o.id_elemento+'" ref="'+o.elem_key+'" style="'+o.style+'">'+nl2br(o.nome)+"</div>");break;case ELEMENTO_TIPO.INTEIRO:o.tipo_totalizador!=CAMPO_TOTALIZADOR.CONTAGEM&&o.tipo_totalizador!=CAMPO_TOTALIZADOR.CONTAGEM_DISTINCAO&&o.tipo_totalizador!=CAMPO_TOTALIZADOR.MEDIA&&o.tipo_totalizador!=CAMPO_TOTALIZADOR.SOMA||(F=!0),a.append('<input type="text" type_campo="inteiro" class="formulario_campo form-control text-right id_elemento" elem_type="'+o.tipo_totalizador+'" id_elemento="'+o.id_elemento+'" id_elemento_vm="campos.elemento_html_'+o.id_elemento+'" ref="'+o.elem_key+'" data-thousands="." data-allow-zero="true" data-allow-negative="true" data-precision="0" maskmoney style="'+o.style+'">');break;case ELEMENTO_TIPO.DECIMAL:[CAMPO_TOTALIZADOR.CONTAGEM,CAMPO_TOTALIZADOR.CONTAGEM_DISTINCAO,CAMPO_TOTALIZADOR.MEDIA,CAMPO_TOTALIZADOR.SOMA].includes(o.tipo_totalizador)&&(F=!0);let e=parseInt(o.decimais,10),T=".",y=",",k="true",x="true",S=`<input type="tel"\n                                                    type_campo="decimal" \n                                                    qtd_decimais="${e}" \n                                                    class="formulario_campo form-control text-right id_elemento" \n                                                    elem_type="${o.tipo_totalizador}" \n                                                    id_elemento="${o.id_elemento}" \n                                                    id_elemento_vm="campos.elemento_html_${o.id_elemento}" \n                                                    ref="${o.elem_key}" \n                                                    data-thousands="${T}" \n                                                    data-decimal="${y}" \n                                                    data-allow-zero="${k}" \n                                                    data-allow-negative="${x}" \n                                                    data-precision="${e}" \n                                                    style="${o.style}"\n                                                    maskmoney>\n                                                `;a.append(S);break;case ELEMENTO_TIPO.OPCOES:if(o.tipo_totalizador!=CAMPO_TOTALIZADOR.CONTAGEM&&o.tipo_totalizador!=CAMPO_TOTALIZADOR.CONTAGEM_DISTINCAO||(F=!0),o.tipo_lista_opcoes==TIPO_LISTA_OPCOES.CHECKBOX){var t=md5(Math.random()+Math.random()+new Date),i=$('<div class="radio_block text-left">');"true"!==o.obrigatorio&&!0!==o.obrigatorio||i.addClass("vld_lista_check"),$(o.opcoes).each(function(e,a){let r="campo_"+String((new Date).getTime())+String(Math.round(1e4*Math.random()))+String((new Date).getTime())+String(Math.round(1e4*Math.random()));var n=$('<input type="checkbox" class="template_switch formulario_campo id_elemento" id_elemento="'+o.id_elemento+'" id_elemento_vm="campos.elemento_html_'+o.id_elemento+'" ref="'+o.elem_key+'" name="'+t+'" value="'+a+'" style="'+o.style+'" id='+r+"><label for="+r+' style="padding: 3px; width: calc(100% - 13px);">'+a+"</label></input>");i.append(n).append("<br>")}),i.appendTo(a)}else if(o.tipo_lista_opcoes==TIPO_LISTA_OPCOES.RADIO){t=md5(Math.random()+Math.random()+new Date),i=$('<div class="radio_block text-left">');"true"!==o.obrigatorio&&!0!==o.obrigatorio||i.addClass("vld_lista_radio"),$(o.opcoes).each(function(e,a){let r="campo_"+String((new Date).getTime())+String(Math.round(1e4*Math.random()))+String((new Date).getTime())+String(Math.round(1e4*Math.random()));var n=$('<input type="radio" class="formulario_campo id_elemento" id_elemento="'+o.id_elemento+'" id_elemento_vm="campos.elemento_html_'+o.id_elemento+'" ref="'+o.elem_key+'" name="'+t+'" value="'+a+'" style="'+o.style+'" id='+r+"><label for="+r+' style="padding-left:4px">'+a+"</label></input>");i.append(n).append("<br>")}),i.appendTo(a)}else if(o.tipo_lista_opcoes==TIPO_LISTA_OPCOES.OPTION_MULTIPLAS){a.append('<select title="" type="select" class="formulario_campo form-control id_elemento selectpicker vld_lista_option_multiplas" multiple id_elemento="'+o.id_elemento+'" id_elemento_vm="campos.elemento_html_'+o.id_elemento+'" ref="'+o.elem_key+'" style="'+o.style+'">');var n=a.find("select");$(o.opcoes).each(function(e,o){add_option(n,o,o)})}else{a.append('<select type="select" class="formulario_campo form-control id_elemento vld_lista_option" id_elemento="'+o.id_elemento+'" id_elemento_vm="campos.elemento_html_'+o.id_elemento+'" ref="'+o.elem_key+'" style="'+o.style+'">');n=a.find("select");add_option(n,"",""),$(o.opcoes).each(function(e,o){add_option(n,o,o)})}break;case ELEMENTO_TIPO.MASCARA:o.tipo_totalizador!=CAMPO_TOTALIZADOR.CONTAGEM&&o.tipo_totalizador!=CAMPO_TOTALIZADOR.CONTAGEM_DISTINCAO||(F=!0),a.append('<input type="text" class="formulario_campo form-control id_elemento" elem_type="'+o.tipo_totalizador+'" id_elemento="'+o.id_elemento+'" id_elemento_vm="campos.elemento_html_'+o.id_elemento+'" ref="'+o.elem_key+'" data-mask="'+o.mascara+'" masktext style="'+o.style+'">');break;case ELEMENTO_TIPO.DATA:o.tipo_totalizador!=CAMPO_TOTALIZADOR.CONTAGEM&&o.tipo_totalizador!=CAMPO_TOTALIZADOR.CONTAGEM_DISTINCAO||(F=!0);var l="1900-01-01",s=new Date,d=("0"+s.getDate()).slice(-2),p=("0"+(s.getMonth()+1)).slice(-2);!o.data_retroativa||!0!==o.data_retroativa&&"true"!==o.data_retroativa||(l=s.getFullYear()+"-"+p+"-"+d),!o.data_retroativa_igual||!0!==o.data_retroativa_igual&&"true"!==o.data_retroativa_igual||(l=s.getFullYear()+"-"+p+"-"+(d?parseInt(d,10)+1:"")),a.append('<input type="date" data_retroativa_igual="'+(!0===o.data_retroativa_igual?"S":"N")+'" data_retroativa="'+(!0===o.data_retroativa?"S":"N")+'" min="'+l+'" max="2222-12-31" class="formulario_campo form-control id_elemento" elem_type="'+o.tipo_totalizador+'" id_elemento="'+o.id_elemento+'" id_elemento_vm="campos.elemento_html_'+o.id_elemento+'" ref="'+o.elem_key+'" style="'+o.style+'">');break;case ELEMENTO_TIPO.CAIXA_VERIFICACAO:a.addClass("text-center"),a.append('<input type="checkbox" value="" class="formulario_campo id_elemento template_switch caixa_verificacao" elem_type="'+o.tipo_totalizador+'" id_elemento="'+o.id_elemento+'" id_elemento_vm="campos.elemento_html_'+o.id_elemento+'" ref="'+o.elem_key+'" style="'+o.style+'">');break;case ELEMENTO_TIPO.SELECAO_DOCUMENTO:var m=$('<div class="input-group">'),c=$('<input type="text" class="formulario_campo form-control id_elemento input_doc" elem_type="'+o.tipo_totalizador+'" readonly id_elemento="'+o.id_elemento+'" id_elemento_vm="campos.elemento_html_'+o.id_elemento+'" ref="'+o.elem_key+'" maxlength="'+r.tamanho+'">'),u=$('<div class="input-group-btn">'),f=$('<button type="button" class="docs btn_documento btn btn-default" data-toggle="tooltip" title="Pesquisar">'),v=$('<span class="glyphicon glyphicon-search"></span>'),h=$('<button type="button" class="btn_download hidden btn btn-default" data-toggle="tooltip" title="Download">'),g=$('<span class="glyphicon glyphicon-download-alt"></span>'),b=$('<button type="button" class="button_limpar_doc btn btn-default hidden" data-toggle="tooltip" title="Limpar Campo">'),O=$('<span class="glyphicon glyphicon-remove"></span>');a.attr("documento_pasta_id",o.documento_pasta_id),v.appendTo(f),f.appendTo(u),O.appendTo(b),b.appendTo(u),g.appendTo(h),h.appendTo(u),c.appendTo(m),u.appendTo(m),a.append(m);break;case ELEMENTO_TIPO.INTEGRACAO:const M=parametros.div_formulario&&parametros.div_formulario.html_id?parametros.div_formulario.html_id:null;o.tipo_totalizador!=CAMPO_TOTALIZADOR.CONTAGEM&&o.tipo_totalizador!=CAMPO_TOTALIZADOR.CONTAGEM_DISTINCAO||(F=!0);var I=$('<div> <div class="input_consulta_integracao" elem_type="'+o.tipo_totalizador+'" id_elemento="'+o.id_elemento+'" id_elemento_vm="campos.elemento_html_'+o.id_elemento+'" ref="'+o.elem_key+'" view_html_id="'+M+'">');a.append(I);break;case ELEMENTO_TIPO.ANEXO:o.tipo_totalizador!=CAMPO_TOTALIZADOR.CONTAGEM&&o.tipo_totalizador!=CAMPO_TOTALIZADOR.CONTAGEM_DISTINCAO||(F=!0);var E=$('<div class="div_input_arquivo" elem_type="'+o.tipo_totalizador+'" id_elemento="'+o.id_elemento+'" id_elemento_vm="campos.elemento_html_'+o.id_elemento+'" ref="'+o.elem_key+'"/>');a.append(E);break;case ELEMENTO_TIPO.BOTAO:var A=$('<button type="button" class="id_elemento formulario_campo btn_form btn btn-default btn_tabela" id_elemento='+o.id_elemento+' id_elemento_vm="campos.elemento_html_'+o.id_elemento+'" style="'+o.style+'" id='+_+' ref="'+o.elem_key+'">'+o.nome+"</button>");a.prepend(A);break;case ELEMENTO_TIPO.EDITOR_TEXTO:o.tipo_totalizador!=CAMPO_TOTALIZADOR.CONTAGEM&&o.tipo_totalizador!=CAMPO_TOTALIZADOR.CONTAGEM_DISTINCAO||(F=!0),a.append('<textarea type="editor_texto" class="editor_texto formulario_campo form-control id_elemento " elem_type="'+o.tipo_totalizador+'" id_elemento="'+o.id_elemento+'" id_elemento_vm="campos.elemento_html_'+o.id_elemento+'" ref="'+o.elem_key+'"></textarea>')}w.push(a)}),0==N||null==N||""==N||Number(N)>0&&H==FORMULARIO_TABELA_TIPO_LINHA.MINIMO){var V=$('<td class="td_formulario_campo">'),B=$('<button type="button" class="btn btn-default btn_exclui_linha pull-right" data-toggle="tooltip" title="Excluir linha"></button>');y=$('<span class="glyphicon glyphicon-trash">');B.append(y),V.append(B),w.push(V),F=!0}F?($(r.campos).each(function(e,o){var a=$('<td class="td_formulario_campo td_total bg-info text-center" id="td_total" id_elemento="'+o.id_elemento+'" id_elemento_vm="campos.elemento_html_'+o.id_elemento+'" >');a.attr("col_id_elemento",o.id_elemento),a.attr("ref",o.elem_key),w.push(a)}),main.render_tabela(w,parseInt(r.tamanho_render,10)<0?0:parseInt(r.tamanho_render,10),j,!1)):main.render_tabela(w,parseInt(r.tamanho_render,10)<0?0:parseInt(r.tamanho_render,10),j),j.data("template",w);var X=$('<div class="table-responsive">');X.append(j),c.append(X),(0==N||null==N||""==N||Number(N)>0&&H==FORMULARIO_TABELA_TIPO_LINHA.MINIMO)&&main.render_btn_add(j),set_datepicker(j.find('input[type="date"]')),main.valida_propriedades_campos(r,c);break;case ELEMENTO_TIPO.EDITOR_TEXTO:c.append('<textarea type="editor_texto" class="formulario_campo form-control id_elemento" id_elemento="'+r.id_elemento+'" id_elemento_vm="campos.elemento_html_'+r.id_elemento+'" id="'+_+'"></textarea>');var Z=c.find("textarea"),G=function(){main.div_formulario.dados_modificados=!0,parametros.obj_formulario.grupos[e].elementos[o].valor=get_tinymce(Z),executar_evento(r,parametros.div_formulario,"alterar",r.id_elemento,null),executar_evento(r,parametros.div_formulario,"alterar_construtor",r.id_elemento,null)};setTimeout(function(){if(parametros.permissoes_formulario&&parametros.obj_formulario.grupos[e].versao_formulario_grupo_id){var o=PROCESSO_ATIVIDADE_FORMULARIO_PERMISSAO.NAO_EXIBIR;$(parametros.permissoes_formulario).each(function(a,t){parametros.obj_formulario.grupos[e].versao_formulario_grupo_id==t.versao_formulario_grupo_id&&(o=parseInt(t.permissao,10))}),parametros.liberar_campos?o=PROCESSO_ATIVIDADE_FORMULARIO_PERMISSAO.EDITAR:(parametros.disabled_all||void 0!==main.obj_solicitacao&&"S"==main.obj_solicitacao.cancelada||void 0!==main.obj_solicitacao&&main.obj_solicitacao.entrega)&&(o=PROCESSO_ATIVIDADE_FORMULARIO_PERMISSAO.VISUALIZAR)}var a=void 0!==o&&o!=PROCESSO_ATIVIDADE_FORMULARIO_PERMISSAO.EDITAR;if(!0!==r.habilitar_historico_texto&&"S"!==r.habilitar_historico_texto||!r.historico)set_tinymce(Z,r.valor,a,null,G,r.style);else{set_tinymce(Z,r.valor,a,null,G,r.style);let e=$("<div>").addClass("historico_observacoes").css({marginTop:"15px",border:"1px solid #e0e0e0",backgroundColor:"#f9f9f9",boxShadow:"0 0 10px rgba(0, 0, 0, 0.1)",borderRadius:"10px"}),o=$("<span>").addClass("bg-info").attr("title","Clique para exibir ou ocultar o histórico").css({display:"block",padding:"10px",cursor:"pointer",borderRadius:"10px"}),t=$("<i>").addClass("fas fa-history"),i=$("<span>").text(` Histórico (${c.find("label").text()}) `),n=$("<i>").addClass("fas fa-caret-down").css({float:"right"});o.append(t,i,n);let l=$("<div>").addClass(`registros_historico_${r.id_elemento}`).css({paddingTop:"15px",paddingLeft:"15px",paddingRight:"15px",lineHeight:"1.6",color:"#333",wordWrap:"break-word"});const s=$("<div>");l.append(s),ReactDOM.render(React.createElement(window.views.formulario.TextoHistorico.default,{historico:r.historico}),s[0]),e.append(o,l),o.on("click",function(){l.toggle(),n.toggleClass("fa-caret-down fa-caret-up")}),c.append(e)}})}"true"!==r.obrigatorio&&!0!==r.obrigatorio||main.set_obrigatorio(c.find('[id_elemento="'+r.id_elemento+'"]'),!0),"true"!==r.bloqueado&&!0!==r.bloqueado||main.set_bloqueado(c.find('[id_elemento="'+r.id_elemento+'"]'),!0),"true"!==r.oculto&&!0!==r.oculto||main.set_visivel(c.find('[id_elemento="'+r.id_elemento+'"]'),!1);var J=function(e){$(e).attr("mascara","true"),$(e).attr("maskmoney")?$(e).maskMoney({thousands:$(e).attr("data-thousands"),decimal:$(e).attr("data-decimal"),allowZero:"true"===$(e).attr("data-allow-zero"),allowNegative:"true"===$(e).attr("data-allow-negative"),suffix:$(e).attr("data-suffix"),precision:$(e).attr("data-precision")}):$(e).attr("masktext")&&$(e).mask($(e).attr("data-mask"))};if(void 0!==r.valor&&null!=r.valor||r.tipo!=ELEMENTO_TIPO.OPCOES||void 0===r.opcoes_padrao||!r.opcoes_padrao||(r.tipo_lista_opcoes==TIPO_LISTA_OPCOES.OPTION||r.tipo_lista_opcoes==TIPO_LISTA_OPCOES.RADIO?void 0!==r.opcoes_padrao[0]&&(r.valor=clone_obj(r.opcoes_padrao[0]),r.trigger_change=!0):(r.valor=clone_obj(r.opcoes_padrao),r.trigger_change=!0)),void 0!==r.valor&&r.valor)if(r.tipo==ELEMENTO_TIPO.TABELA)"object"==typeof r.valor&&$(r.valor).each(function(e,o){n.find(".linha_count").each(function(e,a){if(e==o.linha){var t=$(a).find('[ref="'+o.elem_key+'"]').parent(),i=null;if($(r.campos).each(function(e,a){void 0!==o.elem_key&&void 0!==a.elem_key&&o.elem_key==a.elem_key&&(i=a)}),null!=i)if(i.totalizador=void 0===i.totalizador?0:i.totalizador.format_number(i.decimais,!0),null!==i&&i.tipo==ELEMENTO_TIPO.OPCOES)if(s=i.tipo_lista_opcoes==TIPO_LISTA_OPCOES.RADIO||i.tipo_lista_opcoes==TIPO_LISTA_OPCOES.CHECKBOX?t:t.find("select"),i.tipo_lista_opcoes==TIPO_LISTA_OPCOES.CHECKBOX){s.find('input[type="checkbox"]').attr("totalizador",i.totalizador);for(var n=0;n<o.valor.length;n++)s.find('[value="'+o.valor[n]+'"]').prop("checked",!0)}else i.tipo_lista_opcoes==TIPO_LISTA_OPCOES.RADIO?(s.find('input[type="radio"]').attr("totalizador",i.totalizador),s.find('[value="'+o.valor+'"]').prop("checked",!0)):i.tipo_lista_opcoes==TIPO_LISTA_OPCOES.OPTION_MULTIPLAS?(s.attr("totalizador",i.totalizador),s.val(o.valor).selectpicker("refresh")):(s.attr("totalizador",i.totalizador),s.val(o.valor));else if(null!==i&&i.tipo==ELEMENTO_TIPO.DATA){(s=t.find("input")).attr("totalizador",i.totalizador),s.attr("formated",!0),J(s),set_datepicker(s),setTimeout(function(){set_datepicker(s,o.valor)},150)}else if(null!==i&&i.tipo==ELEMENTO_TIPO.EDITOR_TEXTO){(l=t.find("textarea")).attr("totalizador",i.totalizador)}else if(null!==i&&i.tipo!=ELEMENTO_TIPO.OPCOES&&i.tipo!=ELEMENTO_TIPO.DATA&&i.tipo!=ELEMENTO_TIPO.EDITOR_TEXTO){var l,s;if((parseInt(i.linhas,10)||1)>1)(l=t.find("textarea")).attr("totalizador",i.totalizador),l.val(o.valor);else if((s=t.find("input")).attr("totalizador",i.totalizador),J(s),o.valor&&i.tipo==ELEMENTO_TIPO.INTEIRO)s.maskMoney(),isNaN(parseFloat(o.valor))||s.val(parseFloat(o.valor));else if(o.valor&&i.tipo==ELEMENTO_TIPO.DECIMAL){var _=parseFloat(o.valor);s.maskMoney(),s.maskMoney("mask",_)}else if(o.valor&&i.tipo==ELEMENTO_TIPO.CAIXA_VERIFICACAO)s.prop("checked","S"==o.valor);else if(void 0!==o.valor&&i.tipo==ELEMENTO_TIPO.ANEXO){if(void 0!==o.documento_revisao&&o.documento_revisao)main.inputs_arquivo[r.elem_key][i.elem_key][o.linha].props.setDocumentoRevisaoID(o.valor,o.documento_revisao.mime_type,o.documento_revisao.nome_arquivo,o.documento_revisao.tamanho)}else o.valor&&i.tipo==ELEMENTO_TIPO.SELECAO_DOCUMENTO?(s.attr("objeto",JSON.stringify(o.valor)),s.val(o.valor.nome),setTimeout(function(){t.find(".btn_download").removeClass("hidden"),t.find(".btn_documento").addClass("hidden"),t.find(".button_limpar_doc").removeClass("hidden"),t.find(".button_limpar_doc").click(function(e){s.attr("objeto",""),s.val("").trigger("change"),t.find(".btn_download").addClass("hidden"),t.find(".btn_documento").removeClass("hidden"),t.find(".button_limpar_doc").addClass("hidden"),executar_evento(i,parametros.div_formulario,"limpar",i.id_elemento,null,e)}),t.find(".btn_download").unbind("click"),t.find(".btn_download").click(function(){var e=$($(this).parent().parent().find("input")).attr("objeto");e=""!=e?JSON.parse(e):"",App.obter_token_publico(function(o){App.download(WS_URI+"documento/download/?documento_revisao_id="+e.documento_revisao_id+"&solicitacao=true&token_publico="+o)},e.documento_revisao_id)})},150)):s.val(o.valor)}}})}),"object"==typeof r.style&&$(r.style).each(function(e,o){n.find(".linha_count").each(function(e,a){if(e==o.linha){var t=$(a).find('[ref="'+o.elem_key+'"]').parent(),i=null;if($(r.campos).each(function(e,a){void 0!==o.elem_key&&void 0!==a.elem_key&&o.elem_key==a.elem_key&&(i=a)}),null!==i&&i.tipo==ELEMENTO_TIPO.OPCOES)(i.tipo_lista_opcoes==TIPO_LISTA_OPCOES.RADIO||i.tipo_lista_opcoes==TIPO_LISTA_OPCOES.CHECKBOX?t:t.find("select")).attr("style",o.valor);else if(null!==i&&i.tipo==ELEMENTO_TIPO.DATA){t.find("input").attr("style",o.valor)}else if(null!==i&&i.tipo==ELEMENTO_TIPO.EDITOR_TEXTO){t.find("input").attr("style",o.valor)}else if(null!==i&&i.tipo!=ELEMENTO_TIPO.OPCOES&&i.tipo!=ELEMENTO_TIPO.DATA&&i.tipo!=ELEMENTO_TIPO.EDITOR_TEXTO){if((parseInt(i.linhas,10)||1)>1)t.find("textarea").attr("style",o.valor);else t.find("input").attr("style",o.valor)}}})});else if(r.tipo==ELEMENTO_TIPO.OPCOES){var H=r.tipo_lista_opcoes==TIPO_LISTA_OPCOES.RADIO?c:c.find("select");if(r.tipo_lista_opcoes==TIPO_LISTA_OPCOES.OPTION_MULTIPLAS)H.val(r.valor).selectpicker("refresh"),(!0===r.trigger_change||r.evento_alterar_construtor&&Object.keys(r.evento_alterar_construtor).length)&&(r.evento_alterar_construtor&&Object.keys(r.evento_alterar_construtor).length?H.trigger("change_constructor"):H.trigger("change"));else if(r.tipo_lista_opcoes==TIPO_LISTA_OPCOES.CHECKBOX){if(r.valor&&Array.isArray(r.valor))for(var K=0;K<r.valor.length;K++)c.find("input").each(function(e,o){r.valor[K]==o.value&&$(o).prop("checked",!0)})}else r.tipo_lista_opcoes==TIPO_LISTA_OPCOES.RADIO?(H.find('[value="'+r.valor+'"]').prop("checked",!0),(!0===r.trigger_change||r.evento_alterar_construtor&&Object.keys(r.evento_alterar_construtor).length)&&(r.evento_alterar_construtor&&Object.keys(r.evento_alterar_construtor).length?H.find('[value="'+r.valor+'"]').trigger("change_constructor"):H.find('[value="'+r.valor+'"]').trigger("change"))):(void 0!==r.valor&&null!=r.valor&&""!=r.valor&&0==H.find('option[value="'+r.valor+'"]').length&&add_option(H,r.valor,r.valor),H.val(r.valor),(!0===r.trigger_change||r.evento_alterar_construtor&&Object.keys(r.evento_alterar_construtor).length)&&(r.evento_alterar_construtor&&Object.keys(r.evento_alterar_construtor).length?H.trigger("change_constructor"):H.trigger("change")))}else if(r.tipo==ELEMENTO_TIPO.DATA){H=c.find("input");set_datepicker(H),setTimeout(function(){set_datepicker(H,r.valor)},150),set_datepicker($(H),r.valor)}else if((parseInt(r.linhas,10)||1)>1){c.find("textarea").val(r.valor)}else{H=c.find("input");if(r.valor&&r.tipo==ELEMENTO_TIPO.INTEIRO)H.val(r.valor);else if(r.valor&&r.tipo==ELEMENTO_TIPO.DECIMAL){var W=W=parseFloat(r.valor);H.maskMoney(),H.maskMoney("mask",W)}else r.valor&&r.tipo==ELEMENTO_TIPO.CAIXA_VERIFICACAO?H.prop("checked","S"==r.valor):r.valor&&r.tipo==ELEMENTO_TIPO.SELECAO_DOCUMENTO?(H.attr("objeto",JSON.stringify(r.valor)),H.val(r.valor.nome),setTimeout(function(){c.find(".btn_download").removeClass("hidden"),c.find(".btn_documento").addClass("hidden"),c.find(".button_limpar_doc").removeClass("hidden"),c.find(".button_limpar_doc").click(function(e){H.attr("objeto",""),H.val("").trigger("change"),c.find(".btn_download").addClass("hidden"),c.find(".btn_documento").removeClass("hidden"),c.find(".button_limpar_doc").addClass("hidden"),executar_evento(r,parametros.div_formulario,"limpar",r.id_elemento,null,e)}),c.find(".btn_download").unbind("click"),c.find(".btn_download").click(function(){var e=$($(this).parent().parent().find("input")).attr("objeto");e=""!=e?JSON.parse(e):"",App.obter_token_publico(function(o){App.download(WS_URI+"documento/download/?documento_revisao_id="+e.documento_revisao_id+"&solicitacao=true&token_publico="+o)},e.documento_revisao_id)})},150)):r.valor&&r.tipo==ELEMENTO_TIPO.ANEXO||H.val(r.valor)}else{H=c.find("input");r.tipo==ELEMENTO_TIPO.INTEIRO?H.val(r.valor):r.tipo==ELEMENTO_TIPO.DECIMAL&&H.val(r.valor)}}),App.aplicar_mascaras(a);var _=PROCESSO_ATIVIDADE_FORMULARIO_PERMISSAO.EDITAR;switch(parametros.permissoes_formulario&&o.versao_formulario_grupo_id&&(_=PROCESSO_ATIVIDADE_FORMULARIO_PERMISSAO.NAO_EXIBIR,$(parametros.permissoes_formulario).each(function(e,a){o.versao_formulario_grupo_id==a.versao_formulario_grupo_id&&(_=parseInt(a.permissao,10))})),parametros.liberar_campos?_=PROCESSO_ATIVIDADE_FORMULARIO_PERMISSAO.EDITAR:(parametros.disabled_all||void 0!==main.obj_solicitacao&&null!=main.obj_solicitacao&&"S"==main.obj_solicitacao.cancelada||void 0!==main.obj_solicitacao&&null!=main.obj_solicitacao&&main.obj_solicitacao.entrega)&&(_=PROCESSO_ATIVIDADE_FORMULARIO_PERMISSAO.VISUALIZAR),_){case PROCESSO_ATIVIDADE_FORMULARIO_PERMISSAO.NAO_EXIBIR:a.find("input[type=text]").prop("readonly",!0),a.find("[maskmoney]").removeAttr("readonly"),a.find("[maskmoney]").prop("disabled",!0),a.find("input[type=date]").prop("readonly",!0),a.find("input").prop("disabled",!0),a.find("textarea").prop("disabled",!0),a.find("select").prop("disabled",!0),a.find("input[type=file]").prop("disabled",!0),a.find(".btn_atualizar_anexo").prop("disabled",!0),a.find('input[type="checkbox"]').prop("disabled",!0),a.find('input[type="radio"]').prop("disabled",!0),a.find(".btn_documento").prop("disabled",!0),a.find(".btn_add_linha").prop("disabled",!0),a.find(".btn_exclui_linha").prop("disabled",!0),a.find(".button_limpar").prop("disabled",!0),a.find(".button_limpar_doc").prop("disabled",!0),a.find(".btn_nova_consulta").prop("disabled",!0),a.find(".btn_form").prop("disabled",!0),a.hide();break;case PROCESSO_ATIVIDADE_FORMULARIO_PERMISSAO.VISUALIZAR:a.find("input[type=text]").prop("readonly",!0).attr("permissao",PROCESSO_ATIVIDADE_FORMULARIO_PERMISSAO.VISUALIZAR),a.find("input[type=date]").prop("readonly",!0),a.find("[maskmoney]").removeAttr("readonly"),a.find("[maskmoney]").prop("disabled",!0),a.find('input[type="checkbox"]').prop("disabled",!0),a.find('input[type="radio"]').prop("disabled",!0),a.find("textarea").prop("disabled",!0),a.find("select").prop("disabled",!0),a.find("input[type=file]").prop("disabled",!0),a.find(".btn_atualizar_anexo").prop("disabled",!0),a.find(".btn_documento").prop("disabled",!0),a.find(".btn_add_linha").prop("disabled",!0),a.find(".btn_exclui_linha").prop("disabled",!0),a.find(".button_limpar").prop("disabled",!0),a.find(".button_limpar_doc").prop("disabled",!0),a.find(".btn_nova_consulta").prop("disabled",!0),a.find(".btn_form").prop("disabled",!0);break;case PROCESSO_ATIVIDADE_FORMULARIO_PERMISSAO.EDITAR:}a.appendTo(parametros.div_formulario.form_grupos)}}),$(parametros.div_formulario.form_grupos.find(".form-grupos-campos")).each(function(e,o){0==$(o).children().length&&$(o).remove()}),aplicar_mascaras(),executar_evento(parametros.obj_formulario,parametros.div_formulario,"iniciar",null,!0),executar_evento(parametros.obj_formulario,parametros.div_formulario,"iniciar_construtor",null,!0),App.PE.formulario_render_depois)try{App.PE.formulario_render_depois(parametros)}catch(e){console.log(e)}},this.persistir_valores=function(e,o){$(o.grupos).each(function(o,a){$(a.elementos).each(function(o,a){parseInt(a.tipo,10)!=ELEMENTO_TIPO.TABELA?($(e.form_grupos).find('[elem-key="'+a.elem_key+'"] input:not(.input_consulta_integracao,.input_doc,[type="radio"]), [elem-key="'+a.elem_key+'"] select, [elem-key="'+a.elem_key+'"] textarea').trigger("change"),$(e.form_grupos).find('[elem-key="'+a.elem_key+'"] input[type=radio]:checked').trigger("click")):$(e.form_grupos).find('[elem-key="'+a.elem_key+'"] table').find("tr.linha_count").each(function(e,o){$(o).find('input:not(.input_consulta_integracao,.input_doc,[type="radio"]) , select, textarea').trigger("change"),$(o).find("input[type=radio]:checked").trigger("click")})})})},this.persistir_styles=function(e,o){var a=$(e.form_editor).attr("style");o.style=a,$(o.grupos).each(function(a,t){!0!==t.removido&&void 0!==t.elementos&&t.elementos&&$(t.elementos).each(function(t,r){var i=parseInt(r.tipo,10);if(i!=ELEMENTO_TIPO.TABELA&&""!=r.elem_key){var n=$(e.form_grupos).find('[elem-key="'+r.elem_key+'"] input, [elem-key="'+r.elem_key+'"] select');o.grupos[a].elementos[t].style=n.attr("style")?n.attr("style"):""}else if(i==ELEMENTO_TIPO.TABELA&&""!=r.elem_key){var l=$(e.form_grupos).find('[elem-key="'+r.elem_key+'"] table').find("tr.linha_count"),s=[];l.each(function(e,o){for(var a=$(o).attr("linha_count"),t=0;t<r.campos.length;t++){for(var i=r.campos[t],n=$(o).find('[ref="'+i.elem_key+'"]').not('input[type="file"]').attr("style"),l={linha:a,elem_key:i.elem_key,valor:n||""},_=!1,d=0;d<s.length;d++)if(s[d].elem_key==i.elem_key&&parseInt(s[d].linha,10)==parseInt(a,10)){s[d]=l,_=!0;break}_||s.push(l)}}),r.style=s}})})},this.renderizar_campo_integracao=function(e,o,a,t,r,i,n,l,s,_,d){var p=null,m=null,c=[],u=$("<div>"),f=[],v=0;const h=function(e){e.component._getLabelContainer().val(e.component.option("value")),e.component.option("placeholder",e.component.option("value")?"":App.lang.combobox.selecione)};if(null==i){if(o.obj_formulario.grupos[a].elementos[t].campos)for(var g=0;g<o.obj_formulario.grupos[a].elementos[t].campos.length;g++){var b=o.obj_formulario.grupos[a].elementos[t].campos[g];if(b.elem_key==n){i=JSON.parse(JSON.stringify(b));break}}if(o.obj_formulario.grupos[a].elementos[t].valor)for(g=0;g<o.obj_formulario.grupos[a].elementos[t].valor.length;g++){var O=o.obj_formulario.grupos[a].elementos[t].valor[g];if(O.elem_key==n&&O.linha==l){i.valor=O.valor;break}}}var I=function(e,a,t){if(p.beginCustomLoading(),void 0!==i.arr_condicoes_integracao&&i.arr_condicoes_integracao.length>0)for(var r=0;r<i.arr_condicoes_integracao.length;r++){var n=i.arr_condicoes_integracao[r],s=null;s="-solicitacao_id-"==n.campo_formulario_id&&o.obj_solicitacao?o.obj_solicitacao.solicitacao_id:"-solicitacao_atividade_id-"==n.campo_formulario_id&&o.obj_solicitacao?o.obj_solicitacao.id:valor_campo_formulario(o.obj_formulario,n.campo_formulario_id,l),i.arr_condicoes_integracao[r].valor=s}WS.post("consulta_integracao/executar_consulta",{consulta_id:i.consulta_id,limite:v,paginacao:t,sql_campo:JSON.stringify(i.arr_condicoes_integracao),parametros:JSON.stringify(c),consulta_formulario:!0},function(o){f=a?o.registros:f.concat(o.registros),e.component.option("dataSource",new DevExpress.data.CustomStore.default({loadMode:"raw",key:i.coluna_consulta_integracao_nome,load:function(){return f}})),h(e),p.option("dataSource",e.component.getDataSource()),e.component._popup.option("showTitle",!0),e.component._popup.option("title",o.cabecalho.nome),e.component._popup.option("toolbarItems",[{widget:"dxButton",location:"after",options:{icon:"fa fa-window-restore",onClick:function(){var o=!e.component._popup.option("fullScreen");e.component._popup.option("fullScreen",o),e.component._popup.content().parents(".dx-popup-fullscreen").css("max-height","none"),e.component._popup.content().parents(".dx-popup-wrapper").css("width","100%").css("max-height","100vh").css("height","100%"),p.option("height",e.component._popup._$content.height()-80),e.component._popup._refresh()}}},{widget:"dxButton",visible:e.component._popup.option("fullScreen"),location:"after",options:{icon:"fa fa-times ",onClick:function(){e.component._popup.hide()}}}]),p.endCustomLoading()})},E=function(s,_,d,p,m,c,u,f){var v=d||e,h=p||l,g=m||n,b=c||i,O=u||a,I=f||t;if(main.div_formulario.dados_modificados=!0,$(v.parents("tr")).hasClass("linha_count")){var E={linha:h,elem_key:g,objeto:_,valor:s};b.valor=s,b.linha=h,void 0!==o.obj_formulario.grupos[O].elementos[I].valor&&"string"!=typeof o.obj_formulario.grupos[O].elementos[I].valor&&null!=o.obj_formulario.grupos[O].elementos[I].valor||(o.obj_formulario.grupos[O].elementos[I].valor=[]);var A=!1;$(o.obj_formulario.grupos[O].elementos[I].valor).each(function(e,a){null!=a&&a.elem_key==g&&a.linha==E.linha&&(A=!0,o.obj_formulario.grupos[O].elementos[I].valor[e]=E)}),A||o.obj_formulario.grupos[O].elementos[I].valor.push(E)}else o.obj_formulario.grupos[O].elementos[I].valor=s;_&&r(b,o.div_formulario,"selecionar",b.id_elemento,null,{target:v}),r(b,o.div_formulario,"alterar_construtor",b.id_elemento,null,{target:v})},A=PROCESSO_ATIVIDADE_FORMULARIO_PERMISSAO.EDITAR;o.permissoes_formulario&&o.obj_formulario.grupos[a].versao_formulario_grupo_id&&(A=PROCESSO_ATIVIDADE_FORMULARIO_PERMISSAO.NAO_EXIBIR,$(o.permissoes_formulario).each(function(e,t){o.obj_formulario.grupos[a].versao_formulario_grupo_id==t.versao_formulario_grupo_id&&(A=parseInt(t.permissao,10))})),o.liberar_campos?A=PROCESSO_ATIVIDADE_FORMULARIO_PERMISSAO.EDITAR:(o.disabled_all||void 0!==main.obj_solicitacao&&null!=main.obj_solicitacao&&"S"==main.obj_solicitacao.cancelada||void 0!==main.obj_solicitacao&&null!=main.obj_solicitacao&&main.obj_solicitacao.entrega)&&(A=PROCESSO_ATIVIDADE_FORMULARIO_PERMISSAO.VISUALIZAR);var T=void 0!==A&&A!=PROCESSO_ATIVIDADE_FORMULARIO_PERMISSAO.EDITAR;m=u.dxDropDownBox({value:i.valor,valueExpr:i.coluna_consulta_integracao_nome,placeholder:i.valor?"":App.lang.combobox.selecione,displayExpr:i.coluna_consulta_integracao_nome,readOnly:T,buttons:[{name:"limpar_valor",location:"after",options:{icon:"clear",stylingMode:"text",onClick:function(n){m.option("value",null),e.attr("objeto","{}"),o.obj_formulario.grupos[a].elementos[t].objeto=null,r(i,o.div_formulario,"limpar",i.id_elemento,null,{target:e}),r(i,o.div_formulario,"alterar_construtor",i.id_elemento,null,{target:e}),E("",null)}}},"dropDown"],dataSource:[],contentTemplate:function(o){var a=$("<div>"),t=$("<div>").dxDataGrid({dataSource:o.component.getDataSource(),hoverStateEnabled:!0,columnAutoWidth:!0,filterRow:{visible:!0},scrolling:{mode:"infinite"},selection:{mode:"single"},height:345,onToolbarPreparing:function(e){var o=[{widget:"dxButton",options:{icon:"check",hint:"Confirmar seleção",text:"Confirmar seleção",onClick:function(e){for(var o=p.getSelectedRowKeys(),a=p.getSelectedRowsData(),t=0;t<o.length-1;t++)$(s.parent().find("button.btn_add_linha")[0]).trigger("click");main.campos_integracao_tabela.filter(function(e,o){return e.tabela_elem_key==_&&e.elem_key==n}).slice(l).forEach(function(e,t){e.tabela_elem_key==_&&e.linha>=l&&(e.component.option("value",o[t]),e.div_campo_integracao.attr("objeto",JSON.stringify(a[t])),E(o[t],a[t],e.div_campo_integracao,e.linha,e.elem_key,e.obj_campo,e.obj_grupo_index,e.obj_campo_index))}),m._popup.hide()}},showText:"always",location:"after",name:"BtnConfirmarSelecao",locateInMenu:"auto"}];e.toolbarOptions.items=add_botao_dx_toolbar(o,e.toolbarOptions.items)},onSelectionChanged:function(a){if("multiple"!==p.option("selection.mode")){var t=a.selectedRowKeys,r=t.length;r&&(o.component.option("value",r?t[0]:null),e.attr("objeto",JSON.stringify(a.selectedRowsData[0])),E(t[0],a.selectedRowsData)),o.component._popup.hide()}}});return p=t.dxDataGrid("instance"),o.component.on("valueChanged",function(e){"multiple"!==p.option("selection.mode")&&p.selectRows(e.value,!1)}),t.appendTo(a),a},onOpened:function(e){var o=$(s).find("tr[linha_count]"),a=$(s).find("tr[linha_count="+(o.length-1)+"]").attr("linha_count");d&&l==a&&!e.component.option("value")?(p.option("selection.mode","multiple"),$(p._views.headerPanel._$element).show()):(p.option("selection.mode","single"),$(p._views.headerPanel._$element).hide()),WS.get("consulta_integracao/objeto/",{consulta_id:i.consulta_id},function(o){for(var a="S"==o.paginacao,t=[],r=0;r<o.colunas.length;r++){var i=o.colunas[r];t.push({dataField:i.nome,caption:i.titulo})}if(p.option("columns",t),p.option("pageSize",a?f.length:50),a){var n=p.getScrollable();void 0!==n&&n.option("onScroll",function(o){o.reachedBottom&&(n.option("onScroll",null),v+=50,I(e,!1,a))})}c=o.parametros?object_to_array(o.parametros):[];var l=function(o,t){$("<div>").text(t.nome).appendTo(s),$("<div>").dxTextBox({value:null,onValueChanged:function(t){c[o].valor=t.value,I(e,!0,a)}}).appendTo(s)};e.component._popup.content().find(".parametros").remove();var s=$("<div class='parametros'>");for(r=0;r<c.length;r++){var _=c[r];"S"!=_.excluido&&(c[r].valor="",l(r,_))}e.component._popup.content().prepend(s),c.length||I(e,!0,a),m._popup.option("resizeEnabled")||(m._popup.option("resizeEnabled",!0),m._popup.option("onResizeEnd",function(){p.option("height",e.component._popup._$content.height()-80),e.component._popup._refresh()}),m._popup.option("minWidth",$(".form-grupos.panel-body").last().width()/2)),s.find(".dx-textbox").length&&s.find(".dx-textbox").first().dxTextBox("instance").focus()})},onChange:function(){if(main.div_formulario.dados_modificados=!0,$(e.parents("tr")).hasClass("linha_count")){var r={linha:l,elem_key:n,objeto:e.attr("objeto"),valor:e.find(".dx-dropdownbox").dxDropDownBox("instance").option("value")};void 0!==o.obj_formulario.grupos[a].elementos[t].valor&&"string"!=typeof o.obj_formulario.grupos[a].elementos[t].valor&&null!=o.obj_formulario.grupos[a].elementos[t].valor||(o.obj_formulario.grupos[a].elementos[t].valor=[]);var i=!1;$(o.obj_formulario.grupos[a].elementos[t].valor).each(function(e,l){null!=l&&l.elem_key==n&&l.linha==r.linha&&(i=!0,o.obj_formulario.grupos[a].elementos[t].valor[e]=r)}),i||o.obj_formulario.grupos[a].elementos[t].valor.push(r)}else o.obj_formulario.grupos[a].elementos[t].valor=e.find(".dx-dropdownbox").dxDropDownBox("instance").option("value")},onClosed:function(e){h(e)},onValueChanged:function(e){h(e)}}).dxDropDownBox("instance"),d&&main.campos_integracao_tabela.push({component:m,tabela_elem_key:_,linha:l,div_campo_integracao:e,elem_key:n,obj_campo:i,obj_grupo_index:a,obj_campo_index:t});var y=[];"true"!==i.obrigatorio&&!0!==i.obrigatorio||(y=[{type:"required"}]),u.dxValidator({validationRules:y}),e.append(u)},this.reprocessar_evento_alterar_iniciar=function(e){if(!e||!e.obj_formulario||!e.obj_formulario.grupos)return!1;if(!Array.isArray(e.obj_formulario.evento_iniciar_construtor))return e.obj_formulario.evento_iniciar_construtor;e.obj_formulario.evento_iniciar_construtor={};for(var o=0;o<e.obj_formulario.grupos.length;o++){const t=e.obj_formulario.grupos[o];for(var a=0;a<t.elementos.length;a++){const o=t.elementos[a],r=new Formulario_Campo;r.tipo=FORMULARIO.NOVO,r.arr_grupos=e.obj_formulario.grupos,r.campo=clone_obj(o),r.evento_iniciar_construtor=e.obj_formulario.evento_iniciar_construtor||{},e.obj_formulario.evento_iniciar_construtor=r.recalcular_construtor_filtros()}}return e.obj_formulario.evento_iniciar_construtor},this.valida_propriedades_campos=function(e,o){$(e.campos).each(function(e,a){"true"!==a.bloqueado&&!0!==a.bloqueado||main.set_bloqueado(o.find('[id_elemento="'+a.id_elemento+'"]'),!0),"true"!==a.oculto&&!0!==a.oculto||main.set_visivel(o.find('[id_elemento="'+a.id_elemento+'"]'),!1),"true"!==a.obrigatorio&&!0!==a.obrigatorio||main.set_obrigatorio(o.find('[id_elemento="'+a.id_elemento+'"]'),!0)})}};return Formulario_Util});