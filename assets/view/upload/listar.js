define([],function(){return function(i){"use strict";var t=this;this.html_id=i,this.dialog=$("#"+this.html_id),this.title="Uploads Pendentes",this.oncomplete=null,this.onclose=null,this.tab_listagem=this.dialog.find(".tab_listagem"),this.btn_limpar=this.dialog.find(".btn_limpar"),this.info_icone=this.dialog.find(".info_icone"),this.info_num_arquivo=this.dialog.find(".info_num_arquivo"),this.info_total_arquivos=this.dialog.find(".info_total_arquivos"),this.info_nome_arquivo=this.dialog.find(".info_nome_arquivo"),this.arr_files=[],this.contador_files=0,this.show=function(i,e){var n=setInterval(function(){$('[aba-id-md5="'+t.html_id+'"]').length>0&&(View.show(e),clearInterval(n))},1);t.arr_files=i,t.listar(),t.upload_fila()},this.listar=function(){var i=t.tab_listagem.find("tbody"),e=i.find("tr:first");t.contador_files=i.find("tr:not(:first)").length;$(t.arr_files).each(function(t,n){!function(t){var n=e.clone();n.removeAttr("template-row"),n.css("display",""),n.attr("id",t.id),$(n.find("[template-field='nome']")).text(t.name),$(n.find("[template-field='tamanho']")).text(filesize(parseInt(t.size,10)||0)),$(n.find("[template-field='mime_type']")).text(t.type),n.appendTo(i)}(n)})},this.upload_fila=function(){if(App.is_nativo()){var i=.1,e=setInterval(function(){$(t.arr_files).each(function(n,o){var a=t.tab_listagem.find('[id="'+o.id+'"]').find(".progress-bar");a.css("width",i+"%"),a.addClass("active"),50==(i+=.1)&&clearInterval(e)})},1);WS_pg_files.post("documento/upload_fila",{optionsFileKey:"documentos",documentos:t.arr_files,is_nativo:"S"},function(i){$(t.arr_files).each(function(i,e){var n=t.tab_listagem.find('[id="'+e.id+'"]').find(".progress-bar");n.removeClass("progress-bar-primary"),n.addClass("progress-bar-success"),n.removeClass("active"),n.css("width","100%")}),void 0!==t.oncomplete&&t.oncomplete&&t.oncomplete(i)},!1)}else{var n=t.arr_files.length,o=0;t.info_total_arquivos.text(n);var a=function(){if(o==n&&(t.info_icone.removeClass("fa fa-spinner fa-pulse"),t.info_icone.addClass("fa fa-check")),o<n){var i=o,e=t.arr_files[i];t.info_num_arquivo.text(o+1),t.info_nome_arquivo.text(e.name),t.info_icone.addClass("fa fa-spinner fa-pulse");var s=t.tab_listagem.find('[id="'+e.id+'"]').find(".progress-bar");WS.post("documento/upload_fila",{documentos:e,arquivo_id:e.id,is_nativo:"N"},function(e){if("undefined"==e){var n=t.tab_listagem.find("tr:not(:nth-of-type(1))").eq(t.contador_files+i);$(n).addClass("bg-danger")}else t.arr_files[i].enviado=!0;o++,setTimeout(function(){a()},1e3)},[],null,!0,null,function(i){s.addClass("active"),s.css("width",i+"%"),i>=100&&(s.removeClass("active"),s.addClass("progress-bar-success"))})}else void 0!==t.oncomplete&&t.oncomplete&&t.oncomplete()};a()}},this.btn_limpar.unbind("click"),this.btn_limpar.click(function(){$(t.tab_listagem.find("tr:not(:nth-of-type(1))")).each(function(i,t){var e=$(t).find(".progress-bar").css("width");parseInt(e)>=100&&$(t).remove()})}),this.close=function(){void 0!==t.onclose&&t.onclose&&t.onclose()},this.unload=function(){t.close(),View.unload(this.html_id)}}});