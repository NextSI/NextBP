var dx_Filter_Builder=function(e){if(e){e=spread({div_html:null,fields:null,valor:null},e);var t=tratar_formulario(e.fields);return e.div_html.dxFilterBuilder({allowHierarchicalFields:!0,fields:t,value:e.valor?tratar_valor(e.valor,t):null,groupOperations:["and","or"],customOperations:[{name:"anyof",caption:App.lang.gateway_destino_evento.anyof,icon:"check",editorTemplate:function(e){return $("<div>").dxTagBox({value:e.value,items:e.field.lookup.dataSource,onValueChanged:function(t){e.setValue(t.value&&t.value.length?t.value:null)},width:"auto"})},calculateFilterExpression:function(e,t){return e&&e.length&&Array.prototype.concat.apply([],e.map(function(e){return[[t.dataField,"=",e],"or"]})).slice(0,-1)}}],onContentReady:function(e){e.element.find(".dx-filterbuilder-item-field").unbind("click").click(function(){setTimeout(function(){$(".dx-item").unbind("click").click(function(e){$(this).parent().find(".dx-treeview-toggle-item-visibility").length&&e.stopPropagation()})})})}}).dxFilterBuilder("instance")}},tratar_valor=function(e,t){var a=[];if("string"==typeof e[0])for(var r=0;r<t.length;r++){(o=t[r]).dataField==e[0]&&a.push(e)}else for(r=0;r<e.length;r++){var o,i=!1;if("object"==typeof(o=e[r]))if("string"==typeof o[0]){for(var n=0;n<t.length;n++)if(t[n].dataField==o[0]){i=!0,a.push(o);break}i||r++}else a.push(tratar_valor(o,t));else a.push(o)}return a},tratar_formulario=function(e){for(var t=[],a=0;a<e.grupos.length;a++){var r=e.grupos[a];t.push({dataField:r.id.toString(),caption:r.nome,filterOperations:[null]});for(var o=0;o<r.elementos.length;o++){var i=r.elementos[o];i.tipo!=ELEMENTO_TIPO.TABELA&&i.id_elemento&&i.tipo!=ELEMENTO_TIPO.ANEXO&&i.tipo!=ELEMENTO_TIPO.SELECAO_DOCUMENTO&&i.tipo!=ELEMENTO_TIPO.BOTAO&&t.push({dataField:r.id+"."+i.id_elemento,caption:i.nome+" ID: #"+i.id_elemento,dataType:datatype_elemento_tipo(i.tipo),format:i.tipo==ELEMENTO_TIPO.DECIMAL?{type:"fixedPoint",precision:parseInt(i.decimais)}:i.tipo==ELEMENTO_TIPO.DATA?"dd/MM/yyyy":null,filterOperations:i.tipo!=ELEMENTO_TIPO.OPCOES||i.tipo_lista_opcoes!=TIPO_LISTA_OPCOES.CHECKBOX&&i.tipo_lista_opcoes!=TIPO_LISTA_OPCOES.OPTION_MULTIPLAS?i.tipo==ELEMENTO_TIPO.CAIXA_VERIFICACAO?["=","<>"]:void 0:["=","<>","isblank","isnotblank","anyof"],lookup:i.tipo==ELEMENTO_TIPO.OPCOES?{dataSource:i.opcoes}:null,customizeText:function(e){return"date"==this.dataType?e.value.format_date():e.value}})}}return t},localizar_condicao=function(e){var t="";if(e)if("string"==typeof e[0])t+="("+formatar_condicao(e)+")";else if(e.length){t+="(";for(var a=0;a<e.length;a++){var r=e[a];t+="object"==typeof r?"string"==typeof r[0]?formatar_condicao(r):localizar_condicao(r):converter_operador(r)}t+=")"}return t},formatar_condicao=function(e){var t=e[0].split(".");t.length>1&&t.shift(),t=t.join(".");var a=e[1];!0!==e[2]&&!1!==e[2]||(e[2]=!0===e[2]?"S":"N");var r=null==e[2]?'""':'"'+e[2]+'"',o="("+t+".attr('type_campo') == 'inteiro' ? parseInt("+t+".val()) || 0 : ("+t+".attr('type_campo') == 'decimal' ? parseFloat("+t+".val().replace('.', '').replace(',', '.')) || 0 : ("+t+".hasClass('text_fixo') ? "+t+".text() : ("+t+".attr('type') == 'radio' ? "+t+".filter(':checked').val() : ("+t+".attr('type') == 'checkbox' ? obter_valores_checkBox("+t+") : ("+t+".hasClass('input_consulta_integracao') ? "+t+".find('.dx-dropdownbox').dxDropDownBox('instance').option('value') || '' : "+t+".val()))))))";let i=null;switch(a){case"=":case"<>":case"<":case"<=":case">":case">=":i="("+o+converter_operador(a)+" ("+t+".attr('type_campo') == 'inteiro' ? parseInt("+r+") || 0 : ("+t+".attr('type_campo') == 'decimal' ? parseFloat("+r+") || 0 : ("+t+".attr('type') == 'date' ? "+r+".substr(0,10) : "+r+"))))";break;case"between":i="("+o+" >= "+("("+t+".attr('type_campo') == 'inteiro' ? parseInt("+r+".split(',')[0]) || 0 : ("+t+".attr('type_campo') == 'decimal' ? parseFloat("+r+".split(',')[0]) || 0 : ("+t+".attr('type') == 'date' ? "+r+".split(',')[0].substr(0,10) : "+r+")))")+" && "+o+" <= "+("("+t+".attr('type_campo') == 'inteiro' ? parseInt("+r+".split(',')[1]) || 0 : ("+t+".attr('type_campo') == 'decimal' ? parseFloat("+r+".split(',')[1]) || 0 : ("+t+".attr('type') == 'date' ? "+r+".split(',')[1].substr(0,10) : "+r+")))")+")";break;case"contains":i="("+o+".includes("+r+"))";break;case"notcontains":i="(!"+o+".includes("+r+"))";break;case"startswith":i="("+o+".startsWith("+r+"))";break;case"endswith":i="("+o+".endsWith("+r+"))";break;case"isblank":i="("+o+")";break;case"isnotblank":i="(!"+o+")";break;case"or":i=" || ";break;case"and":i=" && ";break;case"anyof":i="findOne("+o+","+r+".split(','))"}return i="(typeof("+t+") != 'undefined' ? ("+i+") : console.warn('campo "+t+" está sendo chamado, porém não está disponível nesta etapa do processo')) ",i},converter_operador=function(e){switch(e){case"=":return" == ";case"<>":return" != ";case"<":return" < ";case"<=":return" <= ";case">":return" > ";case">=":return" >= ";case"or":return" || ";case"and":return" && "}};