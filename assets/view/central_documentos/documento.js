define(["react","react-dom","./ListarAprovadores","./../componentes_react/InputArquivo"],function(a,o,i,e){return function(t){"use strict";var s=this;this.html_id=t,this.dialog=$("#"+this.html_id),this.title="Documento",this.tipo=null,this.tipo_anexo=null,this.onclose=null,this.onsave=null,this.ondelete=null,this.houve_alteracao=!1,this.lbl_tab_geral=this.dialog.find(".lbl_tab_geral"),this.menu_geral=this.dialog.find(".menu_geral"),this.painel_geral=this.dialog.find(".painel_geral"),this.lbl_tab_seguranca=this.dialog.find(".lbl_tab_seguranca"),this.menu_seguranca=this.dialog.find(".menu_seguranca"),this.painel_seguranca=this.dialog.find(".painel_seguranca"),this.lbl_tab_observacoes=this.dialog.find(".lbl_tab_observacoes"),this.menu_observacoes=this.dialog.find(".menu_observacoes"),this.painel_observacoes=this.dialog.find(".painel_observacoes"),this.lbl_tab_aprovacoes=this.dialog.find(".lbl_tab_aprovacoes"),this.menu_aprovacoes=this.dialog.find(".menu_aprovacoes"),this.painel_aprovacoes=this.dialog.find(".painel_aprovacoes"),this.lbl_tab_distribuicoes=this.dialog.find(".lbl_tab_distribuicoes"),this.menu_distribuicoes=this.dialog.find(".menu_distribuicoes"),this.painel_distribuicoes=this.dialog.find(".painel_distribuicoes"),this.lbl_tab_revisoes=this.dialog.find(".lbl_tab_revisoes"),this.menu_revisoes=this.dialog.find(".menu_revisoes"),this.painel_revisoes=this.dialog.find(".painel_revisoes"),this.lbl_info_versao_revisao=this.dialog.find(".lbl_info_versao_revisao"),this.lbl_tab_historico=this.dialog.find(".lbl_tab_historico"),this.menu_log=this.dialog.find(".menu_log"),this.painel_historico=this.dialog.find(".painel_historico"),this.grid_historico_documento=this.dialog.find("#grid_historico_documento"),this.lbl_tab_notificacao=this.dialog.find(".lbl_tab_notificacao"),this.menu_notificacao=this.dialog.find(".menu_notificacao"),this.painel_notificacao=this.dialog.find(".painel_notificacao"),this.lbl_tab_referencias=this.dialog.find(".lbl_tab_referencias"),this.menu_referencias=this.dialog.find(".menu_referencias"),this.painel_referencias=this.dialog.find(".painel_referencias"),this.div_componente_referencias=this.dialog.find(".div_componente_referencias"),this.painel_novo_arquivo=this.dialog.find(".painel_novo_arquivo"),this.painel_nova_revisao=this.dialog.find(".painel_nova_revisao"),this.dx_listagem_documento_copia_controlada=this.dialog.find(".dx_listagem_documento_copia_controlada"),this.dx_listagem_documento_distribuicoes=this.dialog.find(".dx_listagem_documento_distribuicoes"),this.edt_nome=this.dialog.find(".edt_nome"),this.edt_observacao_revisao=this.dialog.find(".edt_observacao_revisao"),this.edt_observacao_novo=this.dialog.find(".edt_observacao_novo"),this.edt_observacoes_historico=this.dialog.find(".edt_observacoes_historico"),this.edt_tag=this.dialog.find(".edt_tag"),this.div_assunto=this.dialog.find(".div_assunto"),this.cbo_assunto=this.dialog.find(".cbo_assunto"),this.btn_assunto_visualizar=this.dialog.find(".btn_assunto_visualizar"),this.btn_assunto_novo=this.dialog.find(".btn_assunto_novo"),this.div_tipo_documento=this.dialog.find(".div_tipo_documento"),this.div_tipo_aprovacao=this.dialog.find(".div_tipo_aprovacao"),this.cbo_tipo_documento=this.dialog.find(".cbo_tipo_documento"),this.btn_tipo_documento_visualizar=this.dialog.find(".btn_tipo_documento_visualizar"),this.btn_tipo_documento_novo=this.dialog.find(".btn_tipo_documento_novo"),this.div_local_armazenamento=this.dialog.find(".div_local_armazenamento"),this.cbo_local_armazenamento=this.dialog.find(".cbo_local_armazenamento"),this.btn_local_armazenamento_visualizar=this.dialog.find(".btn_local_armazenamento_visualizar"),this.btn_local_armazenamento_novo=this.dialog.find(".btn_local_armazenamento_novo"),this.btn_favoritar_item=this.dialog.find(".btn_favoritar_item"),this.dx_selecao_pasta=this.dialog.find(".dx_selecao_pasta"),this.div_novo_arquivo=this.dialog.find(".div_novo_arquivo"),this.inputArquivoNovo=a.createElement(e,null,null),this.lbl_tab_revisoes=this.dialog.find(".lbl_tab_revisoes"),this.painel_revisoes=this.dialog.find(".painel_revisoes"),this.tab_revisoes=this.dialog.find(".tab_revisoes"),this.th_aprovacao=this.dialog.find(".th_aprovacao"),this.lbl_tab_nova_revisao=this.dialog.find(".lbl_tab_nova_revisao"),this.div_nova_revisao=this.dialog.find(".div_nova_revisao"),this.inputNovaRevisao=a.createElement(e,null,null),this.painel_historico=this.dialog.find(".painel_historico"),this.painel_aprovacoes=this.dialog.find(".painel_aprovacoes"),this.tab_aprovacoes=this.dialog.find(".tab_aprovacoes"),this.lbl_tab_seguranca=this.dialog.find(".lbl_tab_seguranca"),this.painel_seguranca=this.dialog.find(".painel_seguranca"),this.chk_controle_acessos=this.dialog.find(".chk_controle_acessos"),this.dx_popup_validacao_permissoes_retroativas=this.dialog.find(".dx_popup_validacao_permissoes_retroativas"),this.chk_notificacoes=this.dialog.find(".chk_notificacoes"),this.chk_notificar_email_antes=this.dialog.find(".chk_notificar_email_antes"),this.cbo_notificar_email_antes_quem=this.dialog.find(".cbo_notificar_email_antes_quem"),this.chk_notificacao_outros_usuarios=this.dialog.find(".chk_notificacao_outros_usuarios"),this.chk_notificacao_seguranca=this.dialog.find(".chk_notificacao_seguranca"),this.chk_notificacao_aprovador=this.dialog.find(".chk_notificacao_aprovador"),this.chk_copia_controlada=this.dialog.find(".chk_copia_controlada"),this.chk_tornar_dist_pend_aprov_doc=this.dialog.find(".chk_tornar_dist_pend_aprov_doc"),this.elemDistribuicaoControlada=this.dialog.find(".elemDistribuicaoControlada"),this.div_permissoes=this.dialog.find(".div_permissoes"),this.div_emails_adicionais=this.dialog.find(".div_emails_adicionais"),this.div_notificacao_vigencia=this.dialog.find(".div_notificacao_vigencia"),this.tab_permissoes=this.dialog.find(".tab_permissoes"),this.tab_permissoes_grupo=this.dialog.find(".tab_permissoes_grupo"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.btn_add_usuario=this.dialog.find(".btn_add_usuario"),this.btn_add_grupo=this.dialog.find(".btn_add_grupo"),this.btn_download_revisao_atual=this.dialog.find(".btn_download_revisao_atual"),this.btn_group_visualizar_revisao_atual=this.dialog.find(".btn_group_visualizar_revisao_atual"),this.btn_visualizar_revisao_atual=this.dialog.find(".btn_visualizar_revisao_atual"),this.btn_download_revisao_atual_2=this.dialog.find(".btn_download_revisao_atual_2"),this.btn_download_revisao_atual_3=this.dialog.find(".btn_download_revisao_atual_3"),this.menu_visualizar_revisao_atual_google_docs=this.dialog.find(".menu_visualizar_revisao_atual_google_docs"),this.btn_visualizar_revisao_atual_google_docs=this.dialog.find(".btn_visualizar_revisao_atual_google_docs"),this.menu_visualizar_revisao_atual_office_365=this.dialog.find(".menu_visualizar_revisao_atual_office_365"),this.btn_visualizar_revisao_atual_office_365=this.dialog.find(".btn_visualizar_revisao_atual_office_365"),this.btn_assinaturas_clicksign=this.dialog.find(".btn_assinaturas_clicksign"),this.btn_assinaturas_certsign=this.dialog.find(".btn_assinaturas_certsign"),this.btn_assinaturas_d4sign=this.dialog.find(".btn_assinaturas_d4sign"),this.div_codigo=this.dialog.find(".div_codigo"),this.edt_codigo=this.dialog.find(".edt_codigo"),this.edt_validade=this.dialog.find(".edt_validade"),this.edt_dias_notitificacao=this.dialog.find(".edt_dias_notitificacao"),this.cbo_validade_periodo=this.dialog.find(".cbo_validade_periodo"),this.edt_data_vigencia=this.dialog.find(".edt_data_vigencia"),this.div_edt_prazo_dias=this.dialog.find(".div_edt_prazo_dias"),this.edt_prazo_dias=this.dialog.find(".edt_prazo_dias"),this.div_ListarAprovadores=this.dialog.find(".listarAprovadores"),this.ListarAprovadores=a.createElement(i,null,null),this.cbo_tipo_aprovacao=this.dialog.find(".cbo_tipo_aprovacao"),this.cbo_selecionar_alcada=this.dialog.find(".cbo_selecionar_alcada"),this.div_cbo_selecionar_alcada=this.dialog.find(".div_cbo_selecionar_alcada"),this.div_cbo_aprovador=this.dialog.find(".div_cbo_aprovador"),this.cbo_aprovador=this.dialog.find(".cbo_aprovador"),this.panel_central_documentos=this.dialog.find(".panel_central_documentos"),this.content_central_documentos=this.dialog.find(".content_central_documentos"),this.doc_rev_reprovado=this.dialog.find(".doc_rev_reprovado"),this.doc_rev_pendente=this.dialog.find(".doc_rev_pendente"),this.doc_bloqueado=this.dialog.find(".doc_bloqueado"),this.div_carregar_mais_aprovacoes=this.dialog.find(".div_carregar_mais_aprovacoes"),this.btn_carregar_mais_aprovacoes=this.dialog.find(".btn_carregar_mais_aprovacoes"),this.cbo_usuario_historico_aprovacoes=this.dialog.find(".cbo_usuario_historico_aprovacoes"),this.cbo_situacao_historico_aprovacoes=this.dialog.find(".cbo_situacao_historico_aprovacoes"),this.cbo_origem_historico_aprovacoes=this.dialog.find(".cbo_origem_historico_aprovacoes"),this.ipt_revisao_historico_aprovacoes=this.dialog.find(".ipt_revisao_historico_aprovacoes"),this.ipt_nivel_historico_aprovacoes=this.dialog.find(".ipt_nivel_historico_aprovacoes"),this.ipt_consideracoes_historico_aprovacoes=this.dialog.find(".ipt_consideracoes_historico_aprovacoes"),this.ipt_recebimento_data=this.dialog.find(".ipt_recebimento_data"),this.ipt_acao_data=this.dialog.find(".ipt_acao_data"),this.ipt_prazo_data=this.dialog.find(".ipt_prazo_data"),this.aprovacoes_historico=this.dialog.find(".aprovacoes_historico"),this.aprovacoes_configuracoes=this.dialog.find(".aprovacoes_configuracoes"),this.distribuicoes_historico=this.dialog.find(".distribuicoes_historico"),this.distribuicoes_configuracoes=this.dialog.find(".distribuicoes_configuracoes"),this.btn_aprovacoes_historico=this.dialog.find(".btn_aprovacoes_historico"),this.btn_aprovacoes_configuracoes=this.dialog.find(".btn_aprovacoes_configuracoes"),this.btn_distribuicoes_historico=this.dialog.find(".btn_distribuicoes_historico"),this.btn_distribuicoes_configuracoes=this.dialog.find(".btn_distribuicoes_configuracoes"),this.documento=null,this.grupos=new Object,this.grupos_array=new Array,this.usuarios={automatic:!1,add_self:!1},this.usuarios_array=new Array,this.usuarios_aplicar_permissoes_retroativas=[],this.grupos_usuarios_aplicar_permissoes_retroativas=[],this.dataGrid_distribuicao_controlada=null,this.dados_distribuicao_controlada={},this.dataGrid_distribuicoes=null,this.valor=null,this.documento_id=null,this.documento_pasta_id=null,this.nova_revisao=!1,this.permite_alterar_seguranca=!1,this.atividade_id=null,this.projeto_id=null,this.solicitacao_atividade_id=null,this.solicitacao_id=null,this.oportunidade_id=null,this.observacoes=!1,this.arr_historico=null,this.pasta_notificacao=null,this.usuario_historico=null,this.acao_historico=null,this.solicitacao_numero="",this.nome_processo="",this.nome_campo="",this.nome_padrao="",this.versoes=[],this.permitir_exclusao=!0,this.codigo_documento=!1,this.informar_codigo_documento_pasta=!1,this.codigo_pasta="",this.usuario_permissao_escrita=null,this.documento_parametros=null,this.documento_bloqueado=null,this.limite=0,this.limite_quantidade=50,this.todos_carregados=!1,this.param_inicial_aprovacoes=0,this.param_qtde_aprovacoes=50,this.param_todos_carregados_aprovacoes=!1,this.referencia_tabela=null,this.referencia_id=null,this.filtro_historico_aprovacoes_usuario_id,this.filtro_historico_aprovacoes_situacao,this.filtro_historico_aprovacoes_revisao,this.filtro_historico_aprovacoes_nivel,this.filtro_historico_aprovacoes_consideracoes,this.filtro_historico_aprovacoes_origem,this.filtro_historico_aprovacoes_recebimento_data,this.filtro_historico_aprovacoes_acao_data,this.documento_confirmacao_distribuicao=a.createElement(e,null,null),this.visualizar_versoes_documento=!0,this.tab_email_usuarios={tabela:this.dialog.find(".tab_email_usuarios"),header:this.dialog.find(".tab_email_usuarios_header"),input:this.dialog.find(".tab_email_usuarios_header thead .edt_emails"),btn_add:this.dialog.find(".tab_email_usuarios_header thead .btn_add_email"),bp_drop:this.dialog.find(".tab_email_usuarios_header thead .bp_div_drop > ul"),create_row:function(a){var o=$(this.tabela).find("[template-row]").clone();return o.removeAttr("template-row").removeClass("hidden"),o.find(".lbl_email").text(a),o.appendTo(this.tabela.find("tbody")),o},getColumn:function(a,o){return $(a).find("."+o)},elem_key:0,arr_dados:[],add_email:function(a,o){var i,e,t=this.arr_dados;if(i=a.email,e=!1,t.filter(function(a){a.email==i&&(e=!0)}),!(!e&&a.email.trim().length>0&&validateEmail(a.email)))return validateEmail(a.email)?void(void 0!==o&&null!=o&&o(!1)):void alert_modal("Alerta","O e-mail inserido está inválido.");t.push({elem_key:a.elem_key,email:a.email}),void 0!==o&&null!=o&&o(!0)},remove_email:function(a,o){var i=this.arr_dados;i.filter(function(o,e){o.elem_key==a&&i.splice(e,1)})},reset:function(){$(this.tabela).find("tbody").find("tr:not([template-row])").remove(),this.elem_key=0,this.arr_dados=[]}},this.anexos=[],this.pdca_id=null,this.pdca_atividade_id=null,this.tarefa_quadro_lista_cartao_id=null,this.download_url_dialog=null,this.show=function(a,i,e,t,r,n,d,c,_,l,u,p,v,m,h,f){verifica_favorito("documentos",a)&&s.btn_favoritar_item.find("span").addClass("glyphicon-star").removeClass("glyphicon-star-empty"),s.painel_geral.attr("id","painel_geral"+s.html_id),s.painel_seguranca.attr("id","painel_seguranca"+s.html_id),s.painel_observacoes.attr("id","painel_observacoes"+s.html_id),s.painel_aprovacoes.attr("id","painel_aprovacoes"+s.html_id),s.painel_distribuicoes.attr("id","painel_distribuicoes"+s.html_id),s.painel_revisoes.attr("id","painel_revisoes"+s.html_id),s.painel_historico.attr("id","painel_historico"+s.html_id),s.painel_notificacao.attr("id","painel_notificacao"+s.html_id),s.painel_referencias.attr("id","painel_referencias"+s.html_id),s.menu_geral.attr("href","#"+s.painel_geral.attr("id")),s.menu_seguranca.attr("href","#"+s.painel_seguranca.attr("id")),s.menu_observacoes.attr("href","#"+s.painel_observacoes.attr("id")),s.menu_aprovacoes.attr("href","#"+s.painel_aprovacoes.attr("id")),s.menu_distribuicoes.attr("href","#"+s.painel_distribuicoes.attr("id")),s.menu_revisoes.attr("href","#"+s.painel_revisoes.attr("id")),s.menu_log.attr("href","#"+s.painel_historico.attr("id")),s.menu_notificacao.attr("href","#"+s.painel_notificacao.attr("id")),s.menu_referencias.attr("href","#"+s.painel_referencias.attr("id")),s.tipo=i,s.tipo_anexo=p,s.codigo_pasta=v,o.render(s.inputArquivoNovo,s.div_novo_arquivo[0]),o.render(s.inputNovaRevisao,s.div_nova_revisao[0]),s.inputArquivoNovo.props.handleAlterado=this.inputArquivoNovoHandleAlterado,s.inputNovaRevisao.props.handleAlterado=this.inputNovaRevisaoHandleAlterado,WS.get("documento/get_parametros/",null,function(o){s.documento_parametros=o,s.informar_codigo_documento_pasta="N"!=o.documentos_informar_codigo_documento_pasta,s.permitir_exclusao="N"!=o.documentos_permitir_exclusao,1==s.informar_codigo_documento_pasta?(s.div_codigo.removeClass("hidden"),s.edt_codigo.attr("required",!0)):s.edt_nome.parent().parent().toggleClass("col-md-8 col-md-12"),s.carregamento_inicial(a,i,e,t,r,n,d,c,_,l,u,p,v,h,m,f)})},this.carregamento_inicial=function(a,o,i,e,t,r,n,d,c,_,l,u,p,v,m,h){s.solicitacao_numero=n,s.nome_processo=l,void 0!==h&&h&&(s.tarefa_quadro_lista_cartao_id=h),void 0!==m&&m&&(s.pdca_atividade_id=m.pdca_atividade_id),void 0!==v&&v&&(s.pdca_id=v),void 0!==i&&i&&(s.documento_pasta_id=i),void 0!==e&&e&&(s.nova_revisao=e),void 0!==n&&n&&(s.solicitacao_id=n),void 0!==d&&d&&(s.solicitacao_atividade_id=d),void 0!==c&&c&&(s.oportunidade_id=c),void 0!==t&&t&&(s.projeto_id=t),void 0!==r&&r&&(s.atividade_id=r),create_combobox(s.cbo_aprovador,s.listar_grupos_usuarios),s.RenderAprovadores(),void 0!==a&&a?(s.documento_id=a,s.lbl_tab_seguranca.addClass("hidden"),s.preencher()):(App.titulo_aba(s.html_id,"Novo documento"),void 0!==i&&i?(s.preencher_padroes(),s.renderizar_dx_selecao_pasta(i)):(s.listar_assunto(),s.listar_tipo_documento(),s.renderizar_dx_selecao_pasta()),s.chk_notificacoes.prop("checked",s.pasta_notificacao||!1).change(),App.sessao.dados.admin||(s.usuarios=App.sessao.dados,s.usuarios.visualizacao=!0,s.usuarios.download=!0,s.usuarios.escrita=!0,s.usuarios.exclusao=!0,s.usuarios.manutencao_revisoes=!0,s.usuarios.nova_revisao=!0,s.usuarios.seguranca=!0,s.usuarios.automatic=!0,s.usuarios_array.push(s.usuarios)),s.listar_local_armazenamento(),s.permite_alterar(),s.preencher_distribuicoes([])),s.listar_copia_controlada(),void 0!==_&&_&&(s.observacoes=_),s.ajusto_componentes(),s.listar_filtro_historico_aprovacoes()},this.close=function(){void 0!==s.onclose&&s.onclose&&s.onclose(s.houve_alteracao)},this.unload=function(){s.close(),View.unload(this.html_id)},this.permite_alterar=function(){var a=!1;switch(s.tipo){case FORMULARIO.NOVO:s.btn_salvar.show(),a=!0,s.valor=!0,WS.get("documento/ultimo_codigo/",{documento_pasta_id:s.documento_pasta_id},function(a){s.edt_codigo.val(a)}),s.permite_alterar_seguranca=!0,s.btn_favoritar_item.hide();break;case FORMULARIO.EDITAR:s.btn_salvar.show(),a=!0,s.valor=!0,s.permite_alterar_seguranca=!0;break;case FORMULARIO.VISUALIZAR:s.btn_salvar.hide(),a=!1,s.valor=!1,s.permite_alterar_seguranca=!1}s.edt_nome.prop("readonly",!a),s.edt_observacao_revisao.prop("readonly",!a),s.edt_observacao_novo.prop("readonly",!a),s.edt_tag.prop("readonly",!a),s.cbo_assunto.prop("disabled",!a),s.btn_add_grupo.prop("disabled",!a),s.btn_add_usuario.prop("disabled",!a),s.btn_assunto_novo.prop("disabled",!a),s.cbo_tipo_documento.prop("disabled",!a),s.btn_tipo_documento_novo.prop("disabled",!a),s.chk_controle_acessos.prop("disabled",!a),s.chk_notificacao_seguranca.prop("disabled",!a),s.exibicao_validade_vigencia(),s.usuario_permissao_escrita||s.usuario_permissao_nova_revisao||s.tipo==FORMULARIO.NOVO?(s.panel_central_documentos.css("opacity","1").css("cursor","auto"),s.content_central_documentos.css("pointer-events","auto"),s.tipo==FORMULARIO.NOVO||s.usuario_permissao_escrita||(s.panel_central_documentos.css("opacity","1").css("cursor","not-allowed"),s.content_central_documentos.css("pointer-events","none"),s.usuario_permissao_nova_revisao&&(s.content_central_documentos.find(".painel_nova_revisao").css("pointer-events","auto"),s.content_central_documentos.find(".painel_nova_revisao").css("cursor","auto"))),s.lbl_info_versao_revisao.css("pointer-events","auto").css("cursor","auto")):s.lbl_tab_revisoes.parent().click(function(){setTimeout(function(){s.lbl_tab_revisoes.hasClass("active")||s.lbl_tab_historico.hasClass("active")||s.lbl_tab_aprovacoes.hasClass("active")?(s.panel_central_documentos.css("opacity","1").css("cursor","auto"),s.content_central_documentos.css("pointer-events","auto")):(s.panel_central_documentos.css("opacity","0.7").css("cursor","not-allowed"),s.content_central_documentos.css("pointer-events","none")),s.lbl_info_versao_revisao.css("pointer-events","auto").css("cursor","auto")})})},this.ajusto_componentes=function(){switch(s.tipo){case FORMULARIO.NOVO:s.painel_novo_arquivo.show(),s.inputArquivoNovo.props.setDesabilitado(!1),s.painel_nova_revisao.hide(),s.lbl_tab_revisoes.hide(),s.lbl_tab_historico.hide(),s.lbl_tab_nova_revisao.hide(),s.lbl_tab_seguranca.hide(),s.lbl_tab_geral.find("a").tab("show");break;case FORMULARIO.EDITAR:if(s.painel_novo_arquivo.hide(),s.painel_nova_revisao.show(),s.lbl_tab_revisoes.show(),s.lbl_tab_historico.show(),s.lbl_tab_nova_revisao.show(),s.inputNovaRevisao.props.setDesabilitado(!1),s.lbl_tab_seguranca.show(),s.nova_revisao)s.lbl_tab_nova_revisao.find("a").tab("show");else if(s.observacoes)s.lbl_tab_observacoes.find("a").tab("show");else switch(s.tab_foco_inicial){case"revisoes":s.lbl_tab_revisoes.find("a").tab("show");break;default:s.lbl_tab_geral.find("a").tab("show")}}App.verifica_permissao(App.temp.empresa,"assunto")||(s.btn_assunto_novo.hide(),s.btn_assunto_visualizar.hide(),s.div_assunto.removeClass("input-group")),App.verifica_permissao(App.temp.empresa,"tipo_documento")||(s.btn_tipo_documento_novo.hide(),s.btn_tipo_documento_visualizar.hide(),s.div_tipo_documento.removeClass("input-group")),App.verifica_permissao(App.temp.empresa,"local_armazenamento")||(s.btn_local_armazenamento_novo.hide(),s.btn_local_armazenamento_visualizar.hide(),s.div_local_armazenamento.removeClass("input-group"))},this.consultar_ultima_revisao=function(a){if(s.btn_group_visualizar_revisao_atual.hide(),s.btn_download_revisao_atual.hide(),s.menu_visualizar_revisao_atual_google_docs.hide(),s.menu_visualizar_revisao_atual_office_365.hide(),a.documento_revisao_id>0)if("application/pdf"==a.revisao_mime_type&&!detectmob()||"image/png"==a.revisao_mime_type||"image/bmp"==a.revisao_mime_type||"image/jpeg"==a.revisao_mime_type||"image/jpg"==a.revisao_mime_type||"image/gif"==a.revisao_mime_type){if(s.btn_group_visualizar_revisao_atual.show(),s.btn_download_revisao_atual_3.show(),s.usuario_permissao_download?(s.btn_download_revisao_atual_2.unbind("click"),s.btn_download_revisao_atual_2.click(function(){var o=function(){App.obter_token_publico(function(o){App.download(WS_URI+"documento/download/?documento_revisao_id="+a.documento_revisao_id+"&documento_id="+a.id+"&token_publico="+o),"safari"!=getBrowser()&&s.unload()})};"S"==s.documento_bloqueado?alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !','<div class="alert alert-danger" style="text-align: center"> <span href="#" class="alert-link"><strong>Você está tentando baixar um documento </strong>bloqueado,<strong> deseja continuar ?  </strong></span></div>','<i class="fa fa-download" aria-hidden="true"></i> Download',function(){o()},!0):o()}),s.btn_download_revisao_atual_3.unbind("click"),s.btn_download_revisao_atual_3.click(function(){var o=function(){App.obter_token_publico(function(o){App.download(WS_URI+"documento/download_aprovacoes/?documento_revisao_id="+a.documento_revisao_id+"&token_publico="+o)})};"S"==s.documento_bloqueado?alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !','<div class="alert alert-danger" style="text-align: center"> <span href="#" class="alert-link"><strong>Você está tentando baixar um documento </strong>bloqueado,<strong> deseja continuar ?  </strong></span></div>','<i class="fa fa-download" aria-hidden="true"></i> Download',function(){o()},!0):o()})):s.btn_group_visualizar_revisao_atual.find(".dropdown-toggle").addClass("hidden"),"application/pdf"==a.revisao_mime_type)var o=function(){View.load("central_documentos/visualizar_pdf",function(o,i){i.show(a.documento_revisao_id,null,null,"S",a.aprovacao_ultima_rev,s.documento_bloqueado,null,s.usuario_permissao_download)})};else o=function(){View.load("central_documentos/visualizar_documento",function(o,i){i.show(a.documento_revisao_id,a.id,"S","S",s.documento_bloqueado,a.controle_distribuicao,s.usuario_permissao_download)})};s.btn_visualizar_revisao_atual.unbind("click"),s.btn_visualizar_revisao_atual.click(o)}else if(MIME_TYPE_OFFICE.indexOf(a.revisao_mime_type)>=0){var i=function(){App.obter_token_publico(function(o){var i=window.location.protocol+"//"+window.location.host+"/"+window.location.pathname,e=i.indexOf("index.html");e>0&&(i=i.substring(0,e)),i+="/webservice/index.php/documento/download/?documento_revisao_id="+a.documento_revisao_id+"&documento_id="+a.id+"&token_publico="+o+"&acao=abrir";var t="https://docs.google.com/viewer?embedded=true&url="+encodeURIComponent(i);window.open(t,"_blank")})};if(s.usuario_permissao_download){s.btn_group_visualizar_revisao_atual.show(),s.btn_download_revisao_atual.show(),s.btn_visualizar_revisao_atual.hide(),s.btn_download_revisao_atual_2.hide(),s.menu_visualizar_revisao_atual_google_docs.show(),s.menu_visualizar_revisao_atual_office_365.show(),s.btn_visualizar_revisao_atual_google_docs.click(i),s.btn_visualizar_revisao_atual_office_365.click(function(){App.obter_token_publico(function(o){var i=window.location.protocol+"//"+window.location.host+"/"+window.location.pathname,e=i.indexOf("index.html");e>0&&(i=i.substring(0,e)),i+="/webservice/index.php/documento/download/?documento_revisao_id="+a.documento_revisao_id+"&documento_id="+a.id+"&token_publico="+o+"&acao=abrir";var t="https://view.officeapps.live.com/op/view.aspx?src="+encodeURIComponent(i);window.open(t,"_blank")})});var e=function(){var o=function(){App.obter_token_publico(function(o){App.download(WS_URI+"documento/download/?documento_revisao_id="+a.documento_revisao_id+"&documento_id="+a.id+"&token_publico="+o),"safari"!=getBrowser()&&s.unload()})};"S"==s.documento_bloqueado?alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !','<div class="alert alert-danger" style="text-align: center"> <span href="#" class="alert-link"><strong>Você está tentando baixar um documento </strong>bloqueado,<strong> deseja continuar ?  </strong></span></div>','<i class="fa fa-download" aria-hidden="true"></i> Download',function(){o()},!0):o()};s.btn_download_revisao_atual.unbind("click"),s.btn_download_revisao_atual.click(e),extensao_valida(a.revisao_nome,extensoes_validas_assinatura)&&(void 0!==App.sessao.dados.parametro_documento&&"S"==App.sessao.dados.parametro_documento.certsign_ativo&&(s.btn_assinaturas_certsign.show(),s.btn_assinaturas_certsign.unbind("click"),s.btn_assinaturas_certsign.bind("click",function(){View.load("certsign/detalhes",function(o,i){i.show(a.documento_revisao_id)},View.ABA.SIM)})),void 0!==App.sessao.dados.parametro_documento&&"S"==App.sessao.dados.parametro_documento.clicksign_ativo&&(s.btn_assinaturas_clicksign.show(),s.btn_assinaturas_clicksign.unbind("click"),s.btn_assinaturas_clicksign.bind("click",function(){View.load("clicksign/detalhes",function(o,i){i.show(a.documento_revisao_id)},View.ABA.SIM)})),void 0!==App.sessao.dados.parametro_documento&&"S"==App.sessao.dados.parametro_documento.d4sign_ativo&&(s.btn_assinaturas_d4sign.show(),s.btn_assinaturas_d4sign.unbind("click"),s.btn_assinaturas_d4sign.bind("click",function(){View.load("d4sign/detalhes",function(o,i){i.show(a.documento_revisao_id)},View.ABA.MULTIPLAS)})))}else s.btn_group_visualizar_revisao_atual.show(),s.btn_group_visualizar_revisao_atual.find(".dropdown-toggle").addClass("hidden"),s.btn_visualizar_revisao_atual.unbind("click"),s.btn_visualizar_revisao_atual.click(i)}else a.documento_revisao_id&&s.usuario_permissao_download&&(s.btn_download_revisao_atual.show(),e=function(){var o=function(){App.obter_token_publico(function(o){App.download(WS_URI+"documento/download/?documento_revisao_id="+a.documento_revisao_id+"&documento_id="+a.id+"&token_publico="+o),"safari"!=getBrowser()&&s.unload()})};"S"==s.documento_bloqueado?alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !','<div class="alert alert-danger" style="text-align: center"> <span href="#" class="alert-link"><strong>Você está tentando baixar um documento </strong>bloqueado,<strong> deseja continuar ?  </strong></span></div>','<i class="fa fa-download" aria-hidden="true"></i> Download',function(){o()},!0):o()},s.btn_download_revisao_atual.unbind("click"),s.btn_download_revisao_atual.click(e))},this.preencher_padroes=function(a){void 0===a&&(a=null),s.documento_pasta_id&&WS.get("documento_pasta/objeto/",{documento_pasta_id:s.documento_pasta_id},function(o){s.tipo==FORMULARIO.NOVO&&o.usuario_permissao_seguranca?s.lbl_tab_seguranca.show():a&&(o.usuario_permissao_seguranca?s.lbl_tab_seguranca.show():s.lbl_tab_seguranca.hide()),null==o.tags_padrao&&""==o.tags_padrao||s.edt_tag.val(o.tags_padrao),null==o.assunto_id&&""==o.assunto_id||s.listar_assunto(o.assunto_id),null==o.tipo_documento_id&&""==o.tipo_documento_id||s.listar_tipo_documento(o.tipo_documento_id)})},this.preencher=function(){WS.get("documento/objeto/",{documento_id:s.documento_id},function(a){if(s.documento=a,App.titulo_aba(s.html_id,"Documento "+a.nome),s.documento_bloqueado=a.bloqueado,"S"==s.documento_bloqueado&&(s.div_nova_revisao.css("pointer-events","none"),s.div_nova_revisao.parent().css("opacity","0.7").css("cursor","not-allowed"),s.doc_bloqueado.show(),s.doc_bloqueado.append("<br /> Motivo do bloqueio: "+a.motivo_bloqueio)),s.usuario_permissao_visualizacao=a.usuario_permissao_visualizacao,s.usuario_permissao_download=a.usuario_permissao_download,s.usuario_permissao_escrita=a.usuario_permissao_escrita,s.usuario_permissao_manutencao_revisoes=a.usuario_permissao_manutencao_revisoes,s.usuario_permissao_nova_revisao=a.usuario_permissao_nova_revisao,s.usuario_permissao_exclusao=a.usuario_permissao_exclusao,s.usuario_permissao_seguranca=a.usuario_permissao_seguranca,s.permite_alterar(),App.sessao.dados.admin||s.usuario_permissao_escrita||s.usuario_permissao_seguranca||s.usuario_permissao_nova_revisao||s.btn_salvar.hide(),App.sessao.dados.admin||"N"!=a.controle_acessos&&!1!==a.controle_acessos?s.usuarios_array=a.usuarios_permissoes:(s.usuarios=App.sessao.dados,s.usuarios.visualizacao=!0,s.usuarios.download=!0,s.usuarios.escrita=!0,s.usuarios.exclusao=!0,s.usuarios.manutencao_revisoes=!0,s.usuarios.nova_revisao=!0,s.usuarios.seguranca=!0,s.usuarios.automatic=!0,s.usuarios_array.push(s.usuarios)),s.render_usuarios(),s.grupos_array=a.grupos_permissoes,s.render_grupos(),s.documento_pasta_id=a.documento_pasta_id,s.edt_nome.val(a.nome),s.obter_validacao_permissoes_retroativas(),1==s.informar_codigo_documento_pasta&&(s.tipo,FORMULARIO.NOVO),s.edt_codigo.val(a.codigo),s.edt_validade.val(a.validade),s.cbo_validade_periodo.val(a.validade_periodo),set_datepicker(s.edt_data_vigencia,a.data_vigencia),s.exibicao_validade_vigencia(!1),s.edt_observacao_revisao.val(null),s.edt_observacoes_historico.html(a.observacao_documento.replace(/\n\r?/g,"<br />")),s.edt_tag.val(a.tag),s.listar_assunto(a.assunto_id),s.listar_tipo_documento(a.tipo_documento_id),s.listar_local_armazenamento(a.local_armazenamento_id),s.render_revisoes(a),s.render_aprovacoes(a.historico_aprovacoes),s.preencher_distribuicoes(a.distribuicao_controlada_responsaveis),s.arr_historico=a.historico,s.render_historico(),s.limite=0,s.todos_carregados=!1,s.atividade_id=a.projeto_atividade_id,s.projeto_id=a.projeto_id,s.solicitacao_atividade_id=a.solicitacao_atividade_id,s.solicitacao_id=a.solicitacao_id,s.oportunidade_id=a.oportunidade_id,s.consultar_ultima_revisao(a),s.cbo_tipo_aprovacao.val(a.tipo_aprovacao).trigger("change"),s.cbo_tipo_aprovacao.selectpicker("refresh"),null!=a.alcada_generica_id&&a.alcada_generica_id>0?s.alcada_generica_id=a.alcada_generica_id:s.alcada_generica_id=null,s.chk_controle_acessos.prop("checked",a.controle_acessos).change(),a.usuarios_permissoes&&a.grupos_permissoes&&s.lbl_tab_seguranca.removeClass("hidden"),s.chk_copia_controlada.prop("checked",a.utilizar_controle_distribuicao).change(),s.chk_tornar_dist_pend_aprov_doc.prop("checked",a.tornar_dist_pend_aprov_doc).trigger("change"),s.chk_notificacoes.prop("checked",a.notificar_por_email||!1).change(),s.chk_notificar_email_antes.prop("checked",a.notificar_por_email_antes||!1).change(),s.cbo_notificar_email_antes_quem.val(a.notificar_por_email_antes_quem||0),s.edt_dias_notitificacao.val(a.dias_notificacao_email),s.chk_notificacao_seguranca.prop("checked",a.notificar_por_controle_acesso).change(),s.chk_notificacao_aprovador.prop("checked",a.notificar_por_controle_aprovacao).change(),a.notificar_por_email&&a.notificar_emails.length>0){s.chk_notificacao_outros_usuarios.prop("checked",!0).trigger("click");for(var o=0;o<a.notificar_emails.length;o++){var i=a.notificar_emails[o];s.tab_email_usuarios.input.val(i),s.tab_email_usuarios.btn_add.trigger("click")}}s.edt_prazo_dias.val(a.prazo_dias),s.renderizar_dx_selecao_pasta(a.documento_pasta_id)})},this.render_historico=function(){o.render(a.createElement(window.components.DocumentoHistorico.default,{documento_id:s.documento_id}),s.grid_historico_documento[0])},this.render_aprovacoes=function(a){var o=s.tab_aprovacoes.find("tbody"),i=o.find("tr:first");WS.get("documento/listar_historico_aprovacoes/",{documento_id:s.documento_id,usuario_id:s.filtro_historico_aprovacoes_usuario_id,situacao:s.filtro_historico_aprovacoes_situacao,revisao:s.filtro_historico_aprovacoes_revisao,nivel:s.filtro_historico_aprovacoes_nivel,consideracoes:s.filtro_historico_aprovacoes_consideracoes,origem:s.filtro_historico_aprovacoes_origem,recebimento_data:s.filtro_historico_aprovacoes_recebimento_data,acao_data:s.filtro_historico_aprovacoes_acao_data,prazo_data:s.filtro_historico_aprovacoes_prazo_data,limite:s.param_inicial_aprovacoes,limite_quantidade:s.param_qtde_aprovacoes},function(e){e&&(a&&s.tab_aprovacoes.find("tbody > tr:not([template-row])").remove(),s.div_carregar_mais_aprovacoes.removeClass("hidden"),e.length<s.param_qtde_aprovacoes?(s.btn_carregar_mais_aprovacoes.find("span.txt_carregar_mais").text(App.lang.btn_carregar_mais.todos_carregados),s.btn_carregar_mais_aprovacoes.find("span.icn_carregar_mais").remove(),s.btn_carregar_mais_aprovacoes.append('<span class="icn_carregar_mais fa fa-check"></span>'),s.param_todos_carregados_aprovacoes=!0):(s.btn_carregar_mais_aprovacoes.find("span.txt_carregar_mais").text(App.lang.btn_carregar_mais.carregar_mais_registros),s.btn_carregar_mais_aprovacoes.find("span.icn_carregar_mais").remove(),s.btn_carregar_mais_aprovacoes.append('<span class="icn_carregar_mais fa fa-arrow-down"></span>')),$.each(e,function(a,e){!function(a){var e=i.clone();e.removeAttr("template-row"),e.css("display","");var t=e.find(".lbl_usuario");null!=a.nome?(t.html('<img style="height: 20px; width: 20px; margin-right:5px;" class="imagem_usuario pull-left"/>'),null!=a.foto_id?t.find("img").attr("src",WS_URI+"documento/midia/?&tamanho=20&documento_id="+a.foto_id+"&token_midia="+App.sessao.token_midia):t.find("img").attr("src","assets/img/icones_bp/imagem_usuario_padrao.svg"),a.nome!==a.nome_responsavel&&(t.attr("data-container","body"),null!=a.foto_id_responsavel?t.tooltip({title:'<img style="height: 18px;width: 18px;background: white;margin-right:5px;" class="imagem_usuario pull-left" src='+WS_URI+"documento/midia/?&tamanho=20&documento_id="+a.foto_id_responsavel+"&token_midia="+App.sessao.token_midia+"> Responsável: "+a.nome_responsavel,placement:"bottom",html:!0}):t.tooltip({title:'<img style="height: 18px;width: 18px;background: white;margin-right:5px;" class="imagem_usuario pull-left" src="assets/img/icones_bp/imagem_usuario_padrao.svg"> Responsável: '+a.nome_responsavel,placement:"bottom",html:!0})),t.append(a.nome)):(t.html('<img style="height: 20px; width: 20px; margin-right:5px;" class="imagem_usuario pull-left"/>'),null!=a.foto_id_responsavel?t.find("img").attr("src",WS_URI+"documento/midia/?&tamanho=20&documento_id="+a.foto_id_responsavel+"&token_midia="+App.sessao.token_midia):t.find("img").attr("src","assets/img/icones_bp/imagem_usuario_padrao.svg"),t.append(a.nome_responsavel));var s=e.find(".lbl_situacao");"S"==a.excluido?s.html('<span class="label label-default">Excluido</span>'):a.situacao==GED_APROVACAO_SITUACAO.AGUARDANDO?s.html('<span class="label label-warning">Aguardando</span>'):a.situacao==GED_APROVACAO_SITUACAO.APROVADO?s.html('<span class="label label-success">Aprovado</span>'):a.situacao==GED_APROVACAO_SITUACAO.REPROVADO?s.html('<span class="label label-danger">Reprovado</span>'):a.situacao==GED_APROVACAO_SITUACAO.APROVADO_POR_TERCEIRO?s.html('<span class="label label-success">Aprovado por Terceiro</span>'):a.situacao==GED_APROVACAO_SITUACAO.REPROVADO_POR_TERCEIRO?s.html('<span class="label label-danger">Reprovado por Terceiro</span>'):a.situacao==GED_APROVACAO_SITUACAO.AGUARDANDO_NIVEL&&s.html('<span class="label label-warning">Aguardando Alçada</span>'),e.find(".lbl_dt_inicio_aprovacao").html("<span>"+(a.recebimento_data?a.recebimento_data.format_date_time():"")+"</span>"),e.find(".lbl_dt_prazo_aprovacao").html("<span>"+(a.prazo_data?a.prazo_data.format_date_time():"")+"</span>"),e.find(".lbl_dt_fim_aprovacao").html("<span>"+(a.acao_data?a.acao_data.format_date_time():"")+"</span>"),e.find(".lbl_nivel_alcada").html("<span>"+a.nivel+"</span>"),e.find(".lbl_manutencao_revisoes").html("<span>"+a.manutencao_revisoes+"</span>"),e.find(".lbl_nova_revisao").html("<span>"+a.nova_revisao+"</span>");var r=e.find(".lbl_tipo_origem");a.tipo_origem==GED_TIPO_ORIGEM.PASTA?(r.html('<i class="fa fa-folder tipo_origem" aria-hidden="true"></i>'),r.find(".tipo_origem").tooltip({title:"Aprovação foi originada da pasta.",placement:"auto"})):a.tipo_origem==GED_TIPO_ORIGEM.DOCUMENTO&&(r.html('<i class="fa fa-file tipo_origem" aria-hidden="true"></i>'),r.find(".tipo_origem").tooltip({title:"Aprovação foi originada do documento.",placement:"auto"}));var n=e.find(".lbl_consideracoes");null!=a.consideracoes&&""!=a.consideracoes?(n.html('<i class="fa fa-comments consideracoes" aria-hidden="true"></i>'),n.find(".consideracoes").tooltip({title:a.consideracoes.length>100?a.consideracoes.substr(0,100)+"...":a.consideracoes,placement:"auto"}).on("click",function(){alert_modal('<i class="fa fa-comments pull-left" aria-hidden="true"></i>'+a.nome,nl2br(a.consideracoes))}),n.find(".consideracoes").hover(function(){$(this).css("cursor","pointer")})):n.html(""),parseInt(a.aprovacao_atrasada)&&e.addClass("bg-danger"),e.appendTo(o)}(e)}))})},this.render_revisoes=function(a){s.versoes=[];var o=s.tab_revisoes.find("tbody"),i=o.find("tr:first"),e=a.revisoes;s.tab_revisoes.find("tr:gt(1)").remove(),$(e).each(function(e,t){!function(e,t){var r=i.clone();if(r.removeAttr("template-row"),r.css("display",""),0==t)if("N"==e.aprovacao){s.doc_rev_pendente.hide(),s.doc_rev_reprovado.show();var n="Reprovado por "+e.usuario_alteracao_nome+(e.data_aprovacao?" em "+e.data_aprovacao.format_date_time():"")+" <br /> Motivo da reprova: "+e.motivo_reprovacao;s.doc_rev_reprovado.find("span").html('<span href="#" class="alert-link"><i class="fa fa-exclamation-triangle" aria-hidden="true"></i><strong> Atenção! A ultima revisão deste documento está </strong> Reprovada</span><br /><small>'+n+"</small>")}else null==e.aprovacao||"N"==e.controle_distribuicao&&"S"==e.dist_pend_aprov_doc?(s.doc_rev_reprovado.hide(),s.doc_rev_pendente.show()):(s.doc_rev_reprovado.hide(),s.doc_rev_pendente.hide());var d=r.find(".lbl_sequencia"),c=r.find(".td_aprovacao"),_=r.find(".div_aprovacao"),l=r.find(".lbl_data_envio"),u=r.find(".lbl_tamanho"),p=r.find(".lbl_autor"),v=(r.find(".lbl_observacoes"),r.find(".lbl_versao")),m=r.find(".sep_avaliacao"),h=r.find(".btn_aprovar"),f=r.find(".btn_reprovar"),b=r.find(".btn_estornar_avaliacao"),g=r.find(".btn_gerar_url_download"),A=r.find(".btn_distribuir_revisao");g.on("click",function(){var a=function(){WS.post("documento/gerar_url_download/",{documento_revisao_id:e.documento_revisao_id},function(a){alert_saved("URL de download do arquivo gerada com sucesso!"),o(a)})},o=function(o){s.download_url_dialog=DevExpress.ui.dialog.custom({title:"Link de download",messageHtml:"Abaixo, o link de download para o documento: <br><br> <a href="+o+" target='_blank'>"+o+"</a> <br><br> <small>* Com esse link, qualquer usuário poderá realizar o download do documento, mesmo que ele não tenha cadastro no Next BP.</small> <br> <small>* Gerar um novo link irá impossibilitar o download do documento pelo link atual.</small>",buttons:[{text:"OK",onClick:function(){return!1}},{text:"Gerar novo link",onClick:function(o){s.download_url_dialog&&s.download_url_dialog.hide(),a()}},{text:"Copiar link",onClick:function(a){copyToClipboard(o)}}]}),s.download_url_dialog.show()};WS.get("documento/verificar_url_download/",{documento_revisao_id:e.documento_revisao_id},function(i){i?o(i):(s.download_url_dialog&&s.download_url_dialog.hide(),a())})});var k=function(a,o,i){var t={documento_id:e.documento_id,documento_revisao_id:e.documento_revisao_id,aprovacao:o,documento_aprovacao_alcada_id:e.documento_aprovacao_alcada_id};null!=a&&(t.rejeitar=a,t.documento_revisao_reprovar_id=e.documento_revisao_reprovar_id,t.revisoes_reprovadas=e.revisoes_reprovadas),null!=i&&(t.consideracoes=i),WS.post("documento/salvar_documento_aprovacao_revisoes/",t,function(a){if(a){var i=!0===a?"success":"error",e="N"==o?"Revisão reprovada com sucesso":"Revisão aprovada com sucesso";DevExpress.ui.notify.default({message:e,type:i,displayTime:3e3,width:300}),s.preencher()}})},w=function(a,o){parseInt(e.qtde_revisoes_pendentes)>0?alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Aviso!',"<div><p>Deseja rejeitar as revisões anteriores do documento ?</p></div>","Sim",function(){k(!0,a,o)},!0,"Não",null,function(){k(!1,a,o)}):k(!1,a,o)};h.click(function(){alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Aviso!',"Deseja realmente aprovar o Documento: "+e.nome_arquivo+' ?<div class="form-group"><br /><textarea class="form-control" rows="5" id="consideracoes" style="min-width: 100%; max-width: 100%" placeholder="Considerações sobre o documento."></textarea></div>',"Sim",function(){var a=document.getElementById("consideracoes").value;w("S",a)},!0,"Não",null,function(){return!1})}),f.click(function(){alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Aviso!',"Por gentileza, informe o motivo pelo qual deseja reprovar o Documento: <br />"+e.nome_arquivo+'<div class="form-group"><br /><textarea class="form-control" rows="5" id="consideracoes" style="min-width: 100%; max-width: 100%" placeholder="digite o motivo da reprova do documento."></textarea></div>',"Reprovar",function(){var a=document.getElementById("consideracoes").value;w("N",a),s.render_aprovacoes(!0)},!0,"Cancelar",null,function(){return!1})}),b.click(function(){alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',"Deseja estornar a aprovação/reprovação desta revisão?","Estornar Aprova/Reprova",function(){WS.post("documento/salvar_documento_aprovacao_revisoes/",{documento_revisao_id:e.documento_revisao_id,aprovacao:"E"},function(a){if(a){var o=!0===a?"success":"error",i=!0===a?"Estorno realizado com sucesso":"Falha ao estornar a atividade";DevExpress.ui.notify.default({message:i,type:o,displayTime:3e3,width:300}),!0===a&&s.preencher()}else alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',"Não é possivel estornar após o nivel estar aprovado<br /> Deseja gerar uma nova revisão ?","Gerar Nova Revisão",function(){alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',"Está Ação irá duplicar a revisão do documento<br /> Deseja continuar ?","Gerar Nova Revisão",function(){WS.post("documento/gerar_nova_revisao",{documento_revisao_id:e.documento_revisao_id},function(a){DevExpress.ui.notify.default({message:"Revisão salva com sucesso",type:"success",displayTime:3e3,width:300}),s.preencher()})},!0)},!0)})},!0)});var x=function(){s.distribuir_revisao(e.documento_revisao_id)};if(A.click(function(){alertaPopUp({titulo:"Atenção",conteudo:"Ao confirmar a Distribuição será realizada de forma Manual!",botaoConfirmarTexto:"Confirmar",botaoConfirmarFuncao:x,botaoCancelarTexto:"Cancelar"})}),a.historico_aprovacoes)if(c.removeClass("hidden"),s.th_aprovacao.show(),e.aprovacao&&""!=e.aprovacao){var O=r.find(".lbl_aprovado"),C=r.find(".lbl_reprovado");if(e.aprovacao&&"S"==e.aprovacao)_.tooltip({title:"Aprovado"+(e.data_aprovacao?" em "+e.data_aprovacao.format_date_time():""),placement:"right"}),_.tooltip(),O.show();else if(e.aprovacao&&("N"==e.aprovacao||"A"==e.aprovacao)){if("A"==e.aprovacao)var y="<br /> Reprova Automatica";else"N"==e.aprovacao&&(y="<br /> Justificativa da Reprova: "+(null!=e.motivo_reprovacao?e.motivo_reprovacao:""));_.tooltip({title:"Reprovado por "+e.usuario_alteracao_nome+(e.data_aprovacao?" em "+e.data_aprovacao.format_date_time():"")+y,placement:"right"}),C.show()}}else r.find(".lbl_aprovacao_pendente").show(),(App.sessao.dados.admin||a.usuario_permissao_aprovacao)&&(e.documento_aprovacao_alcada_id?(h.parent().show(),f.parent().show(),m.show()):void 0!==s.documento_parametros.documentos_permitir_estorno_aprovacao&&"N"!=s.documento_parametros.documentos_permitir_estorno_aprovacao&&(b.parent().show(),m.show()));else c.addClass("hidden"),s.th_aprovacao.hide();var R=$(r.find("[template-field='observacao_revisao']"));null==e.observacao_revisao||""==e.observacao_revisao?R.hide():(R.tooltip({title:e.observacao_revisao.replace(/\n\r?/g,"<br />"),placement:"auto",html:!0}),R.tooltip()),null!=e.versao?(v.find("span").keypress(function(a){if(!new RegExp("[0-9]").test(a.key))return a.preventDefault(),!1}).keyup(function(a){var o=$(this);if(a.which==KEYPRESS_PADRAO.ENTER){var i=o.text().replace("&nbsp;"),e=o.attr("data-original");if(o.attr("contenteditable",!1),o.parent().css({"user-select":"all"}),s.versoes.filter(function(a){if(parseInt(a.versao,10)==parseInt(i,10))return a}).length>0||0==i.trim().length)o.text(e+" ");else{var t=null;s.versoes.filter(function(a,o){parseInt(a.versao,10)==e&&(t=s.versoes[o].revisao,s.versoes.splice(o,1))}),setTimeout(function(){o.attr("data-original",i),s.versoes.push({revisao:t,versao:parseInt(i.trim(),10)}),clearTimeout(this)},100),o.text(i)}}}).dblclick(function(a){var o=$(this),i="true"==o.attr("contenteditable");if(o.text().replace("&nbsp;",""),i=!i,o.attr("contenteditable",i).attr("data-editor","true"),i){o.parent().css({"user-select":"none"});var e=o.get(0).childNodes[0],t=document.createRange();t.setStart(e,e.length-1),t.setEnd(e,e.length-1);var s=window.getSelection();s.removeAllRanges(),s.addRange(t)}}).blur(function(a){var o=$(this),i=o.text().replace("&nbsp;");o.attr("contenteditable","false");var e=o.attr("data-original");if(s.versoes.filter(function(a){if(parseInt(a,10)==parseInt(i,10))return a}).length>0||0==i.trim().length)o.text(e+" ");else{var t=null;s.versoes.filter(function(a,o){parseInt(a.versao,10)==e&&(t=s.versoes[o].revisao,s.versoes.splice(o,1))}),setTimeout(function(){o.attr("data-original",i),s.versoes.push({revisao:t,versao:parseInt(i.trim(),10)}),clearTimeout(this)},100),o.text(i)}}).html(e.versao+"&nbsp;").attr("data-original",e.versao),s.versoes.push({revisao:e.documento_revisao_id,versao:e.versao})):v.find("span").text(""),d.text(e.sequencia),l.text(e.data_envio?e.data_envio.format_date_time():""),u.text(filesize(parseInt(e.tamanho,10)||0)),p.text(e.usuario_envio_nome?e.usuario_envio_nome:"");var S=$(r.find(".btn_download"));S.addClass("hidden");var I=$(r.find(".btn_submenu")),z=$(r.find(".btn_visualizar"));if("application/pdf"==e.mime_type){var E=function(){View.load("central_documentos/visualizar_pdf",function(a,o){o.show(e.documento_revisao_id,null,null,e.ativa,e.aprovacao,s.documento_bloqueado,null,s.usuario_permissao_download)})};z.unbind("click").click(E)}else"image/png"==e.mime_type||"image/bmp"==e.mime_type||"image/jpeg"==e.mime_type||"image/jpg"==e.mime_type||"image/gif"==e.mime_type?(E=function(){View.load("central_documentos/visualizar_documento",function(a,o){o.show(e.documento_revisao_id,null,e.ativa,e.aprovacao,s.documento_bloqueado,e.controle_distribuicao,s.usuario_permissao_download)})},z.click(E)):z.hide();s.usuario_permissao_visualizacao&&s.usuario_permissao_download&&(S.removeClass("hidden"),S.click(function(){var o=function(){App.obter_token_publico(function(o){App.download(WS_URI+"documento/download/?documento_revisao_id="+e.documento_revisao_id+"&documento_id="+a.id+"&token_publico="+o)},e.documento_revisao_id)};"S"!=e.ativa||"S"!=e.aprovacao?"N"==e.aprovacao?alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !','<div class="alert alert-danger" style="text-align: center"> <span href="#" class="alert-link"><strong>Você está tentando baixar uma revisão </strong>reprovada,<strong> deseja continuar ?  </strong></span></div>','<i class="fa fa-download" aria-hidden="true"></i> Download',function(){o()},!0):null==e.aprovacao?alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !','<div class="alert alert-info" style="text-align: center"> <span href="#" class="alert-link"><strong>Você está tentando baixar uma revisão </strong>pendente,<strong> deseja continuar ?  </strong></span></div>','<i class="fa fa-download" aria-hidden="true"></i> Download',function(){o()},!0):"N"==e.ativa&&alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !','<div class="alert alert-warning" style="text-align: center"> <span href="#" class="alert-link"><strong>Você está tentando baixar uma revisão </strong>obsoleta,<strong> deseja continuar ?  </strong></span></div>','<i class="fa fa-download" aria-hidden="true"></i> Download',function(){o()},!0):"S"==s.documento_bloqueado?alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !','<div class="alert alert-danger" style="text-align: center"> <span href="#" class="alert-link"><strong>Você está tentando baixar um documento </strong>bloqueado,<strong> deseja continuar ?  </strong></span></div>','<i class="fa fa-download" aria-hidden="true"></i> Download',function(){o()},!0):o()}));var D=$(r.find(".btn_ativar_revisao"));if(D.click(function(){alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',"Deseja ativar esta revisão?","Ativar Revisão",function(){WS.post("documento/ativar_revisao",{documento_revisao_id:e.documento_revisao_id,versoes:JSON.stringify(s.versoes)},function(a){DevExpress.ui.notify.default({message:"Revisão ativada com sucesso",type:"success",displayTime:3e3,width:300}),s.preencher()})},!0)}),s.usuario_permissao_escrita&&"S"!=s.documento_bloqueado){var N=$(r.find(".btn_reenviar_revisao"));N.click(function(){alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',"Está Ação irá duplicar a revisão do documento<br /> Deseja continuar ?","Gerar Nova Revisão",function(){s.salvar_documento(s.btn_salvar,!0,e.documento_revisao_id)},!0)}),N.removeClass("hidden")}if(App.verifica_permissao(App.temp.empresa,"substituir_revisao")&&s.usuario_permissao_manutencao_revisoes||App.sessao.dados.admin){var T=$(r.find(".btn_substituir"));T.click(function(){var a=function(a){DevExpress.ui.notify.default({message:"Documento atualizado com sucesso",type:"success",displayTime:3e3,width:300}),s.preencher()};View.load("central_documentos/corrigir_revisao",function(o,i){i.onsave=a,i.show(e.documento_revisao_id,e.nome_arquivo,e.sequencia,e.tamanho)})}),T.removeClass("hidden")}if(("S"==s.documento_parametros.documentos_permitir_exclusao||App.sessao.dados.admin)&&s.usuario_permissao_exclusao&&s.usuario_permissao_manutencao_revisoes){var P=$(r.find(".btn_excluir_revisao"));P.click(function(){alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',"Deseja excluir esta revisão?","Excluir Revisão",function(a){WS.post("documento/excluir_revisao",{documento_revisao_id:e.documento_revisao_id,versoes:JSON.stringify(s.versoes)},function(a){DevExpress.ui.notify.default({message:"Revisão excluida com sucesso",type:"success",displayTime:3e3,width:300}),s.preencher()},[])},!0)}),P.removeClass("hidden")}if((s.usuario_permissao_manutencao_revisoes||s.usuario_permissao_escrita)&&"S"==s.documento_parametros.documentos_permitir_ativar_revisao&&null!=e.aprovacao||D.parent().hide(),"S"==e.ativa){var q=$(r.find(".lbl_ativa"));D.parent().hide(),("S"==s.documento_parametros.documentos_permitir_exclusao||App.sessao.dados.admin)&&s.usuario_permissao_exclusao&&s.usuario_permissao_manutencao_revisoes&&P.addClass("hidden"),I.removeClass("btn-default"),I.addClass("btn-primary"),A.parent().show()}else if("N"==e.ativa&&"S"==e.aprovacao&&"S"==e.controle_distribuicao)q=$(r.find(".lbl_obsoleta")),D.parent().hide(),A.parent().show();else if("N"!=e.ativa||"N"!=e.aprovacao&&"A"!=e.aprovacao)q=$(r.find(".lbl_pendente")),!a.documento_pasta_aprovacao||e.aprovacao&&"S"==e.aprovacao||D.parent().hide(),A.parent().hide();else{var q=$(r.find(".lbl_reprovada"));D.parent().hide(),A.parent().hide()}q.show(),$(r.find(".lbl_nome_arquivo")).text(e.nome_arquivo),r.appendTo(o)}(t,e)})},this.render_usuarios=function(){var a=s.tab_permissoes.find("tbody"),o=a.find("tr:first"),i=function(a,o,i){$(s.usuarios_array).each(function(e,t){t.usuario_id==i.usuario_id&&(s.usuarios=t,"visualizacao"==o?s.usuarios.visualizacao=a.prop("checked"):"download"==o?s.usuarios.download=a.prop("checked"):"exclusao"==o?s.usuarios.exclusao=a.prop("checked"):"escrita"==o?s.usuarios.escrita=a.prop("checked"):"manutencao_revisoes"==o?s.usuarios.manutencao_revisoes=a.prop("checked"):"nova_revisao"==o?s.usuarios.nova_revisao=a.prop("checked"):"seguranca"==o&&(s.usuarios.seguranca=a.prop("checked")),s.usuarios_array[e]=s.usuarios)})},e=function(e){var t=o.clone();t.removeAttr("template-row"),t.css("display","");var r=$(t.find(".btn_usuario_remover"));t.find(".lbl_nome").text(e.nome);var n=t.find(".img_alerta_permissao"),d=(a=>{if(!s.validacao_permissoes_retroativas||!s.validacao_permissoes_retroativas.usuario)return[];var o=s.validacao_permissoes_retroativas.usuario.filter(o=>o.usuario_id==a);return o.length>0&&Array.isArray(o[0].pastas)?o[0].pastas:[]})(e.usuario_id);d.length>0?(n.tooltip({title:"Sem permissão de acesso à(s) pasta(s) predecessora(s)."}),n.show(),n.on("click",()=>s.configurar_popup_validacao_permissoes_retroativas(e.nome,d,"U",e.usuario_id,s.usuarios_aplicar_permissoes_retroativas)),s.usuarios_aplicar_permissoes_retroativas.includes(e.usuario_id)&&(n.removeClass("text-danger fa fa-exclamation-triangle"),n.addClass("text-info fas fa-magic"))):n.hide();var c=t.find(".chk_visualizacao");c.attr("type","checkbox"),c.addClass("checkbox_bootstrap_toggle"),c.prop("checked",1==e.visualizacao).change();var _=t.find(".chk_download");_.attr("type","checkbox"),_.addClass("checkbox_bootstrap_toggle"),_.prop("checked",1==e.download).change();var l=t.find(".chk_escrita");l.attr("type","checkbox"),l.addClass("checkbox_bootstrap_toggle"),l.prop("checked",1==e.escrita).change();var u=t.find(".chk_exclusao");u.attr("type","checkbox"),u.addClass("checkbox_bootstrap_toggle"),u.prop("checked",1==e.exclusao).change();var p=t.find(".chk_manutencao_revisoes");p.attr("type","checkbox"),p.addClass("checkbox_bootstrap_toggle"),p.prop("checked",1==e.manutencao_revisoes).change();var v=t.find(".chk_nova_revisao");v.attr("type","checkbox"),v.addClass("checkbox_bootstrap_toggle"),v.prop("checked",1==e.nova_revisao).change();var m=t.find(".chk_seguranca");m.attr("type","checkbox"),m.addClass("checkbox_bootstrap_toggle"),m.prop("checked",1==e.seguranca).change(),$(c).prop("disabled",!s.valor),$(_).prop("disabled",!s.valor),$(l).prop("disabled",!s.valor),$(u).prop("disabled",!s.valor),$(p).prop("disabled",!s.valor),$(v).prop("disabled",!s.valor),$(m).prop("disabled",!s.valor),$(r).attr("disabled",!s.valor),!App.sessao.dados.admin&&(void 0!==e.automatic&&!0===e.automatic||void 0!==e.add_self&&!0===e.add_self||App.sessao.dados.usuario_id==e.usuario_id)&&(c.prop("disabled",!0),_.prop("disabled",!0),l.prop("disabled",!0),u.prop("disabled",!0),p.prop("disabled",!0),v.prop("disabled",!0),m.prop("disabled",!0),r.attr("disabled",!0),void 0!==e.add_self&&!0===e.add_self&&r.attr("disabled",!1)),c.change(function(){i(c,"visualizacao",e)}),_.change(function(){i(_,"download",e)}),l.change(function(){i(l,"escrita",e)}),u.change(function(){i(u,"exclusao",e)}),p.change(function(){i(p,"manutencao_revisoes",e)}),v.change(function(){i(v,"nova_revisao",e)}),m.change(function(){i(m,"seguranca",e)}),r.click(function(){alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',"Deseja remover o usuário?","Remover",function(){$(s.usuarios_array).each(function(a,o){o.usuario_id==e.usuario_id&&(t.remove(),s.usuarios_array.splice(a,1),s.render_usuarios())})},!0)}),t.appendTo(a)};s.tab_permissoes.find("tr:gt(1)").remove(),$(s.usuarios_array).each(function(a,o){e(o)}),App.aplicar_checkbox(a)},this.render_grupos=function(){var a=s.tab_permissoes_grupo.find("tbody"),o=a.find("tr:first"),i=function(a,o,i){$(s.grupos_array).each(function(e,t){t.grupo_usuarios_id==i.grupo_usuarios_id&&(s.grupos=t,"visualizacao"==o?s.grupos.visualizacao=a.prop("checked"):"download"==o?s.grupos.download=a.prop("checked"):"exclusao"==o?s.grupos.exclusao=a.prop("checked"):"escrita"==o?s.grupos.escrita=a.prop("checked"):"manutencao_revisoes"==o?s.grupos.manutencao_revisoes=a.prop("checked"):"nova_revisao"==o?s.grupos.nova_revisao=a.prop("checked"):"seguranca"==o&&(s.grupos.seguranca=a.prop("checked")),s.grupos_array[e]=s.grupos)})},e=function(e){var t=o.clone();t.removeAttr("template-row"),t.css("display",""),t.find(".lbl_nome").text(e.nome);var r=t.find(".img_alerta_permissao"),n=(a=>{if(!s.validacao_permissoes_retroativas||!s.validacao_permissoes_retroativas.grupo_usuarios)return[];var o=s.validacao_permissoes_retroativas.grupo_usuarios.filter(o=>o.grupo_usuarios_id==a);return o.length>0&&Array.isArray(o[0].pastas)?o[0].pastas:[]})(e.grupo_usuarios_id);n.length>0?(r.tooltip({title:"Sem permissão de acesso à(s) pasta(s) predecessora(s)."}),r.show(),r.on("click",()=>{s.configurar_popup_validacao_permissoes_retroativas(e.nome,n,"G",e.grupo_usuarios_id,s.grupos_usuarios_aplicar_permissoes_retroativas)}),s.grupos_usuarios_aplicar_permissoes_retroativas.includes(e.grupo_usuarios_id)&&(r.removeClass("text-danger fa fa-exclamation-triangle"),r.addClass("text-info fas fa-magic"))):r.hide();var d=t.find(".chk_visualizacao");d.attr("type","checkbox"),d.addClass("checkbox_bootstrap_toggle"),d.prop("checked",1==e.visualizacao);var c=t.find(".chk_download");c.attr("type","checkbox"),c.addClass("checkbox_bootstrap_toggle"),c.prop("checked",1==e.download);var _=t.find(".chk_escrita");_.attr("type","checkbox"),_.addClass("checkbox_bootstrap_toggle"),_.prop("checked",1==e.escrita);var l=t.find(".chk_exclusao");l.attr("type","checkbox"),l.addClass("checkbox_bootstrap_toggle"),l.prop("checked",1==e.exclusao);var u=t.find(".chk_manutencao_revisoes");u.attr("type","checkbox"),u.addClass("checkbox_bootstrap_toggle"),u.prop("checked",1==e.manutencao_revisoes);var p=t.find(".chk_nova_revisao");p.attr("type","checkbox"),p.addClass("checkbox_bootstrap_toggle"),p.prop("checked",1==e.nova_revisao);var v=t.find(".chk_seguranca");v.attr("type","checkbox"),v.addClass("checkbox_bootstrap_toggle"),v.prop("checked",1==e.seguranca),$(d).prop("disabled",!s.valor),$(c).prop("disabled",!s.valor),$(_).prop("disabled",!s.valor),$(l).prop("disabled",!s.valor),$(u).prop("disabled",!s.valor),$(p).prop("disabled",!s.valor),$(v).prop("disabled",!s.valor),$(m).prop("disabled",!s.valor),d.change(function(){i(d,"visualizacao",e)}),c.change(function(){i(c,"download",e)}),_.change(function(){i(_,"escrita",e)}),l.change(function(){i(l,"exclusao",e)}),u.change(function(){i(u,"manutencao_revisoes",e)}),p.change(function(){i(p,"nova_revisao",e)}),v.change(function(){i(v,"seguranca",e)});var m=$(t.find(".btn_grupo_remover"));m.unbind("click"),m.click(function(){alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',"Deseja remover o grupo?","Remover",function(){$(s.grupos_array).each(function(a,o){o.grupo_usuarios_id==e.grupo_usuarios_id&&(t.remove(),s.grupos_array.splice(a,1),s.render_grupos())})},!0)}),t.appendTo(a)};s.tab_permissoes_grupo.find("tr:gt(1)").remove(),$(s.grupos_array).each(function(a,o){e(o)}),App.aplicar_checkbox(a)},this.listar_assunto=function(a){s.cbo_assunto.find("option").remove(),add_option(s.cbo_assunto,"","Nenhum"),WS.get("assunto/listar/",null,function(o){for(var i=0;i<o.length;i++){var e=o[i];s.projeto_id>0?"S"==e.padrao_projeto?add_option(s.cbo_assunto,e.assunto_id,e.descricao,"selected"):add_option(s.cbo_assunto,e.assunto_id,e.descricao):s.solicitacao_id>0?"S"==e.padrao_processos?add_option(s.cbo_assunto,e.assunto_id,e.descricao,"selected"):add_option(s.cbo_assunto,e.assunto_id,e.descricao):s.oportunidade_id>0?"S"==e.padrao_atendimento_relacionamento?add_option(s.cbo_assunto,e.assunto_id,e.descricao,"selected"):add_option(s.cbo_assunto,e.assunto_id,e.descricao):"S"==e.padrao_documentos?add_option(s.cbo_assunto,e.assunto_id,e.descricao,"selected"):add_option(s.cbo_assunto,e.assunto_id,e.descricao)}a&&s.cbo_assunto.val(a).trigger("change")})},this.listar_tipo_documento=function(a){s.cbo_tipo_documento.find("option").remove(),add_option(s.cbo_tipo_documento,"","Nenhum"),WS.get("tipo_documento/listar/",null,function(o){for(var i=0;i<o.length;i++){var e=o[i];s.projeto_id>0?"S"==e.padrao_projeto?add_option(s.cbo_tipo_documento,e.tipo_documento_id,e.nome,"selected"):add_option(s.cbo_tipo_documento,e.tipo_documento_id,e.nome):s.solicitacao_id>0?"S"==e.padrao_processos?add_option(s.cbo_tipo_documento,e.tipo_documento_id,e.nome,"selected"):add_option(s.cbo_tipo_documento,e.tipo_documento_id,e.nome):s.oportunidade_id>0?"S"==e.padrao_atendimento_relacionamento?add_option(s.cbo_tipo_documento,e.tipo_documento_id,e.nome,"selected"):add_option(s.cbo_tipo_documento,e.tipo_documento_id,e.nome):"S"==e.padrao_documentos?add_option(s.cbo_tipo_documento,e.tipo_documento_id,e.nome,"selected"):add_option(s.cbo_tipo_documento,e.tipo_documento_id,e.nome)}a&&s.cbo_tipo_documento.val(a).trigger("change")})},this.listar_local_armazenamento=function(a){s.cbo_local_armazenamento.find("option").remove(),add_option(s.cbo_local_armazenamento,"","Nenhum"),WS.get("local_armazenamento/listar/",null,function(o){for(var i=0;i<o.length;i++){var e=o[i];s.projeto_id>0?1==e.padrao_projeto?add_option(s.cbo_local_armazenamento,e.local_armazenamento_id,e.nome,"selected"):add_option(s.cbo_local_armazenamento,e.local_armazenamento_id,e.nome):s.solicitacao_id>0?1==e.padrao_processos?add_option(s.cbo_local_armazenamento,e.local_armazenamento_id,e.nome,"selected"):add_option(s.cbo_local_armazenamento,e.local_armazenamento_id,e.nome):s.oportunidade_id>0?1==e.padrao_atendimento_relacionamento?add_option(s.cbo_local_armazenamento,e.local_armazenamento_id,e.nome,"selected"):add_option(s.cbo_local_armazenamento,e.local_armazenamento_id,e.nome):"true"===e.padrao_documentos.toString()?add_option(s.cbo_local_armazenamento,e.local_armazenamento_id,e.nome,"selected"):add_option(s.cbo_local_armazenamento,e.local_armazenamento_id,e.nome)}a&&s.cbo_local_armazenamento.val(a).trigger("change")})},this.RenderAprovadores=function(){o.render(s.ListarAprovadores,s.div_ListarAprovadores[0])},this.listar_alcada=function(){WS.get("alcada_aprovadores/listar/",null,function(a){a.length>0&&(s.cbo_selecionar_alcada.find("option").remove(),$(a).each(function(a,o){add_option(s.cbo_selecionar_alcada,o.alcada_generica_id,o.nome)}),s.cbo_selecionar_alcada.selectpicker("refresh"),s.alcada_generica_id&&(s.cbo_selecionar_alcada.val(s.alcada_generica_id).trigger("change"),s.cbo_selecionar_alcada.selectpicker("refresh")))})},this.listar_grupos_usuarios=function(a){var o=s.cbo_aprovador.parent().find(".edt_combobox"),i=new Object;i.nome=o.val(),WS.get("alcada_aprovadores/listar_todos_aprovadores/",i,function(o){limpar_combobox(s.cbo_aprovador),$(o).each(function(a,o){var i=[];i.Nome=o.nome;var e=$('<span class="label lb_tipo" style="margin: 5px;"></span>');"usuarios"==o.tipo?(e.addClass("label-info"),e.text("U"),e.attr("tipo","usuarios")):"grupo_usuarios"==o.tipo?(e.addClass("label-warning"),e.text("GU"),e.attr("tipo","grupo_usuarios")):"alcada_generica"==o.tipo&&(e.addClass("label-danger"),e.text("AP"),e.attr("tipo","alcada_generica")),e.tooltip(),add_option_combobox(s.cbo_aprovador,a,o.id>0?o.id:null,i,e,JSON.stringify(o))}),o.length>0&&a(!0),$(s.cbo_aprovador.parent()).find(".ul_row").click(function(){var a=$(this).parent().attr("dados-adicionais")?JSON.parse($(this).parent().attr("dados-adicionais")):null;s.ListarAprovadores.props.setAprovadoresManual(a),setTimeout(function(){var a=s.cbo_aprovador.parent().find(".ncbo_scroll").find(".row_selected");s.cbo_aprovador.parent().find(".edt_combobox").val(""),a.removeClass("row_selected")})})})},this.exibicao_validade_vigencia=function(a){void 0===a&&(a=!0);var o=!1;switch(s.tipo){case FORMULARIO.NOVO:case FORMULARIO.EDITAR:o=!0;break;case FORMULARIO.VISUALIZAR:case FORMULARIO.EXCLUIR:o=!1}var i=parseInt(s.edt_validade.val(),10);!isNaN(i)&&i>0?(s.cbo_validade_periodo.show(),s.edt_data_vigencia.prop("readonly",!0),s.cbo_validade_periodo.val()&&""!=s.cbo_validade_periodo.val()||s.cbo_validade_periodo.val(0),s.documento&&s.documento.revisao_data_aprovacao&&a&&WS.get("documento/sugestao_vigencia/",{data_revisao:s.documento.revisao_data_aprovacao,validade:i,validade_periodo:s.cbo_validade_periodo.val()},function(a){set_datepicker(s.edt_data_vigencia,a.data_vigencia)},null,null,null,null,s.html_id)):(s.cbo_validade_periodo.hide(),s.edt_data_vigencia.prop("readonly",!o)),s.edt_validade.prop("readonly",!o),s.cbo_validade_periodo.prop("disabled",!o)},this.listar_filtro_historico_aprovacoes=function(){s.cbo_usuario_historico_aprovacoes.children().remove(),s.cbo_situacao_historico_aprovacoes.children().remove(),s.cbo_origem_historico_aprovacoes.children().remove(),WS.get("documento/listar_aprovadores/",{documento_id:s.documento_id},function(a){for(var o=0;o<a.length;o++){var i=a[o];add_option(s.cbo_usuario_historico_aprovacoes,i.id,i.nome)}s.cbo_usuario_historico_aprovacoes.selectpicker({countSelectedText:function(a,o){return a+" usuarios selecionados"}}),s.cbo_usuario_historico_aprovacoes.selectpicker("refresh")}),add_option(s.cbo_situacao_historico_aprovacoes,GED_APROVACAO_SITUACAO.AGUARDANDO,"Aguardando"),add_option(s.cbo_situacao_historico_aprovacoes,GED_APROVACAO_SITUACAO.APROVADO,"Aprovado"),add_option(s.cbo_situacao_historico_aprovacoes,GED_APROVACAO_SITUACAO.REPROVADO,"Reprovado"),add_option(s.cbo_situacao_historico_aprovacoes,GED_APROVACAO_SITUACAO.APROVADO_POR_TERCEIRO,"Aprovado por Terceiro"),add_option(s.cbo_situacao_historico_aprovacoes,GED_APROVACAO_SITUACAO.REPROVADO,"Reprovado por Terceiro"),add_option(s.cbo_situacao_historico_aprovacoes,GED_APROVACAO_SITUACAO.AGUARDANDO_NIVEL,"Aguardando Alçada"),s.cbo_situacao_historico_aprovacoes.selectpicker({countSelectedText:function(a,o){return a+" situação selecionadas"}}),s.cbo_situacao_historico_aprovacoes.selectpicker("refresh"),add_option(s.cbo_origem_historico_aprovacoes,GED_TIPO_ORIGEM.PASTA,"Pasta"),add_option(s.cbo_origem_historico_aprovacoes,GED_TIPO_ORIGEM.DOCUMENTO,"Documento"),s.cbo_origem_historico_aprovacoes.selectpicker({countSelectedText:function(a,o){return a+" origem selecionadas"}}),s.cbo_origem_historico_aprovacoes.selectpicker("refresh")},this.listar_copia_controlada=function(){WS.get("documento_copia_controlada/listar/",{documento_id:s.documento_id,empresa_id:App.sessao.dados.empresa_filial_id},function(a){s.preencher_copia_controlada(a)})},this.preencher_copia_controlada=function(a){var o=document.createElement("div");o.className="div_listagem_documento_copia_controlada",o.style="min-width: 100%;",s.dx_listagem_documento_copia_controlada.find(".div_listagem_documento_copia_controlada").remove(),s.dx_listagem_documento_copia_controlada[0].appendChild(o);var i=detectmob()?"select":"dragAndDrop",e=[{id:DISTRIBUICAO_CONTROLADA_TIPO_COPIA.FISICA,descricao:"Cópia física"},{id:DISTRIBUICAO_CONTROLADA_TIPO_COPIA.ELETRONICA,descricao:"Cópia eletrônica"}];s.dataGrid_distribuicao_controlada=s.dx_listagem_documento_copia_controlada.find(".div_listagem_documento_copia_controlada").dxDataGrid({dataSource:a.dados,keyExpr:"id",allowColumnReordering:!0,showBorders:!0,rowAlternationEnabled:!1,searchPanel:{visible:!0,width:200,placeholder:"Pesquisa geral"},paging:{pageSize:20},pager:{showPageSizeSelector:!0,allowedPageSizes:[20,50,100],showInfo:!0},allowColumnReordering:!0,allowColumnResizing:!0,columnChooser:{enabled:!0,allowSearch:!0,mode:i},stateStoring:{enabled:!0,type:"custom",customLoad:function(a){var o=App.get_parametro_usuario("documento_copia_controlada");return s.template=o.template?o.template:"N",o},customSave:function(a){App.set_parametro_usuario("documento_copia_controlada",a)}},selection:{mode:"multiple"},export:{enabled:!0,fileName:"Relatório de distribuicao controlada"+agora(),allowExportSelectedData:!0},filterRow:{visible:!0,applyFilter:"auto"},headerFilter:{visible:!0},filterPanel:{visible:!0},sorting:{mode:"multiple"},onToolbarPreparing:function(a){var o=[{widget:"dxButton",options:{icon:"fa fa-sync",hint:"Recarregar listagem de distribuicao controlada",text:"Recarregar listagem de distribuicao controlada",onClick:function(){s.listar_copia_controlada()}},showText:"inMenu",location:"after",name:"BtnRefresh",locateInMenu:"auto"}];a.toolbarOptions.items=add_botao_dx_toolbar(o,a.toolbarOptions.items);for(var i=0;i<a.toolbarOptions.items.length;i++){var e=a.toolbarOptions.items[i];"saveButton"==e.name&&(e.visible=!1)}},onContentReady:function(a){add_filtro_cor_tema(a)},onInitNewRow:function(a){a.data.obrigatorio_comprovacao=!1},onEditorPrepared:function(a){"dataRow"==a.parentType&&("responsavel_id"==a.dataField?a.editorElement.dxSelectBox("instance").option("itemTemplate",function(a){var o=null;return"usuarios"==a.tipo?o='<span class="label lb_tipo label-info" style="margin: 5px;" tipo="usuarios" data-original-title="" title="">U</span> ':"grupo_usuarios"==a.tipo&&(o='<span class="label lb_tipo label-warning" style="margin: 5px;" tipo="grupo_usuarios" data-original-title="" title="">GU</span> '),o+a.nome}):"tipo_copia"==a.dataField&&$(a.editorElement).dxSelectBox("instance").on("valueChanged",function(o){o.value==DISTRIBUICAO_CONTROLADA_TIPO_COPIA.ELETRONICA&&(s.dataGrid_distribuicao_controlada.cellValue(a.row.rowIndex,"tipo_copia",o.value),s.dataGrid_distribuicao_controlada.cellValue(a.row.rowIndex,"local_distribuicao_id",null))}))},onEditorPreparing:function(a){"dataRow"==a.parentType&&a.row.data.tipo_copia==DISTRIBUICAO_CONTROLADA_TIPO_COPIA.ELETRONICA&&"local_distribuicao_id"==a.dataField&&(a.editorOptions.disabled=!0)},focusedRowEnabled:!1,editing:{mode:"batch",allowAdding:!0,allowDeleting:!0,allowUpdating:!0,useIcons:!0},columns:[{dataField:"tipo_copia",caption:"Tipo da Cópia",lookup:{dataSource:e,displayExpr:"descricao",valueExpr:"id"}},{dataField:"responsavel_id",caption:"Responsável",lookup:{dataSource:{store:{type:"array",data:a.usuarios,key:function(a){if(a)return a.tipo+";"+a.id+";"+a.nome}},pageSize:10,paginate:!0},valueExpr:function(a){if(a)return a.tipo+";"+a.id+";"+a.nome},displayExpr:"nome"}},{dataField:"local_distribuicao_id",caption:"Local de distribuição",lookup:{dataSource:a.locais_distribuicao,displayExpr:"nome",valueExpr:"id"}},{dataField:"obrigatorio_comprovacao",caption:"Obrigatório comprovação",dataType:"boolean"},{dataField:"dias_prazo",caption:"Prazo em dias",dataType:"number"},{type:"buttons",buttons:[{hint:"Apagar registro",icon:"fa fa-trash",visible:function(a){return!a.row.removed},cssClass:"icon_black",onClick:function(a){s.dataGrid_distribuicao_controlada.deleteRow(a.row.rowIndex)}},{hint:"Recuperar registro",icon:"fa fa-undo",visible:function(a){return a.row.removed},cssClass:"icon_black",onClick:function(a){s.dataGrid_distribuicao_controlada.undeleteRow(a.row.rowIndex)}}]}]}).dxDataGrid("instance")},this.listar_distribuicoes=function(){WS.get("documento_copia_controlada/listar/",{empresa_id:App.sessao.dados.empresa_filial_id},function(a){s.preencher_distribuicoes(a)})},this.preencher_distribuicoes=function(a){var i=document.createElement("div");i.className="div_listagem_documento_distribuicoes",i.style="min-width: 100%;",s.dx_listagem_documento_distribuicoes.find(".div_listagem_documento_distribuicoes").remove(),s.dx_listagem_documento_distribuicoes[0].appendChild(i);var e=detectmob()?"select":"dragAndDrop",t=[{id:DISTRIBUICAO_CONTROLADA_TIPO_COPIA.FISICA,descricao:"Cópia física"},{id:DISTRIBUICAO_CONTROLADA_TIPO_COPIA.ELETRONICA,descricao:"Cópia eletrônica"}],r=[{id:DISTRIBUICAO_CONTROLADA_TIPO_ACAO.ADICIONAR,descricao:"Adicionar documento"},{id:DISTRIBUICAO_CONTROLADA_TIPO_ACAO.REMOVER,descricao:"Remover documento"},{id:DISTRIBUICAO_CONTROLADA_TIPO_ACAO.CIENCIA,descricao:"Ciência"}];s.dataGrid_distribuicoes=s.dx_listagem_documento_distribuicoes.find(".div_listagem_documento_distribuicoes").dxDataGrid({dataSource:a,keyExpr:"id",allowColumnReordering:!0,showBorders:!0,rowAlternationEnabled:!1,searchPanel:{visible:!0,width:200,placeholder:"Pesquisa geral"},paging:{pageSize:20},pager:{showPageSizeSelector:!0,allowedPageSizes:[20,50,100],showInfo:!0},allowColumnReordering:!0,allowColumnResizing:!0,columnChooser:{enabled:!0,allowSearch:!0,mode:e},stateStoring:{enabled:!0,type:"custom",customLoad:function(a){var o=App.get_parametro_usuario("documento_distribuicoes");return s.template=o.template?o.template:"N",o},customSave:function(a){App.set_parametro_usuario("documento_distribuicoes",a)}},selection:{mode:"multiple"},export:{enabled:!0,fileName:"Relatório de distribuicao de documento"+agora(),allowExportSelectedData:!0},filterRow:{visible:!0,applyFilter:"auto"},headerFilter:{visible:!0},filterPanel:{visible:!0},sorting:{mode:"multiple"},onToolbarPreparing:function(a){var o=[{widget:"dxButton",options:{icon:"fa fa-sync",hint:"Recarregar listagem de distribuicao de documento",text:"Recarregar listagem de distribuicao de documento",onClick:function(){s.listar_copia_controlada()}},showText:"inMenu",location:"after",name:"BtnRefresh",locateInMenu:"auto"}];a.toolbarOptions.items=add_botao_dx_toolbar(o,a.toolbarOptions.items);for(var i=0;i<a.toolbarOptions.items.length;i++){var e=a.toolbarOptions.items[i];"saveButton"!=e.name&&"revertButton"!=e.name||(e.visible=!1)}},onContentReady:function(a){add_filtro_cor_tema(a)},editing:{useIcons:!0},columns:[{dataField:"sequencia",caption:"Revisão do documento",dataType:"number"},{dataField:"tipo_copia",caption:"Tipo da Cópia",lookup:{dataSource:t,displayExpr:"descricao",valueExpr:"id"}},{dataField:"usuario_responsavel",caption:"Usuário responsável"},{dataField:"local_distribuicao",caption:"Local de distribuição"},{dataField:"tipo_acao",caption:"Tipo da ação",lookup:{dataSource:r,displayExpr:"descricao",valueExpr:"id"}},{dataField:"confirmado",caption:"Realizado",dataType:"boolean",calculateCellValue:function(a){return"S"==a.confirmado}},{dataField:"data_prazo",caption:"Prazo",dataType:"datetime",format:"dd/MM/yyyy HH:mm"},{dataField:"data_confirmacao",caption:"Confirmação",dataType:"datetime",format:"dd/MM/yyyy HH:mm"},{dataField:"origem_distribuicao",caption:"Distribuição",lookup:{dataSource:[{id:"P",descricao:"Predefinido"},{id:"M",descricao:"Manual"}],displayExpr:"descricao",valueExpr:"id"}},{type:"buttons",buttons:[{hint:"Marcar como realizado",icon:"fa fa-check",cssClass:"icon_black",visible:function(a){return"N"==a.row.data.confirmado&&a.row.data.usuario_id==App.sessao.dados.usuario_id},onClick:function(a){alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !','<div class="alert alert-info" style="text-align: center"> <span href="#" class="alert-link"><strong>Esta ação irá marcar essa atividade como </strong>concluído,<strong> deseja continuar ?</strong></span></div><div id="file-uploader"></div>','<i class="fa fa-check" aria-hidden="true"></i> Confirmar',function(){WS.post("documento_distribuicao_controlada/marcar_realizado/",{id:a.row.data.id,documento_id:a.row.data.documento_id,documento_revisao_id:a.row.data.documento_revisao_id,documento_confirmacao_distribuicao:s.documento_confirmacao_distribuicao.props.arquivoSelecionado},function(a){var o=!0===a?"success":"error",i=!0===a?"Atividade concluída com sucesso":"Falha ao concluir a atividade";DevExpress.ui.notify.default({message:i,type:o,displayTime:3e3,width:300}),!0===a&&s.preencher()},null,null,!0)},!0),o.render(s.documento_confirmacao_distribuicao,$("#file-uploader")[0]),s.documento_confirmacao_distribuicao.props.setDesabilitado(!1)}},{hint:"Download do documento de comprovação",icon:"fa fa-download",cssClass:"icon_black",visible:function(a){return a.row.data.confirmacao_documento_revisao_id},onClick:function(a){App.obter_token_publico(function(o){App.download(WS_URI+"documento/download/?documento_revisao_id="+a.row.data.confirmacao_documento_revisao_id+"&token_publico="+o),"safari"!=getBrowser()&&s.unload()})}}]}],onRowPrepared:function(a){"data"==a.rowType&&a.data.atrasado&&"S"==a.data.atrasado&&a.rowElement.addClass("bg-danger")}}).dxDataGrid("instance")},s.cbo_usuario_historico_aprovacoes.change(function(a){var o=$(this);s.filtro_historico_aprovacoes_usuario_id=o.val(),s.render_aprovacoes(!0)}),s.cbo_situacao_historico_aprovacoes.change(function(a){var o=$(this);s.filtro_historico_aprovacoes_situacao=o.val(),s.render_aprovacoes(!0)}),s.cbo_origem_historico_aprovacoes.change(function(a){var o=$(this);s.filtro_historico_aprovacoes_origem=o.val(),s.render_aprovacoes(!0)}),s.ipt_consideracoes_historico_aprovacoes.keyup(function(a){var o=$(this);s.filtro_historico_aprovacoes_consideracoes=o.val(),s.render_aprovacoes(!0)}),s.ipt_recebimento_data.unbind("change").change(function(a){var o=$(this);s.filtro_historico_aprovacoes_recebimento_data=o.val(),s.render_aprovacoes(!0)}),s.ipt_prazo_data.unbind("change").change(function(a){var o=$(this);s.filtro_historico_aprovacoes_prazo_data=o.val(),s.render_aprovacoes(!0)}),s.ipt_acao_data.unbind("change").change(function(a){var o=$(this);s.filtro_historico_aprovacoes_acao_data=o.val(),s.render_aprovacoes(!0)}),s.ipt_nivel_historico_aprovacoes.keyup(function(a){var o=$(this);s.filtro_historico_aprovacoes_nivel=o.val(),s.render_aprovacoes(!0)}),s.ipt_revisao_historico_aprovacoes.keyup(function(a){var o=$(this);s.filtro_historico_aprovacoes_revisao=o.val(),s.render_aprovacoes(!0)}),s.chk_notificar_email_antes.change(function(a){$(this).prop("checked")?s.div_notificacao_vigencia.removeClass("hidden"):s.div_notificacao_vigencia.addClass("hidden"),1==$(this).prop("checked")||1==s.chk_notificacoes.prop("checked")?(s.chk_notificacao_seguranca.parents(".row").removeClass("hidden"),s.chk_notificacao_outros_usuarios.parents(".row").removeClass("hidden"),s.chk_notificacao_aprovador.parents(".row").removeClass("hidden")):(s.chk_notificacao_seguranca.prop("checked",!1).change().parents(".row").addClass("hidden"),s.chk_notificacao_outros_usuarios.prop("checked",!1).change().parents(".row").addClass("hidden"),s.chk_notificacao_aprovador.prop("checked",!1).change().parents(".row").addClass("hidden"))}),this.edt_validade.unbind("keyup").unbind("change"),this.edt_validade.keyup($.debounce(500,s.exibicao_validade_vigencia)),this.edt_validade.change(s.exibicao_validade_vigencia),this.cbo_validade_periodo.unbind("change"),this.cbo_validade_periodo.change(s.exibicao_validade_vigencia),this.btn_assunto_visualizar.unbind("click"),this.btn_assunto_visualizar.click(function(){""!=s.cbo_assunto.val()&&View.load("assunto/detalhes",function(a,o){o.show(s.cbo_assunto.val(),FORMULARIO.VISUALIZAR)})}),this.btn_assunto_novo.unbind("click"),this.btn_assunto_novo.click(function(){View.load("assunto/detalhes",function(a,o){o.onclose=function(){o.assunto_id&&s.listar_assunto(o.assunto_id)},o.show(null,FORMULARIO.NOVO)})}),this.btn_tipo_documento_visualizar.unbind("click"),this.btn_tipo_documento_visualizar.click(function(){""!=s.cbo_tipo_documento.val()&&View.load("tipo_documento/detalhes",function(a,o){o.show(s.cbo_tipo_documento.val(),FORMULARIO.VISUALIZAR)})}),this.btn_tipo_documento_novo.unbind("click"),this.btn_tipo_documento_novo.click(function(){View.load("tipo_documento/detalhes",function(a,o){o.onclose=function(){o.tipo_documento_id&&s.listar_tipo_documento(o.tipo_documento_id)},o.show(null,FORMULARIO.NOVO)})}),this.btn_local_armazenamento_visualizar.unbind("click"),this.btn_local_armazenamento_visualizar.click(function(){""!=s.cbo_local_armazenamento.val()&&View.load("local_armazenamento/detalhes",function(a,o){o.show(s.cbo_local_armazenamento.val(),FORMULARIO.VISUALIZAR)})}),this.btn_favoritar_item.click(function(){var a=!1,o=$(this).find("span");o.hasClass("glyphicon-star")?(o.removeClass("glyphicon-star").addClass("glyphicon-star-empty"),a=!1):(o.addClass("glyphicon-star").removeClass("glyphicon-star-empty"),a=!0),favoritar_item("documentos",s.documento_id,a)}),this.btn_local_armazenamento_novo.unbind("click"),this.btn_local_armazenamento_novo.click(function(){View.load("local_armazenamento/detalhes",function(a,o){o.onclose=function(){o.local_armazenamento_id&&s.listar_local_armazenamento(o.local_armazenamento_id)},o.show(null,FORMULARIO.NOVO)})}),this.chk_controle_acessos.unbind("change"),this.chk_controle_acessos.change(function(){$(this).prop("checked")?(s.render_usuarios(s.usuarios_array),s.div_permissoes.fadeIn()):(s.div_permissoes.fadeOut(),s.usuarios_array=s.usuarios_array?s.usuarios_array:[],s.usuarios_array=s.usuarios_array.filter(function(a){return a.usuario_id==App.sessao.usuario_id}),s.grupos_array=[],s.tab_permissoes.find("tr:gt(1)").remove(),s.tab_permissoes_grupo.find("tr:gt(1)").remove())}),this.chk_copia_controlada.unbind("change").change(function(){$(this).prop("checked")?s.elemDistribuicaoControlada.fadeIn():s.elemDistribuicaoControlada.fadeOut()}),this.btn_add_usuario.unbind("click"),this.btn_add_usuario.click(function(){View.load("usuario/selecionar",function(a,o){o.show(function(a){var o=!1;if($(s.usuarios_array).each(function(i,e){e.usuario_id==a.usuario_id&&(o=!0)}),!o){var i=!App.sessao.dados.admin&&a.usuario_id==App.sessao.dados.usuario_id;s.usuarios=a,s.usuarios.visualizacao=!!i,s.usuarios.download=!!i,s.usuarios.escrita=!!i,s.usuarios.exclusao=!!i,s.usuarios.manutencao_revisoes=!!i,s.usuarios.nova_revisao=!!i,s.usuarios.seguranca=!!i,s.usuarios.add_self=!!i,s.usuarios_array.push(s.usuarios)}s.render_usuarios(s.usuarios_array),s.obter_validacao_permissoes_retroativas()})})}),this.btn_add_grupo.unbind("click"),this.btn_add_grupo.click(function(){View.load("grupo_usuarios/selecionar",function(a,o){o.show(function(a){var o=!1;$(s.grupos_array).each(function(i,e){e.grupo_usuarios_id==a.grupo_usuarios_id&&(o=!0)}),o||(s.grupos=a,s.grupos.visualizacao=!1,s.grupos.download=!1,s.grupos.escrita=!1,s.grupos.exclusao=!1,s.grupos.manutencao_revisoes=!1,s.grupos.nova_revisao=!1,s.grupos.seguranca=!1,s.grupos_array.push(s.grupos)),s.render_grupos(s.grupos_array),s.obter_validacao_permissoes_retroativas()},MODULOS.DOCUMENTO)})}),this.inputArquivoNovoHandleAlterado=function(a){var o=s.inputArquivoNovo.props.arquivoSelecionado||null;if(o){var i=App.sessao.dados.parametro_processo.processo_padrao_nome_documento;i=i.replace("{nome_processo}",void 0===s.nome_processo?"":s.nome_processo).replace("{nome_documento}",o.name).replace("{nome_campo}",""),""==s.edt_nome.val().trim()?s.atividade_id>0?s.edt_nome.val("Atividade do Projeto #"+s.atividade_id+" - "+o.name):s.solicitacao_atividade_id>0?"S"==App.sessao.dados.parametro_processo.processo_usar_nome_padrao&&null==s.projeto_id?(i=i.replace("{solicitacao_numero}",s.solicitacao_id.toString()),s.edt_nome.val(i)):s.edt_nome.val("Solicitação #"+s.solicitacao_id+" - "+o.name):s.oportunidade_id>0?s.edt_nome.val("Oportunidade #"+s.oportunidade_id+" - "+o.name):s.edt_nome.val(o.name):alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',"O nome do documento já está definido, deseja atualiza-lo com o nome do arquivo selecionado?","Sim. Atualizar nome do documento",function(){s.atividade_id>0?s.edt_nome.val("Atividade do Projeto #"+s.atividade_id+" - "+o.name):s.solicitacao_atividade_id>0?"S"==App.sessao.dados.parametro_processo.processo_usar_nome_padrao&&null==s.projeto_id?(i=i.replace("{solicitacao_numero}",s.solicitacao_id.toString()),s.edt_nome.val(i)):s.edt_nome.val("Solicitação #"+s.solicitacao_id+" - "+o.name):s.oportunidade_id>0?s.edt_nome.val("Oportunidade #"+s.oportunidade_id+" - "+o.name):s.edt_nome.val(o.name)},!0)}},this.inputNovaRevisaoHandleAlterado=function(a){var o=s.inputNovaRevisao.props.arquivoSelecionado||null;o?s.edt_observacao_revisao.show():s.edt_observacao_revisao.hide();var i=s.edt_nome.val();o&&"N"!=s.documento_parametros.documentos_sugerir_alteracao_nome&&o.name!==i&&alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !','Deseja alterar o nome do documento de <b>"'+i+'"</b> para <b>"'+o.name+'"</b> ?',"Sim, alterar nome do documento",function(){s.edt_nome.val(o.name)},!0,"Não")},this.btn_salvar.unbind("click"),this.btn_salvar.click(function(){if(n=validateForm())alert_fail("Preencha os campos obrigatórios");else{if(s.cbo_tipo_aprovacao.val()==TIPO_APROVACAO.MANUAL){for(var a=!1,o=!1,i=[],e=s.ListarAprovadores.props.arrAprovadoresManual.length,t=0;t<e;t++){for(var r=t;r<e;r++)1==s.ListarAprovadores.props.arrAprovadoresManual[r].tipo_aprovador?t!=r&&s.ListarAprovadores.props.arrAprovadoresManual[t].usuario_id==s.ListarAprovadores.props.arrAprovadoresManual[r].usuario_id&&s.ListarAprovadores.props.arrAprovadoresManual[t].nivel==s.ListarAprovadores.props.arrAprovadoresManual[r].nivel&&(a=!0,i.push(s.ListarAprovadores.props.arrAprovadoresManual[t].aprovador_usuario_nome)):2==s.ListarAprovadores.props.arrAprovadoresManual[r].tipo_aprovador&&t!=r&&s.ListarAprovadores.props.arrAprovadoresManual[t].grupo_usuarios_id==s.ListarAprovadores.props.arrAprovadoresManual[r].grupo_usuarios_id&&s.ListarAprovadores.props.arrAprovadoresManual[t].nivel==s.ListarAprovadores.props.arrAprovadoresManual[r].nivel&&(a=!0,i.push(s.ListarAprovadores.props.arrAprovadoresManual[t].aprovador_grupo_nome));t>0&&parseInt(s.ListarAprovadores.props.arrAprovadoresManual[t].nivel)-parseInt(s.ListarAprovadores.props.arrAprovadoresManual[t-1].nivel)>1&&(o=!0)}if(1==a)return(n=new Validation).add(new ValidationMessage(Validation.CODES.ERR_FIELD,"Os itens abaixo estão duplicados: <br /><br />"+i)),alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',n),!1;if(1==o)return(n=new Validation).add(new ValidationMessage(Validation.CODES.ERR_FIELD,"Por gentileza, verifique a ordem dos niveis")),alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',n),!1;if(0==s.ListarAprovadores.props.arrAprovadoresManual.length)return(n=new Validation).add(new ValidationMessage(Validation.CODES.ERR_FIELD,"Por gentileza, informe ao menos um usuário para salvar uma alçada.")),alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',n),!1;if(1!=s.ListarAprovadores.props.arrAprovadoresManual[0].nivel)return(n=new Validation).add(new ValidationMessage(Validation.CODES.ERR_FIELD,'A alçada sempre deverá iniciar com o nivel "1" ')),alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',n),!1}else if(s.cbo_tipo_aprovacao.val()==TIPO_APROVACAO.PREDEFINIDA){var n;if(""==s.cbo_selecionar_alcada.val()||null==s.cbo_selecionar_alcada.val())return(n=new Validation).add(new ValidationMessage(Validation.CODES.ERR_FIELD,"Por gentileza, escolha ao menos uma alçada para continuar.")),alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',n),!1}var d=(new Date).toISOString().substr(0,10);""!=get_datepicker(s.edt_data_vigencia)&&get_datepicker(s.edt_data_vigencia)<d?alert_modal("Documento","A Data de Vigência deste documento está expirada. Deseja continuar?","Sim",function(){s.salvar_documento(s.btn_salvar,!1,null)},!0,"Não",null,function(){}):s.salvar_documento(s.btn_salvar,!1,null)}}),this.salvar_documento=function(a,o,i){if(!s.validar_campos_obrigatorios())return!1;var e=function(a){WS.post("documento/gerar_nova_revisao",{documento_revisao_id:a},function(a){DevExpress.ui.notify.default({message:"Revisão salva com sucesso",type:"success",displayTime:3e3,width:300}),s.preencher()})};App.is_nativo()?App.obter_token_publico(function(t){s.anexos.length>0?(s.cbo_tipo_documento.val()>0&&s.cbo_local_armazenamento.val()>0&&s.cbo_assunto.val()>0&&s.edt_nome.val()&&(s.edt_observacao_revisao.val()||s.edt_observacao_novo.val())&&a.text("Aguarde, enviando o arquivo."),s.anexos):WS.post("documento/salvar",{documento_id:s.documento_id,nome:s.edt_nome.val(),codigo:s.edt_codigo.val(),validade:s.edt_validade.val(),validade_periodo:s.cbo_validade_periodo.val(),data_vigencia:get_datepicker(s.edt_data_vigencia),observacao_documento:s.edt_observacao_novo.val(),observacao_historico_documento:s.edt_observacoes_historico.html(),observacao_revisao:s.edt_observacao_revisao.val(),assunto_id:s.cbo_assunto.val(),tipo_documento_id:s.cbo_tipo_documento.val(),local_armazenamento_id:s.cbo_local_armazenamento.val(),documento_pasta_id:s.documento_pasta_id,usuarios_permissoes:JSON.stringify(s.usuarios_array),grupos_permissoes:JSON.stringify(s.grupos_array),controle_acessos:s.chk_controle_acessos.prop("checked"),validacao_permissoes_retroativas:JSON.stringify({usuarios:s.usuarios_aplicar_permissoes_retroativas||[],grupos:s.grupos_usuarios_aplicar_permissoes_retroativas||[]}),atividade_id:s.atividade_id,projeto_id:s.projeto_id,solicitacao_id:s.solicitacao_id,solicitacao_atividade_id:s.solicitacao_atividade_id,oportunidade_id:s.oportunidade_id,tag:s.edt_tag.val(),notificar_por_email:s.chk_notificacoes.prop("checked"),notificar_por_email_antes:s.chk_notificar_email_antes.prop("checked"),notificar_por_email_antes_quem:s.cbo_notificar_email_antes_quem.val(),dias_notificacao_email:s.edt_dias_notitificacao.val(),notificar_por_usuario_seguranca:s.chk_notificacao_seguranca.prop("checked"),notificar_por_usuario_aprovador:s.chk_notificacao_aprovador.prop("checked"),emails_adicionais:JSON.stringify(s.tab_email_usuarios.arr_dados)||JSON.stringify([]),tipo_anexo:s.tipo_anexo,arrAprovadoresManual:JSON.stringify(s.ListarAprovadores.props.arrAprovadoresManual),tipo_aprovacao:s.cbo_tipo_aprovacao.val(),alcada_generica_id:s.cbo_selecionar_alcada.val(),prazo_dias:s.edt_prazo_dias.val(),utilizar_controle_distribuicao:s.chk_copia_controlada.prop("checked"),tornar_dist_pend_aprov_doc:s.chk_tornar_dist_pend_aprov_doc.prop("checked"),distribuicao_controlada:s.dataGrid_distribuicao_controlada.getController("editing").getChanges().length?CircularJSON.stringify(s.dataGrid_distribuicao_controlada.getController("editing").getChanges()):null,referencia_tabela:s.referencia_tabela,referencia_id:s.referencia_id},function(a){s.documento_pasta_id=a.id,DevExpress.ui.notify.default({message:a.nome+" salvo com sucesso",type:"success",displayTime:3e3,width:300}),void 0!==s.onsave&&s.onsave&&s.onsave(),s.houve_alteracao=!0,s.vincular_documento_pdca(s.documento_id),s.vincular_documento_tarefa_quadro_lista_cartao(s.documento_id),o?e(i):s.unload()},[s.btn_salvar],null,!0)}):((s.inputArquivoNovo.props.arquivoSelecionado||s.inputNovaRevisao.props.arquivoSelecionado)&&s.cbo_tipo_documento.val()>0&&s.cbo_local_armazenamento.val()>0&&s.cbo_assunto.val()>0&&s.edt_nome.val()&&(s.edt_observacao_revisao.val()||s.edt_observacao_novo.val())&&s.btn_salvar.text("Aguarde, enviando o arquivo."),WS.post("documento/salvar",{documento_id:s.documento_id,nome:s.edt_nome.val(),codigo:s.edt_codigo.val(),validade:s.edt_validade.val(),validade_periodo:s.cbo_validade_periodo.val(),data_vigencia:get_datepicker(s.edt_data_vigencia),observacao_documento:s.edt_observacao_novo.val(),observacao_historico_documento:s.edt_observacoes_historico.html(),observacao_revisao:s.edt_observacao_revisao.val(),assunto_id:s.cbo_assunto.val(),tipo_documento_id:s.cbo_tipo_documento.val(),local_armazenamento_id:s.cbo_local_armazenamento.val(),documento_pasta_id:s.documento_pasta_id,arquivo:o?null:s.inputArquivoNovo.props.arquivoSelecionado||s.inputNovaRevisao.props.arquivoSelecionado||null,usuarios_permissoes:JSON.stringify(s.usuarios_array),grupos_permissoes:JSON.stringify(s.grupos_array),controle_acessos:s.chk_controle_acessos.prop("checked"),validacao_permissoes_retroativas:JSON.stringify({usuarios:s.usuarios_aplicar_permissoes_retroativas||[],grupos:s.grupos_usuarios_aplicar_permissoes_retroativas||[]}),atividade_id:s.atividade_id,projeto_id:s.projeto_id,solicitacao_id:s.solicitacao_id,solicitacao_atividade_id:s.solicitacao_atividade_id,oportunidade_id:s.oportunidade_id,tag:s.edt_tag.val(),notificar_por_email:s.chk_notificacoes.prop("checked"),notificar_por_email_antes:s.chk_notificar_email_antes.prop("checked"),notificar_por_email_antes_quem:s.cbo_notificar_email_antes_quem.val(),dias_notificacao_email:s.edt_dias_notitificacao.val(),notificar_por_usuario_seguranca:s.chk_notificacao_seguranca.prop("checked"),notificar_por_usuario_aprovador:s.chk_notificacao_aprovador.prop("checked"),emails_adicionais:JSON.stringify(s.tab_email_usuarios.arr_dados)||JSON.stringify([]),versoes:JSON.stringify(s.versoes),tipo_anexo:s.tipo_anexo,arrAprovadoresManual:JSON.stringify(s.ListarAprovadores.props.arrAprovadoresManual),tipo_aprovacao:s.cbo_tipo_aprovacao.val(),alcada_generica_id:s.cbo_selecionar_alcada.val(),prazo_dias:s.edt_prazo_dias.val(),utilizar_controle_distribuicao:s.chk_copia_controlada.prop("checked"),tornar_dist_pend_aprov_doc:s.chk_tornar_dist_pend_aprov_doc.prop("checked"),distribuicao_controlada:s.dataGrid_distribuicao_controlada.getController("editing").getChanges().length?CircularJSON.stringify(s.dataGrid_distribuicao_controlada.getController("editing").getChanges()):null,referencia_tabela:s.referencia_tabela,referencia_id:s.referencia_id},function(a){s.documento_pasta_id=a.id,DevExpress.ui.notify.default({message:a.nome+" salvo com sucesso",type:"success",displayTime:3e3,width:300}),void 0!==s.onsave&&s.onsave&&s.onsave(),s.houve_alteracao=!0,s.vincular_documento_pdca(a.id),s.vincular_documento_tarefa_quadro_lista_cartao(a.id),o?e(i):s.unload()},[s.btn_salvar],null,!0))},this.distribuir_revisao=function(a){WS.post("documento/distribuir_revisao",{documento_revisao_id:a,distribuicao_controlada:s.dataGrid_distribuicao_controlada.getController("editing").getChanges().length?CircularJSON.stringify(s.dataGrid_distribuicao_controlada.getController("editing").getChanges()):null},function(a){DevExpress.ui.notify.default({message:"Distribuição Manual realizado com sucesso!",type:"success",displayTime:3e3,width:300}),s.preencher(),s.listar_copia_controlada()})},this.pesquisar_email=function(a){var o=s.tab_email_usuarios.input.val(),i=0,e=function(a){s.tab_email_usuarios.bp_drop.parent().attr("data-visible","true");var o=function(){var a=$(this).attr("data-email");s.tab_email_usuarios.input.val(a),s.tab_email_usuarios.btn_add.trigger("click"),s.tab_email_usuarios.bp_drop.parent().attr("data-visible","false")};s.tab_email_usuarios.bp_drop.append($('<li class="li_click '+(0==i?"active":"")+'" data-email="'+a.email+'" data-selecionado="'+(0==i)+'">'+a.nome+" [ "+a.email+" ]</li>").click(o).mousedown(o)),i++};a.which!=KEYPRESS_PADRAO.KEYUP&&a.which!=KEYPRESS_PADRAO.KEYDOWN&&a.which!=KEYPRESS_PADRAO.ENTER&&WS.get("usuario/listar/",{nome:o},function(a){s.tab_email_usuarios.bp_drop.find("li:not([template-row])").remove();for(var o=0;o<a.length;o++){var i=a[o];e(i)}})},this.vincular_documento_pdca=function(a){if(void 0!==s.pdca_atividade_id&&s.pdca_atividade_id>0){var o={documento_id:a,pdca_id:s.pdca_id,pdca_atividade_id:s.pdca_atividade_id};WS.post("documento/vincular_pdca_atividade_documento/",o,function(a){},[])}},this.vincular_documento_tarefa_quadro_lista_cartao=function(a){if(s.tarefa_quadro_lista_cartao_id){var o={documento_id:a,tarefa_quadro_lista_cartao_id:s.tarefa_quadro_lista_cartao_id};WS.post("documento/vincular_tarefa_quadro_lista_cartao_documento/",o,function(a){})}},this.evento_hover_li=function(a,o){var i=$(o).find(".active");a==KEYPRESS_PADRAO.KEYUP?$(i).prev().length>0&&($(o).find(".active").removeClass("active").removeAttr("data-selecionado",!1),$(i).prev().addClass("active").attr("data-selecionado",!0)):a==KEYPRESS_PADRAO.KEYDOWN?$(i).next().length>0&&($(o).find(".active").removeClass("active").attr("data-selecionado",!1),$(i).next().addClass("active").attr("data-selecionado",!0)):a==KEYPRESS_PADRAO.ENTER&&($(o).find(".active").length>0?($(o).find(".active").trigger("click"),s.tab_email_usuarios.bp_drop.find("li:not([template-row])").remove()):s.tab_email_usuarios.btn_add.trigger("click"),s.tab_email_usuarios.bp_drop.parent().attr("data-visible","false"))},this.renderizar_dx_selecao_pasta=function(a){a&&(a=a.toString()),ReactDOM.render(React.createElement(window.components.SelecaoPasta.default,{selecionado:a,aoAlterar(a){s.documento_pasta_id=a},readOnly:s.tipo==FORMULARIO.VISUALIZAR}),s.dx_selecao_pasta[0])},this.validar_campos_obrigatorios=function(){let a=[];return null!==s.edt_nome.val()&&""!==s.edt_nome.val().trim()||a.push("- Informe o nome do documento."),null!==s.cbo_assunto.val()&&""!==s.cbo_assunto.val().trim()||a.push("- Informe o assunto do documento."),null!==s.cbo_tipo_documento.val()&&""!==s.cbo_tipo_documento.val().trim()||a.push("- Informe o tipo do documento."),null!==s.cbo_local_armazenamento.val()&&""!==s.cbo_local_armazenamento.val().trim()||a.push("- Informe o local de armazenamento do documento."),!a.length||(alertaPopUp("Validação",`Preencha os campos obrigatórios antes de continuar:<br><br>${a.join("<br>")}`),!1)},this.chk_notificacoes.unbind("change").change(function(){1==$(this).prop("checked")||1==s.chk_notificar_email_antes.prop("checked")?(s.chk_notificacao_seguranca.parents(".row").removeClass("hidden"),s.chk_notificacao_outros_usuarios.parents(".row").removeClass("hidden"),s.chk_notificacao_aprovador.parents(".row").removeClass("hidden")):(s.chk_notificacao_seguranca.prop("checked",!1).change().parents(".row").addClass("hidden"),s.chk_notificacao_outros_usuarios.prop("checked",!1).change().parents(".row").addClass("hidden"),s.chk_notificacao_aprovador.prop("checked",!1).change().parents(".row").addClass("hidden"))}),this.chk_notificacao_outros_usuarios.unbind("change").change(function(){1==$(this).prop("checked")?s.div_emails_adicionais.removeClass("hidden"):s.div_emails_adicionais.addClass("hidden"),s.tab_email_usuarios.reset()}),this.tab_email_usuarios.btn_add.unbind("click").click(function(a){var o=parseInt(s.tab_email_usuarios.elem_key,10)+1;s.tab_email_usuarios.elem_key=o;var i=s.tab_email_usuarios.input.val(),e={elem_key:o,email:i};s.tab_email_usuarios.add_email(e,function(a){if(a){var t=s.tab_email_usuarios.create_row(i);t.attr("data-id",o),s.tab_email_usuarios.getColumn(t,"btn_remover_email").unbind("click").click(function(a){var o=$(this),i=$(o).parents("tr");$(i).remove(),s.tab_email_usuarios.remove_email(e.elem_key)}),s.tab_email_usuarios.input.val("")}})}),this.tab_email_usuarios.input.unbind("focusout").focusout(function(){s.tab_email_usuarios.bp_drop.parent().attr("data-visible","false")}),this.tab_email_usuarios.input.unbind("keyup").keyup($.debounce(200,s.pesquisar_email)),this.tab_email_usuarios.input.keyup(function(a){s.evento_hover_li(a.which,s.tab_email_usuarios.bp_drop)}),this.cbo_tipo_aprovacao.unbind("change"),this.cbo_tipo_aprovacao.change(function(){if(2==s.cbo_tipo_aprovacao.val())s.div_tipo_aprovacao.removeClass("col-sm-12 col-md-6").addClass("col-sm-8 col-md-4"),s.div_edt_prazo_dias.removeClass("hidden"),s.div_cbo_selecionar_alcada.removeClass("hidden"),s.div_cbo_aprovador.addClass("hidden"),s.listar_alcada(),s.ListarAprovadores.props.setAprovadoresManual(null);else if(1==s.cbo_tipo_aprovacao.val()){s.div_tipo_aprovacao.removeClass("col-sm-12 col-md-6").addClass("col-sm-8 col-md-4"),s.div_edt_prazo_dias.removeClass("hidden"),s.div_cbo_selecionar_alcada.addClass("hidden"),s.div_cbo_aprovador.removeClass("hidden"),s.ListarAprovadores.props.setAlcadaSelecionada(null),s.ListarAprovadores.props.setDocumentoSelecionado(parseInt(s.documento_id));var a=s.cbo_aprovador.parent();s.edt_aprovador=a.find(".edt_combobox"),s.edt_aprovador.keypress(function(a){if(13==a.keyCode){var o=s.cbo_aprovador.parent().find(".ncbo_scroll").find(".row_selected"),i=o.attr("dados-adicionais")?JSON.parse(o.attr("dados-adicionais")):null;s.ListarAprovadores.props.setAprovadoresManual(i),s.cbo_aprovador.parent().find(".edt_combobox").val(""),o.removeClass("row_selected")}})}else s.div_tipo_aprovacao.removeClass("col-sm-8 col-md-4").addClass("col-sm-12 col-md-6"),s.div_edt_prazo_dias.addClass("hidden"),s.div_cbo_selecionar_alcada.addClass("hidden"),s.div_cbo_aprovador.addClass("hidden"),s.ListarAprovadores.props.setAlcadaSelecionada(null),s.ListarAprovadores.props.setAprovadoresManual(null)}),this.cbo_selecionar_alcada.unbind("change"),this.cbo_selecionar_alcada.change(function(){s.ListarAprovadores.props.setAlcadaSelecionada(parseInt($(this).val()))}),this.btn_carregar_mais_aprovacoes.unbind("click").click(function(){if(s.param_todos_carregados_aprovacoes)return!1;s.btn_carregar_mais_aprovacoes.find("span.txt_carregar_mais").text(App.lang.btn_carregar_mais.aguarde),s.btn_carregar_mais_aprovacoes.find("span.icn_carregar_mais").remove(),s.btn_carregar_mais_aprovacoes.append('<span class="icn_carregar_mais fa fa-spinner fa-spin"></span>'),s.param_inicial_aprovacoes=s.param_inicial_aprovacoes+s.param_qtde_aprovacoes,s.render_aprovacoes(!1)}),this.btn_aprovacoes_historico.unbind("click").click(function(){s.btn_aprovacoes_configuracoes.removeClass("active"),s.btn_aprovacoes_historico.addClass("active"),s.aprovacoes_configuracoes.hide(),s.aprovacoes_historico.fadeIn()}),this.btn_aprovacoes_configuracoes.unbind("click").click(function(){s.btn_aprovacoes_historico.removeClass("active"),s.btn_aprovacoes_configuracoes.addClass("active"),s.aprovacoes_historico.hide(),s.aprovacoes_configuracoes.fadeIn()}),this.btn_distribuicoes_historico.unbind("click").click(function(){s.btn_distribuicoes_configuracoes.removeClass("active"),s.btn_distribuicoes_historico.addClass("active"),s.distribuicoes_configuracoes.hide(),s.distribuicoes_historico.fadeIn()}),this.btn_distribuicoes_configuracoes.unbind("click").click(function(){s.btn_distribuicoes_historico.removeClass("active"),s.btn_distribuicoes_configuracoes.addClass("active"),s.distribuicoes_historico.hide(),s.distribuicoes_configuracoes.fadeIn()}),this.menu_referencias.unbind("click").click(function(){s.menu_referencias.parent().hasClass("active")||(ReactDOM.unmountComponentAtNode(s.div_componente_referencias[0]),ReactDOM.render(React.createElement(window.components.Referencias.default,{tabela:"documento",id:s.documento_id}),s.div_componente_referencias[0]))}),this.obter_validacao_permissoes_retroativas=(()=>{if(!s.documento_pasta_id)return!1;WS.post("documento_pasta/verificar_permissoes_retroativas/",{documento_pasta_id:s.documento_pasta_id,usuarios_permissoes:JSON.stringify(s.usuarios_array),grupos_permissoes:JSON.stringify(s.grupos_array)},a=>{s.validacao_permissoes_retroativas=a,s.render_usuarios(),s.render_grupos()})}),this.configurar_popup_validacao_permissoes_retroativas=((a,o,i="U",e,t)=>{s.popup_validacao_permissoes_retroativas=s.dx_popup_validacao_permissoes_retroativas.dxPopup({contentTemplate:function(){var a=!0,r='<div class="text-left" style="min-width: 300px;">Sem permissão de acesso à(s) pasta(s) predecessora(s):<br><ul>';o.map(o=>{var i="";!1===o.permissao_seguranca_usuario_logado&&(a=!1,i=' <span class="text-danger">(você não possui permissão de segurança nesta pasta)</span>'),r+="<li><b>"+o.path+"</b>"+i+"</li>"}),r+="</ul>";const n=$("<div>").dxCheckBox({value:"G"===i?s.grupos_usuarios_aplicar_permissoes_retroativas.includes(e):s.usuarios_aplicar_permissoes_retroativas.includes(e),text:"Adicionar o "+("G"===i?"grupo de usuários":"usuário")+" às permissões de visualização das pastas citadas acima?",disabled:!a,onValueChanged:a=>{if(a.value)t.includes(e)||t.push(e);else{const a=t.indexOf(e);a>=0&&t.splice(a,1)}}});return $("<div>").append(r,n)},container:s.painel_seguranca,showTitle:!0,title:a,visible:!1,dragEnabled:!1,hideOnOutsideClick:!0,showCloseButton:!0,toolbarItems:[{widget:"dxButton",toolbar:"bottom",location:"after",options:{text:"Ok",onClick(){s.popup_validacao_permissoes_retroativas.dxPopup("instance").hide()}}}],onHidden(){s.render_usuarios(),s.render_grupos()}}),s.popup_validacao_permissoes_retroativas.dxPopup("instance").show()})}});