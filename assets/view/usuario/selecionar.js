define([],function(){return function(i){"use strict";var t=this;this.html_id=i,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.onselect=null,this.onclose=null,this.tab_listagem=this.dialog.find(".tab_listagem"),this.edt_nome=this.dialog.find(".edt_nome"),this.edt_email=this.dialog.find(".edt_email"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.modal_chk_admin=this.dialog.find(".modal_chk_admin"),this.modal_chk_analista=this.dialog.find(".modal_chk_analista"),this.modal_chk_cliente=this.dialog.find(".modal_chk_cliente"),this.modal_chk_fornecedor=this.dialog.find(".modal_chk_fornecedor"),this.usuario_id=null,this.arr_usuarios=[],this.show=function(i){t.onselect=i,alertaPopUp({titulo:"Selecionar UsuÃ¡rios",conteudo:(i,a)=>{setTimeout(()=>{t.popup=a,t.dialog.css("padding","0px"),i.replaceWith(t.dialog),t.dialog.closest(".dx-popup-content").css("padding","0px")})},largura:"calc(100% - 20px)",larguraMinima:"300px",larguraMaxima:"800px",botaoConfirmarTexto:null,botaoCancelarTexto:"Fechar"}),t.modal_chk_admin.prop("checked",!0),t.modal_chk_analista.prop("checked",!0),set_focus(t.edt_nome),t.listar()},this.close=function(){close_modal(t.modal.attr("id")),void 0!==t.onclose&&t.onclose&&t.onclose()},this.unload=function(){t.close(),View.unload(this.html_id),t.popup.hide()},this.listar=function(){t.arr_usuarios=[];var i="";t.modal_chk_analista.prop("checked")&&(i+="2,"),t.modal_chk_cliente.prop("checked")&&(i+="1,"),t.modal_chk_fornecedor.prop("checked")&&(i+="4,"),i=i.substr(0,i.length-1),""!=t.edt_nome.val().trim()||""!=t.edt_email.val().trim()?WS.get("usuario/listar/",{nome:t.edt_nome.val(),email:t.edt_email.val(),tipo_usuario:i,admin:t.modal_chk_admin.prop("checked")?"S":"N"},function(i){t.arr_usuarios=i,t.render_lista()}):t.render_lista()},this.render_lista=function(){var i=t.tab_listagem.find("tbody"),a=i.find("tr:first");t.tab_listagem.find("tr:gt(1)").remove(),$(t.arr_usuarios).each(function(e,o){!function(e){var o=a.clone();o.removeAttr("template-row"),o.css("display",""),$(o.find("[template-field='nome']")).text(e.nome),$(o.find("[template-field='email']")).text(e.email),$(o.find("[template-field='tipo_descricao']")).text(e.tipo_descricao),$(o.find("[template-field='bloqueado']")).html(str_yes_no(e.bloqueado));var n=$(o.find(".btn_visualizar"));n.unbind("click"),n.click(function(){View.load("usuario/detalhes",function(i,t){t.show(e.usuario_id,FORMULARIO.VISUALIZAR)})});var l=$(o.find(".btn_selecionar")),d=function(){t.onselect(e),t.unload()};l.unbind("click"),l.click(d),o.dblclick(d);var c=$(o.find(".btn_excluir"));c.unbind("click"),c.click(function(){View.load("usuario/detalhes",function(i,a){a.onclose=t.listar,a.show(e.usuario_id,FORMULARIO.EXCLUIR)})}),o.appendTo(i)}(o)})},this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){t.unload()}),this.edt_nome.unbind("keyup"),this.edt_nome.keyup($.debounce(500,t.listar)),this.edt_email.unbind("keyup"),this.edt_email.keyup($.debounce(500,t.listar)),this.modal_chk_admin.change(function(){t.listar()}),this.modal_chk_analista.change(function(){t.listar()}),this.modal_chk_cliente.change(function(){t.listar()}),this.modal_chk_fornecedor.change(function(){t.listar()})}});