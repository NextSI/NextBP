define([],function(){return function(e){"use strict";var a=this;this.html_id=e,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title="Gráficos",this.tipo=null,this.onclose=null,this.onsave=null,this.profit_ability=this.dialog.find(".profit_ability"),this.nine_box=this.dialog.find(".nine_box"),this.cbo_versao=this.dialog.find(".cbo_versao"),this.kpi=this.dialog.find(".kpi"),this.responsabilidade=this.dialog.find(".responsabilidade"),this.competencia=this.dialog.find(".competencia"),this.comparar=this.dialog.find(".comparar"),this.ae_desejado=this.dialog.find(".ae_desejado"),this.ae_atual=this.dialog.find(".ae_atual"),this.ce_atual=this.dialog.find(".ce_atual"),this.ce_desejado=this.dialog.find(".ce_desejado"),this.area_id=null,this.efetividade_atuacao=0,this.efetividade_competencias=0,this.desejado_atuacao_efetiva=0,this.desejado_competencias_essenciais=0,this.responsabilidade_id=0,this.atuacao_efetiva_id=0,this.id_versao="",this.show=function(e,t,i){a.responsabilidade_id=t,a.atuacao_efetiva_id=i,1!=App.sessao.dados.admin&&"S"!=App.sessao.dados.supervisor_empenho||(a.nine_box.removeClass("hidden"),a.comparar.removeClass("hidden")),WS.get("competencias_essenciais/gerar_graficos/",{responsabilidade_id:t,atuacao_efetiva_id:i},function(e){if(e.length>0)a.kpi.text(e[0].nome),a.responsabilidade.text(e[0].descricao),a.ae_desejado.text(e[0].desejado_atuacao),a.ae_atual.text(e[0].efetividade_atuacao),a.ce_atual.text(e[0].efetividade_competencias),a.ce_desejado.text(e[0].desejado_competencias),$.each(e,function(e,t){var i={efetividade_atuacao:t.efetividade_atuacao,efetividade_competencias:t.efetividade_competencias,desejado_atuacao_efetiva:t.desejado_atuacao,desejado_competencias_essenciais:t.desejado_competencias,versao:t.versao_controle};if(0==e)a.gera_grafico(i,$(".grafico_nine_box")),a.gera_grafico(i,$(".grafico_profit_ability"));else{var o="N. #"+t.versao_base+" - Ver. #"+t.versao_controle;add_option(a.cbo_versao,t.competencias_essenciais_id,o)}}),a.cbo_versao.selectpicker("refresh");else{var t=new Validation;t.add(new ValidationMessage(Validation.CODES.ERR_FIELD,"Dados insuficientes para gerar o gráfico")),alert_modal("Validação",t),a.unload()}})},a.cbo_versao.change(function(e){$.each($.find("[versao]"),function(e,a){1!=$(a).attr("versao")&&a.remove()}),$(this).val()>0&&WS.get("competencias_essenciais/gerar_graficos/",{competencias_essenciais_id:$(this).val(),responsabilidade_id:a.responsabilidade_id,atuacao_efetiva_id:a.atuacao_efetiva_id},function(e){var t=e[0];$.each($.find("[versao='"+t.versao_controle+"']"),function(e,a){a.remove()});var i={efetividade_atuacao:t.efetividade_atuacao,efetividade_competencias:t.efetividade_competencias,desejado_atuacao_efetiva:t.desejado_atuacao,desejado_competencias_essenciais:t.desejado_competencias,versao:t.versao_controle};a.gera_grafico(i,$(".grafico_nine_box")),a.gera_grafico(i,$(".grafico_profit_ability"))})}),this.gera_grafico=function(e,a){var t=420,i=e.efetividade_atuacao,o=e.efetividade_competencias,s=e.desejado_atuacao_efetiva,d=e.desejado_competencias_essenciais,c=i/100*400,n=o/100*420,r=s/100*400,l=d/100*420;c=t-c,n=90+n,r=t-r,l=90+l;var _=a,p=_.find("[template-pontos]"),f=_.find("[template-pontos]").find(".ponto_atual").clone(),v=_.find("[template-pontos]").find(".ponto_desejado").clone();p.removeAttr("template-pontos"),f.css("display","").attr("versao",e.versao),v.css("display","").attr("versao",e.versao),f.attr({cx:Math.ceil(n),cy:Math.ceil(c)}),v.attr({cx:Math.ceil(l),cy:Math.ceil(r)}),f.appendTo(p),v.appendTo(p);var h=_.find("[template-ae-desejado]").clone(),m=_.find("[template-ae-atual]").clone(),u=_.find("[template-ce-desejado]").clone(),g=_.find("[template-ce-atual]").clone();h.removeAttr("template-ae-desejado").attr("versao",e.versao).css("display",""),m.removeAttr("template-ae-atual").attr("versao",e.versao).css("display",""),u.removeAttr("template-ce-desejado").attr("versao",e.versao).css("display",""),g.removeAttr("template-ce-atual").attr("versao",e.versao).css("display",""),h.attr({"font-size":15,x:l,y:r-20}).text("AE: "+s+"%"),u.attr({"font-size":15,x:l,y:r-8}).text("CE: "+d+"%"),m.attr({"font-size":15,x:n+55,y:c+15}).text("AE: "+i+"%"),g.attr({"font-size":15,x:n+55,y:c+25}).text("CE: "+o+"%");var j=_.find("[template-fundo-atual]").clone(),y=_.find("[template-fundo-desejado]").clone();j.removeAttr("template-fundo-atual").attr("versao",e.versao).css("display",""),y.removeAttr("template-fundo-desejado").attr("versao",e.versao).css("display",""),j.attr({x:n,y:c}),y.attr({x:l-55,y:r-35});var x=_.find("[template-linha-competencia-atual]").clone(),b=_.find("[template-linha-atuacao-atual]").clone(),M=_.find("[template-linha-competencia-desejado]").clone(),A=_.find("[template-linha-atuacao-desejado]").clone();x.removeAttr("template-linha-competencia-atual").attr("versao",e.versao).css("display",""),b.removeAttr("template-linha-atuacao-atual").attr("versao",e.versao).css("display",""),M.removeAttr("template-linha-competencia-desejado").attr("versao",e.versao).css("display",""),A.removeAttr("template-linha-atuacao-desejado").attr("versao",e.versao).css("display",""),x.attr({x1:90,x2:Math.ceil(n),y1:Math.ceil(c),y2:Math.ceil(c),stroke:"red"}),b.attr({x1:Math.ceil(n),x2:Math.ceil(n),y1:t,y2:Math.ceil(c),stroke:"red"}),M.attr({x1:90,x2:Math.ceil(l),y1:Math.ceil(r),y2:Math.ceil(r),stroke:"blue"}),A.attr({x1:Math.ceil(l),x2:Math.ceil(l),y1:t,y2:Math.ceil(r),stroke:"blue"}),_.find(".content_data").append(j,y,x,b,M,A,h,m,u,g)},this.unload=function(){a.close(),View.unload(this.html_id)},this.close=function(){close_modal(a.modal.attr("id")),void 0!==a.onclose&&a.onclose&&a.onclose(this.fechar_janela_pai)}}});