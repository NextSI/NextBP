"use strict";define(["react","react-dom"],function(e,a){class t extends e.Component{constructor(e){super(e),this.state={arrAprovadores:{},arrAprovadoresManual:[],documento_id:0,documento_pasta_id:0},this.handleDeletarLinha=this.handleDeletarLinha.bind(this),this.handleAlterarNivel=this.handleAlterarNivel.bind(this),this.handleAlterarTipoAprovacao=this.handleAlterarTipoAprovacao.bind(this),this.props.arrAprovadores=[],this.props.arrAprovadoresManual=[],this.props.setAlcadaSelecionada=e=>{this.listar_aprovadores_predefinida(e,!1)},this.props.setDocumentoPastaSelecionada=e=>{this.setState({documento_pasta_id:e}),this.listar_aprovadores_manual(e)},this.props.setDocumentoSelecionado=e=>{this.setState({documento_id:e}),this.listar_aprovadores_manual_documento(e)},this.props.setAprovadoresManual=e=>{if(null==e)this.setState({arrAprovadoresManual:[]});else if("usuarios"==e.tipo){let a={},t=this.state.arrAprovadoresManual.length;a.usuario_id=e.id,a.aprovador_usuario_nome=e.nome,a.nivel=0==t?"1":parseInt(this.state.arrAprovadoresManual[t-1].nivel),a.tipo_aprovacao="2",a.tipo_aprovador=TIPO_APROVADOR.USUARIO;let r=this.state.arrAprovadoresManual.slice();r.push(a),this.setState({arrAprovadoresManual:r})}else if("grupo_usuarios"==e.tipo){let a={};a.grupo_usuarios_id=e.id,a.aprovador_grupo_nome=e.nome,a.nivel="1",a.tipo_aprovacao="2",a.tipo_aprovador=TIPO_APROVADOR.GRUPO_USUARIOS;let t=this.state.arrAprovadoresManual.slice();t.push(a),this.setState({arrAprovadoresManual:t})}else if("alcada_generica"==e.tipo){let a=this;this.state.arrAprovadores.length||this.state.arrAprovadoresManual.length?alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',"Esta ação irá limpar os aprovadores selecionados, deseja continuar ?","Sim",function(){a.state.arrAprovadores.length&&a.setState({arrAprovadores:[]}),a.state.arrAprovadoresManual.length&&a.setState({arrAprovadoresManual:[]}),a.listar_aprovadores_predefinida(e.id,!0)},!0):a.listar_aprovadores_predefinida(e.id,!0)}}}listar_aprovadores_predefinida(e,a){let t=this;null==e?t.setState({arrAprovadores:[]}):WS.get("alcada_aprovadores/objeto/",{alcada_generica_id:e},function(e){if(null!==e)if(a){let a=t.state.arrAprovadoresManual.slice();e.aprovadores.forEach(function(t){t.tipo_aprovador=null!=t.usuario_id?TIPO_APROVADOR.USUARIO:TIPO_APROVADOR.GRUPO_USUARIOS,t.nome_alcada_predefinida=e.nome_alcada_generica,a.push(t)},this),t.setState({arrAprovadoresManual:a})}else t.setState({arrAprovadores:e})})}listar_aprovadores_manual(e){let a=this;null==e?a.setState({arrAprovadoresManual:[]}):WS.get("alcada_aprovadores/listar_aprovadores_manual/",{documento_pasta_id:e},function(e){e&&(e.forEach(function(e){1==e.tipo_aprovador?(delete e.grupo_usuario_id,delete e.aprovador_grupo_nome):2==e.tipo_aprovador&&(delete e.usuario_id,delete e.aprovador_usuario_nome)},this),a.setState({arrAprovadoresManual:e}))})}listar_aprovadores_manual_documento(e){let a=this;null==e?a.setState({arrAprovadoresManual:[]}):WS.get("alcada_aprovadores/listar_aprovadores_manual_documento/",{documento_id:e},function(e){e&&(e.forEach(function(e){1==e.tipo_aprovador?(delete e.grupo_usuario_id,delete e.aprovador_grupo_nome):2==e.tipo_aprovador&&(delete e.usuario_id,delete e.aprovador_usuario_nome)},this),a.setState({arrAprovadoresManual:e}))})}OrdenarVetor(){this.setState({arrAprovadoresManual:this.state.arrAprovadoresManual.sort(function(e,a){var t=e.nivel,r=a.nivel;return parseInt(t)<parseInt(r)?-1:parseInt(t)>parseInt(r)?1:0})})}handleAlterarNivel(e,a){e.nivel=a.target.value,this.OrdenarVetor()}handleAlterarTipoAprovacao(e,a){e.tipo_aprovacao=a.target.value}handleDeletarLinha(e,a){var t=this,r={usuario_id:a.usuario_id,documento_id:this.state.documento_id,documento_pasta_id:this.state.documento_pasta_id,grupo_usuario_id:a.grupo_usuarios_id};WS.get("documento/verifica_aprovador/",r,function(r){if(r.length>0){var o="";if(a.usuario_id>0)o="Usuário não pode ser removido, pois, tem aprovação pendente.";else if(a.grupo_usuarios_id>0){var l=[];r.forEach(function(e){l.push(e.nome)}),o="Grupo não pode ser removido, pois, existe um ou mais usuários com aprovação pendente: ["+l.join(", ")+"]"}alert_modal("Aprovador",o)}else t.state.arrAprovadoresManual.splice(e,1),t.OrdenarVetor()})}render(){this.props.arrAprovadores=this.state.arrAprovadores,this.props.arrAprovadoresManual=this.state.arrAprovadoresManual;let a=[],t=[];if(Object.keys(this.state.arrAprovadores).length)$(this.state.arrAprovadores.aprovadores).each(function(t,r){a.push(e.createElement("tr",{"template-row":!0,style:{cursor:"not-allowed",opacity:"0.5"},key:"Aprovadores"+t},e.createElement("td",{style:{width:"10%"},key:r.nivel},e.createElement("input",{type:"number","template-field":"nivel",className:"form-control edt_nivel",value:r.nivel,style:{pointerEvents:"none"}})),e.createElement("td",{style:{fontSize:"12px"}},e.createElement("span",{"template-field":"label_tipo",className:"label "+(null!=r.aprovador_usuario_nome?"label-info":"label-warning"),style:{verticalAlign:"middle"}},null!=r.aprovador_usuario_nome?"U":"GU")," ",e.createElement("span",{"template-field":"aprovador",style:{verticalAlign:"middle"}},null!=r.aprovador_usuario_nome?r.aprovador_usuario_nome:r.aprovador_grupo_nome)),e.createElement("td",null,e.createElement("select",{"template-field":"tipo_aprovacao",className:"form-control",value:r.tipo_aprovacao,style:{pointerEvents:"none"}},e.createElement("option",{value:"1"},"Apenas um usuário"),e.createElement("option",{value:"2"},"Todos os usuários")))))}),t.push(e.createElement("tr",null,e.createElement("td",null,"Nível"),e.createElement("td",null,"Aprovador"),e.createElement("td",null,"Tipo de aprovação")));else if(Object.keys(this.state.arrAprovadoresManual).length){let r=this;$(this.state.arrAprovadoresManual).each(function(t,o){let l=md5(Math.random()+new Date+Math.random()+md5(Math.random()));a.push(e.createElement("tr",{"template-row":!0,key:"AprovadoresManual"+l},e.createElement("td",{style:{width:"10%"}},e.createElement("input",{type:"number","template-field":"nivel",className:"form-control edt_nivel",defaultValue:o.nivel,onChangeCapture:()=>r.handleAlterarNivel(this,event)})),e.createElement("td",{style:null!=o.nome_alcada_predefinida?{fontSize:"12px"}:{fontSize:"initial"}},null!=o.nome_alcada_predefinida?e.createElement("div",null,e.createElement("span",{"template-field":"alcada_predefinida",className:"label label-danger",style:{verticalAlign:"middle"}},"AP")," ",e.createElement("span",{"template-field":"alcada_predefinida_nome",style:{verticalAlign:"middle"}},o.nome_alcada_predefinida)):"",e.createElement("span",{"template-field":"label_tipo",className:"label "+(null!=o.aprovador_usuario_nome?"label-info":"label-warning"),style:{verticalAlign:"middle"}},null!=o.aprovador_usuario_nome?"U":"GU")," ",e.createElement("span",{"template-field":"aprovador",style:{verticalAlign:"middle"}},null!=o.aprovador_usuario_nome?o.aprovador_usuario_nome:o.aprovador_grupo_nome)),e.createElement("td",null,e.createElement("select",{"template-field":"tipo_aprovacao",className:"form-control",defaultValue:o.tipo_aprovacao,onChangeCapture:()=>r.handleAlterarTipoAprovacao(this,event)},e.createElement("option",{value:"1"},"Apenas um usuário"),e.createElement("option",{value:"2"},"Todos os usuários"))),e.createElement("td",null,e.createElement("button",{type:"button",className:"btn btn-default btn_remover_aprovador pull-right",onClick:()=>r.handleDeletarLinha(t,this)},e.createElement("span",{className:"glyphicon glyphicon-trash"}),e.createElement("span",{className:"hidden-xs"},"Remover")))))}),t.push(e.createElement("tr",null,e.createElement("td",null,"Nível"),e.createElement("td",null,"Aprovador"),e.createElement("td",null,"Tipo de aprovação"),e.createElement("td",null," ")))}return(0!=this.state.arrAprovadores.length||0!=this.state.arrAprovadoresManual.length)&&e.createElement("div",{className:"row"},e.createElement("table",{className:"tab_listagem table table-striped table-hover"},e.createElement("thead",null,t),e.createElement("tbody",null,a)))}}return t});